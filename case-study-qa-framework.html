<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f0f0f0" id="theme-color-meta">
    <title>Case Study - Quality Assurance Framework</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollToPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollSmoother.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/Draggable.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
      <script src="global-clock-component.js"></script>
    <style>
        @font-face {
            font-family: 'Unica77LL';
            src: url('Unica77LLWeb-Medium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
        }

        @font-face {
            font-family: 'Input';
            src: url('https://github.com/amachinic/Merem/raw/main/Input-Regular_(InputSansNarrow-Light).ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
        }

        :root {
            /* ===== UNIFIED DESIGN SYSTEM ===== */
            /* Background & Surface Colors */
            --bg-color: #f0f0f0;
            --surface-color: #ffffff;
            --surface-secondary: #f8f9fa;
            --surface-accent: #f3f4f6;
            
            /* Text Colors */
            --text-color: #333333;
            --text-secondary: #8d8d8d;
            --text-muted: #6b7280;
            
            /* Border & Stroke Colors */
            --border-color: rgba(0, 0, 0, 0.1);
            --border-hover: rgba(0, 0, 0, 0.15);
            --border-focus: rgba(0, 0, 0, 0.2);
            
            /* Shadow Colors */
            --shadow-light: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --shadow-strong: rgba(0, 0, 0, 0.16);
            
            /* Component Specific */
            --card-bg-color: #1a1a1a;
            --card-text-color: #ffffff;
            --interactive-bg: rgba(0, 0, 0, 0.05);
            --interactive-hover: rgba(0, 0, 0, 0.08);
            
            /* Typography */
            --font-size-body: 1.125rem; /* 18px base body size */
            --line-height-body: 1.6;

            /* Link Colors */
            --link-color: #0066cc;
            --link-hover: #004499;
            
            /* Legacy Support */
            --secondary-text-color: #8d8d8d;
            --nav-bg-color: rgba(255, 255, 255, 0.15);
            --nav-border-color: rgba(255, 255, 255, 0.2);
            --nav-hover-color: rgba(0, 0, 0, 0.08);
            --clock-bg-color: #f0f0f0;
            --tooltip-bg-color: white;
            --tooltip-text-color: black;
            --shadow-color: rgba(0, 0, 0, 0.12);
            --toggle-border-color: rgba(0, 0, 0, 0.3);
            --light-nav-border-color: rgba(0, 0, 0, 0.15);
            
            /* Design System: Case Study Color Palette */
            --case-study-qa-framework: rgb(0, 5, 11); /* Obsidian */
            --case-study-design-system: rgb(8, 0, 11); /* Violet */
            --case-study-mobile-experience: rgb(0, 10, 5); /* Forest green */
            --case-study-ai-integration: rgb(14, 6, 0); /* Rouge */
        }

        [data-theme="dark"] {
            /* ===== UNIFIED DESIGN SYSTEM - DARK MODE ===== */
            /* Background & Surface Colors */
            --bg-color: #0f0f0f;
            --surface-color: #1a1a1a;
            --surface-secondary: #222222;
            --surface-accent: #2a2a2a;
            
            /* Text Colors */
            --text-color: #ffffff;
            --text-secondary: #888888;
            --text-muted: #666666;
            
            /* Border & Stroke Colors */
            --border-color: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.15);
            --border-focus: rgba(255, 255, 255, 0.2);
            
            /* Shadow Colors */
            --shadow-light: rgba(0, 0, 0, 0.2);
            --shadow-medium: rgba(0, 0, 0, 0.3);
            --shadow-strong: rgba(0, 0, 0, 0.4);
            
            /* Component Specific */
            --card-bg-color: #1a1a1a;
            --card-text-color: #ffffff;
            --interactive-bg: rgba(255, 255, 255, 0.05);
            --interactive-hover: rgba(255, 255, 255, 0.08);
            
            /* Link Colors */
            --link-color: #66b3ff;
            --link-hover: #4da6ff;
            
            /* Legacy Support */
            --secondary-text-color: #888888;
            --nav-bg-color: rgba(255, 255, 255, 0.05);
            --nav-border-color: rgba(255, 255, 255, 0.15);
            --nav-hover-color: rgba(255, 255, 255, 0.2);
            --clock-bg-color: #0f0f0f;
            --tooltip-bg-color: #333;
            --tooltip-text-color: #ffffff;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --toggle-border-color: rgba(255, 255, 255, 0.15);
            --light-nav-border-color: transparent;
            
            /* Design System: Monochromatic Gradient Palette for Dark Mode */
            --case-study-qa-framework: rgb(22, 24, 28); /* Darkest gradient - sophisticated charcoal */
            --case-study-design-system: rgb(28, 30, 35); /* Dark-mid gradient - refined slate */
            --case-study-mobile-experience: rgb(35, 38, 42); /* Mid-light gradient - elegant graphite */
            --case-study-ai-integration: rgb(42, 45, 50); /* Lightest gradient - premium steel */
        }

        /* =================================
           TYPOGRAPHY SYSTEM
           ================================= */
        
        /* Typography Mapping Guide:
           - H1 (64px) = Major page titles
           - H2 (40px) = Section titles, project titles  
           - H3 (24px) = Subsection titles, problem questions
           - Body (16px) = General text, labels, team circles
           - Value (14px) = Meta values, form inputs, triage text
           - Caption (12px) = Pills, small labels, sublabels
        */
        
        /* Desktop & Tablet Typography (default) */
        .type-h1 {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 64px;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .type-h2 {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 40px;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .type-h3 {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 24px;
            font-weight: 400;
            line-height: 1.5;
        }
        
        .type-body {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.6;
        }
        
        .type-value {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
        }
        
        .type-label,
        .type-caption {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 12px;
            font-weight: 400;
            line-height: 1.4;
        }
        
        /* Mobile Typography */
        @media (max-width: 768px) {
            .type-h1 {
                font-size: 40px;
            }
            
            .type-h2 {
                font-size: 32px;
            }
            
            .type-h3 {
                font-size: 20px;
            }
            
            .type-body {
                font-size: 14px;
            }
            
            .type-value {
                font-size: 13px;
            }
            
            .type-label,
            .type-caption {
                font-size: 11px;
            }
        }
        
        /* Extra Small Mobile Typography */
        @media (max-width: 480px) {
            .type-h1 {
                font-size: 32px;
            }
            
            .type-h2 {
                font-size: 28px;
            }
            
            .type-h3 {
                font-size: 18px;
            }
            
            .type-body {
                font-size: 14px;
            }
            
            .type-value {
                font-size: 12px;
            }
            
            .type-label,
            .type-caption {
                font-size: 10px;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background-color: var(--bg-color);
            scrollbar-width: none; /* Firefox */
        }

        body {
            font-family: 'Unica77LL', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            opacity: 0;
            animation: fadeIn 1.5s ease-in-out forwards;
            min-height: 100vh;
            -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
            overscroll-behavior: none; /* Prevent bounce on scroll boundaries */
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        /* Ensure page starts at top */
        html {
            scroll-behavior: smooth;
        }
        
        /* Force initial scroll position to top */
        html, body {
            scroll-padding-top: 0;
            scroll-margin-top: 0;
        }
        
        /* Prevent any unwanted initial scroll offset */
        * {
            scroll-margin-top: 0;
        }

        /* Universal textarea reset - override user agent styles */
        textarea {
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
            font-size: 13px !important;
            line-height: 1.4 !important;
            padding: 12px !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 6px !important;
            background-color: var(--surface-color) !important;
            color: var(--text-color) !important;
            outline: none !important;
            box-sizing: border-box !important;
            resize: none !important;
            overflow-y: auto !important;
            transition: background-color 0.15s ease-in-out !important;
            width: 100% !important;
            max-width: 100% !important;
        }

        textarea:hover {
            border-color: var(--border-hover) !important;
            background-color: var(--surface-color) !important;
        }

        textarea:focus {
            border-color: var(--border-focus) !important;
            background-color: var(--surface-color) !important;
            outline: none !important;
            box-shadow: none !important;
        }

        textarea::placeholder {
            color: var(--text-muted) !important;
        }

        textarea:focus::placeholder {
            opacity: 0 !important;
        }

        /* Dark theme textarea styles */
        [data-theme="dark"] textarea {
            background-color: var(--surface-color) !important;
            border-color: var(--border-color) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] textarea:hover {
            border-color: var(--border-hover) !important;
            background-color: var(--surface-color) !important;
        }

        [data-theme="dark"] textarea:focus {
            border-color: var(--border-focus) !important;
            background-color: var(--surface-color) !important;
        }

        [data-theme="dark"] textarea::placeholder {
            color: var(--text-muted) !important;
        }

        /* Hide default scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Smooth momentum scrolling for webkit browsers */
        body, html {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        /* Fade in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Fade out animation for page transitions */
        body.fade-out {
            animation: fadeOut 0.8s ease-in-out forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Dark mode fade overlay */
        .fade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: 100dvh; /* Use dynamic viewport height */
            background-color: var(--bg-color);
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
        }

        .fade-overlay.active {
            opacity: 1;
        }

        /* Global Clock Container styles injected dynamically */



        /* Sections */
        .section {
            min-height: 100vh;
            min-height: 100dvh; /* Use dynamic viewport height on supported browsers */
            padding: 40px;
            display: flex;
            align-items: left;
            justify-content: left;
            position: relative;
        }

        .section-content {
            width: 100%;
            padding: 0 40px;
        }

        /* Hero Section */
        .hero-section {
            display: flex;
            justify-content: left;
            align-items: left;
            flex-direction: column;
            padding: 140px 40px 120px 40px;
        }

        .hero-title {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: clamp(36px, 6vw, 64px);
            font-weight: 500;
            margin-bottom: 60px;
            color: var(--text-color) !important;
            opacity: 0;
            transform: translateY(30px);
        }

        .hero-subtitle {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: clamp(18px, 3vw, 24px);
            color: var(--secondary-text-color);
            margin-bottom: 40px;
            opacity: 0;
            transform: translateY(30px);
            max-width: 700px;
            line-height: 1.6;
        }



        .hero-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateY(30px);
        }

        .meta-item {
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            color: var(--secondary-text-color);
        }

        .meta-item strong {
            color: var(--text-color);
        }

        /* Project Introduction */
        .project-intro {
            margin-top:80px;
            margin-bottom: 160px;
            opacity: 0;
            transform: translateY(30px);
        }

        /* Project label extends body typography */
        .project-label {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 14px; /* type-body */
            font-weight: 400;
            color: var(--text-color);
            margin-bottom: 8px;
        }

        /* Project title extends H1 typography */
        .project-title {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 64px; /* type-h1 */
            font-weight: 500;
            color: var(--text-color);
            margin: 0;
            line-height: 1.2;
        }

        /* Project Meta Layout */
        .project-meta-layout {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px 24px;
            opacity: 0;
            transform: translateY(30px);
            padding-top: 12px;
        }

        /* Grid placement map for > 768px */
        @media (min-width: 769px) {
            .project-meta-layout {
                grid-template-columns: 25% 35% 40%;
                column-gap: 24px;
                row-gap: 24px;
            }

            /* Row 1 */
            .project-meta-layout .meta-item:nth-child(1) { grid-column: 1; grid-row: 1; }
            .project-meta-layout .meta-item:nth-child(2) { grid-column: 2; grid-row: 1; }
            .project-meta-layout .meta-item:nth-child(3) { grid-column: 3; grid-row: 1; }

            /* Row 2 */
            .project-meta-layout .meta-item:nth-child(4) { grid-column: 1; grid-row: 2; }
            .project-meta-layout .meta-item:nth-child(5) { grid-column: 2 / 4; grid-row: 2; }

            /* Row 3 */
            .project-meta-layout .meta-item:nth-child(6) { grid-column: 1 / 4; grid-row: 3; }

            /* Remove generic span helpers above 768 in favor of explicit mapping */
            .project-meta-layout .meta-span-2 { grid-column: auto; }
            .project-meta-layout .meta-span-3 { grid-column: auto; }
        }

        /* Individual dividers for each meta-item */
        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
            border-top: 1px solid rgb(0 0 0 / 6%);
            padding-top: 12px;
            opacity: 0;
            transform: translateY(20px);
        }

        /* Dark mode border color for all meta-items */
        [data-theme="dark"] .meta-item {
            border-top-color: rgb(255 255 255 / 8%);
        }
        
        /* Column spanning classes */
        .meta-span-2 {
            grid-column: span 2;
        }
        
        .meta-span-3 {
            grid-column: span 3;
        }

        /* Meta label extends body typography */
        .meta-label {
            font-family: 'Input', monospace;
            font-size: 14px; /* type-body */
            font-weight: 400;
            color: var(--text-color);
        }

        /* Meta value extends H3 typography */
        .meta-value-simple {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 24px; /* type-h3 */
            font-weight: 400;
            color: var(--text-color);
        }

        .meta-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Pill extends caption typography */
        .pill {
            display: inline-block;
            background: #f8f9fa;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 14px; /* type-caption */
            font-weight: 400;
            color: var(--text-color);
            border: 1px solid var(--toggle-border-color);
        }

        [data-theme="dark"] .pill {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--toggle-border-color);
        }

        /* Special styling for client pill */
        .client-pill {
            background: var(--text-color);
            color: var(--bg-color);
            font-size: 14px;
            font-weight: 500;
            padding: 8px 16px;
            border: 1px solid var(--text-color);
            letter-spacing: 0.5px;
        }

        [data-theme="dark"] .client-pill {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }

        /* Typography Hierarchy - Mapped to Typography System */
        h1, .h1 {
            font-size: 40px; /* type-h2 */
            font-weight: 500;
            line-height: 1.2;
        }

        h2, .h2 {
            font-size: 28px; /* between type-h3 and type-h2 */
            font-weight: 500;
            line-height: 1.3;
        }

        h3, .h3 {
            font-size: 24px; /* type-h3 */
            font-weight: 400;
            line-height: 1.5;
        }

        /* Tablet responsive */
        @media (max-width: 1024px) {
            .section {
                padding: 80px 30px 120px;
            }
            
            .project-meta-layout {
                grid-template-columns: repeat(3, 1fr);
                gap: 24px 32px;
            }
            
            .project-title {
                font-size: 36px; /* type-h1 tablet */
            }
            
            h1, .h1 {
                font-size: 36px;
            }

            h2, .h2 {
                font-size: 26px;
            }

            h3, .h3 {
                font-size: 22px;
            }
            
            .problem-statement-title {
                font-size: 26px;
            }
            
            .problem-statement-text {
                font-size: 22px;
            }
        }

        /* Medium screens - 2 column layout */
        @media (max-width: 900px) {
            .project-meta-layout {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px 24px;
            }
            
            .meta-span-3 {
                grid-column: span 2;
            }

            /* Results section 2x2 layout on tablets */
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .metric-number {
                font-size: 40px;
            }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .section {
                padding: 60px 20px 40px;
            }
            
            .section-content {
                padding: 0 !important;
                margin-bottom: 40px;
            }
            
            .project-intro {
                margin-bottom: 60px;
            }
            
            .project-meta-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            /* Reset column spans on mobile */
            .meta-span-2,
            .meta-span-3 {
                grid-column: span 1;
            }

            /* Results section responsive adjustments */
            #results {
                padding: 40px 20px 60px !important;
            }

            /* How might we section responsive adjustments */
            #how-might-we {
                padding: 0px 20px 40px !important;
            }

            /* Results section 2x2 grid layout on mobile */
            .results-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 16px !important;
            }

            .metric-card {
                padding: 24px 16px !important;
            }

            .metric-number {
                font-size: 28px !important;
                margin-bottom: 8px !important;
            }

            .metric-label {
                font-size: 11px !important;
                line-height: 1.3 !important;
            }
            
            .project-title {
                font-size: 32px; /* type-h1 mobile */
            }
            
            .meta-label {
                font-size: 14px;
            }
            
            .meta-value-simple {
                font-size: 20px; /* type-h3 mobile */
            }
            
            .pill {
                font-size: 12px;
                padding: 8px 16px;
            }
            
            .client-pill {
                font-size: 12px;
                padding: 8px 16px;
            }

            h1, .h1 {
                font-size: 32px;
            }

            h2, .h2 {
                font-size: 24px;
            }

            h3, .h3 {
                font-size: 20px;
            }

            .problem-statement-title {
                font-size: 24px;
                margin-bottom: 16px;
            }

            .problem-statement-text {
                font-size: 20px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .section {
                padding: 40px 15px 30px;
            }
            
            .section-content {
                padding: 0 5px;
                margin-bottom: 100px;
            }
            
            .project-intro {
                margin-bottom: 48px;
            }
            
            .project-meta-layout {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            /* Reset column spans on extra small screens */
            .meta-span-2,
            .meta-span-3 {
                grid-column: span 1;
            }
            
            .meta-value-simple {
                font-size: 18px; /* type-h3 extra small mobile */
            }
            
            .project-title {
                font-size: 32px; /* type-h1 extra small mobile */
            }
            
            .client-pill {
                font-size: 12px;
                padding: 5px 10px;
            }
            
            h1, .h1 {
                font-size: 28px;
            }

            h2, .h2 {
                font-size: 22px;
            }

            h3, .h3 {
                font-size: 18px;
            }

            .problem-statement-title {
                font-size: 22px;
                margin-bottom: 12px;
            }
            
            .problem-statement-text {
                font-size: 18px;
                line-height: 1.5;
            }
        }



        /* Elephant in the Room Section */
        .elephant-section {
            background: linear-gradient(135deg, var(--bg-color) 0%, var(--surface-color) 100%);
        }

        /* Problem question extends between H3 and H2 */
        .problem-question {
            font-size: clamp(24px, 4vw, 36px); /* type-h3 to slightly larger */
            color: var(--text-color);
            margin-bottom: 40px;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .team-circles {
            display: flex;
            justify-content: center;
            margin: 60px 0;
        }

        .circle-container {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .team-circle {
            width: 120px;
            height: 120px;
            border: 2px solid var(--secondary-text-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            color: var(--text-color);
            background: var(--bg-color);
        }

        .causes-list {
            list-style: none;
            padding: 0;
            max-width: 500px;
            margin: 0 auto;
        }

        .cause-item {
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 18px;
            color: var(--text-color);
            opacity: 0;
            transform: translateX(-30px);
        }

        /* Defects Section */
        .defects-section {
            background: linear-gradient(135deg, var(--bg-color) 0%, rgba(162, 230, 51, 0.02) 100%);
        }

        .defect-severity-legend {
            background: var(--card-bg-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .defect-severity-legend h3 {
            margin-bottom: 16px;
            color: var(--text-color);
        }

        .severity-items {
            display: flex;
            flex-wrap: wrap;
            gap: 24px;
        }

        .severity-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .severity-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .severity-item.critical .severity-dot {
            background: var(--text-color);
        }

        .severity-item.high .severity-dot {
            background: var(--secondary-text-color);
        }

        .severity-item.medium .severity-dot {
            background: var(--text-color);
            opacity: 0.7;
        }

        .severity-item.low .severity-dot {
            background: var(--secondary-text-color);
            opacity: 0.5;
        }

        .defects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .defect-card {
            background: var(--card-bg-color);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
            opacity: 0;
            transform: translateY(30px);
        }

        .defect-card.critical {
            border-left-color: var(--text-color);
        }

        .defect-card.high {
            border-left-color: var(--secondary-text-color);
        }

        .defect-card.medium {
            border-left-color: var(--text-color);
            border-left-width: 3px;
            opacity: 0.8;
        }

        .defect-card.low {
            border-left-color: var(--secondary-text-color);
            border-left-width: 2px;
            opacity: 0.6;
        }

        .defect-card.other {
            border-left-color: var(--secondary-text-color);
            opacity: 0.4;
        }

        .defect-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .defect-icon {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .defect-card h4 {
            margin: 2px 0 0 0;
            color: var(--text-color);
            font-size: 16px;
        }

        .defect-sublabel {
            font-size: 12px;
            color: var(--secondary-text-color);
            font-style: italic;
        }

        /* Triage Component */
        /* .triage-section inherits base section styles */

        /* 8-column layout container with 7/8 content, 1/8 empty space */
        .triage-layout-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            align-items: stretch; /* stretch children so both cards share full row height */
            margin-top: 60px;
        }

        /* Implementation video: occupy columns 1-6 on large viewports */
        #implementation .final-video-card { grid-column: 1 / 8; }
        @media (max-width: 1200px) {
            #implementation .final-video-card { grid-column: 1; }
        }

        /* Default desktop layout: 5/8 columns for content, 3/8 for component */
        .triage-info-card {
            grid-column: 1 / 6; /* 5 columns (62.5%) */
        }

        .triage-component-container {
            grid-column: 6 / 9; /* 3 columns (37.5%) */
        }

        /* Smaller viewports: Fill all 8 columns */
        @media (max-width: 1440px) {
            .triage-info-card {
                grid-column: 1 / 6; /* 5 columns */
            }
            
            .triage-component-container {
                grid-column: 6 / 9; /* 3 columns - fills all 8 total */
                padding: 20px; /* Slightly reduced padding */
            }
        }
        
        /* Prevent overflow in narrow triage layout - covers side-by-side layout range only */
        @media (max-width: 1440px) and (min-width: 1201px) {
            .triage-info-card {
                grid-column: 1 / 6; /* 5 columns */
            }
            
            .triage-component-container {
                grid-column: 6 / 9; /* 3 columns - needs scaled content to prevent overflow */
            }
            
            /* Scale down all triage content to prevent overflow in narrow layout */
            .triage-component-container label {
                font-size: 13px;
            }
            
            .triage-component-container .annotation-label {
                font-size: 12px;
            }
            
            .triage-component-container .annotation-circle {
                width: 36px;
                height: 36px;
                font-size: 13px;
            }
            
            .triage-component-container .custom-dropdown-display {
                font-size: 13px;
                padding: 6px 8px;
                min-height: 32px;
            }
            
            .triage-component-container .selected-text {
                font-size: 13px;
            }
            
            .triage-component-container textarea {
                font-size: 13px;
                padding: 8px;
                max-height: 40px;
            }
            
            .triage-component-container .author-input {
                font-size: 13px;
                padding: 6px 8px;
                height: 38px !important; /* Match mobile sync button height - force override */
                min-height: 38px; /* Ensure minimum height on mobile */
                flex-shrink: 0; /* Prevent shrinking */
            }
            
            .triage-component-container textarea[id^="defect-description"]::placeholder {
                font-size: 13px;
            }
            
            .triage-component-container .author-sync-btn {
             
                font-size: 13px;
                padding: 0 6px;
                flex-shrink: 0; /* Prevent shrinking */
            }
            
            .triage-component-container .custom-enhanced-dropdown {
                min-width: 0;
                max-width: 100%;
            }
            
            .triage-component-container .custom-dropdown-options {
                max-width: 100%;
                box-sizing: border-box;
            }
            
            .triage-component-container .custom-option {
                font-size: 13px;
                padding: 6px 8px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .triage-component-container .severity-section,
            .triage-component-container .defect-type-section,
            .triage-component-container .status-section {
                min-width: 0;
                overflow: hidden;
            }
            
            .triage-component-container .status-btn {
                padding: 3px 2px;
                min-height: 30px;
                font-size: 13px;
            }
            
            .triage-component-container .status-icon {
                width: 24px;
                height: 24px;
            }
            
            .triage-component-container .status-buttons {
                gap: 12px;
            }
            
            .triage-component-container .header-sync-btn,
            .triage-component-container .header-add-btn {
                font-size: 10px;
                padding: 2px 4px;
                height: 16px;
            }
        }
        
        /* Medium viewports: Adjust for better spacing */
        @media (max-width: 1200px) {
            .triage-info-card {
                grid-column: 1 / 6; /* 5 columns */
            }
            
            .triage-component-container {
                grid-column: 6 / 9; /* 3 columns - full 8 column usage */
            }
            
            /* Scale down text in triage component */
            .triage-component-container label {
                font-size: 13px;
            }
            
            .triage-component-container .annotation-label {
                font-size: 12px;
            }
            
            .triage-component-container .annotation-circle {
                width: 36px;
                height: 36px;
                font-size: 13px;
            }
            
            /* Scale down dropdown text */
            .triage-component-container .custom-dropdown-display {
                font-size: 13px;
                padding: 6px 8px;
                min-height: 32px;
            }
            
            .triage-component-container .selected-text {
                font-size: 13px;
            }
            
            /* Scale down description textarea */
            .triage-component-container textarea {
                font-size: 13px;
                padding: 8px;
                max-height: 40px;
            }
            
            .triage-component-container textarea #defect-description {
                min-height: 60px;
            }


            /* Scale down author input */
            .triage-component-container .author-input {
                font-size: 13px;
                padding: 6px 8px;
                min-height: 40px; /* Ensure minimum height on mobile */
                flex-shrink: 0; /* Prevent shrinking */
            }
            
            /* Scale down description textarea placeholder to match author input */
            .triage-component-container textarea[id^="defect-description"]::placeholder {
                font-size: 13px;
            }
            
            /* Scale down sync button */
            .triage-component-container .author-sync-btn {
                min-height: 40px; /* Ensure minimum height on mobile */
                font-size: 13px;
                padding: 0 6px;
                flex-shrink: 0; /* Prevent shrinking */
            }
            
            /* Fix dropdown overflow issues */
            .triage-component-container .custom-enhanced-dropdown {
                min-width: 0; /* Allow dropdowns to shrink */
                max-width: 100%; /* Prevent overflow */
            }
            
            .triage-component-container .custom-dropdown-options {
                max-width: 100%; /* Constrain options width */
                box-sizing: border-box;
    
            }

            .custom-dropdown-options {
                border: 1px solid var(--border-color) !important;

            }
            
            .triage-component-container .custom-option {
                font-size: 13px;
                padding: 6px 8px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            /* Ensure triage card sections don't overflow */
            .triage-component-container .severity-section,
            .triage-component-container .defect-type-section,
            .triage-component-container .status-section {
                min-width: 0; /* Allow sections to shrink */
                overflow: hidden;
            }
            
            /* Smaller status buttons for constrained space */
            .triage-component-container .status-btn {
                padding: 3px 2px;
                min-height: 40px;
                font-size: 13px;
            }
            
            .triage-component-container .status-icon {
                width: 24px;
                height: 24px;
            }
            
            .triage-component-container .status-buttons {
                gap: 12px;
            }
            
            /* Scale down links section */
            .triage-component-container .header-sync-btn,
            .triage-component-container .header-add-btn {
                font-size: 10px;
                padding: 2px 4px;
                height: 16px;
            }
        }



        /* Tablet and Mobile: Stack vertically */
        @media (max-width: 1200px) {
            .triage-layout-container {
                grid-template-columns: 1fr !important; /* Force single column */
                gap: 24px;
                margin-top: 40px;
                justify-items: center; /* Center align all grid items */
            }
            
            .triage-info-card {
                grid-column: 1 !important; /* Reset to single column */
                margin-bottom: 20px; /* Add spacing between stacked cards */
                justify-self: center; /* Center align the black card */
                width: 100%;
                min-width: 0;
            }
            
            .triage-component-container {
                grid-column: 1 !important; /* Reset to single column */
                justify-self: center; /* Center align the triage card */
                width: 100%;
                min-width: 0;
            }
        }

        /* Triage info card - metric card obsidian color */
        .triage-info-card {
            grid-column: 1 / 6;
            padding: 0;              /* remove inner padding; use compare card visuals */
            border: none;            /* no separate card chrome */
            box-shadow: none;
            background: transparent; /* let compare card be the visual container */
            min-height: 400px;
            height: 100%;
            display: flex;
        }

        .triage-info-card h3, .triage-info-card .triage-title {
            font-size: 28px;
            font-weight: 600;
            margin: 0 0 16px 0;
            color: var(--text-color); /* use dynamic token for visibility in both themes */
            font-family: 'Unica77LL', Arial, sans-serif;
        }

        .triage-info-card p {
            font-size: 16px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin: 0 0 32px 0;
        }

        /* Triage Info Card â€“ Image Comparison (scoped) */
        .triage-info-card .triage-compare-card {
            background: var(--surface-color);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 16px 24px 24px 24px;
            width: 100%;
            position: relative;
            margin-top: 0;           /* remove extra gap */
            height: 100%;            /* fill full card height */
            display: flex;
            flex-direction: column;
            /* Local CTA color system for this canvas */
            --cta-bg-strong: var(--interactive-hover);
            --cta-border-strong: var(--border-hover);
            --cta-fg-strong: var(--text-color);
            --cta-bg-subtle: var(--surface-color);
            --cta-border-subtle: var(--border-color);
            --cta-fg-subtle: var(--text-color);
        }
        [data-theme="dark"] .triage-info-card .triage-compare-card {
            --cta-bg-strong: var(--interactive-hover);
            --cta-border-strong: var(--border-hover);
            --cta-fg-strong: var(--text-color);
            --cta-bg-subtle: var(--surface-color);
            --cta-border-subtle: var(--border-color);
            --cta-fg-subtle: var(--text-color);
        }

        .triage-info-card .triage-compare-container {
            position: relative;
            width: 100%;
            flex: 1;                /* grow to fill remaining height */
            min-height: 360px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }

        .triage-info-card .triage-compare-image-before,
        .triage-info-card .triage-compare-image-after {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Light mode: slightly lighten images to improve overlay icon contrast */
        .triage-info-card [class^="triage-compare-image-"],
        .triage-info-card .triage-compare-image-before,
        .triage-info-card .triage-compare-image-after {
            filter: brightness(1.1) contrast(1.05);
        }
        /* Dark mode: keep original without lightening */
        [data-theme="dark"] .triage-info-card [class^="triage-compare-image-"],
        [data-theme="dark"] .triage-info-card .triage-compare-image-before,
        [data-theme="dark"] .triage-info-card .triage-compare-image-after {
            filter: none;
        }

        .triage-info-card .triage-compare-image-after {
            clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 100%);
        }

        /* Label above the compare canvas */
        .triage-info-card .triage-compare-label {
            width: 100%;
            text-align: center;
            font-size: 11px;
            line-height: 1.2;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .triage-info-card .triage-compare-annotation-widget {
            position: absolute;
            left: 12px;
            top: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: var(--cta-bg-strong);
            border-radius: 16px;
            border: 1px solid var(--cta-border-strong);
            z-index: 5;
            transition: background-color .2s ease, border-color .2s ease, color .2s ease;
        }
        .triage-info-card .triage-compare-annotation-widget:hover,
        .triage-info-card .triage-compare-annotation-widget:focus-within { background: var(--cta-bg-subtle); border-color: var(--cta-border-subtle); }

        /* Preview bubble beside the Annotate CTA: subtle, low-contrast */
        .triage-info-card .triage-compare-annotation-preview {
            display: inline-flex;
            background: var(--cta-bg-strong);
            color: var(--cta-fg-strong);
            border: 1px solid var(--cta-border-strong) !important;
            cursor: pointer; /* make it obvious it's clickable */
            transition: background-color .2s ease, border-color .2s ease, color .2s ease;
        }
        .triage-info-card .triage-compare-annotation-preview:hover,
        .triage-info-card .triage-compare-annotation-preview:focus-visible { background: var(--cta-bg-subtle); color: var(--cta-fg-subtle); border-color: var(--cta-border-subtle) !important; }

        .triage-info-card .triage-compare-annotation-btn {
            background: var(--text-color);
            color: var(--bg-color);
            border: none;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            cursor: pointer;
        }

        .triage-info-card .triage-compare-opacity {
            position: absolute;
            right: 12px;
            top: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 6px;
            padding: 0; /* no horizontal padding to keep width constant */
            background: var(--cta-bg-strong);
            border: 1px solid var(--cta-border-strong);
            border-radius: 50%;
            z-index: 5;
            cursor: pointer;
            width: 32px;
            height: 32px;
            box-sizing: border-box;
            transition: border-radius 0.2s ease, padding 0.2s ease, height 0.2s ease, background-color 0.15s ease, border-color 0.15s ease;
        }

        .triage-info-card .triage-compare-opacity-icon {
            width: 14px;
            height: 14px;
            display: block;
            color: var(--text-color);
            position: absolute;
            left: 50%; /* center horizontally regardless of width */
            transform: translateX(-50%);
            top: 7px;  /* vertically centered for 28px height */
        }

        /* Remove hover/expanded visual changes: keep default compact state only */
        /* Helper track positioning and visibility */
        .triage-info-card .triage-compare-opacity-track {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 34px;   /* below the icon */
            width: 5px;
            height: calc(100% - 34px - 14px); /* fill space above value */
            border: 1px solid #ffffff; /* white front stroke for visibility */
            background: rgba(0,0,0,0.12);
            border-radius: 3px;
            display: none;
            pointer-events: none; /* do not block slider interactions */
            z-index: 1;
        }
        /* Never auto-show helper track; no expanded/hover state */

        /* Delete last annotation CTA under the annotate widget */
        .triage-info-card .triage-compare-delete {
            position: absolute;
            left: 12px;
            top: 58px;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--cta-bg-strong);
            border: 1px solid var(--cta-border-strong);
            border-radius: 50%;
            color: var(--cta-fg-strong);
            z-index: 6;
            cursor: pointer;
            transition: background-color .2s ease, border-color .2s ease, color .2s ease;
        }
        .triage-info-card .triage-compare-delete:hover,
        .triage-info-card .triage-compare-delete:focus-visible { background: var(--cta-bg-subtle); border-color: var(--cta-border-subtle); color: var(--cta-fg-subtle); }
        .triage-info-card .triage-compare-opacity-slider {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 34px;   /* align with helper track */
            height: calc(100% - 34px - 14px);
            width: 24px; /* hit area */
            background: transparent; /* use pseudo track visuals */
            border: none;
            border-radius: 2px;
            outline: none;
            appearance: slider-vertical;
            -webkit-appearance: slider-vertical;
            writing-mode: bt-lr; /* Firefox vertical */
            display: none;
            z-index: 2;
        }
        /* WebKit track/thumb */
        .triage-info-card .triage-compare-opacity-slider::-webkit-slider-runnable-track {
            width: 3px;
            background: #ffffff; /* white track */
            border: none;
            border-radius: 2px;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.35); /* dark outline so white is visible */
        }
        .triage-info-card .triage-compare-opacity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 10px;
            height: 10px;
            background: #ffffff; /* white thumb */
            border: 1px solid rgba(0,0,0,0.35); /* dark outline for visibility */
            border-radius: 50%;
            margin-top: -4px; /* center on 3px track */
        }
        /* Firefox track/thumb */
        .triage-info-card .triage-compare-opacity-slider::-moz-range-track {
            width: 3px;
            background: #ffffff; /* white track */
            border: none;
            border-radius: 2px;
            box-shadow: 0 0 0 1px rgba(0,0,0,0.35); /* dark outline so white is visible */
        }
        .triage-info-card .triage-compare-opacity-slider::-moz-range-thumb {
            width: 10px;
            height: 10px;
            background: #ffffff; /* white thumb */
            border: 1px solid rgba(0,0,0,0.35); /* dark outline for visibility */
            border-radius: 50%;
        }
        /* Dark theme tweaks for contrast */
        [data-theme="dark"] .triage-info-card .triage-compare-opacity-slider {
            background: rgba(255,255,255,0.35);
            border-color: rgba(255,255,255,0.25);
        }
        [data-theme="dark"] .triage-info-card .triage-compare-opacity-slider::-webkit-slider-runnable-track,
        [data-theme="dark"] .triage-info-card .triage-compare-opacity-slider::-moz-range-track {
            background: rgba(255,255,255,0.35);
            border-color: rgba(255,255,255,0.25);
        }
        [data-theme="dark"] .triage-info-card .triage-compare-opacity-slider::-webkit-slider-thumb,
        [data-theme="dark"] .triage-info-card .triage-compare-opacity-slider::-moz-range-thumb {
            background: #fff;
            border-color: rgba(0,0,0,0.4);
        }
        /* Do not auto-show slider on hover/expanded; controlled only by JS if needed */
        .triage-info-card .triage-compare-opacity-value { font-size: 8px; color: var(--text-secondary); font-weight: 600; text-align: center; display: none; }

        /* Use hover styling as the default appearance for upload controls */
        .triage-info-card .triage-compare-upload {
            position: absolute;
            background: var(--cta-bg-strong);
            border: 1px solid var(--cta-border-strong);
            border-radius: 16px;
            cursor: pointer;
            z-index: 20;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: auto;
            height: 36px;
            padding: 0 10px;
            box-sizing: border-box;
            opacity: 1;
            overflow: hidden;
            color: var(--cta-fg-strong);
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, width 0.2s ease;
        }
        .triage-info-card .triage-compare-upload-left { left: 12px; bottom: 12px; }
        .triage-info-card .triage-compare-upload-right { right: 12px; bottom: 12px; }
        .triage-info-card .triage-compare-upload-text { font-size: 11px; color: currentColor; opacity: 1; white-space: nowrap; }
        .triage-info-card .triage-compare-upload:hover,
        .triage-info-card .triage-compare-upload:focus-visible { background: var(--cta-bg-subtle); border-color: var(--cta-border-subtle); color: var(--cta-fg-subtle); }
        .triage-info-card .triage-compare-reset:hover { background: var(--cta-bg-subtle); border-color: var(--cta-border-subtle); color: var(--cta-fg-subtle); font:11px;}
        .triage-info-card .triage-compare-upload:hover .triage-compare-upload-text { opacity: 1; }
        .triage-info-card .triage-compare-upload-input { display: none; }

        .triage-info-card .triage-compare-upload-icon { width: 16px; height: 16px; display: block; color: currentColor; flex-shrink: 0; pointer-events: none; }

        .triage-info-card .triage-compare-slider { position: absolute; top: 0; left: 50%; width: 3px; height: 100%; background: #A2E633 !important; transform: translateX(-50%); z-index: 6; cursor: ew-resize; }
        .triage-info-card .triage-compare-reset {
            font-size: 11px;
            position: absolute;
            left: 50%;
            bottom: 28px;
            transform: translateX(-50%);
            background: var(--surface-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 14px;
            border-radius: 10px;
            cursor: pointer;
            z-index: 12; /* above uploads (z-index 20 for labels; reset should sit visually central but not block clicks on uploads */
            pointer-events: auto;
        }

        [data-theme="dark"] .triage-info-card .triage-compare-card { background: var(--surface-color); border-color: var(--border-color); }

        /* Removed metrics under the triage comparison canvas */

        .info-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
        }

        /* ===== DARK MODE SUPPORT FOR TRIAGE COMPONENT ===== */
        [data-theme="dark"] .triage-info-card {
            border-color: var(--border-color);
            box-shadow: 0 4px 20px var(--shadow-light);
        }

        .triage-component-container {
            background: var(--surface-color);
            border-radius: 16px;
            opacity: 1; /* Ensure visible on small viewports */
            transform: none;
            padding: 24px;
            border: 1px solid var(--border-color);
            width: 100%;
            box-shadow: 0 4px 20px var(--shadow-light);
            position: relative;
            overflow: visible;
            transition: none;
            margin: 0;
            max-width: 500px;
            color: var(--text-color);
            min-height: 400px; /* prevent collapse */
        }



        [data-theme="dark"] .triage-component-container {
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .triage-close-btn {
            background: var(--surface-secondary);
            border-color: var(--border-color);
        }

        [data-theme="dark"] .triage-close-btn:hover {
            background: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        /* Triage Close Button */
        .triage-close-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface-color);
            border: 1px solid var(--border-color);
            box-shadow: 0 3px 12px var(--shadow-medium), 0 1px 4px var(--shadow-light);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 15;
            transition: all 0.2s ease;
            padding: 0;
            color: var(--text-color);
        }

        .triage-close-btn:hover {
            background: var(--surface-secondary);
            border-color: var(--border-hover);
            box-shadow: 0 4px 16px var(--shadow-strong), 0 2px 6px var(--shadow-medium);
            transform: translateY(-1px);
        }

        .triage-close-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px var(--shadow-medium), 0 1px 3px var(--shadow-light);
        }

        .close-icon {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            line-height: 1;
            user-select: none;
        }

        .triage-close-btn:hover .close-icon {
            color: var(--text-color);
        }

        .triage-card {
            display: grid;
            grid-template-columns: auto 1fr; /* Mobile layout for all screens */
            grid-template-rows: auto auto auto auto auto auto; /* Added row for author section */
            row-gap: 24px;
            column-gap: 24px;
            align-items: start;
            padding: 16px;
            background: var(--surface-secondary);
            border-radius: 12px;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            /* Removed transition to prevent jerky animations */
            overflow: visible !important;
            will-change: transform, opacity;
            backface-visibility: hidden;
            position: relative;
            z-index: 1;
        }

        
        .annotation-number {
            grid-column: 1;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            text-align: center;
        }
        
        .severity-section {
            grid-column: 2;
            grid-row: 1;
        }
        
        .defect-type-section {
            grid-column: 3;
            grid-row: 1;
        }
        
        .status-section {
            grid-column: 4;
            grid-row: 1;
        }
        
        .description-section {
            grid-column: 2 / 4;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            padding-top: 6px;
        }
        
        .links-section {
            grid-column: 4;
            grid-row: 2;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            padding-top: 6px;
        }


        


        /* Mobile layout is now default for all screens */
            
            /* Responsive grid adjustments for very small screens */
            @media (max-width: 480px) {

           
           
           
                .triage-card {
                    padding: 12px;
                    row-gap: 24px;
                    column-gap: 12px;
                }
            }
            
            @media (max-width: 360px) {
                .triage-card {
                    padding: 10px;
                    row-gap: 10px;
                    column-gap: 10px;

                }
            }
            
            /* Annotation component - left column */
            .annotation-number {
                grid-column: 1;
                grid-row: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 8px;
                padding: 0;
                margin: 0;
                width: auto;
                min-width: 60px;
            }
            
            .annotation-label {
                font-size: 12px;
                font-weight: 400;
                margin-bottom: 6px;
                text-align: center;
            }
            
            .annotation-circle {
                margin: 0;
                align-self: center;
            }
            
            /* Severity section - right column */
            .severity-section {
                grid-column: 2;
                grid-row: 1;
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                margin: 0;
                padding: 0;
                position: relative;
                z-index: 100;
            }
            
            /* Ensure severity dropdown appears above defect type dropdown */
            .severity-section .custom-enhanced-dropdown {
                z-index: 100;
            }
            
            .severity-section .custom-dropdown-options {
                z-index: 100001 !important;
            }
            
            /* Row 2: Defect Type */
            .defect-type-section {
                grid-column: 1 / 3;
                grid-row: 2;
                width: 100%;
            }
            
            /* Row 3: Description */
            .description-section {
                grid-column: 1 / 3;
                grid-row: 3;
                width: 100%;
                padding-top: 0;
            }
            
            /* Row 4: Links */
            .links-section {
                grid-column: 1 / 3;
                grid-row: 4;
                width: 100%;
                padding-top: 0;
            }
            
            /* Row 5: Status */
            .status-section {
                grid-column: 1 / 3;
                grid-row: 5;
                width: 100%;
            }
            
        /* Row 6: Author */
        .author-section {
            grid-column: 1 / 3;
            grid-row: 6;
            width: 100%;
            
        }
        
        .author-container {
                display: flex;
            gap: 12px;
            align-items: flex-end; /* Align both elements to bottom */
                width: 100%;

        }
        
        .author-input-container {
            flex: 2; /* Takes 2/3 of the width */
            display: flex;
            flex-direction: column;
        }
        
        .author-input-container label {
            display: block;
            font-weight: 400;
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            text-align: left;
            width: 100%;
            line-height: 1.4;
        }
        
        .author-input {
            width: 100%;
            max-width: 100%;
            height: 44px !important;
            min-height: 44px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            line-height: 1.4;
            outline: none;
            transition: background-color 0.15s ease-in-out;
            box-sizing: border-box;
            flex-shrink: 0; /* Prevent shrinking */
        }
        
        .author-input:hover {
            border-color: var(--border-hover) !important;
            background-color: var(--surface-color);
        }
        
        .author-input:focus {
            border-color: var(--border-focus) !important;
            background-color: var(--surface-color);
            outline: none;
            box-shadow: none;
        }
        
        .author-input::placeholder {
            color: var(--text-muted);
        }
        
        .author-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }
        
        .author-sync-btn {
            flex: 1; /* Takes 1/3 of the width */
            height: 44px !important; /* Match exact height with input field - force override */
            min-height: 44px; /* Ensure minimum height */
            background: var(--text-secondary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 8px;
            overflow: hidden;
            flex-shrink: 0; /* Prevent shrinking */
        }
        
        /* Hover state - lighter fill */
        .author-sync-btn:hover:not(.selected) {
            background: var(--text-color);
            color: var(--surface-color);
        }
        
        /* Selected state - show synced content with transition */
        .author-sync-btn.selected {
            background: var(--text-color);
            color: var(--surface-color);
        }
        
        .author-sync-btn-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
        }
        
        .author-sync-btn-content-default {
            /* Default "Sync" content */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
        
        .author-sync-btn-content-selected {
            /* Selected checkmark + "Synced" content */
            transform: translateY(100%); /* Hidden below by default */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        /* Show selected content when in selected state */
        .author-sync-btn.selected .author-sync-btn-content-default {
            transform: translateY(-100%); /* Slide default content up and out */
        }
        
        .author-sync-btn.selected .author-sync-btn-content-selected {
            transform: translateY(0%); /* Slide selected content up into view */
        }
        
        .author-sync-btn-text {
            font-size: 14px;
            font-weight: 500;
            color: inherit;
            white-space: nowrap;
        }
        
        .author-sync-btn-checkmark {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            border: 1px solid white;
            border-radius: 50%;
            background: transparent;
        }
        
        .author-sync-btn-checkmark svg {
            width: 10px;
            height: 10px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }
        

        

        
        /* Status buttons styling */
        .status-buttons {
            display: flex;
            flex-direction: row;
            gap: 6px;
            width: 100%;
            justify-content: space-between;
            flex-wrap: nowrap;
        }
        
        .status-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 6px 4px;
            min-height: 36px;
            border-radius: 6px;
            transition: all 0.2s ease;
            min-width: 0; /* Allow buttons to shrink */
        }

        /* Status icons - responsive sizing */
        .status-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }

        /* Responsive status buttons for smaller triage containers */
        @media (max-width: 1200px) {
            .status-buttons {
                gap: 4px;
            }
            
            .status-btn {
                padding: 4px 2px;
                min-height: 32px;
            }
            
            .status-icon {
                width: 20px;
                height: 20px;
            }
        }

        /* Extra small containers (like 25% width triage) */
        @media (max-width: 900px) {
            .status-btn {
                padding: 3px 1px;
                min-height: 28px;
            }
            
            .status-icon {
                width: 18px;
                height: 18px;
            }
        }
            

        
        /* Ensure proper spacing and immediate appearance without staggering */
            .triage-card > * {
                margin: 0;
                opacity: 1 !important;
                transform: none !important;
                transition: none !important;
            }
            
        /* Close button positioning */
            .triage-close-btn {
                position: absolute;
                top: -10px;
                right: -10px;
                z-index: 15;
                width: 30px;
                height: 30px;
        }

        /* Dark theme adjustments */
        [data-theme="dark"] .triage-card {
            color: var(--card-text-color);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .author-input-container label {
            color: var(--text-secondary);
            }
            
        [data-theme="dark"] .author-input {
                background: var(--surface-color);
            border-color: var(--border-color);
            color: var(--text-color);
        }
        
        [data-theme="dark"] .author-input:hover {
            border-color: var(--border-hover);
            background-color: var(--surface-color);
        }
        
        [data-theme="dark"] .author-input:focus {
                border-color: var(--border-color);
            background-color: var(--surface-color);
            box-shadow: none;
        }
        
        [data-theme="dark"] .author-input::placeholder {
            color: var(--text-muted);
        }
        
        [data-theme="dark"] .author-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }
        
        [data-theme="dark"] .author-sync-btn {
            background: var(--surface-color);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }
        
        [data-theme="dark"] .author-sync-btn:hover:not(.selected) {
            background: var(--interactive-hover);
            color: var(--text-color);
            border-color: var(--border-hover);
        }
        
        [data-theme="dark"] .author-sync-btn.selected {
            background: var(--text-color);
            color: var(--surface-color);
            border-color: var(--text-color);
        }



        /* Clean severity styling using home page palette */
        .triage-card.severity-critical {
            background: var(--case-study-qa-framework);
            color: var(--card-text-color);
            border-color: var(--text-color);
        }

        .triage-card.severity-high {
            background: var(--case-study-design-system);
            color: var(--card-text-color);
            border-color: var(--secondary-text-color);
        }

        .triage-card.severity-medium {
            background: var(--case-study-mobile-experience);
            color: var(--card-text-color);
            border-color: var(--text-color);
            opacity: 0.9;
        }

        .triage-card.severity-low {
            background: var(--case-study-ai-integration);
            color: var(--card-text-color);
            border-color: var(--secondary-text-color);
            opacity: 0.8;
        }

        .triage-card.severity-other {
            background: var(--secondary-text-color);
            color: var(--card-text-color);
            border-color: var(--toggle-border-color);
            opacity: 0.7;
        }

        .triage-card.severity-default {
            background: var(--card-bg-color);
            color: var(--card-text-color);
            border-color: var(--toggle-border-color);
        }

        .defect-type-section,
        .description-section,
        .links-section,
        .status-section {
            display: flex;
            flex-direction: column;
            min-width: 0;
            overflow: hidden;
            align-items: flex-start;
            justify-content: flex-start;
            width: 100%;
        }
        
        /* Allow dropdowns to escape their containers */
        .defect-type-section,
        .severity-section {
            overflow: visible !important;
            position: relative;
        }



        .annotation-label {
            display: block;
            font-size: 12px;
            font-weight: 400;
            margin: 0;
            color: var(--text-secondary);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            text-align: center;
        }



        .annotation-circle {
            width: 40px;
            height: 40px;
            background-color: var(--text-secondary);
            color: var(--surface-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding-bottom: 2px;
        }

        [data-theme="dark"] .annotation-circle {
            background: var(--surface-color);
            color: var(--text-color);
            border-color: var(--border-color);
        }
        
        /* Severity color variations */
        .annotation-circle.severity-low {
            background-color: #E2F6C8 !important;
    color: var(--case-study-qa-framework);
    border: 1px solid #E2F6C8 !important;
        }
        
        .annotation-circle.severity-medium {
            background-color: #dfdc40 !important;
    color: var(--case-study-qa-framework);
    border: 1px solid #dfdc40 !important;
        }
        
        .annotation-circle.severity-high {
            background-color: #A2E633 !important;
    color: var(--case-study-qa-framework);
    border: 1px solid #A2E633 !important;
        }

        /* Canvas annotations: match severity colors like annotation-circle */
        .triage-annotation.severity-low { background-color: #E2F6C8 !important; color: var(--case-study-qa-framework) !important; border: 1px solid #E2F6C8 !important; }
        .triage-annotation.severity-medium { background-color: #dfdc40 !important; color: var(--case-study-qa-framework) !important; border: 1px solid #dfdc40 !important; }
        .triage-annotation.severity-high { background-color: #A2E633 !important; color: #000000 !important; border: 1px solid #A2E633 !important; }



       .triage-annotation {
        background-color: #A2E633 !important;
        color: #000000 !important;
        border: 1px solid #A2E633 !important;
        }




        .defect-type-section label,
        .description-section label,
        .links-section label,
        .status-section label,
        .severity-section label {
            display: block;
            font-weight: 400;
            margin-bottom: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            text-align: left;
            width: 100%;
            line-height: 1.4;
        }

        /* Removed all .defect-dropdown and .severity-dropdown CSS garbage - we only use custom dropdowns now */

        textarea[id^="defect-description"] {
            width: 100%;
            max-width: 100%;
            height: 32px !important;
            flex: 1;
            padding: 12px 12px 12px 12px;
            border: 1px solid var(--border-color) !important;
            border-radius: 6px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            line-height: 1.4;
            outline: none;
            transition: background-color 0.15s ease-in-out !important;
            box-sizing: border-box;
            resize: none;
            overflow-y: auto;
        }

        textarea[id^="defect-description"]:hover {
            border-color: var(--border-hover) !important;
            background-color: var(--surface-color);
            transition: all 0.15s ease-in-out !important;
        }

        textarea[id^="defect-description"]:focus {
            border-color: var(--border-focus) !important;
            background-color: var(--surface-color);
            outline: none;
            box-shadow: none;

        }

        textarea[id^="defect-description"]::placeholder {
            color: var(--text-muted);
        }
        
        textarea[id^="defect-description"]:focus::placeholder {
            opacity: 0;
        }

        textarea[id^="defect-description"]:disabled {
            background-color: var(--surface-secondary);
            color: var(--text-muted);
            cursor: not-allowed;
            border-color: var(--border-color);
            opacity: 0.5;
        }

        .links-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
            flex: 1;
        }

        .links-background-card {
            flex: 1;
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--surface-secondary);
            box-sizing: border-box;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            transition: border-color 0.15s ease-in-out, background-color 0.15s ease-in-out;
        }

        [data-theme="dark"] .links-background-card {
            background-color: var(--surface-color);
            border-color: var(--border-color);
        }

        .link-item {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--surface-color);
            transition: border-color 0.15s ease-in-out, background-color 0.15s ease-in-out;
            box-sizing: border-box;
            max-height: 40px;
        }

        .link-item:hover {
            border-color: var(--border-hover);
            background-color: var(--interactive-hover);
        }

        .simple-link {
            color: var(--link-color);
            text-decoration: none;
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 14px;
            transition: color 0.3s ease;
            flex: 1;
            word-break: break-all;
        }

        .simple-link:hover {
            color: var(--link-hover);
            text-decoration: underline;
        }

        .link-input {
            width: 100%;
            height: 36px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            outline: none;
            transition: all 0.15s ease-in-out;
            box-sizing: border-box;
        }

        .link-input:hover {
            border-color: var(--border-hover);
            background-color: var(--surface-color);
        }

        .link-input:focus {
            border-color: var(--border-focus);
            background-color: var(--interactive-hover);
            outline: none;
        }

        .link-input::placeholder {
            color: var(--text-muted);
        }
        
        .link-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }

        .link-input:disabled {
            background-color: var(--surface-secondary);
            color: var(--text-muted);
            cursor: not-allowed;
            border-color: var(--border-color);
            opacity: 0.5;
        }
        
        [data-theme="dark"] .link-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }

        .add-link-btn {
            background: none;
            border: none;
            color: var(--link-color);
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            font-family: 'Unica77LL', Arial, sans-serif;
            text-decoration: underline;
            transition: color 0.3s ease;
            align-self: flex-start;
            margin-top: 10px;
        }

        .add-link-btn:hover {
            color: var(--link-hover);
            text-decoration: underline;
        }

        .remove-link-btn,
        .save-link-btn,
        .cancel-link-btn {
            height: 32px;
            padding: 0 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--surface-color);
            color: var(--text-color);
            cursor: pointer;
            font-size: 14px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-weight: 500;
            transition: all 0.15s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            outline: none;
        }

        .save-link-btn {
            background-color: var(--text-color);
            color: var(--surface-color);
            border-color: var(--text-color);
        }

        .save-link-btn:hover {
            background-color: var(--text-secondary);
            border-color: var(--text-secondary);
        }

        .save-link-btn:focus {
            box-shadow: 0 0 0 2px var(--shadow-light);
        }

        .remove-link-btn {
            width: 24px;
            height: 24px;
            padding: 0;
            border: 1px solid hsl(214.3 31.8% 91.4%);
            border-radius: 4px;
            background-color: hsl(0 0% 100%);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-weight: 500;
            transition: all 0.15s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            outline: none;
        }

        .remove-link-btn:hover {
            border-color: var(--border-hover);
            background-color: var(--interactive-hover);
        }

        .remove-link-btn:focus {
            box-shadow: 0 0 0 2px var(--shadow-light);
        }

        .cancel-link-btn:hover {
            background-color: var(--surface-secondary);
            border-color: var(--border-hover);
        }

        .cancel-link-btn:focus {
            box-shadow: 0 0 0 2px var(--shadow-light);
        }

        .link-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            flex: 1;
        }

        .links-header {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            width: 100%;
        }

        .header-add-btn {
            background: none;
            border: 1px solid hsl(214.3 31.8% 91.4%);
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            height: 20px;
            background-color: hsl(0 0% 100%);
            flex-shrink: 0;
            white-space: nowrap;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .header-add-btn:hover {
            border-color: hsl(214.3 31.8% 85%);
            background-color: hsl(210 40% 98%);
        }

        /* Header buttons container */
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Sync button - similar styling to add button */
        .header-sync-btn {
            background: none;
            border: 1px solid hsl(214.3 31.8% 91.4%);
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: default;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
            height: 20px;
            background-color: hsl(0 0% 100%);
            flex-shrink: 0;
            white-space: nowrap;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            position: relative;
        }

        .header-sync-btn:hover {
            border-color: hsl(214.3 31.8% 85%);
            background-color: hsl(210 40% 98%);
        }

        .header-sync-btn:hover .sync-tooltip {
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        /* Sync tooltip - matching clock-location component pattern */
        .sync-tooltip {
            visibility: hidden;
            background-color: var(--tooltip-bg-color);
            color: var(--tooltip-text-color);
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            top: calc(100% + 5px);
            left: calc(100% - 120px) !important;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s, background-color 0.3s ease, color 0.3s ease;
            font-size: 12px;
            white-space: normal;
            box-shadow: 0 2px 5px var(--shadow-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            letter-spacing: 0.02em;
            line-height: 1.3;
            max-width: 200px;
            width: max-content;
            min-width: 180px;
        }

        /* Prevent tooltip cutoff near right edge */
        .header-buttons .header-sync-btn:last-of-type .sync-tooltip,
        .header-sync-btn .sync-tooltip {
            right: 0;
            left: auto;
            transform: translateX(0);
        }

        .sync-tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            right: 20px;
            border: 6px solid transparent;
            border-bottom-color: var(--tooltip-bg-color);
        }

        /* Status Buttons - Updated for responsive design */
        .status-buttons {
            display: flex;
            gap: 6px;
            width: 100%;
        }

        .status-btn {
            flex: 1;
            padding: 6px 4px;
            border: 1px solid;
            border-radius: 6px;
            background-color: transparent;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            min-height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            white-space: nowrap;
            min-width: 0; /* Allow buttons to shrink */
        }

        /* Status icon styling - responsive */
        .status-icon {
            width: 24px;
            height: 24px;
            transition: all 0.15s ease-in-out;
            object-fit: contain;
        }

        /* Icon hover effects removed - no tints applied */

        /* White icons when status button is selected (higher specificity to override hover) */
        .status-btn.selected .status-icon { filter: brightness(0) invert(1); }

        /* Ensure white icons stay white when selected button is hovered */
        .status-btn.selected:hover .status-icon {
            filter: brightness(0) invert(1) !important;
        }

        /* Dark theme icon hover tints removed */

        /* Dark icons when dark theme status button is selected */
        [data-theme="dark"] .status-btn.selected .status-icon { filter: brightness(0); }

        /* Ensure dark icons stay dark when selected button is hovered in dark theme */
        [data-theme="dark"] .status-btn.selected:hover .status-icon { filter: brightness(0); }

        /* Not Started - Neutral base (selected gets color) */
        .status-btn[data-status="not-started"] {
            border-color: var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-secondary);
        }

        .status-btn[data-status="not-started"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        .status-btn[data-status="not-started"].selected {
            background-color: var(--card-bg-color) !important;
    color: var(--card-bg-color) !important;
    border-color: var(--text-secondary) !important;
        }

        /* In Progress - Neutral base */
        .status-btn[data-status="in-progress"] {
            border-color: var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-secondary);
        }

        .status-btn[data-status="in-progress"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        .status-btn[data-status="in-progress"].selected {
            background-color: var(--card-bg-color) !important;
            color: var(--card-bg-color) !important;
            border-color: var(--text-secondary) !important;
        }

        /* Defect Persists - Neutral base */
        .status-btn[data-status="defect-persists"] {
            border-color: var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-secondary);
        }

        .status-btn[data-status="defect-persists"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        .status-btn[data-status="defect-persists"].selected {
            background-color: var(--card-bg-color) !important;
            color: var(--card-bg-color) !important;
            border-color: var(--text-secondary) !important;
        }

        /* Resolved - Neutral base */
        .status-btn[data-status="resolved"] {
            border-color: var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-secondary);
        }

        .status-btn[data-status="resolved"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        .status-btn[data-status="resolved"].selected {background-color: var(--card-bg-color) !important;
    color: var(--card-bg-color) !important;
    border-color: var(--text-secondary) !important;
        }

        /* Status tooltip styling */
        .status-header {
            display: flex;
            align-items: center;
            gap: 4px;
            position: relative;
            overflow: visible;
        }

        .status-section {
            overflow: visible !important;
            position: relative;
        }

        .status-info-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary) !important;
            padding: 0px 0px 0px 2px;
            border-radius: 3px;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
        }

        .status-info-btn:hover {
            background-color: hsl(215.4 16.3% 95%);
            color: hsl(215.4 16.3% 35%);
        }

        .status-tooltip {
            position: absolute;
            top: calc(100% - 1px);
            left: calc(100% - 90px);
            right: -4px;
            z-index: 15000;
            background: white;
            border: 1px solid hsl(215.4 16.3% 85%);
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            width: 200px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            pointer-events: auto;
        }

        .status-tooltip-close {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
            color: hsl(215.4 16.3% 55%);
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
            transition: all 0.15s ease;
            z-index: 1;
        }

        .status-tooltip-close:hover {
            background-color: hsl(215.4 16.3% 95%);
            color: hsl(215.4 16.3% 35%);
        }

        .status-tooltip-content {
            padding: 16px 0 12px 0;
        }

        .status-tooltip-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            font-size: 13px;
            color: hsl(215.4 16.3% 35%);
        }

        .status-tooltip-item img {
            flex-shrink: 0;
        }

        /* Dark theme support for status tooltip */
        [data-theme="dark"] .status-info-btn {
            color: hsl(215.4 16.3% 65%);
        }

        [data-theme="dark"] .status-info-btn:hover {
            background-color: hsl(215.4 16.3% 25%);
            color: hsl(215.4 16.3% 85%);
        }

        [data-theme="dark"] .status-tooltip {
            border-color: var(--border-hover) !important;
            background-color: var(--surface-color) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }



        [data-theme="dark"] .status-tooltip-close {
            color: hsl(215.4 16.3% 65%);
        }

        [data-theme="dark"] .status-tooltip-close:hover {
            background-color: hsl(215.4 16.3% 25%);
            color: hsl(215.4 16.3% 85%);
        }

        [data-theme="dark"] .status-tooltip-item {
            color: hsl(215.4 16.3% 75%);
        }



        /* Dark theme status buttons */
        [data-theme="dark"] .status-btn[data-status="not-started"] {
            border-color: var(--border-color);
            color: var(--text-secondary);
            background-color: var(--surface-color);
        }

        [data-theme="dark"] .status-btn[data-status="not-started"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        [data-theme="dark"] .status-btn[data-status="not-started"].selected {
            background-color: var(--text-secondary);
            color: var(--surface-color);
            border-color: var(--text-secondary);
        }

        [data-theme="dark"] .status-btn[data-status="in-progress"] {
            border-color: var(--border-color);
            color: var(--text-secondary);
            background-color: var(--surface-color);
        }

        [data-theme="dark"] .status-btn[data-status="in-progress"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        [data-theme="dark"] .status-btn[data-status="in-progress"].selected {
            background-color: #6FA9F5;
            color: #0B1220;
            border-color: #5A93DC;
        }

        [data-theme="dark"] .status-btn[data-status="defect-persists"] {
            border-color: var(--border-color);
            color: var(--text-secondary);
            background-color: var(--surface-color);
        }

        [data-theme="dark"] .status-btn[data-status="defect-persists"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        [data-theme="dark"] .status-btn[data-status="defect-persists"].selected {
            background-color: #F3C756;
            color: #0B1220;
            border-color: #DDB247;
        }

        [data-theme="dark"] .status-btn[data-status="resolved"] {
            border-color: var(--border-color);
            color: var(--text-secondary);
            background-color: var(--surface-color);
        }

        [data-theme="dark"] .status-btn[data-status="resolved"]:hover {
            background-color: var(--interactive-hover);
            border-color: var(--border-hover);
        }

        [data-theme="dark"] .status-btn[data-status="resolved"].selected {
            background-color: #37C690;
            color: #0B1220;
            border-color: #2BAB7E;
        }



        .link-placeholder {
            cursor: pointer;
            justify-content: center;
        }



        .add-link-btn-full {
            background: none;
            border: none;
            color: var(--text-secondary) !important;
            font-size: 12px;
            cursor: pointer;
            padding: 0;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            width: 100%;
            height: 100%;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .add-icon {
            font-weight: 500;
            font-size: 20px;
        }

        .add-text {
            font-weight: 500;
        }

        [data-theme="dark"] .header-add-btn {
            background-color: hsl(222.2 84% 4.9%);
            border-color: hsl(217.2 32.6% 17.5%);
            color: hsl(215.4 16.3% 56.9%);
        }

        [data-theme="dark"] .header-add-btn:hover {
            border-color: hsl(217.2 32.6% 22%);
            background-color: hsl(217.2 32.6% 17.5%);
        }

        /* Dark theme sync button */
        [data-theme="dark"] .header-sync-btn {
            background-color: hsl(222.2 84% 4.9%);
            border-color: hsl(217.2 32.6% 17.5%);
            color: hsl(215.4 16.3% 56.9%);
        }

        [data-theme="dark"] .header-sync-btn:hover {
            border-color: hsl(217.2 32.6% 22%);
            background-color: hsl(217.2 32.6% 17.5%);
        }

        /* Dark theme sync tooltip */
        [data-theme="dark"] .sync-tooltip {
            background: hsl(210 40% 98%);
            color: hsl(222.2 84% 4.9%);
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1), 0 2px 8px rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .sync-tooltip::after {
            border-top-color: hsl(210 40% 98%);
        }

        /* Custom Defect Icons */
        .custom-defect-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            margin-right: 8px;
        }

        .custom-defect-icon svg {
            width: 100%;
            height: 100%;
            fill: currentColor;
        }

        /* Defect card icon sizing */
        .defect-card .custom-defect-icon {
            width: 24px;
            height: 24px;
            margin-right: 0;
            margin-bottom: 8px;
        }

        /* Removed .defect-dropdown .custom-defect-icon CSS - not needed anymore */

        /* Icon colors by severity */
        .defect-card.critical .custom-defect-icon svg {
            fill: #e74c3c;
        }

        .defect-card.high .custom-defect-icon svg {
            fill: #f39c12;
        }

        .defect-card.medium .custom-defect-icon svg {
            fill: #3498db;
        }

        .defect-card.low .custom-defect-icon svg {
            fill: #a2e633;
        }

        .defect-card.other .custom-defect-icon svg {
            fill: #95a5a6;
        }

        /* Dark theme icon adjustments */
        [data-theme="dark"] .defect-card.critical .custom-defect-icon svg {
            fill: #ff6b6b;
        }

        [data-theme="dark"] .defect-card.high .custom-defect-icon svg {
            fill: #feca57;
        }

        [data-theme="dark"] .defect-card.medium .custom-defect-icon svg {
            fill: #54a0ff;
        }

        [data-theme="dark"] .defect-card.low .custom-defect-icon svg {
            fill: #5f27cd;
        }

        [data-theme="dark"] .defect-card.other .custom-defect-icon svg {
            fill: #a4b0be;
        }

        [data-theme="dark"] .add-link-btn-full {
            color: var(--text-secondary) !important;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
        }
        



        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 100002; /* Higher than dropdown z-index */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Prevent background scrolling when modal is open */
        body.modal-open {
            overflow: hidden;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 12px;
            min-width: 480px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px var(--shadow-medium), 0 10px 10px -5px var(--shadow-light);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.15s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .modal-close:hover {
            background-color: var(--interactive-hover);
            color: var(--text-color);
        }

        .modal-body {
            padding: 24px;
        }

        .service-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .service-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 12px;
            border: 1px solid hsl(214.3 31.8% 91.4%);
            border-radius: 8px;
            background-color: hsl(0 0% 100%);
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: hsl(215 15% 55%);
            min-height: 80px;
        }

        .service-option:hover {
            border-color: hsl(215 15% 8-column);
            box-shadow: 0 0 0 1px hsl(221.2 83.2% 53.3% / 0.2);
        }

        .service-option.selected {
            border-color: #1f2937;
            background-color: hsl(221.2 83.2% 97%);
            box-shadow: 0 0 0 1px hsl(221.2 83.2% 53.3% / 0.2);
        }

        .service-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
        }

        .url-input-row {
            margin-top: 16px;
        }

        .api-token-input-row {
            margin-top: 12px;
        }

        .modal-field-label {
            display: block;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 12px;
            font-weight: 400;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .modal-url-input {
            width: 100%;
            height: 40px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--surface-color);
            color: var(--text-color);
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            outline: none;
            transition: all 0.15s ease-in-out;
            box-sizing: border-box;
        }

        .modal-url-input:hover {
            border-color: var(--border-hover);
        }

        .modal-url-input:focus {
            border-color: var(--border-focus);
        }

        .modal-url-input::placeholder {
            color: var(--text-muted);
        }
        
        .modal-url-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }

        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-top: 1px solid hsl(214.3 31.8% 91.4%);
            background-color: hsl(210 40% 98%);
        }

        .modal-footer-right {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            height: 40px;
            padding: 0 16px;
            border-radius: 6px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            outline: none;
            border: 1px solid;
        }

        .modal-btn-secondary {
            background-color: hsl(0 0% 100%);
            color: hsl(215 15% 55%);
            border-color: hsl(214.3 31.8% 91.4%);
        }

        .modal-btn-secondary:hover {
            background-color: hsl(210 40% 96%);
            border-color: hsl(214.3 31.8% 85%);
        }

        .modal-btn-primary {
            background-color: hsl(215 15% 60%);
            color: hsl(210 40% 98%);
            border-color: hsl(215 15% 60%);
        }

        .modal-btn-primary:hover {
            background-color: #1f2937;
            border-color: #1f2937;
        }

        .modal-btn-primary:disabled {
            background-color: hsl(210 40% 96%);
            color: var(--text-secondary);
            border-color: hsl(214.3 31.8% 91.4%);
            cursor: not-allowed;
        }

        .modal-btn-sync {
            background-color: hsl(0 0% 100%);
            color: hsl(215 15% 55%);
            border-color: hsl(215 15% 55%);
            font-size: 14px;
        }

        .modal-btn-sync:hover {
            background-color: hsl(210 40% 96%);
            border-color: hsl(215 15% 50%);
            color: hsl(215 15% 50%);
        }

        .modal-btn-sync {
            position: relative;
            cursor: default;
        }

        .modal-btn-sync:hover .modal-sync-tooltip {
            visibility: visible;
            opacity: 1;
            pointer-events: auto;
        }

        /* Modal sync tooltip */
        .modal-sync-tooltip {
            visibility: hidden;
            background-color: var(--tooltip-bg-color);
            color: var(--tooltip-text-color);
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 15000;
            top: -70px;
            left: 0;
            transform: translateX(0);
            opacity: 0;
            transition: opacity 0.3s, background-color 0.3s ease, color 0.3s ease;
            font-size: 12px;
            white-space: normal;
            box-shadow: 0 2px 5px var(--shadow-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            letter-spacing: 0.02em;
            line-height: 1.3;
            max-width: 200px;
            width: max-content;
            min-width: 180px;
        }

        .modal-sync-tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 20px;
            border: 6px solid transparent;
            border-bottom-color: var(--tooltip-bg-color);
        }

        /* Modal error banner */
        .modal-error-banner {
            display: none;
            background-color: hsl(0, 93%, 12%);
            color: white;
            padding: 12px 24px;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 12px;
            font-weight: 500;
        }

        .modal-error-banner.active {
            display: flex;
        }

        .modal-error-banner .error-icon {
            width: 16px;
            height: 16px;
            color: white;
            flex-shrink: 0;
        }

        .error-message {
            text-align: left;
        }

        /* Dark mode for modal */
        [data-theme="dark"] .modal-content {
            background: hsl(222.2 84% 4.9%);
            border-color: hsl(217.2 32.6% 17.5%);
        }

        [data-theme="dark"] .modal-header {
            border-bottom-color: hsl(217.2 32.6% 17.5%);
        }

        [data-theme="dark"] .modal-header h3 {
            color: hsl(210 40% 98%);
        }

        [data-theme="dark"] .modal-close {
            color: hsl(215.4 16.3% 56.9%);
        }

        [data-theme="dark"] .modal-close:hover {
            background-color: hsl(217.2 32.6% 17.5%);
            color: hsl(210 40% 98%);
        }

        [data-theme="dark"] .service-option {
            background-color: hsl(222.2 84% 4.9%);
            border-color: hsl(217.2 32.6% 17.5%);
            color: hsl(210 40% 98%);
        }

        [data-theme="dark"] .service-option:hover {
            border-color: #1f2937;
        }

        [data-theme="dark"] .service-option.selected {
            background-color: hsl(221.2 83.2% 10%);
        }






        
        [data-theme="dark"] .modal-url-input:focus::placeholder {
            opacity: 0; /* Hide placeholder on focus */
        }

        /* ===== CUSTOM HORIZONTAL TRIAGE LAYOUT ===== */
        /* Custom horizontal layout for triage component between tablet and mobile */
        @media (max-width: 1200px) and (min-width: 769px) {
            /* Override max-width constraint for triage component container */
            .triage-component-container {
                max-width: none !important; /* Remove 500px max-width constraint */
                width: 100% !important;
            }

            /* X close button remains visible in horizontal layout */

            .triage-card {
                display: grid !important;
                grid-template-columns: auto 140px 1fr auto 120px !important; /* 5 columns: annotation(narrow), severity(140px), defect-type(wide), status-col, sync-cta(120px) */
                grid-template-rows: auto auto auto !important; /* 3 rows */
                gap: 24px 16px !important; /* Row gap 24px, column gap 16px */
                padding: 16px !important;
                width: 100% !important;
                max-width: none !important;
            }

            /* Row 1, Column 1: Annotation (narrow width) */
            .annotation-number {
                grid-column: 1 !important;
                grid-row: 1 !important;
                position: static !important;
                margin: 0 !important;
                display: flex !important;
                align-items: center !important;
                gap: 8px !important;
                align-self: center !important;
                margin-bottom: 2px !important;
            }

            .annotation-number .annotation-label {
                display: inline !important;
                margin: 0 !important;
                font-size: 12px;
            }

            .annotation-number .annotation-circle {
                display: inline-flex !important;
                margin: 0 !important;
            }

            /* Row 1, Column 2: Defect Severity */
            .severity-section {
                grid-column: 2 !important;
                grid-row: 1 !important;
                margin: 0 !important;
                align-self: center !important;
                width: 140px !important;
            }

            .severity-section .custom-dropdown-display,
            .severity-section .custom-enhanced-dropdown {
                width: 140px !important;
                max-width: 140px !important;
                min-width: 140px !important;
            }

            /* Row 1, Column 3: Defect Type (wider) */
            .defect-type-section {
                grid-column: 3 !important;
                grid-row: 1 !important;
                margin: 0 !important;
                align-self: center !important;
            }

            /* Row 1, Columns 4-5: Defect Status */
            .status-section {
                grid-column: 4 / 6 !important; /* Span columns 4-5 */
                grid-row: 1 !important;
                align-self: center !important;
                margin: 0 !important;
            }

            /* Row 2, Columns 2-3: Description */
            .description-section {
                grid-column: 2 / 4 !important; /* Span columns 2-3 */
                grid-row: 2 !important;
                align-self: start !important;
            }

            /* Row 2, Columns 4-5: Author */
            .author-section {
                grid-column: 4 / 6 !important; /* Span columns 4-5 */
                grid-row: 2 !important;
                align-self: start !important;
                margin: 0 !important;
                display: flex !important;
                flex-direction: column !important;
            }

            /* Row 3, Columns 2-3: Links */
            .links-section {
                grid-column: 2 / 4 !important; /* Span columns 2-3 */
                grid-row: 3 !important;
                align-self: start !important;
            }

            /* Row 3, Columns 4-5: Sync CTA (spans both columns like status and author) - Override all other sync button rules */
            .triage-card .author-sync-btn {
                grid-column: 4 / 6 !important; /* Span columns 4-5 */
                grid-row: 3 !important;
                height: 100% !important; /* Fill entire grid cell height */
                min-height: 40px !important; /* Minimum height for usability */
                max-height: none !important; /* Remove height constraint */
                font-size: 13px !important;
                width: 100% !important; /* Fill column width */
                min-width: 200px !important; /* Ensure minimum button width for spanning two columns */
                max-width: 100% !important; /* Constrain to column */
                align-self: stretch !important; /* Stretch to fill grid cell */
                justify-self: stretch !important; /* Stretch horizontally to fill grid cell */
                position: relative !important; /* Relative positioning for absolute content */
                margin: 0 !important;
                padding: 0 8px !important; /* Proper padding for button content */
                box-sizing: border-box !important; /* Include padding in width calculation */
                flex-shrink: 0 !important; /* Prevent shrinking */
            }

            .author-sync-btn-text {
            
                font-size: 18px !important;
            }
            /* Let base content styles work - only ensure proper button container */

            /* Make description textarea 40px height */
            .description-section textarea {
                height: 40px !important; /* Match dropdown heights */
                max-height: 40px !important;
                min-height: 40px !important;
                resize: none !important; /* Remove resize handle */
            }


            /* Author input container fills the author section */
            .author-section .author-input-container {
                width: 100% !important;
                margin: 0 !important;
                display: flex !important;
                flex-direction: column !important;
            }

            /* Author textarea - copy ALL description textarea styles exactly */
            .author-section textarea,
            .author-section textarea[id="defect-author"] {
                width: 100% !important;
                max-width: 100% !important;
                height: 40px !important; /* Match dropdown heights */
                max-height: 40px !important;
                min-height: 40px !important;
                flex: 1 !important;
                padding: 12px 12px 12px 12px !important; /* Exact same as description */
                border: 1px solid hsl(214.3 31.8% 91.4%);
                border-radius: 6px !important;
                background-color: hsl(0 0% 100%);
                color: var(--text-color) !important;
                font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                font-size: 13px !important;
                line-height: 1.4 !important;
                outline: none !important;
                transition: background-color 0.15s ease-in-out !important;
                box-sizing: border-box !important;
                resize: none !important; /* Disable manual resize */
                overflow-y: auto !important; /* Allow scrolling if content exceeds height */
            }







            .author-section textarea:hover,
            .author-section textarea[id="defect-author"]:hover {
                border-color: var(--border-focus) !important;
                background-color: var(--surface-color) !important;
                transition: all 0.15s ease-in-out !important;
            }

            .author-section textarea:focus,
            .author-section textarea[id="defect-author"]:focus {
                border-color: var(--border-focus) !important;
                background-color: var(--surface-color) !important;
                outline: none !important;
                box-shadow: none !important;
            }



            [data-theme="dark"] .author-section textarea, .author-section textarea[id="defect-author"] {
                border-color: var(--border-focus) !important;
                background-color: var(--surface-color) !important;
                outline: none !important;
                box-shadow: none !important;
        
            }

            [data-theme="dark"].author-section textarea:focus::placeholder,
            .author-section textarea[id="defect-author"]:focus {
                border-color: var(--border-focus) !important;
                background-color: var(--surface-color) !important;
                transition: all 0.15s ease-in-out !important;
            }

            [data-theme="dark"].author-section textarea:focus,
            .author-section textarea[id="defect-author"]:focus {
                border-color: var(--border-focus) !important;
                background-color: var(--surface-color) !important;
                outline: none !important;
                box-shadow: none !important;
            }



            .author-section textarea::placeholder,
            .author-section textarea[id="defect-author"]::placeholder {
                color: var(--text-muted) !important;
                font-size: 13px !important;
                line-height: 1.4 !important;
                font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
            }
            
            .author-section textarea:focus::placeholder,
            .author-section textarea[id="defect-author"]:focus::placeholder {
                opacity: 0 !important; /* Hide placeholder on focus */
            }

            /* Make author label identical to description label */
            .author-section label {
                display: block !important;
                font-weight: 400 !important;
                margin-bottom: 6px !important;
                font-size: 12px !important;
                color: var(--text-secondary) !important;
                font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                text-align: left !important;
                width: 100% !important;
                line-height: 1.4 !important;
            }

            /* Removed conflicting sync button positioning rule - handled above */




        }

        /* ===== GENERAL SYNC CTA FULL WIDTH OVERRIDE ===== */
        /* Ensure sync CTA takes full width in ALL viewports */
        .author-sync-btn {
            width: 100% !important; /* Force full width */
            max-width: 100% !important; /* Ensure no constraints */
            flex: none !important; /* Remove any flex sizing */
            box-sizing: border-box !important; /* Include padding in width */
        }

        /* Ensure parent containers don't constrain width */
        .triage-component-container {
            width: 100% !important;
        }

        .triage-card {
            width: 100% !important;
        }

        /* ===== LARGE VIEWPORT ADJUSTMENTS (DESKTOP) ===== */
        /* For viewports larger than 1200px - taller description and full-width sync CTA */
        @media (min-width: 1201px) {
            /* Taller description field for better content entry */
            textarea[id^="defect-description"] {
                height: 80px !important; /* Increase from default 32px */
                min-height: 80px !important;
                max-height: 120px !important; /* Allow some expansion */
            }

            /* Full-width sync CTA in desktop layout - override all width constraints */
            .author-sync-btn {
                width: 100% !important; /* Full width of container */
                min-width: 100% !important;
                max-width: 100% !important;
                flex: none !important; /* Remove flex sizing */
                grid-column: 1 / -1 !important; /* Span all columns in its container */
            }

            /* Ensure sync button container allows full width */
            .author-container {
                width: 100% !important;
                display: block !important; /* Remove any flex constraints */
            }

            .triage-component-container {
                width: 100% !important;
                max-width: 460px !important; /* Remove any width constraints */
            }
        }

        /* ===== SMALL VIEWPORT ADJUSTMENTS (MOBILE) ===== */
        /* For viewports smaller than 768px - taller description and full-width sync CTA */
        @media (max-width: 767px) {
            /* Taller description field for mobile content entry */
            textarea[id^="defect-description"] {
                height: 100px !important; /* Even taller for mobile */
                min-height: 100px !important;
                max-height: 150px !important; /* Allow more expansion on mobile */
            }

            /* Full-width sync CTA in mobile layout - override all constraints */
            .author-sync-btn {
                width: 100% !important; /* Full width of container */
                min-width: 100% !important;
                max-width: 100% !important;
                flex: none !important; /* Remove flex sizing */
                display: block !important; /* Block display for full width */
                grid-column: 1 / -1 !important; /* Span all columns */
            }

            /* Ensure containers allow full width */
            .author-container {
                width: 100% !important;
                display: block !important; /* Remove flex constraints */
            }

            .author-input-container {
                width: 100% !important;
                display: block !important;
            }

            .triage-component-container {
                width: 100% !important;
                max-width: none !important; /* Remove any width constraints */
            }

            .triage-card {
                width: 100% !important;
                max-width: none !important;
            }
        }

        [data-theme="dark"] .modal-footer {
            background-color: hsl(222.2 84% 6%);
            border-top-color: hsl(217.2 32.6% 17.5%);
        }

        [data-theme="dark"] .modal-btn-secondary {
            background-color: hsl(222.2 84% 4.9%);
            color: hsl(210 40% 98%);
            border-color: hsl(217.2 32.6% 17.5%);
        }

        [data-theme="dark"] .modal-btn-secondary:hover {
            background-color: hsl(217.2 32.6% 17.5%);
            border-color: hsl(217.2 32.6% 22%);
        }

        [data-theme="dark"] .modal-field-label {
            color: var(--text-secondary) !important;    
        }

        /* Service link styling */
        .service-link {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .service-link:hover {
            text-decoration: none;
        }

        .service-link-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .service-link-icon svg {
            transition: transform 0.15s ease-in-out;
        }

        .service-link:hover .service-link-icon svg {
            transform: scale(1.1);
        }





        /* Sprint Cycles Section */
        .sprint-section {
            background: linear-gradient(135deg, var(--bg-color) 0%, rgba(162, 230, 51, 0.02) 100%);
        }

        .sprint-timeline {
            background: var(--card-bg-color);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timeline-header {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
            padding: 16px;
            background: var(--card-bg-color);
            border-radius: 8px;
            color: var(--card-text-color);
            text-align: center;
            border: 1px solid var(--toggle-border-color);
        }

        .phase-label {
            font-weight: 600;
            font-size: 14px;
        }

        .sprint-phases {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .sprint-phase {
            background: rgba(162, 230, 51, 0.1);
            border: 1px solid rgba(162, 230, 51, 0.3);
            border-radius: 12px;
            padding: 20px 16px;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.3s ease;
        }

        .sprint-phase:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(162, 230, 51, 0.2);
        }

        .phase-number {
            width: 32px;
            height: 32px;
            background: #a2e633;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin: 0 auto 12px;
        }

        .sprint-phase h3 {
            font-size: 14px;
            margin: 0;
            color: var(--text-color);
            line-height: 1.3;
        }

        .team-responsibilities {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .responsibility-row {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }

        .team-badge {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
            opacity: 0;
            transform: scale(0);
        }

        .team-badge.ba {
            background: var(--case-study-qa-framework);
            color: var(--card-text-color);
        }

        .team-badge.dp {
            background: var(--case-study-design-system);
            color: var(--card-text-color);
        }

        .team-badge.dev {
            background: var(--case-study-mobile-experience);
            color: var(--card-text-color);
        }

        .team-badge.qa {
            background: var(--case-study-ai-integration);
            color: var(--card-text-color);
        }

        /* Workflow Diagram */
        .workflow-diagram {
            background: var(--card-bg-color);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .workflow-title {
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 32px;
            text-align: center;
            font-size: 16px;
        }

        .workflow-sections {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 32px;
            margin-bottom: 24px;
        }

        .workflow-section h4 {
            color: var(--text-color);
            margin-bottom: 20px;
            text-align: center;
            padding: 12px;
            background: rgba(162, 230, 51, 0.1);
            border-radius: 8px;
        }

        .workflow-steps {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
        }

        .workflow-step {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            color: var(--text-color);
            font-size: 14px;
            opacity: 0;
            transform: translateX(-30px);
        }

        .workflow-arrow {
            font-size: 20px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .workflow-complex {
            position: relative;
        }

        .decision-diamond {
            background: #FF9800;
            color: white;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            margin: 16px 0;
            font-weight: 600;
            opacity: 0;
            transform: scale(0.8);
        }

        .workflow-branches {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .branch {
            flex: 1;
            text-align: center;
        }

        .branch-label {
            background: #a2e633;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 12px;
        }

        .no-branch .branch-label {
            background: var(--case-study-ai-integration);
            color: var(--card-text-color);
            border: 1px solid var(--toggle-border-color);
        }

        .timeline-footer {
            text-align: center;
            padding: 16px;
            background: var(--card-bg-color);
            border-radius: 8px;
            color: var(--card-text-color);
            font-weight: 600;
            border: 1px solid var(--toggle-border-color);
        }

        /* QA Insights Section */
        .insights-section {
            background: linear-gradient(135deg, var(--bg-color) 0%, var(--surface-color) 100%);
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
            margin-top: 40px;
        }

        .insight-card {
            background: var(--card-bg-color);
            border-radius: 16px;
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(40px);
        }

        .insight-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(162, 230, 51, 0.15);
        }

        .insight-icon {
            font-size: 48px;
            margin-bottom: 20px;
            display: block;
        }

        .insight-card h3 {
            color: var(--text-color);
            font-size: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            opacity: 0.95;
        }

        .insight-card p {
            color: var(--secondary-text-color);
            line-height: 1.6;
            font-size: 16px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sprint-phases {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .team-responsibilities {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .workflow-sections {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sprint-phases {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .team-responsibilities {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .timeline-header {
                grid-template-columns: 1fr;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            /* Removed infinite bounce animation */
        }

        /* Challenge Section with Parallax */
        .challenge-section {
            background: var(--bg-color);
            overflow: hidden;
            min-height: 120vh;
        }

        .parallax-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 120%;
            background: linear-gradient(135deg, var(--bg-color) 0%, rgba(0, 0, 0, 0.1) 100%);
            background-size: cover;
            background-position: center;
            will-change: transform;
        }

        .challenge-content {
            position: relative;
            z-index: 2;
            color: white;
            text-align: center;
            padding: 100px 0;
        }

        /* How Might We Section */
        .hmw-section {
            background: var(--card-bg-color);
            color: var(--card-text-color);
            text-align: center;
        }

        .hmw-statement {
            font-size: clamp(24px, 4vw, 48px);
            font-weight: 300;
            line-height: 1.3;
            opacity: 0;
            transform: translateY(50px);
        }

        /* Framework Section - Main Interactive Component */
        .framework-section {
            background: var(--bg-color);
            min-height: 150vh;
            padding: 120px 40px;
        }

        .framework-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 60px;
            opacity: 0;
            transform: translateY(50px);
        }

        .framework-card {
            background: var(--card-bg-color);
            color: var(--card-text-color);
            border-radius: 12px;
            padding: 32px;
            border: 1px solid transparent;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .framework-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px var(--shadow-color);
        }

        .framework-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--text-color);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .framework-card:hover::before {
            transform: scaleX(1);
        }

        .card-number {
            font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            color: var(--secondary-text-color);
            font-weight: 500;
            margin-bottom: 16px;
        }

        .card-title {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .card-description {
            font-family: 'Unica77LL', Arial, sans-serif;
            color: var(--secondary-text-color);
            font-size: 14px;
            line-height: 1.5;
            opacity: 0.8;
        }

        /* Section Headers */
        .section-header {
            text-align: left;
            margin-bottom: 60px;
        }

        /* Section title extends between H2 and H1 */
        .section-title {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: clamp(32px, 5vw, 56px); /* between type-h2 and type-h1 */
            font-weight: 500;
            margin-bottom: 16px;
            opacity: 0;
            transform: translateY(30px);
            padding-top: 200px;
        }

        .section-subtitle {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 18px;
            color: var(--secondary-text-color);
            margin: 0;
            opacity: 0;
            transform: translateY(30px);
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            align-items: center;
            margin-top: 80px;
        }

        .content-text h3 {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 20px;
            opacity: 0;
            transform: translateX(-30px);
        }

        .content-text p {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--secondary-text-color);
            margin-bottom: 20px;
            opacity: 0;
            transform: translateX(-30px);
        }

        .content-image {
            background: var(--card-bg-color);
            color: var(--card-text-color);
            border-radius: 16px;
            aspect-ratio: 4/3;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: translateX(30px);
        }

        /* Synopsis Section Full Width Override */
        #synopsis .section-content {
            max-width: 100% !important;
            padding: 0px 80px 0px 40px;
        }

        /* Eight Column Content Styles */
        .eight-column-content {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            max-width: 100%;
            margin: 0;
            position: relative;
            margin-top: 120px;
        }

        .synopsis-title {
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: clamp(32px, 5vw, 56px); /* Consistent with other section titles */
            font-weight: 500;
            color: var(--text-color);
            margin: 0 0 40px 0;
            text-align: left;
            grid-column: 3 / 8;
            line-height: 1.2;
        }

        /* Content Container for CTA Pills and Story Content */
        .content-container {
            grid-column: 3 / 8;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .story-content {
            font-family: 'Unica77LL', Arial, sans-serif;
            text-align: left;
            padding-right: 40px; /* General content padding rule */
        }

        .story-content p {
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            color: var(--text-color);
            margin-bottom: 24px;
            margin-right: 0;
            text-align: left;
            
            /* Enhanced typography for better word flow */
            max-width: 65ch; /* Approximately 7-10 words per line */
            hyphens: none; /* Disable hyphenation to prevent word breaking */
            word-wrap: normal; /* Prevent aggressive word wrapping */
            overflow-wrap: break-word; /* Only break extremely long words */
            white-space: normal;
            
            /* Advanced orphan/widow control */
            orphans: 4; /* Minimum 4 lines at bottom of page */
            widows: 4; /* Minimum 4 lines at top of page */
            
            /* Improved text rendering */
            text-rendering: optimizeLegibility;
            font-kerning: auto;
            font-variant-ligatures: common-ligatures;
            
            /* Subtle letter and word spacing for better readability */
            letter-spacing: -0.01em;
            word-spacing: 0.05em;
        }

        .story-content p:last-child {
            margin-bottom: 0;
        }

        /* Responsive Typography Adjustments for Optimal Word Flow */
        @media (max-width: 1024px) {
            .story-content p {
                max-width: 60ch; /* Slightly tighter for medium screens */
                font-size: var(--font-size-body);
            }
        }

        @media (max-width: 768px) {
            .story-content p {
                max-width: 55ch; /* Optimal for mobile screens */
                font-size: 1rem; /* 16px mobile */
                line-height: 1.5;
                word-spacing: 0.03em;
            }

            .section-title { padding-top: 60px !important; }
        }

        @media (max-width: 480px) {
            .story-content p {
                max-width: 50ch; /* Compact for small mobile */
                font-size: 0.9375rem; /* 15px */
                line-height: 1.5;
                letter-spacing: 0;
                word-spacing: 0.02em;
            }

            .section-title {

            padding-top: 80px !important;
            }
        }

        /* Hide old visual aids system */
        .visual-aids {
            display: none;
        }











        /* CTA Pills Container */
        .cta-pills-container {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            flex-wrap: wrap;
            transition: all 0.4s ease; /* Smooth layout transitions */
        }

        /* Section-specific spacing for inline CTA rows */
        .hmw-content > .cta-pills-container,
        .defect-glossary-content > .cta-pills-container {
            margin-bottom: 40px; /* match synopsis content gap */
        }

        .pill-group {
            display: flex;
            align-items: center;
            gap: 0;
            border-radius: 6px;
        }



        /* CTA Pills - Unified Design System for Text, TLDR, and Voice buttons */
        .cta-pill {
            background: var(--case-study-qa-framework);
            color: var(--bg-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 22px;
            font-weight: 500;
            padding: 8px 12px; /* Reduced from 16px to match voice pill */
            border: 2px solid transparent; /* Invisible border prevents layout shift */
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            outline: none;
            white-space: nowrap;
            text-align: center;
            min-width: 60px; /* Reduced from 120px to match voice pill */
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cta-pill:hover {
            background: #a2e633 !important;
            color: var(--card-bg-color) !important;
            opacity: 1 !important;
        }

        .cta-pill.selected {
            background: #a2e633 !important;
            color: var(--card-bg-color) !important;
            border: 2px solid #7ebb1c !important;
        }

        /* Primary Action - Text Pill */
        .pill-1 {
            border-radius: 6px;
            transition: all 0.3s ease;
            z-index: 10;
            position: relative;
        }

        .pill-1.connected {
            border-radius: 6px 0 0 6px;
        }

        .text-pill:hover {
            background: #a2e633;
            color: var(--card-bg-color);
            border: 2px solid #7ebb1c !important;
        }

        .text-pill.active {
            background: #a2e633;
            color: var(--card-bg-color);
            border: 2px solid #7ebb1c !important;
        }

        /* Text Icon Styling */
        .text-icon {
            width: 24px;
            height: 24px;
            filter: brightness(0) invert(1); /* White icon for dark background */
            transition: filter 0.3s ease;
        }

        /* Light mode - when text pill is selected (green background), make icon black */
        .text-pill.active .text-icon,
        .text-pill:hover .text-icon {
            filter: brightness(0); /* Black icon for light/green background */
        }

        /* Dark mode adjustments */
        [data-theme="dark"] .text-icon {
            filter: brightness(0) invert(1); /* White icon for dark background */
        }

        [data-theme="dark"] .text-pill.active .text-icon,
        [data-theme="dark"] .text-pill:hover .text-icon {
            filter: brightness(0); /* Black icon for green background in dark mode */
        }

        /* Secondary Action - TLDR Pill */
        .pill-2 {
            width: 0;
            min-width: 0;
            padding: 8px 0;
            opacity: 0;
            overflow: hidden;
            border-radius: 0 6px 6px 0;
            transform: translateX(-24px); /* Increased to hide more completely */
            z-index: 5;
            position: relative;
            border: none !important; /* Override any inherited borders */
            border-left: none !important;
            margin-left: -4px; /* Additional negative margin to ensure complete hiding */
            transition: width 0.4s ease, padding 0.4s ease, opacity 0.4s ease, transform 0.4s ease; /* Specific transitions only */
        }


        .pill-2:hover {
            width: 0;
            min-width: 0;
            padding: 8px 0;
            opacity: 0;
            overflow: hidden;
            border-radius: 0 6px 6px 0;
            transform: translateX(-24px); /* Match the base state */
            z-index: 5;
            position: relative;
            border-left: none !important;
            margin-left: -4px; /* Match the base state */
        }

        .pill-2.show {
            width: auto;
            width: 80px;
            padding: 8px 16px;
            opacity: 1;
            transform: translateX(0);
            transition: width 0.4s ease, padding 0.4s ease, opacity 0.4s ease, transform 0.4s ease, background-color 0.2s ease, color 0.2s ease !important;
            border: 1px solid var(--toggle-border-color) !important;

        }

        .pill-2.hide {
            width: 0 !important;
            min-width: 0 !important;
            padding: 0 !important;
            opacity: 0 !important;
            transform: translateX(-24px) !important;
            transition: width 0.4s ease, padding 0.4s ease, opacity 0.4s ease, transform 0.4s ease !important;
            border: none !important;
            overflow: hidden !important;
}
        

        .tldr-pill:hover {
            background: #76b314 !important;
            border: 2px solid #7ebb1c !important;
        }

        .tldr-pill.active,
        .tldr-pill.selected {
            background: #76b314 !important;
            color: var(--card-bg-color) !important;
            border-bottom: 2px solid #7ebb1c !important;
            border-right: 2px solid #7ebb1c !important;
            border-top: 2px solid #7ebb1c !important;
            border-left: 2px solid transparent !important; /* Keep consistent spacing */
            transition: background-color 0.2s ease, color 0.2s ease !important; /* Fast, smooth color-only transitions */
        }

        @keyframes swingIn {
            0% {
                transform: translateX(-30px);
                opacity: 0;
            }
            100% {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes swingOut {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateX(-30px);
                opacity: 0;
            }
        }

        /* Third Option - Voice Pill */
        .pill-3 {
            min-width: 60px; /* Reduced from 120px for icon-only */
            padding: 8px 12px; /* Reduced horizontal padding */
        }

        /* Mobile Fix - Remove pill-2 width/padding but keep in flow for interactions */
        @media (max-width: 768px) {
            .pill-2 {
                width: 0 !important;
                min-width: 0 !important;
                padding: 0 !important;
                margin: 0 !important;
                border: none !important;
                overflow: hidden !important;
            }
            
            .pill-2.show {
                width: 80px !important;
                padding: 8px 16px !important;
            }
        }


        
        .voice-pill {
            border: 1px solid #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            position: relative;
            transition: all 0.4s ease; /* Smooth transitions for all layout changes */
        }

        .voice-pill::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/sound.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: brightness(0) invert(1); /* Makes the icon white */
        }

        .voice-pill:hover:not(.speaking) {
            background: #a2e633;
            color: transparent;
            border: 2px solid #7ebb1c !important;
            position: relative;
        }

        .voice-pill:hover:not(.speaking)::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: none; /* Keep play icon original color (black) */
        }

        .voice-pill.speaking {
            background: #a2e633;
            color: transparent;
            border-color: #a2e633;
            position: relative;
        }

        .voice-pill.speaking::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: none; /* Keep stop icon original color (black) */
        }

        /* Dark mode */
        [data-theme="dark"] .voice-pill:hover:not(.speaking) {
            background: #a2e633;
            color: transparent;
            border-color: #a2e633;
            position: relative;
        }

        [data-theme="dark"] .voice-pill:hover:not(.speaking)::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: none; /* Keep play icon original color (black) */
        }

        [data-theme="dark"] .voice-pill.speaking {
            background: #a2e633;
            color: transparent;
            border-color: #a2e633;
            position: relative;
        }

        [data-theme="dark"] .voice-pill.speaking::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: none; /* Keep stop icon original color (black) */
        }

        [data-theme="dark"] .voice-pill::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/sound.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: brightness(0) invert(1); /* Makes the icon white */
        }














        /* Dark mode styles - Unified Design System */
        [data-theme="dark"] .cta-pill {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-color);
            border: 1px solid var(--toggle-border-color);
        }

        [data-theme="dark"] .cta-pill.selected {
            background: #a2e633 !important;
            color: #000000 !important;
            border-color: #a2e633 !important;
        }

        [data-theme="dark"] .text-pill:hover,
        [data-theme="dark"] .text-pill.active {
            background: #a2e633;
            color: #000000;
            border-color: #a2e633;
        }

        [data-theme="dark"] .tldr-pill:hover,
        [data-theme="dark"] .tldr-pill.active,
        [data-theme="dark"] .tldr-pill.selected {
            background: #76b314 !important;
            color: #000000;
            border: 2px solid #76b314 !important;
        }

        [data-theme="dark"] .voice-pill { border: 1px solid var(--toggle-border-color) !important; }















        /* Voice pill available state - when in synopsis section */
        .voice-pill.available {
            border: 1px solid var(--toggle-border-color);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1) !important;
            width: 60px !important;
            height: 44px !important;
            transform: none !important;
            transition: background-color 0.3s ease, color 0.3s ease !important;
            align-items: center !important;
        }

        [data-theme="dark"] .voice-pill.available {
            border: 1px solid var(--toggle-border-color);
            width: 60px !important;
            height: 44px !important;
            transform: none !important;
        }

        /* Available + Speaking states handled by main speaking rules above */

        /* Fast flashing animation for voice pill when audio is playing */
        @keyframes voicePillFlash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        
        .voice-pill.playing::before {
            animation: voicePillFlash 1.1s ease-in-out infinite;
        }

        /* Enhanced transitions for audio widget */
        .audio-control-widget {
            will-change: transform, opacity;
            backface-visibility: hidden;
            transform: translateZ(0); /* Force GPU acceleration */
        }

        .audio-control-widget.active {
            animation: subtleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes subtleGlow {
            0% {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            100% {
                box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.05);
            }
        }

        [data-theme="dark"] .audio-control-widget.active {
            animation: subtleGlowDark 2s ease-in-out infinite alternate;
        }

        @keyframes subtleGlowDark {
            0% {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            }
            100% {
                box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
            }
        }

        /* Word highlighting during speech */
        .story-content.speech-active {
            user-select: none;
        }

        .speech-word {
            position: relative;
            transition: all 0.2s ease;
        }

        .speech-word.current {
            background: linear-gradient(120deg, rgba(255, 107, 107, 0.3) 0%, rgba(255, 107, 107, 0.15) 100%);
            border-radius: 3px;
            padding: 1px 2px;
            margin: -1px -2px;
            box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.2);
        }

        .speech-word.current::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 4px;
            z-index: -1;
        }

        [data-theme="dark"] .speech-word.current {
            background: linear-gradient(120deg, rgba(255, 107, 107, 0.4) 0%, rgba(255, 107, 107, 0.2) 100%);
            box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.3);
        }

        [data-theme="dark"] .speech-word.current::before {
            background: rgba(255, 107, 107, 0.15);
        }

        /* Final word highlighting (confirmed speech recognition results) */
        .speech-word.highlighted {
            background: linear-gradient(120deg, rgba(255, 107, 107, 0.4) 0%, rgba(255, 107, 107, 0.2) 100%);
            box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.3);
            animation: wordConfirm 0.3s ease-out;
        }

        [data-theme="dark"] .speech-word.highlighted {
            background: linear-gradient(120deg, rgba(255, 107, 107, 0.5) 0%, rgba(255, 107, 107, 0.25) 100%);
            box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.4);
        }

        @keyframes wordConfirm {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.5);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 1px rgba(255, 107, 107, 0.3);
            }
        }

        /* Fixed Bottom Audio Player */
                .audio-control-widget {
            border-radius: 12px 12px 12px 12px;
            width: 700px; /* Increased width to accommodate settings button */
            height: 48px;
            border: 1px solid var(--toggle-border-color);
            position: fixed;
            bottom: 2%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 1000;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 0 20px;
            font-family: 'Input', monospace;
            transition: transform 0.3s ease, opacity 0.3s ease;
 
            backdrop-filter: blur(3px);
            background: rgba(24, 24, 24, 0.4);

        }

        [data-theme="dark"] .audio-control-widget {
         
            border-color: var(--toggle-border-color);
            backdrop-filter: blur(3px);
            background: rgba(24, 24, 24, 0.75);
        }

        .audio-control-widget.hidden {
            transform: translateX(-50%) translateY(100%);
            opacity: 0;
            pointer-events: none;
        }

        .audio-control-widget.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }



        /* Audio Widget Close Button */
        .audio-close-btn {
            width: 26px;
            height: 26px;
            background: rgba(255, 255, 255, 0.9);
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/X.png');
            background-size: 16px 16px;
            background-repeat: no-repeat;
            background-position: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: transparent; /* Hide any text content */
            font-size: 0; /* Hide text */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            line-height: 1;
            padding: 0;
            font-family: 'Input', monospace;
            flex-shrink: 0;
            position: relative;
        }

        .audio-close-btn:hover {
            opacity: 0.7;
        }

        .audio-close-btn:active {
            opacity: 0.5;
        }

        [data-theme="dark"] .audio-close-btn {
            background: transparent;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/X.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            border: 1px solid var(--toggle-border-color);
            color: transparent;
            filter: brightness(0) invert(1); /* Makes the icon white */
        }

        [data-theme="dark"] .audio-close-btn:hover {
            opacity: 0.7;
        }

        .audio-control-widget.active {
            pointer-events: auto;
        }

        /* Horizontal Layout Container */
        .audio-control-widget .audio-content {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
            justify-content: center; /* Center align all controls */
        }

        .audio-main-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .audio-control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #000000;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            font-family: 'Input', monospace;
            transition: all 0.2s ease;
            outline: none;
            width: 32px;
            height: 26px;
        }

        [data-theme="dark"] .audio-control-btn {
            background-color: transparent;
            border: 1px solid var(--toggle-border-color);
            color: var(--text-color);
        }

        .audio-control-btn:hover {
            opacity: 0.7;
        }

        [data-theme="dark"] .audio-control-btn:hover {
            opacity: 0.7;
        }

        .audio-control-btn:active {
            opacity: 0.5;
        }

        /* Play/Pause Button with Icons */
        .play-pause-btn {
            width: 36px;
            height: 26px;
            font-size: 0; /* Hide text */
            position: relative;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png');
            background-size: 16px 16px;
            background-repeat: no-repeat;
            background-position: center;
        }

        .play-pause-btn.playing {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png');
        }

        /* Dark mode - Make icons white */
        [data-theme="dark"] .play-pause-btn {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            filter: brightness(0) invert(1) !important;
        }

        [data-theme="dark"] .play-pause-btn.playing {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            filter: brightness(0) invert(1) !important;
        }

        /* Seek Buttons with Icons */
        .seek-btn {
            width: 32px;
            height: 26px;
            font-size: 0; /* Hide text */
            background-size: 16px 16px;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* Dark mode - Make seek icons white */
        [data-theme="dark"] #rewindBtn {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---LEFT.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            filter: brightness(0) invert(1) !important;
        }

        [data-theme="dark"] #fastForwardBtn {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---Right.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            filter: brightness(0) invert(1) !important;
        }

        /* Rewind Button (Left) */
        #rewindBtn {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---LEFT.png');
        }

        /* Fast Forward Button (Right) */
        #fastForwardBtn {
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---Right.png');
        }

        .speed-controls {
            display: none; /* Hidden by default, will be in settings dropdown */
        }

        .speed-btn {
            width: 38px;
            height: 24px;
            font-size: 10px;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        [data-theme="dark"] .speed-btn {
            border: 1px solid var(--toggle-border-color);
        }

        .speed-btn.active {
            background: var(--text-color);
            color: var(--bg-color);
            border-color: var(--text-color);
        }

        /* Desktop Settings Button */
        .audio-settings-btn {
            position: relative;
            width: 32px;
            height: 26px;
            background: rgba(255, 255, 255, 0.9);
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/settings.png');
            background-size: 16px 16px;
            background-repeat: no-repeat;
            background-position: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        [data-theme="dark"] .audio-settings-btn {
            background-color: transparent;
            background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/settings.png') !important;
            background-size: 16px 16px !important;
            background-repeat: no-repeat !important;
            background-position: center !important;
            border: 1px solid var(--toggle-border-color);
            filter: brightness(0) invert(1);
        }

        .audio-settings-btn:hover {
            opacity: 0.7;
        }

        #audioSettingsDropdown {

            backdrop-filter: blur(3px) !important;

        }

        /* Desktop Settings Dropdown */
        .audio-settings-dropdown {
            position: absolute;
            bottom: 60px;
            left: 0;
            background: rgba(24, 24, 24, 0.8);
            backdrop-filter: blur(3px);
            border: 1px solid var(--toggle-border-color);
            border-radius: 8px;
            padding: 8px;
            display: none;
            flex-direction: column;
            gap: 4px;
            min-width: 80px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
        }

        [data-theme="dark"] .audio-settings-dropdown {
            background: rgba(24, 24, 24, 0.98) !important;
            backdrop-filter: blur(3px) !important;
            -webkit-backdrop-filter: blur(3px) !important;
        }

        .audio-settings-dropdown.show {
            display: flex;
            animation: slideUpFade 0.4s ease;
            background: rgb(134 134 134 / 89%);
            backdrop-filter: blur(3px) !important;
            -webkit-backdrop-filter: blur(3px) !important;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .audio-settings-dropdown .speed-btn {
            width: 100%;
            height: 28px;
            font-size: 11px;
            border-radius: 4px;
            justify-content: center;
        }

        /* Progress indicator */
        .audio-progress {
            flex: 1;
            height: 26px;
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            margin: 0 16px;
        }

        .audio-progress-track {
            width: 100%;
            height: 4px;
            background: rgb(199 199 199);
            border-radius: 2px;
            position: relative;
            overflow: visible;
        }

        [data-theme="dark"] .audio-progress-track {
            background: #a1e6335d;
        }

        [data-theme="dark"]  .audio-progress-bar {
            background: #88d709de;
        }

        .audio-progress-bar {
            height: 100%;
            background: var(--text-color);
            width: 0%;
            border-radius: 3px;
            pointer-events: none;
            transition: width 0.1s ease;
        }

        .audio-progress-knob {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--text-color);
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            left: 0%;
            cursor: grab;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(255, 255, 255, 0.15);
        }

        .audio-progress-knob:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 3px 8px rgba(255, 255, 255, 0.2);
        }

        .audio-progress-knob:active,
        .audio-progress-knob.dragging {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.3);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.25);
        }

        .audio-progress-track:hover {
            background: rgb(199 199 199);
        }

        [data-theme="dark"] .audio-progress-track:hover {
            background: #a1e6335d;
        }

        [data-theme="dark"] .audio-progress-knob {
            background: #a2e633;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .audio-progress-knob:hover {
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        /* Mobile adjustments - Horizontal Layout (Scaled Desktop Design) */
        @media (max-width: 768px) {
            .audio-control-widget {
                position: fixed;
                bottom: 2%;
                left: 50%;
                transform: translateX(-50%);
                z-index: 1000;
                height: 42px; /* Scaled down from desktop 48px */
                width: 95%;
                max-width: 480px; /* Scaled down from desktop 700px */
                display: flex;
                align-items: center;
                gap: 10px; /* Scaled down from desktop 16px */
                padding: 0 12px; /* Scaled down from desktop 20px */
                flex-direction: row; /* Horizontal layout like desktop */
            }

            .audio-control-widget.hidden {
                transform: translateX(-50%) translateY(100%);
            }

            .audio-content {
                display: flex;
                align-items: center;
                gap: 10px; /* Scaled down from desktop 16px */
                flex: 1;
                justify-content: center;
            }

            /* Mobile Settings Button - Same as desktop but smaller */
            .audio-settings-btn {
                position: relative; /* Match desktop positioning */
                width: 26px; /* Scaled down from desktop 32px */
                height: 24px; /* Match seek button height */
                background: rgba(255, 255, 255, 0.9);
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/settings.png');
                background-size: 12px 12px; /* Scaled down from desktop 16px */
                background-repeat: no-repeat;
                background-position: center;
                border: 1px solid rgba(255, 255, 255, 0.3);
                border-radius: 6px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0;
                transition: all 0.2s ease;
                flex-shrink: 0;
            }

            [data-theme="dark"] .audio-settings-btn {
                background-color: transparent;
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/settings.png') !important;
                background-size: 12px 12px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                border: 1px solid var(--toggle-border-color);
                filter: brightness(0) invert(1) !important;
            }

            .audio-settings-btn:hover {
                opacity: 0.7;
            }

            /* Mobile Settings Dropdown - Positioned relative to button */
            .audio-settings-dropdown {
                position: absolute;
                bottom: 48px; /* Scaled from desktop 60px */
                left: 0;
                background: rgba(24, 24, 24, 0.75);
                backdrop-filter: blur(3px);
                -webkit-backdrop-filter: blur(3px);
                border: 1px solid var(--toggle-border-color);
                border-radius: 8px;
                padding: 6px; /* Scaled down from desktop 8px */
                display: none;
                flex-direction: column;
                gap: 3px; /* Scaled down from desktop 4px */
                min-width: 70px; /* Scaled down from desktop 80px */
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 1001;
            }

            [data-theme="dark"] .audio-settings-dropdown {
                background: rgba(24, 24, 24, 0.75);
                backdrop-filter: blur(3px);
                -webkit-backdrop-filter: blur(3px);
            }

            .audio-settings-dropdown.show {
                display: flex;
                animation: slideUpFade 0.2s ease;
            }

            .audio-settings-dropdown .speed-btn {
                width: 100%;
                height: 24px; /* Scaled down from desktop 28px */
                font-size: 10px; /* Scaled down from desktop 11px */
                border-radius: 4px;
                justify-content: center;
            }

            /* Main Controls - Horizontal like desktop */
            .audio-main-controls {
                display: flex;
                align-items: center;
                gap: 6px; /* Scaled down from desktop 8px */
                flex-shrink: 0;
            }

            /* Hide speed controls - only in dropdown */
            .speed-controls {
                display: none;
            }

            /* Progress Bar - Scaled down */
            .audio-progress {
                flex: 1;
                height: 20px; /* Scaled down from desktop 26px */
                margin: 0;
                display: flex;
                align-items: center;
            }

            /* Close Button - Far right like desktop */
            .audio-close-btn {
                position: relative; /* Match desktop positioning */
                width: 20px; /* Scaled down from desktop 26px */
                height: 20px; /* Scaled down from desktop 26px */
                background-size: 10px 10px; /* Scaled down from desktop 16px */
                flex-shrink: 0;
            }

            /* Mobile Audio Control Button Sizing */
            .audio-control-btn {
                width: 32px; /* Scaled down from desktop */
                height: 26px; /* Scaled down from desktop */
                font-size: 0; /* Hide any text/emojis */
            }

            /* Mobile Play/Pause Button */
            .play-pause-btn {
                width: 36px; /* Slightly larger for importance */
                height: 28px;
                background-size: 16px 16px; /* Scaled down from desktop */
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png');
                background-repeat: no-repeat;
                background-position: center;

            }

            .play-pause-btn.playing {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png');
            }

            /* Mobile Seek Buttons */
            .seek-btn {
                width: 30px;
                height: 24px;
                background-size: 12px 12px; /* Scaled down from desktop */
                background-repeat: no-repeat;
                background-position: center;
            }

            #rewindBtn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---LEFT.png');
            }

            #fastForwardBtn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---Right.png');
            }

            /* Dark mode mobile - Force icon properties */
            [data-theme="dark"] .play-pause-btn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20play.png') !important;
                background-size: 16px 16px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                filter: brightness(0) invert(1) !important;
            }

            [data-theme="dark"] .play-pause-btn.playing {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%20stop.png') !important;
                background-size: 16px 16px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                filter: brightness(0) invert(1) !important;
            }

            [data-theme="dark"] #rewindBtn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---LEFT.png') !important;
                background-size: 12px 12px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                filter: brightness(0) invert(1) !important;
            }

            [data-theme="dark"] #fastForwardBtn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/audio%20-%205s---Right.png') !important;
                background-size: 12px 12px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                filter: brightness(0) invert(1) !important;
            }

            [data-theme="dark"] .audio-close-btn {
                background-image: url('https://raw.githubusercontent.com/amachinic/Merem/main/X.png') !important;
                background-size: 10px 10px !important;
                background-repeat: no-repeat !important;
                background-position: center !important;
                filter: brightness(0) invert(1) !important;
            }
        }



        /* Text Highlighting */
        .highlight-target {
            position: relative;
            transition: all 0.3s ease;
        }

        .highlight-target.highlighted {
            background: rgba(162, 230, 51, 0.4); /* #a2e633 with 25% transparency */
            border-radius: 3px;
            transition: background-color 0.3s ease;
        }

        [data-theme="dark"] .highlight-target.highlighted {
            background: rgba(162, 230, 51, 0.2); /* Slightly more transparent for dark mode */
        }

        /* Inline Pill */
        .inline-pill {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid var(--toggle-border-color);
            color: var(--text-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: inherit;
            font-weight: inherit;
            line-height: inherit;
            padding: 2px 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            outline: none;
            display: inline;
            vertical-align: baseline;
            margin: 0 1px;
        }

        .inline-pill:hover {
            background: var(--card-bg-color);
            color: var(--bg-color);
            transform: translateY(-2px);
        }

        .inline-pill:active {
            transform: translateY(0);
        }

        /* Dark mode inline pill - matches CTA pill style */
        [data-theme="dark"] .inline-pill {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-color);
            border-color: var(--toggle-border-color);
        }

        [data-theme="dark"] .inline-pill:hover {
            background: rgba(255, 255, 255, 0.25);
            color: var(--text-color);
            transform: translateY(-2px);
        }

        /* Results Section - Left-aligned like Overview */
        #results {
            min-height: auto !important;
            padding: 40px 40px 200px 40px;
        }

        #results .section-content {
            max-width: none;
            width: 100%;
            padding: 0 40px;
        }

        #results .section-header {
            text-align: left;
            margin-bottom: 60px;
            max-width: none;
            width: 100%;
        }

        /* Impact header explicit spacing */
        #impact-header { padding-top: 0; }

        /* Explicit spacing between marquee block and section header */
        #results .impact-marquee { margin-bottom: 60px; }

        /* Impact Marquee (intro animation above metrics) */
        .impact-marquee {
            display: grid;
            gap: 0;
            width: 100vw; /* full bleed */
            margin-left: calc(50% - 50vw);
        }

        .impact-marquee-row {
            position: relative;
            width: 100%;
            height: 56px;
            background: transparent; /* Light mode bar */
            overflow: hidden;
            display: flex;
            align-items: center;
        }

        .impact-marquee-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .impact-marquee-content {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0;
            width: max-content;
            animation: impactMarqueeLeft 60s linear infinite;
        }

        .impact-marquee-content.reverse { animation: impactMarqueeRight 60s linear infinite; }

        /* Faster marquee on large screens */
        @media (min-width: 1400px) {
            .impact-marquee-content { animation-duration: 45s; }
            .impact-marquee-content.reverse { animation-duration: 45s; }
        }
        @media (min-width: 1800px) {
            .impact-marquee-content { animation-duration: 36s; }
            .impact-marquee-content.reverse { animation-duration: 36s; }
        }
        @media (min-width: 2400px) {
            .impact-marquee-content { animation-duration: 28s; }
            .impact-marquee-content.reverse { animation-duration: 28s; }
        }

        .impact-pill {
            display: inline-flex;
            align-items: center;
            background: transparent;
            color: #aaaaaa; /* Light mode text */
            border: 2px solid #aaaaaa; /* Light mode border */
            padding: 8px 16px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 13px;
            white-space: nowrap;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            margin-right: 20px;
            flex-shrink: 0;
            transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            cursor: default;
            user-select: none;
        }

        .impact-pill:hover {
            transform: scale(1.08);
            /* Background/border/text colors are set dynamically via JS for variability */
        }

        .impact-fade-left,
        .impact-fade-right {
            position: absolute;
            top: 0;
            height: 100%;
            width: 120px;
            z-index: 2;
            pointer-events: none;
        }

        .impact-fade-left {
            left: 0;
            background: linear-gradient(90deg,
                var(--bg-color) 0%,
                var(--bg-color) 30%,
                transparent 100%);
        }

        .impact-fade-right {
            right: 0;
            background: linear-gradient(270deg,
                var(--bg-color) 0%,
                var(--bg-color) 30%,
                transparent 100%);
        }

        @keyframes impactMarqueeLeft {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        @keyframes impactMarqueeRight {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(0); }
        }

        /* Fade-in animation for marquee when dark mode is active */
        @keyframes impactMarqueeFadeIn {
            0% { opacity: 0; transform: translateY(6px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Dark mode inversion */
        [data-theme="dark"] .impact-marquee-row {
            background: transparent; /* Dark mode bar */
        }

        [data-theme="dark"] .impact-pill {
            color: #ffffff;
            border-color: #ffffff;
        }

        

        [data-theme="dark"] .impact-fade-left {
            background: linear-gradient(90deg,
                var(--bg-color) 0%,
                var(--bg-color) 30%,
                transparent 100%);
        }

        [data-theme="dark"] .impact-fade-right {
            background: linear-gradient(270deg,
                var(--bg-color) 0%,
                var(--bg-color) 30%,
                transparent 100%);
        }

        /* Apply fade-in on dark mode toggle */
        .impact-marquee { opacity: 1; will-change: opacity, transform; }
        [data-theme="dark"] .impact-marquee {
            opacity: 0;
            animation: impactMarqueeFadeIn 600ms ease-out 120ms forwards;
        }

        /* Final video card (Implementation section) */
        .final-video-card {
            background: #000;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            width: 100%;
            height: auto; /* let video define height */
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow-light);
            position: relative;
            padding: 0;
        }
        .final-video-card video {
            position: relative;
            width: 100%;
            height: auto; /* preserve aspect ratio without cropping */
            object-fit: contain; /* ensure full video is visible inside card */
            display: block;
            background: #000;
            aspect-ratio: 16 / 9; /* reserve space before metadata loads to avoid collapse */
        }

        @media (prefers-reduced-motion: reduce) {
            [data-theme="dark"] .impact-marquee {
                animation: none;
                opacity: 1;
                transform: none;
            }
        }

        /* Large viewport optimizations */
        @media (min-width: 1400px) {
            .impact-fade-left, .impact-fade-right { width: 180px; }
            .impact-pill { font-size: 14px; padding: 12px 24px; margin-right: 32px; }
            .impact-marquee-row { height: 70px; }
        }

        @media (min-width: 1800px) {
            .impact-fade-left, .impact-fade-right { width: 220px; }
            .impact-pill { font-size: 16px; padding: 14px 28px; margin-right: 40px; }
        }

        @media (min-width: 2400px) {
            .impact-fade-left, .impact-fade-right { width: 300px; }
            .impact-pill { font-size: 18px; padding: 16px 32px; margin-right: 48px; }
            .impact-marquee-row { height: 100px; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .impact-marquee-row { height: 48px; }
            .impact-pill { padding: 8px 16px; font-size: 12px; margin-right: 12px; }
            .impact-fade-left, .impact-fade-right { width: 80px; }
        }

        /* How might we Section - Same styling as Results */
        #how-might-we {
            min-height: auto !important;
            padding: 40px;
        }

        #how-might-we .section-content {
            max-width: none;
            width: 100%;
            padding: 0 40px;
        }

        /* How might we Grid Structure */
        .how-might-we-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            max-width: 100%;
            margin: 0;
            position: relative;
        }

        #how-might-we .section-header {
            grid-column: 1 / -1 !important; /* Full width across all columns */
            text-align: left;
            margin-bottom: 60px;
            max-width: none;
            width: 100%;
            grid-row: 1 !important; /* Ensure header stays on the first row */
        }

        /* Desktop: limit HMW title to ~75% of container (6 of 8 columns) */
        @media (min-width: 1200px) {
            #how-might-we .section-header { grid-column: 1 / 7 !important; }
        }

        /* Responsive adjustments for How might we grid */
        @media (max-width: 1440px) { /* intentionally inherits defaults for now */ }

        /* How might we content styling - align with synopsis .content-container */
        .hmw-content {
            grid-column: 3 / 8 !important; /* Match .content-container default */
            grid-row: 2 !important; /* Force paragraph block below the header */
            font-family: 'Unica77LL', Arial, sans-serif;
            text-align: left;
            margin-top: 60px;
            opacity: 0; /* Start hidden for animation */
            transform: translateY(30px); /* Start slightly below for animation */
            padding-right: 40px; /* General content padding rule */
        }

        .hmw-content p {
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            color: var(--text-color);
            margin-bottom: 24px;
            text-align: left;
            
            /* Enhanced typography for better word flow */
            max-width: 65ch; /* Approximately 7-10 words per line */
            hyphens: none; /* Disable hyphenation to prevent word breaking */
            word-wrap: normal; /* Prevent aggressive word wrapping */
            overflow-wrap: break-word; /* Only break extremely long words */
            white-space: normal;
            
            /* Advanced orphan/widow control */
            orphans: 4; /* Minimum 4 lines at bottom of page */
            widows: 4; /* Minimum 4 lines at top of page */
            
            /* Improved text rendering */
            text-rendering: optimizeLegibility;
            font-kerning: auto;
            font-variant-ligatures: common-ligatures;
            
            /* Subtle letter and word spacing for better readability */
            letter-spacing: -0.01em;
            word-spacing: 0.05em;
        }

        .hmw-content p:last-child {
            margin-bottom: 0;
        }

        /* Large Screens - Keep alignment with story-content columns */
        @media (min-width: 1600px) {
            .hmw-content { grid-column: 3 / 7 !important; margin-right: 160px; }
        }

        /* Large Tablet Responsive - matches defect-glossary-content */
        @media (max-width: 1200px) {
            .hmw-content {
                grid-column: 2 / 8; /* Match .content-container tablet */
                margin-top: 40px;
            }
        }
        
        @media (max-width: 1024px) {
            .how-might-we-grid { grid-template-columns: repeat(8, 1fr); gap: 30px; }
            #how-might-we .section-header { grid-column: 1 / -1 !important; }
            .hmw-content { grid-column: 1 / 6 !important; margin-top: 40px; }
            .hmw-content p { font-size: var(--font-size-body); max-width: 60ch; }
        }

        @media (max-width: 768px) {
            .how-might-we-grid { grid-template-columns: 1fr 1fr; gap: 20px; }
            .hmw-content { grid-column: 1 / 3 !important; margin-top: 32px; gap: 30px; }
            .hmw-content p { font-size: 1rem; /* 16px */ margin-bottom: 20px; max-width: 55ch; line-height: 1.5; word-spacing: 0.03em; }
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .how-might-we-grid { grid-template-columns: 1fr; }
            /* Title spans ~7/8 width, leaving a right gutter */
            #how-might-we .section-header { width: 87.5% !important; }
            .hmw-content { grid-column: 1 / 2 !important; gap: 30px; }
            .hmw-content p { font-size: 0.9375rem; /* 15px */ margin-bottom: 20px; max-width: 50ch; }
        }

        /* Remove overrides that forced single-column placement on large viewports */
        /* .hmw-paragraph grid overrides removed to respect .hmw-content placement */

        /* Old defect-glossary-content styles removed - now handled in layout container section */

        .defect-glossary-content p {
            font-size: var(--font-size-body);
            line-height: var(--line-height-body);
            color: var(--text-color);
            margin-bottom: 24px;
            text-align: left;
            
            
            /* Enhanced typography for better word flow */
            max-width: 65ch; /* Approximately 7-10 words per line */
            hyphens: none; /* Disable hyphenation to prevent word breaking */
            word-wrap: normal; /* Prevent aggressive word wrapping */
            overflow-wrap: break-word; /* Only break extremely long words */
            white-space: normal;
            
            /* Advanced orphan/widow control */
            orphans: 4; /* Minimum 4 lines at bottom of page */
            widows: 4; /* Minimum 4 lines at top of page */
            
            /* Improved text rendering */
            text-rendering: optimizeLegibility;
            font-kerning: auto;
            font-variant-ligatures: common-ligatures;
            
            /* Subtle letter and word spacing for better readability */
            letter-spacing: -0.01em;
            word-spacing: 0.05em;
        }

        .defect-glossary-content p:last-child {
            margin-bottom: 0;
        }

        /* Large Screens - Better Readability */
        @media (min-width: 1600px) {
            .defect-glossary-content {
                grid-column: 1 / 6; /* 5 columns (62.5%) - matches triage-info-card desktop */
                margin-right: 160px;
            }
        }

        /* Note: Responsive rules for defect-glossary-content now handled in the main layout container section below */

        /* Defect Glossary Layout Container - Similar to triage layout */
        .defect-glossary-layout-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            align-items: start;
            margin-top: 60px;
        }

        /* ===== Defect Glossary: Rearranged Layout ===== */
        /* Make the entire section content a grid so header + component can stack on left, content on right */
        #defect-glossary .section-content {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            align-items: start;
        }

        /* Use inner container to hold component (left) and content (right) together */
        #defect-glossary .defect-glossary-layout-container {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 40px;
            grid-column: 1 / -1; /* occupy full section width */
            grid-row: 2; /* below header */
        }

        /* Header stays on row 1 (user previously set 1 / 7) */
        #defect-glossary .section-header { grid-column: 1 / 7 !important; grid-row: 1; }

        /* Inside container: left = component, right = content */
        #defect-glossary .defect-glossary-layout-container .defect-table-container { grid-column: 1 / 4; grid-row: 1; }
        #defect-glossary .defect-glossary-layout-container .defect-glossary-content { grid-column: 5 / 9; grid-row: 1; align-self: start; margin-top: 0 !important; }

        /* Tablet/Mobile: stack header, component, then content */
        @media (max-width: 1200px) {
            #defect-glossary .section-content { grid-template-columns: 1fr !important; gap: 24px; }
            #defect-glossary .section-header { grid-column: 1 !important; grid-row: 1; }
            #defect-glossary .defect-glossary-layout-container { grid-column: 1 !important; grid-row: 2; grid-template-columns: 1fr !important;  }
            #defect-glossary .defect-glossary-layout-container .defect-table-container { grid-column: 1; grid-row: 1; }
            #defect-glossary .defect-glossary-layout-container .defect-glossary-content { grid-column: 1; grid-row: 2; }
        }

        /* Default desktop layout: 5/8 columns for content, 3/8 for component - matches triage exactly */
            .defect-glossary-content {
            grid-column: 1 / 6; /* 5 columns (62.5%) - matches triage-info-card */
            font-family: 'Unica77LL', Arial, sans-serif;
            text-align: left;
            opacity: 0; /* Start hidden for animation */
            transform: translateY(30px); /* Start slightly below for animation */
            padding-right: 40px; /* General content padding rule */
        }

        /* Defect Table Container - Match triage component layout and styling */
        .defect-table-container {
            grid-column: 6 / 9; /* 3 columns (37.5%) - matches triage-component-container */
            width: 100%;
            margin: 0;
            /* Grid column handled by responsive system above */
        }

        /* Defect Table Card - aligned with triage component light styling */
        .defect-table-card {
            background: var(--surface-color);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px var(--shadow-light);
            overflow: hidden;
            height: 640px;
            width: 100%;
            display: flex;
            flex-direction: column;
            transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-color);
        }

        /* Defect Table Footer */
        .defect-table-footer {
            height: 10px;
            background: var(--surface-accent);
            border-radius: 0 0 16px 16px;
            flex-shrink: 0;
        }

        /* Defect Table Header */
        .defect-table-header {
            background: var(--surface-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 18px 24px;
            color: var(--text-color);
        }

        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .filter-label {
            display: flex;
            align-items: center;
            white-space: nowrap;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            font-family: 'Unica77LL', Arial, sans-serif;
        }

        .filter-label svg {
            margin-right: 8px;
        }



        [data-theme="dark"]     .filter-label svg {
            margin-right: 8px;
            stroke: var(--text-secondary) !important;
        }

        [data-theme="dark"]     .filter-label {
            color: var(--text-secondary) !important;
        }

        .severity-filters {
            display: flex;
            background: var(--surface-accent);
            border-radius: 8px;
            padding: 3px;
            gap: 8px;
            flex-wrap: nowrap;
            width: 100%;
        }

        .severity-btn {
            flex: 1;
            min-width: 60px;
            height: 30px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s, color 0.2s;
            padding: 0 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-family: 'Unica77LL', Arial, sans-serif;
        }

        .severity-btn.active {
            background-color: var(--text-color);
            color: var(--surface-color);
            border-color: var(--text-color);
        }

        .severity-btn:not(.active) {
            background: var(--surface-secondary);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        /* Inherit neutral style explicitly to avoid empty ruleset */
        .severity-btn.low-severity:not(.active) { background: var(--surface-color); color: var(--case-study-qa-framework); border-color: var(--border-color); }

        .severity-btn.low-severity.active { background-color: #E2F6C8 !important; color: var(--case-study-qa-framework) !important;             font-weight: 600 !important;}

        .severity-btn.medium-severity:not(.active) { background: var(--surface-color); color: var(--case-study-qa-framework); border-color: var(--border-color); }

        .severity-btn.medium-severity.active { background-color: #dfdc40 !important; color: var(--case-study-qa-framework) !important;             font-weight: 600 !important;}

        .severity-btn.high-severity:not(.active) { background: var(--surface-color); color: var(--text-secondary); border-color: var(--border-color); }

        .severity-btn.high-severity.active {
            background-color: #a2e633 !important;
            color: var(--case-study-qa-framework) !important;
            font-weight: 600;
        }

        /* Defect Cards List */
        .defect-cards-list {
            padding: 12px 16px 24px 24px;
            height: 420px;
            overflow-y: scroll;
            scrollbar-width: thin;
            scrollbar-color: var(--text-secondary) transparent;
            flex: 1;
            scrollbar-gutter: stable;
            background: var(--surface-secondary);
        }

        .defect-cards-list::-webkit-scrollbar {
            width: 8px;
            background: var(--surface-color);
        }

        .defect-cards-list::-webkit-scrollbar-track {
            background: var(--surface-color);
            border-radius: 4px;
        }

        .defect-cards-list::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .defect-cards-list::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .defect-cards-list::-webkit-scrollbar-corner {
            background: var(--surface-color);
        }

        /* Hide scrollbar arrows */
        .defect-cards-list::-webkit-scrollbar-button {
            display: none;
        }

        .defect-cards-list .defect-card {
            background: var(--surface-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            box-shadow: 0 1px 2px 0 var(--shadow-light);
            border: 1px solid var(--border-color);
            transition: box-shadow 0.15s, opacity 0.4s ease, transform 0.4s ease;
            opacity: 0;
            transform: translateY(16px);
            color: var(--text-color);
            will-change: opacity, transform;
        }

        .defect-card-content {
            display: grid;
            grid-template-columns: auto 1fr auto;
            grid-template-rows: auto auto;
            gap: 8px 12px;
            align-items: start;
        }

        .defect-card-icon {
            grid-column: 1;
            grid-row: 1;
            width: 36px;
            height: 36px;
            margin-top: 2px; /* Slight adjustment for better alignment */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .defect-card-icon svg {
            width: 32px !important;
            height: 32px !important;
            fill: #FFF !important;
            stroke: none;
            flex-shrink: 0;
        }

        .defect-card-title {
            grid-column: 2;
            grid-row: 1;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            align-self: center;
            margin: 0;
        }

        .defect-card-severity {
            grid-column: 3;
            grid-row: 1;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 500;
            white-space: nowrap;
            font-family: 'Unica77LL', Arial, sans-serif;
            align-self: center; /* Center align with icon and title */
        }

        .defect-card-description {
            grid-column: 2 / 4;
            grid-row: 2;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            font-family: 'Unica77LL', Arial, sans-serif;
            margin: 0;
        }

        /* Duplicate rules removed - now handled in grid layout above */

        .defect-card-severity.high {
            background-color: #A2E633 !important;
            color: var(--case-study-qa-framework);
            border: 1px solid #A2E633 !important;
            font-weight: 600;
        }

        .defect-card-severity.medium {
            background-color: #dfdc40 !important;
            color: var(--case-study-qa-framework);
            border: 1px solid #dfdc40 !important;
            font-weight: 600;
        }

        .defect-card-severity.low {
          background-color: #E2F6C8 !important;
    color: var(--case-study-qa-framework);
    border: 1px solid #E2F6C8 !important;
    font-weight: 600;
        }

        /* Description rule removed - now handled in grid layout above */



        /* Empty state */
        .defect-empty-state {
            text-align: center;
            padding: 32px 0;
            color: #9ca3af;
        }

        .defect-empty-icon {
            width: 32px;
            height: 32px;
            background-color: #d1d5db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
        }

        .defect-empty-icon span {
            font-size: 12px;
            font-weight: 500;
            color: #4b5563;
        }

        .defect-empty-text {
            font-size: 12px;
            font-family: 'Unica77LL', Arial, sans-serif;
        }

        /* Responsive Design - Match triage layout exactly */
        @media (max-width: 1440px) {
            .defect-glossary-content {
                grid-column: 1 / 6; /* 5 columns - matches triage-info-card */
            }
            
            .defect-table-container {
                grid-column: 6 / 9; /* 3 columns - matches triage-component-container */
            }
        }

        @media (max-width: 1200px) {
            .defect-glossary-layout-container {
                grid-template-columns: 1fr !important;
                gap: 24px;
                margin-top: 40px;
                justify-items: start; /* Left align items for proper header/content alignment */
            }
            
            .defect-glossary-content {
                grid-column: 1 !important;
                padding-top: 40px;
                margin-bottom: 20px;
                padding-right: 0;
                justify-self: start; /* Left align the content with header */
                max-width: 800px; /* Match header max-width for consistency */
            }

            .defect-table-container {
                grid-column: 1 !important;
                flex-direction: column;
                align-items: center;
                justify-self: center; /* Center align the table - override container's start alignment */
            }

            .defect-table-card {
                height: 640px; /* Includes 10px footer */
                width: 100%;
                max-width: 400px;
            }

            .defect-cards-list {
                height: 350px; /* Reduced by 10px for footer */
            }
        }

        /* Mobile responsive - matches triage mobile behavior */
        @media (max-width: 768px) {
            .triage-layout-container {
                padding: 0 56px 0 0 !important; 
            }
            
            .defect-table-container {
                padding: 0 56px 0 0 !important; 
            }
            
            /* Mobile typography for defect glossary content */
            .defect-glossary-content p {
                font-size: 14px; /* Mobile font size */
                margin-bottom: 18px;
            }

            .defect-table-card {
                width: 100% !important; /* Full width on mobile */
                max-width: none !important; /* Remove max-width constraint */
            }

            .defect-cards-list {
                height: 300px; /* Reduced by 10px for footer */
                padding: 12px;
                padding-right: 16px;
            }

            .defect-table-header {
                padding: 12px;
            }

            .severity-filters {
                gap: 8px;
            }

            .severity-btn {
                font-size: 12px;
                min-width: 46px;
            }
        }

        /* Defect Table Caption */
        .defect-table-caption {
            margin-top: 20px;
            text-align: left;
        }

        .defect-table-caption p {
            font-family: 'Input', 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: var(--secondary-text-color);
            margin: 0;
            max-width: 800px; /* Limit width for better readability */
        }

        /* Responsive caption width alignment */
        @media (max-width: 1200px) {
            .defect-table-caption {
                width: 100%;
                max-width: 480px; /* Match defect table card max-width */
                text-align: left; /* Ensure left alignment */
            }
            
            .defect-table-caption p {
                max-width: none; /* Remove max-width restriction on mobile */
                width: 100%;
                text-align: left;
            }
        }

        @media (max-width: 768px) {
            .defect-table-caption {
    
                max-width: none; /* Full width on mobile */
                margin-left: 0;
                margin-right: 0;
            }
        }

        /* Defect Glossary Section - Duplicate styles from how-might-we */
        #defect-glossary .section-content {
            max-width: none;
        }

        #defect-glossary .section-header {
            grid-column: 1 / 7; /* Extended to match how-might-we */
            text-align: left;
            margin-bottom: 0px !important;
            max-width: 1200px;
            width: 100%;
        }

        @media (min-width: 1440px) {
            #defect-glossary .section-content {
                padding: 0 40px;
            }
        }



        @media (max-width: 1200px) {
            #defect-glossary .section-header {
                grid-column: 1 !important; /* Single column at tablet breakpoint */
                justify-self: start; /* Left align with content */
                text-align: left; /* Keep text left-aligned */
                max-width: 800px; /* Constrain width for better readability */
            }
        }

        @media (max-width: 1024px) {
            #defect-glossary .section-header {
                grid-column: 1;
            }
        }

        /* How might we Pills Styling */
        .hmw-pills-container {
            display: flex;
            gap: 16px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .hmw-pill {
            background: #f8f9fa;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: var(--text-color);
            border: 1px solid var(--toggle-border-color);

            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.2s ease;
            opacity: 0;
            transform: translateY(6px);
        }

        .hmw-pill:hover {
            transform: translateY(-1px);
        }

        [data-theme="dark"] .hmw-pill {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        [data-theme="dark"] .hmw-pill:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Word-by-word animation for hmw title */
        .hmw-animated-title {
            opacity: 1;
            letter-spacing: -0.02em !important;
            line-height: 1.2 !important;

        }

        .hmw-word {
            opacity: 0;
            display: inline-block;
            transition: opacity 0.54s ease;
        }

        .hmw-word.visible {
            opacity: 1;
        }

        /* Responsive pills */
        @media (max-width: 768px) {
            .hmw-pills-container {
                gap: 12px;
                margin-top: 30px;
            }

            .hmw-pill {
                padding: 10px 20px;
                font-size: 12px;
            }
        }

        /* ========================================
           Process Map Canvas Styling
        ======================================== */
        
        /* Aggressive reset for process map - override ALL potential conflicts */
        .process-map-canvas,
        .process-map-canvas *,
        .process-map-canvas *::before,
        .process-map-canvas *::after {
            box-sizing: border-box !important;
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
        }
        
        /* Override any inherited spacing from parent elements */
        #process-map .process-map-canvas-container {
            padding: 0;
            margin-top: 40px !important;
            margin-left: auto !important;
            margin-right: auto !important;
        }
        
        /* Keep normal section-content padding - that was correct */
        
        .process-map-canvas-container {
            margin-top: 40px;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        .process-map-canvas {
            position: relative;
            width: 100%;
            height: 600px;
    
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 0 !important;
            margin: 0 !important;
        }

        .canvas-content {
            width: 100%;
            height: 100%;
            overflow: hidden; /* No native scrollbars */
            position: relative;
            cursor: grab;
            padding: 0;
            margin: 0;
            border: none;
            touch-action: none; /* We'll handle gestures manually */
            overscroll-behavior: contain; /* Prevent page scroll chaining */
            white-space: nowrap; /* Allow wide child to extend horizontally */
        }

        .canvas-content:active {
            cursor: grabbing;
        }

        .process-map-image {
            position: relative;
            display: inline-block;  /* Shrink-to-fit around its contents */
            width: max-content;     /* Expand to content width (can exceed parent) */
            height: 100%;           /* Fit canvas height */
            will-change: transform; /* Optimize for animations */
            transform: translateZ(0); /* Force hardware acceleration */
            backface-visibility: hidden; /* Prevent flickering */
            user-select: none; /* Prevent text selection */
            z-index: 1;
        }

        .process-map-img {
            height: 100%;
            width: auto;
            display: block;
            pointer-events: none;
        }

        .process-map-image img:hover {
            /* transform: scale(1.02); DISABLED FOR DEBUGGING */
            opacity: 0.95;
        }

        /* Scroll Hint */
        .scroll-hint {
            position: absolute;
            padding: 4px 8px !important;
            bottom: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-family: 'Input', monospace;
            opacity: 0.8;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .process-map-canvas:hover .scroll-hint {
            opacity: 1;
        }

        /* Zoom Hint (always visible, top-right) */
        .process-map-zoom-hint {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 6px 12px !important;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 999px;
            font-size: 12px;
            font-family: 'Input', monospace;
            opacity: 1;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
        }

        .process-map-zoom-hint svg {
            width: 14px;
            height: 14px;
            display: block;
            color: currentColor;
        }

        /* Dark mode adjustments */
        [data-theme="dark"] .process-map-canvas {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .process-map-image img {
            box-shadow: none;
        }

        /* Custom Scrollbar for Canvas */
        .canvas-content::-webkit-scrollbar {
            height: 8px;
        }

        .canvas-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }

        .canvas-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .canvas-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .canvas-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .canvas-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .canvas-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .process-map-canvas {
                height: 640px;
            }
        }

        @media (max-width: 768px) {
            .process-map-canvas {
                height: 520px;
            }
            
            .scroll-hint {
                font-size: 11px;
                padding: 6px 10px;
            }
        }

        @media (max-width: 480px) {
            .process-map-canvas {
                height: 460px;
            }
        }

        /* Process Map Caption */
        .process-map-caption {
            margin-top: 20px;
            text-align: left;
        }

        .process-map-caption p {
            font-family: 'Input', 'SF Mono', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: var(--secondary-text-color);
            margin: 0;
            max-width: 800px; /* Limit width for better readability */
        }



        .results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 60px 0px 0px 0px !important;
        }

        .metric-card {
            text-align: center;
            padding: 20px 20px;
            background: var(--card-bg-color);
            color: var(--card-text-color);
            border-radius: 16px;
            border: 1px solid transparent;
            opacity: 0;
            transform: translateY(30px);
            border-color: var(--toggle-border-color);
        }

        .metric-number {
            font-size: 48px;
            font-weight: 500;
            color: var(--card-text-color);
            margin-bottom: 12px;
            line-height: 1.1;
        }

        .metric-label {
            color: #a7a7a7;
            font-size: 14px;
            opacity: 0.8;
            font-family: 'Input', monospace;
        }

        /* Individual Metric Card Colors - Mapped from Gallery Cards */
        .metric-card:nth-child(1) {
            background-color: var(--case-study-qa-framework) !important;
        }

        .metric-card:nth-child(2) {
            background-color: var(--case-study-design-system) !important;
        }

        .metric-card:nth-child(3) {
            background-color: var(--case-study-mobile-experience) !important;
        }

        .metric-card:nth-child(4) {
            background-color: var(--case-study-ai-integration) !important;
        }

        /* Extra Large Screens - Optimized for 1440px+ */
        @media (min-width: 1440px) {
            #results .section-content,
            #how-might-we .section-content {
                padding: 0 40px;
            }

            .results-grid {
                gap: 20px;
                margin: 60px 0px 0px 0px !important;
            }

            .metric-card {
                padding: 30px 20px;
            }
        }

        /* Large Screens - Better Readability */
        @media (min-width: 1600px) {
            .content-container {
                grid-column: 3 / 7;
                margin-right: 160px
            }
        }

        /* Large Tablet Responsive */
        @media (max-width: 1200px) {
            .synopsis-title {
                grid-column: 3 / 7;
                /* Font size handled by clamp() */
            }




        }

        /* Tablet Responsive */
        @media (max-width: 1024px) {
            .synopsis-title {
                grid-column: 1 / 7;
                /* Font size handled by clamp() */
            }

            .content-container {
                grid-column: 1 / 6;
            }



            .story-content p {
                font-size: 17px;
            }

            .cta-pill {
                font-size: 17px;
            }

            .text-pill {
                width: 72px;
            }

            .voice-pill {
                width: 60px !important;
                min-width: 60px !important;
                max-width: 60px !important;
                height: 44px !important;
                min-height: 44px !important;
                max-height: 44px !important;
                transform: none !important;
            }




        }

        @media (max-width: 900px) {
            .synopsis-title {
                grid-column: 1 / 2;
                /* Font size handled by clamp() */
            }

            .eight-column-content {
                grid-template-columns: 1fr 1fr;
                gap: 30px;
                margin-top: 40px;
            }

            .content-container {
                grid-column: 1 / 3;
            }



            .story-content p {
                font-size: 22px; /* Standardized font size */
            }

            .cta-pill {
                font-size: 17px;
            }

            .text-pill {
                width: 72px;
            }

            .voice-pill {
                width: 60px !important;
                min-width: 60px !important;
                max-width: 60px !important;
                height: 44px !important;
                min-height: 44px !important;
                max-height: 44px !important;
                transform: none !important;
            }


        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .section {
                padding: 0 20px 0 20px;
            }

            .content-grid {
                grid-template-columns: 1fr;
                gap: 40px;
            }

            .framework-grid {
                grid-template-columns: 1fr;
            }



            .content-text h3,
            .content-text p,
            .content-image {
                transform: translateY(30px);
            }

            #synopsis .section-content {
                padding: 0 !important;
            }

            .synopsis-title {
                font-size: 32px; /* Override clamp for mobile consistency */
                margin-bottom: 32px;
                grid-column: 1 / 2;
            }



            .eight-column-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }

            .content-container {
                grid-column: 1 / 2;
                gap: 30px;
            }



            .story-content p {
                font-size: 17px; /* Standardized to match 768px */
                margin-bottom: 20px;
            }

            .cta-pill {
                font-size: 16px;
                padding: 6px 12px;
            }

            .text-pill {
                width: 64px;
            }

            .voice-pill {
                width: 60px !important;
                min-width: 60px !important;
                max-width: 60px !important;
                height: 44px !important;
                min-height: 44px !important;
                max-height: 44px !important;
                transform: none !important;
            }



            .speech-word.current {
                padding: 0px 1px;
                margin: 0px -1px;
            }




        }

        /* Natural title wrap for smaller viewports */
        @media (max-width: 600px) {
            .synopsis-title .mobile-break::before {
                content: "\A";
                white-space: pre;
            }
        }

        /* Extra Small Mobile */
        @media (max-width: 480px) {
            .synopsis-title {
                font-size: 28px; /* Override clamp for extra small mobile */
                margin-bottom: 24px;
            }

            .story-content p {
                font-size: 15px;
                line-height: 1.5;
                margin-bottom: 18px;
            }
            
            .hmw-content {
                margin-top: 24px;
            }
            
            .hmw-content p {
                font-size: 15px; /* Standardized to 15px for mobile */
                margin-bottom: 18px;
            }
            
            .defect-glossary-content {
                margin-top: 24px;
            }
            
            .defect-glossary-content p {
                font-size: 14px; /* Standardized to 15px for mobile */
                margin-bottom: 18px;
            }

            .overlay-image {
                height: 200px;
            }

            .cta-pill {
                font-size: 15px;
                padding: 5px 10px;
            }

            .text-pill {
                width: 60px;
            }

            .voice-pill {
                width: 50px !important;
            }
        }

        /* ===== DARK MODE SUPPORT FOR DEFECT GLOSSARY ===== */
        [data-theme="dark"] .defect-table-card {
            background: var(--case-study-design-system);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            color: var(--card-text-color);
        }

        [data-theme="dark"] .defect-table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .defect-table-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--card-text-color);
        }

        [data-theme="dark"] .defect-cards-list {
            background: #141414 !important;
        }


        [data-theme="dark"] .defect-table-footer {
            background: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .filter-label {
            color: var(--card-text-color);
        }

        [data-theme="dark"] .severity-filters {
            background: rgba(255, 255, 255, 0.08);
        }

        [data-theme="dark"] .severity-btn {
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .severity-btn.active {
            background-color: rgba(255, 255, 255, 0.8);
            color: var(--case-study-design-system);
            border-color: rgba(255, 255, 255, 0.8);
            font-weight: 600 !important;
        }

        /* Override only the 'ALL' CTA in defect glossary for dark mode */
        [data-theme="dark"] #defect-glossary #severity-all-defect.severity-btn.active {
            background-color: #ffffff !important;
            color: #000000 !important;
            border-color: #ffffff !important;
        }

        [data-theme="dark"] .severity-btn:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .defect-cards-list {
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        [data-theme="dark"] .defect-cards-list::-webkit-scrollbar {
            background: transparent;
        }

        [data-theme="dark"] .defect-cards-list::-webkit-scrollbar-track {
            background: transparent;
        }

        [data-theme="dark"] .defect-cards-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .defect-cards-list .defect-card {
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            color: var(--card-text-color);
        }

        [data-theme="dark"] .defect-card-title {
            color: var(--card-text-color);
        }

        [data-theme="dark"] .defect-card-description {
            color: #a7a7a7;
        }

        /* ===== Minimal Greyscale UI Overrides: Header Buttons, Status, Severity Filters ===== */
        /* Header buttons (light and dark): align to minimal greyscale */
        .header-add-btn,
        .header-sync-btn {
            background-color: var(--surface-color) !important;
            border: 1px solid var(--border-color) !important;
            color: var(--text-secondary) !important;
            box-shadow: none !important;
        }

        .header-add-btn:hover,
        .header-sync-btn:hover {
            background-color: var(--interactive-hover) !important;
            border-color: var(--border-hover) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .header-add-btn,
        [data-theme="dark"] .header-sync-btn {
            background-color: var(--surface-color) !important;
            border-color: var(--border-color) !important;
            color: var(--text-secondary) !important;
        }

        /* Severity filters: neutral greyscale */
        .severity-filters {
            background: var(--surface-secondary) !important;
            border: 1px solid var(--border-color) !important;
            padding: 4px !important;
            gap: 6px !important;
        }

        .severity-btn {
            border: 1px solid var(--border-color);
            background: var(--surface-color);
            color: var(--text-secondary);
        }

        .severity-btn:not(.active) {
            background: var(--surface-color) !important;
            color: var(--text-secondary) !important;
            border-color: var(--border-color) !important;
        }
        
       [data-theme="dark"] .severity-btn:not(.active) {
            background: var(--surface-color) !important;
            color: #FFF !important;
            border-color: var(--border-color) !important; 
        }

        .severity-btn.active {
            background-color: var(--case-study-qa-framework) !important;
            color: var(--bg-color) !important;
            border-color: var(--text-color) !important;
        }

        /* Neutralize severity-specific color variants */
        .severity-btn.low-severity,
        .severity-btn.medium-severity,
        .severity-btn.high-severity {
            border-color: var(--border-color) !important;
        }


        /* Status buttons: minimal greyscale across states */
        .status-btn {
            border: 1px solid var(--border-color) !important;
            background: var(--surface-color) !important;
            color: var(--text-secondary) !important;
        }

        .status-btn:hover {
            background: var(--interactive-hover) !important;
            border-color: var(--border-hover) !important;
            color: var(--text-color) !important;
        }

        .status-btn.selected {
            background-color: var(--text-color) !important;
            color: var(--bg-color) !important;
            border-color: var(--text-color) !important;
        }

        /* Neutralize per-status color rules (light and dark) */
        .status-btn[data-status] {
            border-color: var(--border-color) !important;
            color: var(--text-secondary) !important;
            background: var(--surface-color) !important;
        }

        [data-theme="dark"] .status-btn[data-status] {
            border-color: var(--border-color) !important;
            color: var(--text-secondary) !important;
            background: #161616 !important;
        }

        /* Ensure selected state in dark mode keeps the same palette unless explicitly overridden */
        [data-theme="dark"] .status-btn[data-status].selected {
            border-color: var(--border-color) !important;
            color: var(--text-secondary) !important;
            background: #161616 !important;
        }

        /* ===== Minimal Greyscale UI Overrides: Add Link Modal ===== */
        .modal-footer {
            background-color: var(--surface-secondary) !important;
            border-top: 1px solid var(--border-color) !important;
        }

        .modal-btn {
            border: 1px solid var(--border-color) !important;
            box-shadow: none !important;
        }

        .modal-btn-secondary,
        .modal-btn-sync {
            background-color: var(--surface-color) !important;
            color: var(--text-secondary) !important;
            border-color: var(--border-color) !important;
        }

        .modal-btn-secondary:hover,
        .modal-btn-sync:hover {
            background-color: var(--interactive-hover) !important;
            border-color: var(--border-hover) !important;
            color: var(--text-color) !important;
        }

        .modal-btn-primary {
            background-color: var(--text-color) !important;
            color: var(--bg-color) !important;
            border-color: var(--text-color) !important;
        }

        .modal-btn-primary:hover {
            background-color: var(--text-color) !important;
            filter: brightness(0.9) !important;
            border-color: var(--text-color) !important;
        }

        .modal-btn-primary:disabled {
            background-color: var(--surface-secondary) !important;
            color: var(--text-secondary) !important;
            border-color: var(--border-color) !important;
        }

        .service-option {
            border: 1px solid var(--border-color) !important;
            background-color: var(--surface-color) !important;
            color: var(--text-secondary) !important;
            box-shadow: none !important;
        }

        .service-option:hover {
            border-color: var(--border-hover) !important;
            background-color: var(--interactive-hover) !important;
            color: var(--text-color) !important;
        }

        .service-option.selected {
            border-color: var(--text-color) !important;
            background-color: var(--surface-secondary) !important;
            color: var(--text-color) !important;
        }

        [data-theme="dark"] .modal-content {
            background: var(--surface-color) !important;
            border-color: var(--border-color) !important;
        }

        [data-theme="dark"] .modal-header {
            border-bottom-color: var(--border-color) !important;
        }

        [data-theme="dark"] .modal-header h3 {
            color: var(--text-color) !important;
        }

        /* ===== Status icon contrast alignment ===== */
        .status-btn .status-icon {
            opacity: 0.85;
            filter: none;
            transition: opacity 0.15s ease-in-out, filter 0.15s ease-in-out;
        }

        /* Default (non-selected) status icons: neutral greyscale in light mode */
        .status-btn:not(.selected) .status-icon {
            filter: grayscale(1) saturate(0) brightness(0.55) contrast(1.05) !important;
        }

        .status-btn:hover .status-icon {
            opacity: 1;
        }

        /* Selected: ensure icon contrasts with selected background (consistent for all statuses) */
        .status-btn.selected .status-icon {
            filter: brightness(0) invert(1) !important;
            opacity: 1;
        }

        /* Dark theme: non-selected icons should be light; selected becomes dark on light selected bg */
        /* Default (non-selected) status icons: neutral greyscale in dark mode (slightly brighter) */
        [data-theme="dark"] .status-btn:not(.selected) .status-icon {
            opacity: 0.95;
            filter: grayscale(1) saturate(0) brightness(0.95) contrast(1.05) !important;
        }

        [data-theme="dark"] .status-btn.selected .status-icon {
            filter: brightness(0) invert(1) !important;
        }

        [data-theme="dark"] .defect-table-footer {
            background-color: var(--surface-accent);
        }



        /* Loading States */
        .fade-in { opacity: 0; transform: translateY(30px); }
        .fade-in.show { opacity: 1; transform: translateY(0); transition: opacity 0.6s ease, transform 0.6s ease; }

        .slide-in-left {
            opacity: 0;
            transform: translateX(-50px);
        }

        .slide-in-right {
            opacity: 0;
            transform: translateX(50px);
        }



        /* Enhanced framework card interactions */
        .framework-card {
            will-change: transform;
            transform-style: preserve-3d;
        }

        .framework-card:hover {
            z-index: 10;
        }

        /* Smooth scrolling and performance */
        /* Removed will-change properties to prevent performance issues */

        /* Enhanced typewriter cursor */
        .hmw-statement::after {
            content: '|';
            /* Removed blink animation */
            margin-left: 2px;
        }

        /* Removed blink keyframes */
        
        /* GlobalClockComponent handles its own positioning */
        
        /* Fade overlay for smooth transitions */
        .fade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f0f0f;
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
        }

        .fade-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Navigation state styling */
        .navigating {
            overflow: hidden;
        }

        /* Light mode fade-out effect */
        .fade-out {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        /* Custom Scrollbar Implementation */
        /* Hide default scrollbar */
        body::-webkit-scrollbar {
            display: none;
        }

        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Custom Scrollbar Track */
        .custom-scrollbar {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 60vh;
            background: var(--toggle-border-color);
            border-radius: 2px;
            z-index: 1000;
            opacity: 0.6;
            transition: opacity 0.3s ease;
        }

        .custom-scrollbar:hover {
            opacity: 1;
        }

        .scroll-track {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .scroll-thumb {
            position: absolute;
            width: 100%;
            background: var(--text-color);
            border-radius: 2px;
            transition: background-color 0.2s ease;
            min-height: 20px;
            cursor: pointer;
        }

        .scroll-thumb:hover {
            background: var(--secondary-text-color);
        }

        /* Section Indicators */
        .section-indicators {
            position: fixed;
            right: 35px;
            top: 50%;
            transform: translateY(-50%);
            height: 60vh;
            z-index: 1001;
            pointer-events: none;
        }

        .section-indicator {
            position: absolute;
            right: 0;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .section-indicator.active {
            opacity: 1;
        }

        .indicator-bubble {
            background: var(--tooltip-bg-color);
            color: var(--tooltip-text-color);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 400;
            white-space: nowrap;
            position: relative;
            box-shadow: 0 2px 5px var(--shadow-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            letter-spacing: 0.02em;
            line-height: 1.2;
        }

        .indicator-bubble::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid var(--tooltip-bg-color);
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        /* Mobile adjustments */
        @media (max-width: 768px) {
            .custom-scrollbar {
                right: 10px;
                width: 2px;
                height: 50vh;
            }

            .section-indicators {
                right: 20px;
                height: 50vh;
            }

            .indicator-bubble {
                font-size: 11px;
                padding: 4px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Global Clock Container Component (Outside ScrollSmoother for fixed positioning) -->
    <div id="global-clock-container"></div>

    <!-- ScrollSmoother Wrapper -->
    <div id="smooth-wrapper">
        <div id="smooth-content">

    <!-- Hero Section -->
    <section id="overview" class="section hero-section">
        <div class="section-content">
            <!-- Project Header -->
            <div class="project-intro">
                <div class="project-label">Case Study</div>
                <h1 class="project-title">Quality Assurance Framework</h1>
            </div>
            
            <!-- Project Meta Grid -->
            <div class="project-meta-layout">
                <!-- Row 1: Client, Duration, Reading time -->
                <div class="meta-item">
                    <div class="meta-label">Company</div>
                    <div class="meta-value-simple">TD Bank</div>
                </div>
                
                <div class="meta-item">
                    <div class="meta-label">Duration</div>
                    <div class="meta-value-simple">2-3 months</div>
                </div>
                
                <div class="meta-item">
                    <div class="meta-label">Reading time</div>
                    <div class="meta-value-simple">10 minutes</div>
                </div>
                
                <!-- Row 2: Team (col 1), Areas of impact (col 2-3) -->
                <div class="meta-item">
                    <div class="meta-label">Teams</div>
                    <div class="meta-pills">
                        <span class="pill">UX / UI</span>
                        <span class="pill">DEV</span>
                        <span class="pill">QA</span>
                        <span class="pill">BA</span>
                    </div>
                </div>
                
                <div class="meta-item meta-span-2">
                    <div class="meta-label">Areas of Impact</div>
                    <div class="meta-pills">
                        <span class="pill">Product Design</span>
                        <span class="pill">Design Strategy</span>
                        <span class="pill">Project Management</span>
                    </div>
                </div>
                
                <!-- Row 3: Features (spans all 3 columns) -->
                <div class="meta-item meta-span-3">
                    <div class="meta-label">Features</div>
                    <div class="meta-pills">
                        <span class="pill">Interactive Playground</span>
                        <span class="pill">Process Map</span>
                        <span class="pill">Future-Proofed</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="scroll-indicator">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 5V19M12 19L7 14M12 19L17 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
    </section>



       <!-- Results Section -->
        <section id="results" class="section">
            <div class="section-content">
                <!-- Impact Marquee Intro (visible on load, no fade) - siphoned out of header -->
                <div class="impact-marquee">
                    <!-- Row 1 - Moving Left -->
                    <div class="impact-marquee-row">
                        <div class="impact-fade-left"></div>
                        <div class="impact-fade-right"></div>
                        <div class="impact-marquee-wrapper">
                            <div class="impact-marquee-content">
                                <!-- Duplicate sets to create seamless loop -->
                                <span class="impact-pill">DESIGN SYSTEM</span>
                                <span class="impact-pill">SCALABLE</span>
                                <span class="impact-pill">ACCESSIBLE</span>
                                <span class="impact-pill">COLLABORATION</span>
                                <span class="impact-pill">COMPONENTS</span>
                                <span class="impact-pill">TOKENS</span>
                                <span class="impact-pill">FIGMA LIBRARY</span>
                                <span class="impact-pill">REACT</span>

                                <span class="impact-pill">DESIGN SYSTEM</span>
                                <span class="impact-pill">SCALABLE</span>
                                <span class="impact-pill">ACCESSIBLE</span>
                                <span class="impact-pill">COLLABORATION</span>
                                <span class="impact-pill">COMPONENTS</span>
                                <span class="impact-pill">TOKENS</span>
                                <span class="impact-pill">FIGMA LIBRARY</span>
                                <span class="impact-pill">REACT</span>
                            </div>
                        </div>
                    </div>

                    <!-- Row 2 - Moving Right -->
                    <div class="impact-marquee-row">
                        <div class="impact-fade-left"></div>
                        <div class="impact-fade-right"></div>
                        <div class="impact-marquee-wrapper">
                            <div class="impact-marquee-content reverse">
                                <!-- Duplicate sets to create seamless loop -->
                                <span class="impact-pill">USER EXPERIENCE</span>
                                <span class="impact-pill">PROTOTYPING</span>
                                <span class="impact-pill">CONSISTENCY</span>
                                <span class="impact-pill">GUIDELINES</span>
                                <span class="impact-pill">DOCUMENTATION</span>
                                <span class="impact-pill">ACCESSIBILITY</span>
                                <span class="impact-pill">GOVERNANCE</span>
                                <span class="impact-pill">MAINTENANCE</span>

                                <span class="impact-pill">USER EXPERIENCE</span>
                                <span class="impact-pill">PROTOTYPING</span>
                                <span class="impact-pill">CONSISTENCY</span>
                                <span class="impact-pill">GUIDELINES</span>
                                <span class="impact-pill">DOCUMENTATION</span>
                                <span class="impact-pill">ACCESSIBILITY</span>
                                <span class="impact-pill">GOVERNANCE</span>
                                <span class="impact-pill">MAINTENANCE</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-header" id="impact-header">
                    <h2 class="section-title">Systemic Impact</h2>
                    <p class="section-subtitle">Measurable improvements in design quality, team efficiency and collaboration.</p>
                </div>
            <div class="results-grid">
                <div class="metric-card">
                    <div class="metric-number">6+</div>
                    <div class="metric-label">Projects scaled with continual scalable application</div>
                        </div>
                <div class="metric-card">
                    <div class="metric-number">92%</div>
                    <div class="metric-label">Defect resolution rate per release without automation</div>
                        </div>
                <div class="metric-card">
                    <div class="metric-number">200+</div>
                    <div class="metric-label">Defects identified, tracked, and resolved</div>
                            </div>
                <div class="metric-card">
                    <div class="metric-number">3</div>
                    <div class="metric-label">Years worth of backlogged defects catalogued</div>
                        </div>
                    </div>
                </div>
    </section>



    <!-- The Elephant in the Room Section -->
    <section id="synopsis" class="section">
        <div class="section-content">
            <div class="eight-column-content">


                <h2 class="synopsis-title">The Elephant in <span class="mobile-break">the Room</span></h2>
                
                <div class="content-container">
                    <div class="cta-pills-container">
                        <div class="pill-group" id="synopsis-pill-group">
                            <button class="cta-pill text-pill pill-1" data-option="text" id="textPill">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/text.png" alt="Text" class="text-icon">
                            </button>
                            <button class="cta-pill tldr-pill pill-2" data-option="tldr" id="tldrPill">tl;dr</button>
                        </div>
                        <button class="cta-pill voice-pill pill-3" data-cta="voice" id="voicePill" data-pill-id="synopsis-voice" data-audio="https://raw.githubusercontent.com/amachinic/Merem/main/QA%20Voiceover.mp3"></button>
                    </div>
                    
                    <div class="story-content">
                        <p>I originally started my career as a graphic designerâ€”which basically meant I spent almost a decade obsessing over the spacing between letters and whether the rags of a paragraph looked natural. <span class="highlight-target" data-highlight="tldr">I was formally taught how to analyze images and paintings, archiving tens of thousands of images out of personal curiosity and inspiration.</span> As a young graphic designer, I was trained by my mentors to see things most people tend to overlook.</p>
                        
                        <p>Sometimes, it felt a little neuroticâ€”the attention to detailâ€”but over time, it became incredibly formative to my career. <span class="highlight-target" data-highlight="tldr">That skill never left me.</span> My awareness and my ways of seeing the world only continued to expand.</p>
                        
                        <p><span class="highlight-target" data-highlight="tldr">Fast forward to Fall 2022. Our design team is in the final stages of delivering the first-ever MVP for Project Odysseyâ€”the largest funded multi-channel servicing application aimed at transforming this company's legacy enterprise experience. I'm in a typical bi-weekly touchpoint with our front-end developers and lead QA, reviewing newly developed components for the upcoming sprint. After our usual friendly conversations, we walkthrough the initial development designs and reach verbal agreement of the changes that need to be made. We take screenshots of the development environment, follow up with meeting notes in an email, say our goodbyesâ€”and then do it all over again two weeks later.</span></p>
                        
                        <p><span class="highlight-target" data-highlight="tldr">Our teams meet again and, while the components were almost always functionally correct, the UI nearly almost always contained a visual defect. Another two weeks would pass, and then anotherâ€”and the same issues would resurface each cycle: off-brand buttons, misaligned fields, inconsistent spacing and typography. It was design dÃ©jÃ  vu.</span></p>
                        
                        <p>Our original design team consisted of exceptionally trained visual designers, most with formal backgrounds in the arts and advertising. We had built strong relationships with our developers. By the time we shipped the initial MVP, we had resolved the vast majority of visual defectsâ€”setting ourselves up for a very successful launch.</p>
                        
                        <p>Now, before the emergence of the professional title; product designer, many visual designers identified first and foremost <span class="highlight-target" data-highlight="tldr">as graphic designersâ€”we honed our craft, trained our eyes, and took pride in the details others often missed.</span> We were type purists, layout and composition obsessives. <span class="highlight-target" data-highlight="tldr">There was a shared reverence for the visual language of design. This matteredâ€”because as design teams grew, and the discipline matured into broader roles, visual quality assurance started to fall between the cracks.</span> When I joined this company three years ago, our department had just four designers. This year, we're now more than fifteen. <span class="highlight-target" data-highlight="tldr">But with scale comes the risk of fragmentation. Visual quality assurance became the sole responsibility of each designer, siloed within their respective projects.</span></p>
                        
                        <p>Most designers followed the same approachâ€”verbal feedback during sprint reviews, maybe a Word doc, a couple of JIRA tickets, and an email chain to track issues. But nothing really changed. <span class="highlight-target" data-highlight="tldr">The same problems persisted. Eventually, our department identified and consolidated an entire year's worth of backlogged defects.  Addressing them would require nearly a full year of development work.</span></p>
                        
                        <p><span class="highlight-target" data-highlight="tldr">How did it get this bad? Why did this happen?</span></p>
                        
                        <p>It wasn't due to lack of effort. Everyone cared. Everyone was trying. But <span class="highlight-target" data-highlight="tldr">we had no shared visual language. Designers saw what developers and QA couldn't name. Developers relied heavily on the eyes of a designer to rectify the visual design before release. QA had no formal framework, scripts, or training for assessing visual design. We weren't seeing together.</span></p>
                        
                        <p><span class="highlight-target" data-highlight="tldr">That's when it clicked: We weren't just missing pixels. We were missing a strategic process.</span></p>
                    </div>
                </div>
                

            </div>
        </div>
    </section>


    <!-- How might we Section -->
    <section id="how-might-we" class="section">
        <div class="section-content">
            <div class="how-might-we-grid">
            <div class="section-header">
                    <h2 class="section-title hmw-animated-title">How might we develop a cross-collaboration framework that bridges design, development, and QAâ€”so that teams can see problems together, and catch defects before they reach production?</h2>
                    
                    <!-- Three conceptual pills -->
                    <div class="hmw-pills-container">
                        <div class="hmw-pill">Cross-Collaboration</div>
                        <div class="hmw-pill">Transparency</div>
                        <div class="hmw-pill">Clarity</div>
            </div>
                    </div>
                
                <!-- How might we paragraph content -->
                <div class="hmw-content hmw-paragraph">
                    <div class="cta-pills-container">
                        <div class="pill-group" id="hmw-pill-group">
                            <button class="cta-pill text-pill pill-1" data-option="text">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/text.png" alt="Text" class="text-icon">
                            </button>
                            <button class="cta-pill tldr-pill pill-2" data-option="tldr">tl;dr</button>
                </div>
                        <button class="cta-pill voice-pill pill-3" data-cta="voice" id="hmwVoicePill" data-pill-id="hmw-voice" data-audio="https://raw.githubusercontent.com/amachinic/Merem/main/QA%20-%20Defect%20list.mp3"></button>
                    </div>
                    <p>The challenge wasnâ€™t just about finding defectsâ€”it was about creating a shared language between disciplines that had historically worked in silos, especially in enterprise environments. Designers think in experiences, developers think in logic, and QA thinks in edge cases. Each lens is critical, but without meaningful collaboration between them, key issues inevitably slip through the cracks.</p> <p>Our framework needed to bridge these disconnects while keeping pace with the speed and agility modern development demands. We couldnâ€™t just add more meetings or documentationâ€”we had to build transparency directly into the tools and workflows teams were already using, so collaboration felt natural, not forced.</p> <p>This required a fundamental shift in how we thought about quality assurance: not as a siloed function, but as an enabling practice that empowers every team member to take ownership of quality. That meant creating systems that could capture intent, communicate context, and support fast, continuous feedback across every stage of the workâ€”all grounded in a language we could all speak and understand.</p> <p>Instead of relying on formal processes, I approached the problem through a UX lensâ€”focusing on how each discipline saw the work, and where those perspectives clashed or overlapped. The goal was to create alignment without slowing momentum. What emerged was a clear path forward: a shared process that felt intuitive to everyone involved, grounded in real-world collaboration.</p>
                </div>
                    </div>
                    </div>
    </section>


    <!-- Process Map Section -->
    <section id="process-map" class="section">
        <div class="section-content">
            <div class="section-header">
                <h2 class="section-title">Process Map</h2>
                <p class="section-subtitle">Visual representation of our quality assurance framework and workflow methodology</p>
                </div>
            <div class="process-map-canvas-container">
                <!-- Process Map Canvas -->
                <div class="process-map-canvas">
                    <div class="canvas-content">
                        <!-- Permanent process map image -->
                        <div class="process-map-image">
                            <img class="process-map-img" src="https://raw.githubusercontent.com/amachinic/Merem/refs/heads/main/QA%20-%20Process%20Flow%20Map.png" alt="QA Process Flow Map" />
            </div>
                    </div>
                    <div class="process-map-zoom-hint">
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <span>Zoom in</span>
                    </div>
                    
                    
                    </div>
                </div>
                
                <!-- Process Map Caption -->
                <div class="process-map-caption">
                    <p>Process Map - 2-Week Sprint Cycle</P>
                    </div>
    </section>


    <!-- Defect Glossary Section -->
    <section id="defect-glossary" class="section">
        <div class="section-content">
            <div class="section-header">
                    <h2 class="section-title defect-glossary-animated-title">Defect glossary</h2>
                <p class="section-subtitle">Comprehensive taxonomy for identifying and categorizing quality issues</p>
                </div>
                
            <!-- Two-column layout container -->
            <div class="defect-glossary-layout-container">
                <!-- Left: Content -->
                <div class="defect-glossary-content">
                    <div class="cta-pills-container">
                        <div class="pill-group" id="defect-glossary-pill-group">
                            <button class="cta-pill text-pill pill-1" data-option="text">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/text.png" alt="Text" class="text-icon">
                            </button>
                            <button class="cta-pill tldr-pill pill-2" data-option="tldr">tl;dr</button>
                        </div>
                        <button class="cta-pill voice-pill pill-3" data-cta="voice" id="defectVoicePill" data-pill-id="defect-voice" data-audio="https://raw.githubusercontent.com/amachinic/Merem/main/QA%20-%20Placeholder.mp3"></button>
                    </div>
                    <p>Understanding the taxonomy of defects is crucial for effective quality assurance. Visual defects include misaligned elements, incorrect typography, color inconsistencies, and spacing issues that compromise the design integrity. These seemingly minor issues compound over time, eroding user trust and brand perception.</p>
                    
                    <p>Functional defects encompass broken interactions, failed form validations, navigation errors, and performance bottlenecks that prevent users from completing their intended tasks. These issues directly impact user success rates and business objectives, making them critical to identify and resolve quickly.</p>
                    
                    <p>User experience defects are often the most subtle but equally damagingâ€”confusing workflows, inconsistent patterns, poor accessibility, and cognitive overload that frustrate users even when everything technically "works." A comprehensive defect glossary helps teams develop a shared vocabulary for identifying and prioritizing these varied quality issues.</p>
                    </div>
                
                <!-- Right: Defect Table Component -->
                <div class="defect-table-container">
                    <div class="defect-table-card">
                        <!-- Filter Header -->
                        <div class="defect-table-header">
                            <div class="filter-section">
                                <div class="filter-label">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46 22,3"></polygon>
                                    </svg>
                                    <span>Filter by Severity</span>
                                </div>
                                
                                <div class="severity-filters">
                                    <button id="severity-all-defect" class="severity-btn active" data-severity="all">ALL</button>
                                    <button class="severity-btn low-severity" data-severity="low">LOW</button>
                                    <button class="severity-btn medium-severity" data-severity="medium">MEDIUM</button>
                                    <button class="severity-btn high-severity" data-severity="high">HIGH</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Defect Cards List -->
                        <div class="defect-cards-list">
                            <!-- Defect cards will be populated by JavaScript -->
                        </div>
                        
                        <!-- Card Footer -->
                        <div class="defect-table-footer"></div>
                    </div>
                    
                    <!-- Defect Table Caption -->
                    <div class="defect-table-caption">
                        <p>Interactive Defect Glossary</p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Interactive Defect Triage Component -->
    <section id="triage-component" class="section triage-section">
        <div class="section-content">
            <div class="section-header">
                <h2 class="section-title">Modular Defect Triage Component</h2>
                <p class="section-subtitle">Interactive tool for systematic defect classification and tracking</p>
            </div>
            
            <!-- Two-column layout container -->
            <div class="triage-layout-container">
                <!-- Left: Black card -->
                <div class="triage-info-card">
                        <div class="triage-compare-card">
                            <div class="triage-compare-label">slider</div>
                        <div class="triage-compare-container" id="triageCompare">
                            <div class="triage-compare-annotation-widget">
                                <button class="triage-compare-annotation-btn" id="triageAnnotateBtn">Annotate</button>
                                <button class="triage-compare-annotation-preview" id="triageAnnotationPreview" title="Add annotation" style="width:22px;height:22px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;line-height:1;">+</button>
                            </div>
                            <button class="triage-compare-delete" id="triageDeleteBtn" title="Delete last annotation">
                                <!-- Using trash.svg icon (paths inlined for theming via currentColor) -->
                                <svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                                    <path fill="currentColor" fill-rule="evenodd" d="M9.17,4.54h-4.96c-.19,0-.34.15-.34.34v1.89c0,.19.15.34.34.34h.81l.37,14.8c0,.18.15.33.34.33h12.1c.18,0,.33-.15.34-.33l.37-14.8h.81c.19,0,.34-.15.34-.34v-1.89c0-.19-.15-.34-.34-.34h-4.96v-.65c0-.33-.13-.65-.36-.88s-.55-.36-.88-.36h-2.73c-.33,0-.65.13-.88.36s-.36.55-.36.88v.65ZM17.86,7.11l-.36,14.46H6.05l-.36-14.46h12.17ZM9.41,10.41c0-.56-.45-1.01-1.01-1.01h-.01c-.56,0-1.01.45-1.01,1.01v8.12c0,.56.45,1.01,1.01,1.01h.01c.56,0,1.01-.45,1.01-1.01v-8.12ZM16.16,10.41c0-.56-.45-1.01-1.01-1.01h-.01c-.56,0-1.01.45-1.01,1.01v8.12c0,.56.45,1.01,1.01,1.01h.01c.56,0,1.01-.45,1.01-1.01v-8.12ZM12.79,10.41c0-.56-.45-1.01-1.01-1.01h-.01c-.56,0-1.01.45-1.01,1.01v8.12c0,.56.45,1.01,1.01,1.01h.01c.56,0,1.01-.45,1.01-1.01v-8.12ZM8.73,10.41v8.12c0,.18-.15.33-.33.33h-.01c-.18,0-.33-.15-.33-.33v-8.12c0-.18.15-.33.33-.33h.01c.18,0,.33.15.33.33ZM15.49,10.41v8.12c0,.18-.15.33-.33.33h-.01c-.18,0-.33-.15-.33-.33v-8.12c0-.18.15-.33.33-.33h.01c.18,0,.33.15.33.33ZM12.11,10.41v8.12c0,.18-.15.33-.33.33h-.01c-.18,0-.33-.15-.33-.33v-8.12c0-.18.15-.33.33-.33h.01c.18,0,.33.15.33.33ZM19,5.22v1.22H4.55v-1.22h14.46ZM13.7,3.89v.65h-3.86v-.65c0-.15.06-.29.17-.4.11-.11.25-.17.4-.17h2.73c.15,0,.29.06.4.17.11.11.17.25.17.4h0Z"/>
                                </svg>
                            </button>
                            <div class="triage-compare-opacity" id="triageOpacity">
                                <!-- Using Sun.svg icon (paths inlined for theming via currentColor) -->
                                <svg class="triage-compare-opacity-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                    <circle cx="12" cy="12" r="5.81" fill="none" stroke="currentColor" stroke-miterlimit="10"/>
                                    <line x1="12" y1="1.07" x2="12" y2="4.23" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="12" y1="19.77" x2="12" y2="22.93" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="22.93" y1="12" x2="19.77" y2="12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="4.23" y1="12" x2="1.07" y2="12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="4.28" y1="4.27" x2="6.5" y2="6.51" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="17.5" y1="17.49" x2="19.73" y2="19.73" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="19.73" y1="4.27" x2="17.5" y2="6.51" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                    <line x1="6.5" y1="17.49" x2="4.28" y2="19.73" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <!-- Visible helper track for light mode contrast -->
                                <div class="triage-compare-opacity-track" aria-hidden="true"></div>
                                <input type="range" class="triage-compare-opacity-slider" id="triageOpacitySlider" min="0" max="100" value="100" orient="vertical">
                                <div class="triage-compare-opacity-value" id="triageOpacityValue">100%</div>
                            </div>
                            <img class="triage-compare-image-before" id="triageImageBefore" src="https://raw.githubusercontent.com/amachinic/Merem/main/A2.png" alt="Dev Image">
                            <img class="triage-compare-image-after" id="triageImageAfter" src="https://raw.githubusercontent.com/amachinic/Merem/main/A1.png" alt="Final Image">
                            <label class="triage-compare-upload triage-compare-upload-left" id="triageUploadLeft" title="Upload Dev Image">
                                <svg class="triage-compare-upload-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                    <polyline points="7,10 12,5 17,10" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                    <line x1="12" y1="5" x2="12" y2="16" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                <span class="triage-compare-upload-text">Upload Dev</span>
                                <input type="file" class="triage-compare-upload-input" id="triageInputLeft" accept="image/*">
                            </label>
                            <label class="triage-compare-upload triage-compare-upload-right" id="triageUploadRight" title="Upload Final Image">
                                <svg class="triage-compare-upload-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                    <polyline points="7,10 12,5 17,10" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                    <line x1="12" y1="5" x2="12" y2="16" stroke="currentColor" stroke-width="1.5"/>
                                </svg>
                                <span class="triage-compare-upload-text">Upload Final</span>
                                <input type="file" class="triage-compare-upload-input" id="triageInputRight" accept="image/*">
                            </label>
                            <div class="triage-compare-slider" id="triageSlider"></div>
                        </div>
                        <button class="triage-compare-reset" id="triageReset">Reset</button>
                    </div>
                </div>
                
                <!-- Right: Triage component -->
                <div class="triage-component-container">
                <div class="triage-card">
                    <button class="triage-close-btn" onclick="smartCloseTriageCard(this)" title="Reset or remove triage card">
                        <span class="close-icon">âœ•</span>
                    </button>
                    <div class="annotation-number">
                        <span class="annotation-label">Annotation</span>
                        <div class="annotation-circle" id="annotation-circle">1</div>
                    </div>
                    <div class="severity-section">
                        <label>Defect severity</label>
                        <!-- Custom dropdown will be created here by JavaScript -->
                    </div>
                    <div class="defect-type-section">
                        <label>Defect type</label>
                        <!-- Custom dropdown will be created here by JavaScript -->
                    </div>
                    <div class="status-section">
                <div class="status-header">
                    <label>Defect status</label>
                    <button class="status-info-btn" onclick="toggleStatusTooltip(this)" title="Show status legend">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9,9h0a3,3,0,0,1,6,0c0,2-3,3-3,3"></path>
                            <path d="M12,17h0"></path>
                        </svg>
                    </button>
                    <div class="status-tooltip" style="display: none;">
                        <button class="status-tooltip-close" onclick="closeStatusTooltip(this)">Ã—</button>
                        <div class="status-tooltip-content">
                            <div class="status-tooltip-item">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---NOT-STARTED.png" alt="Not Started" width="20" height="20">
                                <span>Not Started</span>
                            </div>
                            <div class="status-tooltip-item">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---IN-PROGRESS.png" alt="In Progress" width="20" height="20">
                                <span>In Progress</span>
                            </div>
                            <div class="status-tooltip-item">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---DEFECT-PERSISTS.png" alt="Unresolved" width="20" height="20">
                                <span>Unresolved</span>
                            </div>
                            <div class="status-tooltip-item">
                                <img src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---RESOLVED.png" alt="Resolved" width="20" height="20">
                                <span>Resolved</span>
                            </div>
                        </div>
                    </div>
                </div>
                        <div class="status-buttons" id="status-buttons">
                                                        <button type="button" class="status-btn selected" data-status="not-started" onclick="selectStatusForCard(this, 'not-started')" title="Not Started">
                                <img class="status-icon" src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---NOT-STARTED.png" alt="Not Started">
                            </button>
                            <button type="button" class="status-btn" data-status="in-progress" onclick="selectStatusForCard(this, 'in-progress')" title="In Progress">
                                <img class="status-icon" src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---IN-PROGRESS.png" alt="In Progress">
                            </button>
                            <button type="button" class="status-btn" data-status="defect-persists" onclick="selectStatusForCard(this, 'defect-persists')" title="Defect Persists">
                                <img class="status-icon" src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---DEFECT-PERSISTS.png" alt="Defect Persists">
                            </button>
                            <button type="button" class="status-btn" data-status="resolved" onclick="selectStatusForCard(this, 'resolved')" title="Resolved">
                                <img class="status-icon" src="https://raw.githubusercontent.com/amachinic/Merem/main/GREY---RESOLVED.png" alt="Resolved">
                            </button>
                        </div>
                        <input type="hidden" id="status-select" name="status" value="not-started">
                    </div>
                    <div class="author-section">
                        <div class="author-container">
                            <div class="author-input-container">
                                <label for="defect-author">Author</label>
                                <textarea id="defect-author" placeholder="Name"></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- Sync CTA as independent element for proper grid positioning -->
                    <button class="author-sync-btn" onclick="syncAuthor()" title="Sync author">
                        <!-- Default content: "Sync" text -->
                        <div class="author-sync-btn-content author-sync-btn-content-default">
                            <div class="author-sync-btn-text">Sync</div>
                        </div>
                        
                        <!-- Selected content: Circular checkmark + "Synced" text -->
                        <div class="author-sync-btn-content author-sync-btn-content-selected">
                            <div class="author-sync-btn-checkmark">
                                <svg viewBox="0 0 24 24">
                                    <path d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <div class="author-sync-btn-text">Synced</div>
                        </div>
                    </button>
                    <div class="description-section">
                        <label for="defect-description">Description</label>
                        <textarea id="defect-description" placeholder="Provide a brief but accurate description of the defect."></textarea>
                    </div>
                    <div class="links-section">
                        <div class="links-header">
                            <label>Links</label>
                            <div class="header-buttons">
                                <button class="header-sync-btn" title="Sync functionality" tabindex="-1">
                                    â‡„ API
                                    <div class="sync-tooltip">I'm sorry this feature is not yet available. We're still building and scaling.</div>
                                </button>
                                <button class="header-add-btn" onclick="openLinkModalForCard(1)" title="Add link">+ Add Link</button>
                        </div>
                        </div>
                        <div class="links-background-card">
                        <div class="links-container" id="links-container">
                                <div class="link-item">
                                    <a href="https://zip.co" target="_blank" class="simple-link service-link" title="https://zip.co">
                                        <span class="service-link-icon"><img src="https://raw.githubusercontent.com/amachinic/Merem/main/zip.png" width="27" height="20" alt="Zip"></span>
                                        <span>Zip</span>
                                    </a>
                                    <button class="remove-link-btn" onclick="removeLink(this)" title="Remove link">âœ•</button>
                                </div>
                                <div class="link-item link-placeholder" onclick="openLinkModalForCard(1)">
                                    <button class="add-link-btn-full" title="Add link">
                                        <span class="add-icon">+</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </section>





    <!-- Implementation Section -->
    <section id="implementation" class="section">
        <div class="section-content">
            <div class="section-header">
                <h2 class="section-title">Future-Proofed</h2>
                <p class="section-subtitle">A framework built to scale the future of quality assurance.</p>
            </div>
            <div class="triage-layout-container">
                <div class="final-video-card fade-in">
                <video src="https://raw.githubusercontent.com/amachinic/Merem/main/scanner.mp4" autoplay muted loop playsinline preload="auto"></video>
                </div>
            </div>
        </div>
    </section>




    <!-- Hidden Audio Element -->
    <audio id="voiceoverAudio" preload="metadata" crossorigin="anonymous">
        <source src="https://github.com/amachinic/Merem/blob/main/QA%20Voiceover.mp3?raw=true&v=2" type="audio/mpeg">
        <source src="https://raw.githubusercontent.com/amachinic/Merem/main/QA%20Voiceover.mp3?v=2" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // Register GSAP plugins
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin, Draggable);

        // Preserve scroll position on page refresh
        if (history.scrollRestoration) {
            history.scrollRestoration = 'auto';
        }
        
        // Prevent unwanted scroll to top after page is loaded
        let pageLoaded = false;
        window.addEventListener('load', () => {
            setTimeout(() => {
                pageLoaded = true;
            }, 1000); // Allow 1 second for initial setup
        });
        
        // Override any forced scroll to top after page load
        const originalScrollTo = window.scrollTo;
        window.scrollTo = function(x, y) {
            if (pageLoaded && y === 0 && arguments.length === 2) {
                console.log('Prevented unwanted scroll to top');
                return; // Prevent scroll to top after page is loaded
            }
            return originalScrollTo.apply(this, arguments);
        };
        
        // Initialize Global Components
        document.addEventListener('DOMContentLoaded', function() {
            // ================== TRIAGE INFO CARD â€“ IMAGE COMPARISON ==================
            (function initTriageComparison() {
                const container = document.getElementById('triageCompare');
                if (!container) return;
                const slider = document.getElementById('triageSlider');
                const imgBefore = document.getElementById('triageImageBefore');
                const imgAfter = document.getElementById('triageImageAfter');
                const uploadLeft = document.getElementById('triageUploadLeft');
                const uploadRight = document.getElementById('triageUploadRight');
                const inputLeft = document.getElementById('triageInputLeft');
                const inputRight = document.getElementById('triageInputRight');
                const resetBtn = document.getElementById('triageReset');
                const opacityCtl = document.getElementById('triageOpacity');
                const opacitySlider = document.getElementById('triageOpacitySlider');
                const opacityValue = document.getElementById('triageOpacityValue');
                const annotateBtn = document.getElementById('triageAnnotateBtn');

                let isDragging = false;
                let currentPos = 50;
                let annotationCounter = 0;

                // Ensure visible numbers are sequential (1..N) on all existing annotations
                function renumberAnnotations() {
                    const anns = container.querySelectorAll('.triage-annotation');
                    anns.forEach((a, idx) => {
                        let numEl = a.querySelector('span');
                        if (!numEl) {
                            numEl = document.createElement('span');
                            a.appendChild(numEl);
                        }
                        numEl.textContent = String(idx + 1);
                        numEl.setAttribute('style','position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)');
                    });
                }

                function updateSlider(pct) {
                    currentPos = pct;
                    slider.style.left = pct + '%';
                    imgAfter.style.clipPath = `polygon(${pct}% 0%, 100% 0%, 100% 100%, ${pct}% 100%)`;
                }
                updateSlider(50);

                function makeAnnotationDraggable(el) {
                    let drag = false, sx=0, sy=0, sl=0, st=0;
                    el.addEventListener('mousedown', (e) => {
                        drag = true;
                        sx = e.clientX; sy = e.clientY;
                        sl = parseInt(el.style.left) || 0; st = parseInt(el.style.top) || 0;
                        el.style.cursor='grabbing';
                        e.preventDefault();
                    });
                    document.addEventListener('mousemove', (e) => {
                        if(!drag) return;
                        const maxLeft = Math.max(0, container.clientWidth - el.offsetWidth);
                        const maxTop  = Math.max(0, container.clientHeight - el.offsetHeight);
                        const nextLeft = Math.max(0, Math.min(maxLeft, sl + (e.clientX - sx)));
                        const nextTop  = Math.max(0, Math.min(maxTop,  st + (e.clientY - sy)));
                        el.style.left = nextLeft + 'px';
                        el.style.top  = nextTop + 'px';
                    });
                    document.addEventListener('mouseup', () => { if(drag){ drag=false; el.style.cursor='grab'; } });
                }

                const annPreview = document.getElementById('triageAnnotationPreview');
                const deleteBtn = document.getElementById('triageDeleteBtn');
                // Create a default high-severity annotation on load
                (function createDefaultHighSeverityAnnotation(){
                    if (!container || !annotateBtn) return;
                    annotationCounter = 1;
                    const ann = document.createElement('div');
                    const num = document.createElement('span');
                    num.textContent = '1';
                    ann.appendChild(num);
                    const contRect = container.getBoundingClientRect();
                    const btnRect = annotateBtn.getBoundingClientRect();
                    const gap = 8;
                    let defaultLeft = btnRect.right - contRect.left + gap - 2;
                    let defaultTop  = btnRect.top - contRect.top + (btnRect.height - 24) / 2;
                    defaultLeft = Math.max(0, Math.min(contRect.width - 24, defaultLeft));
                    defaultTop  = Math.max(0, Math.min(contRect.height - 24, defaultTop));
                    ann.className = 'triage-annotation severity-high';
                    ann.setAttribute('style', `position:absolute;top:${defaultTop}px;left:${defaultLeft}px;width:24px;height:24px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;cursor:grab;z-index:9;user-select:none;box-shadow:0 2px 6px rgba(0,0,0,.25);`);
                    num.setAttribute('style','position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)');
                    container.appendChild(ann);
                    makeAnnotationDraggable(ann);
                })();
                function createAnnotationFromCta() {
                        annotationCounter++;
                        const ann = document.createElement('div');
                        const num = document.createElement('span');
                        // Set the number for this annotation; will be re-validated by renumberAnnotations
                        num.textContent = String(annotationCounter);
                        ann.appendChild(num);
                        // Place new annotation to the right of the Annotate CTA within the canvas
                        const contRect = container.getBoundingClientRect();
                        const btnRect = annotateBtn.getBoundingClientRect();
                        const gap = 8; // spacing from button
                        let defaultLeft = btnRect.right - contRect.left + gap - 2; // tiny nudge to the right from previous
                        let defaultTop  = btnRect.top - contRect.top + (btnRect.height - 24) / 2;
                        // clamp within container bounds
                        defaultLeft = Math.max(0, Math.min(contRect.width - 24, defaultLeft));
                        defaultTop  = Math.max(0, Math.min(contRect.height - 24, defaultTop));
                        ann.className = 'triage-annotation';
                        // Default color matches the annotation CTA (black button on white widget): black fill with white inner dot is too strong.
                        // Use a neutral but clear accent: default to annotation CTA background (black) only if no severity yet; otherwise overridden.
                        ann.setAttribute('style', `position:absolute;top:${defaultTop}px;left:${defaultLeft}px;width:24px;height:24px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;cursor:grab;z-index:9;user-select:none;box-shadow:0 2px 6px rgba(0,0,0,.25);`);
                        num.setAttribute('style','position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)');
                        container.appendChild(ann);
                        // Ensure all annotations are numbered sequentially
                        renumberAnnotations();
                        // Apply current severity color class to this new annotation (overrides default)
                        const severityDropdown = document.querySelector('.severity-section .custom-enhanced-dropdown');
                        if (severityDropdown) {
                            const val = severityDropdown.getAttribute('data-value') || severityDropdown.dataset.value;
                            if (val === 'low') ann.classList.add('severity-low');
                            else if (val === 'medium') ann.classList.add('severity-medium');
                            else if (val === 'high') ann.classList.add('severity-high');
                        }
                        if (annPreview) annPreview.textContent = '+';
                        makeAnnotationDraggable(ann);
                }
                if (annotateBtn) {
                    annotateBtn.addEventListener('click', createAnnotationFromCta);
                }
                if (annPreview) {
                    annPreview.addEventListener('click', (e) => { e.stopPropagation(); createAnnotationFromCta(); });
                }

                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const anns = container.querySelectorAll('.triage-annotation');
                        const last = anns[anns.length - 1];
                        if (last) {
                            last.remove();
                            annotationCounter = Math.max(0, annotationCounter - 1);
                            // Re-sequence numbers after deletion
                            renumberAnnotations();
                            if (annPreview) annPreview.textContent = '+'; // keep plus symbol
                        }
                    });
                }

                if (opacityCtl && opacitySlider && opacityValue) {
                    // Keep only the icon visible when selecting the CTA
                    opacityCtl.addEventListener('click', (e) => {
                        e.stopPropagation();
                        opacitySlider.style.display = 'none';
                        opacityValue.style.display = 'none';
                        const track = opacityCtl.querySelector('.triage-compare-opacity-track');
                        if (track) track.style.display = 'none';
                    });
                    document.addEventListener('click', (e) => {
                        if (!opacityCtl.contains(e.target)) {
                            opacitySlider.style.display = 'none';
                            opacityValue.style.display = 'none';
                            const track = opacityCtl.querySelector('.triage-compare-opacity-track');
                            if (track) track.style.display = 'none';
                        }
                    });
                    // Maintain input behavior if changed programmatically elsewhere
                    opacitySlider.addEventListener('input', function () {
                        const v = this.value;
                        imgAfter.style.opacity = v / 100;
                        opacityValue.textContent = v + '%';
                    });
                }

                function bindUpload(labelEl, inputEl, targetImg, uploadedText) {
                    if (!labelEl || !inputEl) return;
                    // Avoid double-binding in case init runs more than once
                    if (inputEl.dataset.boundUpload === '1') return;
                    inputEl.dataset.boundUpload = '1';
                    // Rely on native <label> behavior (no manual .click()) to prevent double triggers
                    inputEl.addEventListener('change', (e)=>{
                        const f=e.target.files[0];
                        if(f && f.type.startsWith('image/')){
                            const r=new FileReader();
                            r.onload=(ev)=>{
                                targetImg.src = ev.target.result;
                                const textEl = labelEl.querySelector('.triage-compare-upload-text');
                                if (textEl) textEl.textContent = uploadedText;
                            };
                            r.readAsDataURL(f);
                        }
                    });
                }
                bindUpload(uploadLeft, inputLeft, imgBefore, 'Dev Uploaded');
                bindUpload(uploadRight, inputRight, imgAfter, 'Final Uploaded');

                // Keep annotation colors in sync with severity (use annotation-circle as source of truth)
                const severityDropdown = document.querySelector('.severity-section .custom-enhanced-dropdown');
                const annotationCircleEl = document.getElementById('annotation-circle');
                // Default severity: high
                if (annotationCircleEl) {
                    annotationCircleEl.classList.add('severity-high');
                }
                if (severityDropdown) {
                    severityDropdown.setAttribute('data-value','high');
                    severityDropdown.dataset.value = 'high';
                }
                function getCurrentSeverity() {
                    if (annotationCircleEl) {
                        if (annotationCircleEl.classList.contains('severity-low')) return 'low';
                        if (annotationCircleEl.classList.contains('severity-medium')) return 'medium';
                        if (annotationCircleEl.classList.contains('severity-high')) return 'high';
                    }
                    // Fallback to dropdown data-value if present
                    if (severityDropdown) {
                        const v = severityDropdown.getAttribute('data-value') || severityDropdown.dataset.value;
                        if (v === 'low' || v === 'medium' || v === 'high') return v;
                    }
                    return null;
                }
                function applySeverityClassToAnnotations() {
                    const sev = getCurrentSeverity();
                    if (!sev) return; // don't strip classes if we don't know severity
                    const anns = container.querySelectorAll('.triage-annotation');
                    anns.forEach(a => {
                        a.classList.remove('severity-low','severity-medium','severity-high');
                        a.classList.add(`severity-${sev}`);
                    });
                    // Reflect on annotation-circle too
                    if (annotationCircleEl) {
                        annotationCircleEl.classList.remove('severity-low','severity-medium','severity-high');
                        annotationCircleEl.classList.add(`severity-${sev}`);
                    }
                }
                if (severityDropdown) {
                    applySeverityClassToAnnotations();
                    severityDropdown.addEventListener('change', applySeverityClassToAnnotations);
                    severityDropdown.addEventListener('click', () => setTimeout(applySeverityClassToAnnotations, 0));
                }

                // Also mirror colors directly from the annotation-circle via MutationObserver (authoritative source)
                function applyFromAnnotationCircle() {
                    if (!annotationCircleEl) return;
                    const anns = container.querySelectorAll('.triage-annotation');
                    const isLow = annotationCircleEl.classList.contains('severity-low');
                    const isMed = annotationCircleEl.classList.contains('severity-medium');
                    const isHigh = annotationCircleEl.classList.contains('severity-high');
                    anns.forEach(a => {
                        a.classList.remove('severity-low','severity-medium','severity-high');
                        if (isLow) a.classList.add('severity-low');
                        else if (isMed) a.classList.add('severity-medium');
                        else if (isHigh) a.classList.add('severity-high');
                    });
                }
                if (annotationCircleEl) {
                    applyFromAnnotationCircle();
                    const mo = new MutationObserver(applyFromAnnotationCircle);
                    mo.observe(annotationCircleEl, { attributes: true, attributeFilter: ['class'] });
                }

                function handleDrag(e){ if(!isDragging) return; e.preventDefault(); const rect=container.getBoundingClientRect(); const cx = (e.touches && e.touches[0]? e.touches[0].clientX : e.clientX); const pct = Math.max(0, Math.min(100, ((cx - rect.left)/rect.width)*100)); updateSlider(pct); }
                slider.addEventListener('mousedown', e=>{ isDragging=true; e.preventDefault(); });
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', ()=> isDragging=false);
                slider.addEventListener('touchstart', e=>{ isDragging=true; e.preventDefault(); });
                document.addEventListener('touchmove', handleDrag, { passive:false });
                document.addEventListener('touchend', ()=> isDragging=false);

                if (resetBtn){ resetBtn.addEventListener('click', ()=>{
                    imgBefore.src = "data:image/svg+xml,%3Csvg width='800' height='450' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='800' height='450' fill='%23333333'/%3E%3C/svg%3E";
                    imgAfter.src = "data:image/svg+xml,%3Csvg width='800' height='450' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='800' height='450' fill='%23666666'/%3E%3C/svg%3E";
                    updateSlider(50);
                    if (opacitySlider && opacityValue){ opacitySlider.value = 100; opacityValue.textContent='100%'; imgAfter.style.opacity = 1; }
                    // remove annotations
                    container.querySelectorAll('.triage-annotation').forEach(n=> n.remove());
                    annotationCounter = 0;
                }); }
            })();
            // ================== END TRIAGE INFO CARD â€“ IMAGE COMPARISON ==================
            // Initialize Clock Container Component (using the working approach)
            const clockContainer = new GlobalClockComponent({
                backLinkText: 'â† Back',
                backLinkUrl: 'Home.html',
                showNameDisplay: false,
                hideLocationClock: true,
                caseStudyTitle: 'Case Study - Quality Assurance Framework'
            });
            
            // Inject clock CSS styles
            const clockStyle = document.createElement('style');
            clockStyle.textContent = clockContainer.getCSS();
            document.head.appendChild(clockStyle);
            
            // Render the clock component
            const clockContainerElement = document.getElementById('global-clock-container');
            clockContainerElement.innerHTML = clockContainer.getHTML();
            clockContainer.init();
        });

    // Components successfully separated and initialized



    // Function to create responsive row-based animations
    function createRowBasedAnimations() {
            const tl = gsap.timeline();
            
            // Check if we're in mobile view (single column) - includes tablet 2-column
            const isMobile = window.matchMedia('(max-width: 900px)').matches;
            
            if (isMobile) {
                // Mobile: 6 individual rows (items 1-6) - animate each row sequentially
                for (let i = 1; i <= 6; i++) {
                    tl.to(`.meta-item:nth-child(${i})`, {
                        opacity: 1,
                        y: 0,
                        duration: 0.3,
                        ease: 'power2.out'
                    }, i === 1 ? 0 : '-=0.2'); // Faster overlap between rows
                }
            } else {
                // Desktop: 3 rows - animate row by row from top to bottom
                // Row 1: Items 1-3 (Company, Duration, Reading time)
                tl.to('.meta-item:nth-child(1), .meta-item:nth-child(2), .meta-item:nth-child(3)', {
                    opacity: 1,
                    y: 0,
                    duration: 0.3,
                    ease: 'power2.out',
                    stagger: 0.05 // Faster stagger within the row
                })
                // Row 2: Items 4-5 (Teams, Areas of Impact)
                .to('.meta-item:nth-child(4), .meta-item:nth-child(5)', {
                    opacity: 1,
                    y: 0,
                    duration: 0.3,
                    ease: 'power2.out',
                    stagger: 0.05
                }, '-=0.15') // Faster overlap with previous row
                // Row 3: Item 6 (Features)
                .to('.meta-item:nth-child(6)', {
                    opacity: 1,
                    y: 0,
                    duration: 0.3,
                    ease: 'power2.out'
                }, '-=0.15'); // Faster overlap with previous row
            }
            
            return tl;
    }

        // Advanced hero animations with clean reveal
        const heroTl = gsap.timeline({ delay: 0.5 });
        
        // Animate the project intro
        heroTl.to('.project-intro', {
            opacity: 1,
            y: 0,
            duration: 1.2,
            ease: 'power3.out'
        })
        // Start meta layout + row animations overlapping the title (earlier)
        .add('afterProjectTitle')
        .to('.project-meta-layout', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power3.out'
        }, '-=0.8')
        // Row-based animations - responsive to layout
        .add(createRowBasedAnimations(), '-=0.8');

        // Enhanced parallax with layered movement
        gsap.to('.parallax-container', {
            yPercent: -50,
            ease: 'none',
            scrollTrigger: {
                trigger: '.challenge-section',
                start: 'top bottom',
                end: 'bottom top',
                scrub: 1.5
            }
        });

        // Parallax for content elements
        gsap.utils.toArray('.content-text, .content-image').forEach((element, index) => {
            gsap.to(element, {
                y: index % 2 === 0 ? -50 : 50,
                ease: 'none',
                scrollTrigger: {
                    trigger: element,
                    start: 'top bottom',
                    end: 'bottom top',
                    scrub: 2
                }
            });
        });

        // Simple section title animations with fade-in (like project title)
        // Exclude defect-glossary-animated-title as it has its own custom animation
        gsap.utils.toArray('.section-title:not(.defect-glossary-animated-title)').forEach(title => {
            gsap.to(title, {
                opacity: 1,
                y: 0,
                duration: 1.2,
                ease: 'power3.out',
                scrollTrigger: {
                    trigger: title,
                    start: 'top 85%',
                    toggleActions: 'play none none reverse'
                }
            });
        });

        // Fade-in triage component once, preventing conflicting reflows
        gsap.to('.triage-component-container', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power2.out',
            scrollTrigger: {
                trigger: '#triage-component',
                start: 'top 85%',
                once: true
            }
        });

        // Section subtitle animations
        gsap.utils.toArray('.section-subtitle').forEach(subtitle => {
            gsap.to(subtitle, {
                opacity: 1,
                y: 0,
                duration: 1,
                ease: 'power2.out',
                delay: 0.2,
                scrollTrigger: {
                    trigger: subtitle,
                    start: 'top 80%'
                }
            });
        });

        // Dynamic "How Might We" statement with typewriter effect
        const hmwStatement = document.querySelector('.hmw-statement');
        if (hmwStatement) {
            const originalText = hmwStatement.textContent;
            hmwStatement.textContent = '';
            
            gsap.to(hmwStatement, {
                scrollTrigger: {
                    trigger: hmwStatement,
                    start: 'top 80%',
                    onEnter: () => {
                        let index = 0;
                        const typewriterInterval = setInterval(() => {
                            hmwStatement.textContent = originalText.slice(0, index + 1);
                            index++;
                            if (index >= originalText.length) {
                                clearInterval(typewriterInterval);
                            }
                        }, 30);
                    }
                }
            });
        }

        // Framework grid animation
        gsap.to('.framework-grid', {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: 'power2.out',
            scrollTrigger: {
                trigger: '.framework-grid',
                start: 'top 70%'
            }
        });

        // Enhanced framework cards with hover magnetism
        gsap.to('.framework-card', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power2.out',
            stagger: {
                amount: 0.6,
                from: 'random'
            },
            scrollTrigger: {
                trigger: '.framework-grid',
                start: 'top 60%'
            }
        });

        // Magnetic hover effect for framework cards
        document.querySelectorAll('.framework-card').forEach(card => {
            const magnetic = (e) => {
                const { left, top, width, height } = card.getBoundingClientRect();
                const centerX = left + width / 2;
                const centerY = top + height / 2;
                const deltaX = (e.clientX - centerX) * 0.15;
                const deltaY = (e.clientY - centerY) * 0.15;
                
                gsap.to(card, {
                    x: deltaX,
                    y: deltaY,
                    duration: 0.3,
                    ease: 'power2.out'
                });
            };

            const resetPosition = () => {
                gsap.to(card, {
                    x: 0,
                    y: 0,
                    duration: 0.5,
                    ease: 'elastic.out(1, 0.5)'
                });
            };

            card.addEventListener('mousemove', magnetic);
            card.addEventListener('mouseleave', resetPosition);
        });

        // Content text animations
        gsap.utils.toArray('.content-text h3').forEach(heading => {
            gsap.to(heading, {
                opacity: 1,
                x: 0,
                duration: 1,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: heading,
                    start: 'top 80%'
                }
            });
        });

        gsap.utils.toArray('.content-text p').forEach(paragraph => {
            gsap.to(paragraph, {
                opacity: 1,
                x: 0,
                duration: 1,
                ease: 'power2.out',
                delay: 0.2,
                scrollTrigger: {
                    trigger: paragraph,
                    start: 'top 80%'
                }
            });
        });

        // Content image animations
        gsap.utils.toArray('.content-image').forEach(image => {
            gsap.to(image, {
                opacity: 1,
                x: 0,
                duration: 1,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: image,
                    start: 'top 80%'
                }
            });
        });

        // Enhanced metric cards with number counting animation
        gsap.to('.metric-card', {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: 'power2.out',
            stagger: 0.15,
            scrollTrigger: {
                trigger: '.results-grid',
                start: 'top 70%',
                onEnter: () => {
                    console.log('ðŸŽ¯ Impact section scroll trigger fired!');
                    // Animate numbers counting up
                    const metricNumbers = document.querySelectorAll('#results .metric-number');
                    console.log('ðŸ“Š Found metric numbers:', metricNumbers.length);
                    
                    // Use hardcoded values to avoid corruption
                    const originalValues = ['6+', '92%', '200+', '3'];
                    
                    metricNumbers.forEach((number, index) => {
                        const finalNumber = originalValues[index] || '0';
                        console.log(`ðŸ“ˆ Metric ${index + 1} - Using value: "${finalNumber}"`);
                        
                        const numValue = parseInt(finalNumber.replace(/[%+]/g, ''));
                        const hasPercent = finalNumber.includes('%');
                        const hasPlus = finalNumber.includes('+');
                        
                        console.log(`ðŸ“Š Parsed - Value: ${numValue}, Percent: ${hasPercent}, Plus: ${hasPlus}`);
                        
                        // Use simple object animation
                        const counter = { value: 0 };
                        
                        gsap.to(counter, {
                            value: numValue,
                            duration: 2,
                            ease: 'power2.out',
                            onStart: function() {
                                console.log(`ðŸŽ¬ Started animating metric ${index + 1}`);
                            },
                            onUpdate: function() {
                                const currentValue = Math.round(counter.value);
                                let displayText = currentValue.toString();
                                
                                // Always add symbols during animation
                                if (hasPercent) displayText += '%';
                                if (hasPlus) displayText += '+';
                                
                                number.textContent = displayText;
                            },
                            onComplete: function() {
                                // Ensure final value is correct
                                let finalText = numValue.toString();
                                if (hasPercent) finalText += '%';
                                if (hasPlus) finalText += '+';
                                number.textContent = finalText;
                                console.log(`âœ… Completed animating metric ${index + 1} to: "${finalText}"`);
                            }
                        });
                    });
                }
            }
        });

        // Manual trigger for metric animation (in case ScrollTrigger has issues)
        function triggerMetricAnimation() {
            console.log('ðŸŽ¯ Manually triggering metric animation');
            const metricNumbers = document.querySelectorAll('#results .metric-number');
            console.log('ðŸ“Š Found metric numbers for manual trigger:', metricNumbers.length);
            
            // Define the original values directly since data-original is getting corrupted
            const originalValues = ['6+', '92%', '200+', '3'];
            
            metricNumbers.forEach((number, index) => {
                const finalNumber = originalValues[index] || '0';
                console.log(`ðŸ”¢ Processing metric ${index + 1}: "${finalNumber}"`);
                
                const numValue = parseInt(finalNumber.replace(/[%+]/g, ''));
                const hasPercent = finalNumber.includes('%');
                const hasPlus = finalNumber.includes('+');
                
                console.log(`ðŸ“ˆ Animation setup - Value: ${numValue}, Percent: ${hasPercent}, Plus: ${hasPlus}`);
                
                // Use a simple object to track the counter value
                const counter = { value: 0 };
                
                gsap.to(counter, {
                    value: numValue,
                    duration: 2,
                    ease: 'power2.out',
                    onUpdate: function() {
                        const currentValue = Math.round(counter.value);
                        let displayText = currentValue.toString();
                        
                        // Always add symbols during animation
                        if (hasPercent) displayText += '%';
                        if (hasPlus) displayText += '+';
                        
                        number.textContent = displayText;
                        console.log(`ðŸ”„ Updating metric ${index + 1}: ${currentValue} -> "${displayText}"`);
                    },
                    onComplete: function() {
                        // Ensure final value is correct
                        let finalText = numValue.toString();
                        if (hasPercent) finalText += '%';
                        if (hasPlus) finalText += '+';
                        number.textContent = finalText;
                        console.log(`âœ… Completed metric ${index + 1}: "${finalText}"`);
                    }
                });
            });
        }

        // Monitor metric numbers for unexpected changes
        function monitorMetricNumbers() {
            const impactNumbers = document.querySelectorAll('#results .metric-number');
            console.log('ðŸ” Monitoring metric numbers...');
            
            impactNumbers.forEach((number, index) => {
                const currentValue = number.textContent;
                console.log(`ðŸ“‹ Metric ${index + 1} current value: "${currentValue}"`);
                
                // Set up a mutation observer to catch what's changing the values
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'childList' || mutation.type === 'characterData') {
                            console.log(`ðŸš¨ Metric ${index + 1} text changed to: "${number.textContent}"`);
                            console.trace('Stack trace of what changed the metric:');
                        }
                    });
                });
                
                observer.observe(number, {
                    childList: true,
                    characterData: true,
                    subtree: true
                });
            });
        }

        // Force trigger the metric animation after a delay to ensure it works
        setTimeout(() => {
            console.log('ðŸ• Force-checking Impact section metric numbers...');
            const impactNumbers = document.querySelectorAll('#results .metric-number');
            
            if (impactNumbers.length === 0) {
                console.log('âŒ No Impact section metric numbers found!');
                return;
            }
            
            let needsManualTrigger = false;
            
            impactNumbers.forEach((number, index) => {
                const currentText = number.textContent;
                console.log(`ðŸ“Š Impact Metric ${index + 1}: "${currentText}"`);
                if (currentText === '0' || currentText === '' || currentText === '0%' || currentText === '0+') {
                    needsManualTrigger = true;
                }
            });
            
            if (needsManualTrigger) {
                console.log('âš ï¸ Impact metric numbers stuck at 0, force-triggering animation');
                
                // Kill any existing animations on these elements
                impactNumbers.forEach(number => {
                    gsap.killTweensOf(number);
                });
                
                // Manually trigger with fresh animation
                triggerMetricAnimation();
            } else {
                console.log('âœ… Impact metric numbers already animated correctly');
            }
            
            // Start monitoring for unexpected changes
            monitorMetricNumbers();
        }, 3000); // Extended delay to avoid conflicts

        // Word-by-word animation for "How might we" title
        function initHowMightWeAnimation() {
            const hmwTitle = document.querySelector('.hmw-animated-title');
            if (!hmwTitle) {
                console.log('âš ï¸ HMW title not found');
                return;
            }

            // Normalize and rebuild content to ensure the latest copy is used
            const normalizedText = hmwTitle.textContent.trim().replace(/\s+/g, ' ');
            const tokens = normalizedText.split(' ');

            // Replace content with wrapped words (preserve spaces between tokens)
            hmwTitle.innerHTML = tokens.map(t => `<span class="hmw-word">${t}</span>`).join(' ');

            // Animate words appearing one by one on early trigger
            const wordElements = hmwTitle.querySelectorAll('.hmw-word');

            gsap.timeline({
                scrollTrigger: {
                    trigger: '#how-might-we',
                    start: 'top 95%',
                    once: true,
                    onEnter: () => {
                        wordElements.forEach((word, index) => {
                            gsap.to(word, {
                                opacity: 1,
                                duration: 0.6,
                                delay: index * 0.15,
                                ease: 'power2.out'
                            });
                        });

                        const totalTitleDuration = (wordElements.length * 0.15) + 0.6;
                        gsap.to('.hmw-pill', {
                            opacity: 1,
                            y: 0,
                            duration: 0.2,
                            delay: totalTitleDuration + 0.2,
                            ease: 'power2.out'
                        });
                    }
                }
            });
        }

        // Initialize the animation after DOM is ready (no double-init)
        document.addEventListener('DOMContentLoaded', () => {
            initHowMightWeAnimation();
            initHmwContentAnimation();
            initDefectGlossaryAnimation();
            initDefectGlossaryContentAnimation();
            initDefectTableComponent();
        });

        // Independent animation for HMW content
        function initHmwContentAnimation() {
            const hmwContent = document.querySelector('.hmw-content');
            if (!hmwContent) {
                console.log('âš ï¸ HMW content not found');
                return;
            }

            gsap.to(hmwContent, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: hmwContent,
                    start: 'top 80%',
                    once: true
                }
            });

            console.log('âœ… HMW content independent animation initialized');
        }

        // Word-by-word animation for "Defect glossary" title
        function initDefectGlossaryAnimation() {
            const defectGlossaryTitle = document.querySelector('.defect-glossary-animated-title');
            if (!defectGlossaryTitle) {
                console.log('âš ï¸ Defect glossary title not found');
                return;
            }

            console.log('ðŸŽ­ Initializing simple Defect Glossary fade-in animation');
            
            // Simple fade-in animation like other section titles
            gsap.fromTo(defectGlossaryTitle, 
                {
                    opacity: 0,
                    y: 30
                },
                {
                    opacity: 1,
                    y: 0,
                    duration: 0.8,
                    ease: 'power2.out',
                    scrollTrigger: {
                        trigger: '#defect-glossary',
                        start: 'top 70%',
                        once: true
                    }
                }
            );
        }

        // Independent animation for Defect Glossary content
        function initDefectGlossaryContentAnimation() {
            const defectGlossaryContent = document.querySelector('.defect-glossary-content');
            if (!defectGlossaryContent) {
                console.log('âš ï¸ Defect glossary content not found');
                return;
            }

            gsap.to(defectGlossaryContent, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: defectGlossaryContent,
                    start: 'top 80%',
                    once: true,
                    onEnter: () => {
                        if (typeof window.renderDefectCards === 'function') {
                            window.renderDefectCards();
                        }
                    }
                }
            });

            console.log('âœ… Defect glossary content independent animation initialized');
        }

        // Defect Table Component Functionality
        function initDefectTableComponent() {
            console.log('ðŸ”§ Initializing Defect Table Component');

            // Defect data using the same icon mapping as dropdown
            const defects = [
                {
                    id: 1,
                    title: "Missing Component",
                    description: "This defect pertains to components that are observably and visibly missing from the current development design. Missing component defects are typically classified as 'Critical' as it may directly affect business outcomes and customer experience.",
                    severity: "high",
                    iconKey: "missing-component"
                },

                {
                    id: 2,
                    title: "Malfunctioning Component",
                    description: "This defect pertains to malfunctioning components designed and developed uniquely for your project, this may include custom components and interactions, as well as component innovations.",
                    severity: "high",
                    iconKey: "broken-code"
                },
                {
                    id: 3,
                    title: "Layout and Alignment",
                    description: "This defect pertains to layout and alignment issues and inaccuracies in visual design and CSS. Layout and spacing defects are typically classified as 'Minor' as it may affect customer experience and expectations.",
                    severity: "medium",
                    iconKey: "layout-alignment"
                },
                {
                    id: 4,
                    title: "Content Misalignment",
                    description: "This defect pertains to major content misalignments between the current development design and the most up-to-date Master Copy Deck (MCD). Major content misalignment defects include typos and literal errors that affect cohesive wording or language.",
                    severity: "medium",
                    iconKey: "content-misalignment"

                },
                {
                    id: 5,
                    title: "Screen Reader Sequence",
                    description: "This defect pertains to screen reader issues, such as incorrect module sequencing and orientation. The reading sequence of screen readers, such as JAWs, typically read left to right and top to bottom.",
                    severity: "medium",
                    iconKey: "screen-reader"
                },
                {
                    id: 6,
                    title: "Design System Misalignment",
                    description: "This defect pertains to a misalignment between the current development design and the most up-to-date TD Emerald Design System Component Library. Design system misalignment defects are typically classified as 'Minor'.",
                    severity: "low",
                    iconKey: "design-system"
                },
                {
                    id: 7,
                    title: "Color",
                    description: "This defect pertains to color issues and inaccuracies in visual design and CSS. Color defects are typically classified as 'Minor' as it may affect customer experience, expectations, and accessibility needs.",
                    severity: "low",
                    iconKey: "colour"
                },
                {
                    id: 8,
                    title: "Font Size & Style",
                    description: "This defect pertains to font style or size issues and inaccuracies in visual design and CSS. Font style or size defects are typically classified as 'Minor' as it may affect customer experience, expectations, and accessibility needs.",
                    severity: "low",
                    iconKey: "font-style"
                },
                {
                    id: 9,
                    title: "Padding & Spacing",
                    description: "This defect pertains to minor padding and spacing issues and inaccuracies in visual design and CSS.",
                    severity: "low",
                    iconKey: "spacing"
                },
                {
                    id: 10,
                    title: "Other",
                    description: "This defect pertains to anomalies and undefined issues, please use this category flexibly for your project needs.",
                    severity: "low",
                    iconKey: "other"
                }
            ];

            let selectedSeverity = "all";

            // Create icon using existing defectIconMap with proper styling
            function createIcon(iconKey) {
                const iconContainer = document.createElement('div');
                iconContainer.className = 'defect-card-icon';
                
                // Get the icon HTML from the existing defectIconMap
                const iconMap = window.currentIconMap || defectIconMap;
                const iconHtml = iconMap[iconKey] || iconMap['other']; // Fallback to 'other' icon
                
                iconContainer.innerHTML = iconHtml;
                
                // Apply proper styling to the SVG inside
                const svg = iconContainer.querySelector('svg');
                if (svg) {
                    svg.style.width = '16px';
                    svg.style.height = '16px';
                    svg.style.fill = '#6b7280';
                    svg.style.stroke = 'none'; // Remove any stroke
                }
                
                return iconContainer;
            }

            // Render defect cards
            // Rendering guard flags
            window.isRenderingDefects = window.isRenderingDefects || false;
            window.defectListHasRendered = window.defectListHasRendered || false;

            async function renderDefectCards() {
                if (window.isRenderingDefects) return; // Prevent concurrent renders
                window.isRenderingDefects = true;
                const container = document.querySelector('.defect-cards-list');
                if (!container) {
                    console.log('âš ï¸ Defect cards container not found');
                    window.isRenderingDefects = false;
                    return;
                }

                // Sort by severity (high > medium > low), and then alphabetically by title within each severity
                const severityRank = { high: 3, medium: 2, low: 1 };
                const filteredDefects = selectedSeverity === "all" 
                    ? [...defects].sort((a, b) => {
                        const rankDiff = (severityRank[b.severity] || 0) - (severityRank[a.severity] || 0);
                        if (rankDiff !== 0) return rankDiff;
                        // Stable tie-breakers to avoid reordering flicker
                        const titleDiff = (a.title || '').localeCompare(b.title || '', undefined, { sensitivity: 'base' });
                        if (titleDiff !== 0) return titleDiff;
                        return (a.id || 0) - (b.id || 0);
                    }) 
                    : defects
                        .filter(defect => defect.severity === selectedSeverity)
                        .sort((a, b) => (a.title || '').localeCompare(b.title || '', undefined, { sensitivity: 'base' }));

                console.log(`Rendering ${filteredDefects.length} defect cards for severity: ${selectedSeverity}`);

                if (filteredDefects.length === 0) {
                    container.innerHTML = `
                        <div class="defect-empty-state">
                            <div class="defect-empty-icon">
                                <span>?</span>
                            </div>
                            <p class="defect-empty-text">No defects found with the selected severity level</p>
                        </div>
                    `;
                    return;
                }

                // Clear container first
                container.innerHTML = '';

                // Build deterministically using severity groups and a fragment
                const fragment = document.createDocumentFragment();
                const makeCard = (defect) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'defect-card';
                    
                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'defect-card-content';
                    
                    const iconElement = createIcon(defect.iconKey);
                    iconElement.className = 'defect-card-icon';
                    
                    const titleH4 = document.createElement('h4');
                    titleH4.className = 'defect-card-title';
                    titleH4.textContent = defect.title;
                    
                    const severitySpan = document.createElement('span');
                    severitySpan.className = `defect-card-severity ${defect.severity}`;
                    severitySpan.textContent = defect.severity.toUpperCase();
                    
                    const descP = document.createElement('p');
                    descP.className = 'defect-card-description';
                    descP.textContent = defect.description;
                    
                    contentDiv.appendChild(iconElement);
                    contentDiv.appendChild(titleH4);
                    contentDiv.appendChild(severitySpan);
                    contentDiv.appendChild(descP);
                    cardDiv.appendChild(contentDiv);
                    return cardDiv;
                };

                const cards = filteredDefects.map(makeCard);
                cards.forEach(card => fragment.appendChild(card));
                container.innerHTML = '';
                container.appendChild(fragment);

                // Fade-in one-by-one using a deterministic NodeList order
                for (let i = 0; i < cards.length; i++) {
                    const card = cards[i];
                    requestAnimationFrame(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    });
                    await new Promise(r => setTimeout(r, 80));
                }

                window.defectListHasRendered = true;
                window.isRenderingDefects = false;
            }

            // Setup filter buttons
            function setupFilterButtons() {
                const buttons = document.querySelectorAll('.severity-btn');
                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        // Remove active class from all buttons
                        buttons.forEach(btn => btn.classList.remove('active'));
                        
                        // Add active class to clicked button
                        button.classList.add('active');
                        
                        // Update selected severity
                        selectedSeverity = button.dataset.severity;
                        
                        // Re-render cards
                        renderDefectCards();
                    });
                });
            }

            // Make renderDefectCards available globally for icon updates
            window.renderDefectCards = renderDefectCards;
            
            // Initialize component (filters only). First render occurs when content reveals to avoid double animation.
            setupFilterButtons();
            console.log('âœ… Defect Table Component initialized (render deferred to reveal)');
        }

        // Process Map Canvas: Drag-to-pan + Wheel-to-zoom (no native scrolling)
        function initProcessMapCanvas() {
            console.log('ðŸ—ºï¸ Initializing Drag + Zoom for Process Map');
            
            const canvas = document.querySelector('.canvas-content');
            const wrapper = document.querySelector('.process-map-image');
            const img = document.querySelector('.process-map-img');

            if (!canvas || !wrapper || !img) return;

            let scale = 1;
            const minScale = 1;
            const maxScale = 6;
            let dragInstance = null;

            function computeBaseWidth() {
                const canvasH = canvas.clientHeight;
                const baseW = img.naturalWidth * (canvasH / img.naturalHeight);
                return baseW;
            }

            function computeBounds(currentScale) {
                const vw = canvas.clientWidth;
                const vh = canvas.clientHeight;
                const baseW = computeBaseWidth();
                const baseH = vh; // image fits canvas height at scale 1
                const sw = baseW * currentScale;
                const sh = baseH * currentScale;

                const minX = sw > vw ? vw - sw : (vw - sw) / 2;
                const maxX = sw > vw ? 0 : (vw - sw) / 2;
                const minY = sh > vh ? vh - sh : (vh - sh) / 2;
                const maxY = sh > vh ? 0 : (vh - sh) / 2;

                return { minX, maxX, minY, maxY };
            }

            function clamp(val, min, max) {
                return Math.max(min, Math.min(max, val));
            }

            function applyTransform(x, y, s) {
                gsap.set(wrapper, { x, y, scale: s, transformOrigin: '0 0' });
            }

            function initDrag() {
                if (dragInstance) dragInstance.kill();
                const bounds = computeBounds(scale);
                // Track velocity manually (avoid plugin getVelocity dependency)
                let lastDragX = 0;
                let lastDragY = 0;
                let lastDragTime = 0;
                let velX = 0;
                let velY = 0;

                dragInstance = Draggable.create(wrapper, {
                    type: 'x,y',
                    bounds,
                    inertia: false,
                    edgeResistance: 0.85,
                    throwResistance: 3500,
                    onPress: function () {
                        canvas.closest('.process-map-canvas')?.classList.add('is-interacting');
                        gsap.killTweensOf(wrapper);
                        lastDragX = this.x;
                        lastDragY = this.y;
                        lastDragTime = performance.now();
                        velX = 0;
                        velY = 0;
                    },
                    onDrag: function () {
                        const b = computeBounds(scale);
                        // Clamp position
                        this.x = clamp(this.x, b.minX, b.maxX);
                        this.y = clamp(this.y, b.minY, b.maxY);
                        // Velocity estimation
                        const now = performance.now();
                        const dt = Math.max(1, now - lastDragTime);
                        velX = (this.x - lastDragX) / (dt / 1000); // px/sec
                        velY = (this.y - lastDragY) / (dt / 1000); // px/sec
                        lastDragX = this.x;
                        lastDragY = this.y;
                        lastDragTime = now;
                        applyTransform(this.x, this.y, scale);
                    },
                    onDragEnd: function () {
                        // Momentum glide after release
                        const b = computeBounds(scale);
                        const effectiveSeconds = 0.3; // how long velocity projects distance
                        const vx = velX || 0;
                        const vy = velY || 0;
                        let targetX = clamp(this.x + vx * effectiveSeconds, b.minX, b.maxX);
                        let targetY = clamp(this.y + vy * effectiveSeconds, b.minY, b.maxY);

                        gsap.to(wrapper, {
                            x: targetX,
                            y: targetY,
                            duration: 0.7,
                            ease: 'power3.out',
                            delay: 0.06, // tiny delay to feel like it eases in to the glide
                            overwrite: true,
                            onUpdate: () => {
                                // Keep Draggable's internal state in sync
                                this.x = Number(gsap.getProperty(wrapper, 'x')) || 0;
                                this.y = Number(gsap.getProperty(wrapper, 'y')) || 0;
                            },
                            onComplete: () => {
                                this.update();
                                canvas.closest('.process-map-canvas')?.classList.remove('is-interacting');
                            }
                        });
                    },
                    cursor: 'grab',
                    activeCursor: 'grabbing'
                })[0];
                // Center on init
                const startX = clamp(0, bounds.minX, bounds.maxX);
                const startY = clamp(0, bounds.minY, bounds.maxY);
                applyTransform(startX, startY, scale);
                dragInstance.update();
            }

            function zoomAt(pointX, pointY, delta) {
                const prevScale = scale;
                const factor = 1 - delta * 0.0005; // even slower wheel zoom for softer feel
                scale = clamp(prevScale * factor, minScale, maxScale);

                // Current transform
                const current = gsap.getProperty(wrapper);
                const curX = Number(current('x')) || 0;
                const curY = Number(current('y')) || 0;

                // Content coords under cursor before zoom
                const contentX = (pointX - curX) / prevScale;
                const contentY = (pointY - curY) / prevScale;

                // New transform to keep cursor focus
                let newX = pointX - contentX * scale;
                let newY = pointY - contentY * scale;

                // Clamp to bounds
                const b = computeBounds(scale);
                newX = clamp(newX, b.minX, b.maxX);
                newY = clamp(newY, b.minY, b.maxY);

                applyTransform(newX, newY, scale);
                if (dragInstance) dragInstance.applyBounds(b);
            }

            // Absolute zoom to a specific scale around a point (re-uses zoomAt math)
            function setScaleAt(pointX, pointY, newScale) {
                const prevScale = scale;
                newScale = clamp(newScale, minScale, maxScale);
                if (Math.abs(newScale - prevScale) < 0.0001) return;
                scale = newScale;

                const current = gsap.getProperty(wrapper);
                const curX = Number(current('x')) || 0;
                const curY = Number(current('y')) || 0;

                const contentX = (pointX - curX) / prevScale;
                const contentY = (pointY - curY) / prevScale;

                let newX = pointX - contentX * scale;
                let newY = pointY - contentY * scale;

                const b = computeBounds(scale);
                newX = clamp(newX, b.minX, b.maxX);
                newY = clamp(newY, b.minY, b.maxY);

                applyTransform(newX, newY, scale);
                if (dragInstance) dragInstance.applyBounds(b);
            }

            // Expose setter for scroll-driven animation to use
            window.setScaleAt = setScaleAt;

            let wheelInteractTimeout = null;
            function onWheel(e) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const px = e.clientX - rect.left;
                const py = e.clientY - rect.top;
                canvas.closest('.process-map-canvas')?.classList.add('is-interacting');
                zoomAt(px, py, e.deltaY);
                if (wheelInteractTimeout) clearTimeout(wheelInteractTimeout);
                wheelInteractTimeout = setTimeout(() => {
                    canvas.closest('.process-map-canvas')?.classList.remove('is-interacting');
                }, 250);
            }

            function onResize() {
                const b = computeBounds(scale);
                if (dragInstance) dragInstance.applyBounds(b);
                // Clamp current position to new bounds
                const current = gsap.getProperty(wrapper);
                let x = Number(current('x')) || 0;
                let y = Number(current('y')) || 0;
                x = clamp(x, b.minX, b.maxX);
                y = clamp(y, b.minY, b.maxY);
                applyTransform(x, y, scale);
            }

            function start() {
                // Reset to scale 1 and centered so full height is shown on load
                scale = 1;
                const bounds = computeBounds(scale);
                const startX = clamp(0, bounds.minX, bounds.maxX);
                const startY = clamp(0, bounds.minY, bounds.maxY);
                applyTransform(startX, startY, scale);
                // Prevent any pending tweens from previous interactions
                gsap.killTweensOf(wrapper);
                initDrag();
                canvas.addEventListener('wheel', onWheel, { passive: false });
                window.addEventListener('resize', onResize);
            }

            if (img.complete) {
                start();
            } else {
                img.addEventListener('load', start, { once: true });
            }

            console.log('âœ… Drag + Zoom initialized for Process Map');
        }

        // Process Map Section Animation - Disabled to prevent flicker/zoom on scroll
        function initProcessMapAnimation() { /* no-op */ }

        // Initialize Process Map functionality
        setTimeout(() => {
            initProcessMapCanvas();
            initProcessMapAnimation();
        }, 600);

        // Ensure final video autoplays on load (some browsers need a play() kick after metadata)
        window.addEventListener('load', () => {
            const vid = document.querySelector('#implementation .final-video-card video');
            if (!vid) return;
            const tryPlay = () => { vid.play().catch(() => {}); };
            vid.addEventListener('loadeddata', tryPlay, { once: true });
            // Fallback retry
            setTimeout(tryPlay, 1200);
        });

        // Reveal fades consistently on scroll (aligns with other sections)
        function initSimpleFades() {
            const els = document.querySelectorAll('.fade-in');
            const io = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('show');
                        io.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.2 });
            els.forEach(el => io.observe(el));
        }
        initSimpleFades();

        // Dedicated Impact section metric animation trigger
        function initImpactMetricsAnimation() {
            console.log('ðŸŽ¯ Setting up dedicated Impact metrics animation');
            
            ScrollTrigger.create({
                trigger: '#results',
                start: 'top 75%',
                once: true,
                onEnter: () => {
                    console.log('ðŸ”¥ Dedicated Impact section trigger fired!');
                    
                    setTimeout(() => {
                        const impactNumbers = document.querySelectorAll('#results .metric-number');
                        console.log('ðŸ“ˆ Found', impactNumbers.length, 'Impact metric numbers to animate');
                        
                        if (impactNumbers.length > 0) {
                            // Kill any existing animations
                            impactNumbers.forEach(number => gsap.killTweensOf(number));
                            
                            // Trigger fresh animation
                            triggerMetricAnimation();
                        }
                    }, 100);
                }
            });
        }

        // Initialize Impact metrics animation
        setTimeout(() => {
            initImpactMetricsAnimation();
        }, 1000);

        // Enhanced metric cards for "How might we" section
        gsap.utils.toArray('#how-might-we .metric-card').forEach(card => {
            gsap.to(card, {
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: card,
                    start: 'top 70%',
                    onEnter: () => {
                        // Animate numbers counting up for this specific section
                        const number = card.querySelector('.metric-number');
                        if (number) {
                        const finalNumber = number.textContent;
                            const numValue = parseInt(finalNumber.replace(/[%+]/g, ''));
                        const hasPercent = finalNumber.includes('%');
                            const hasPlus = finalNumber.includes('+');
                        
                        gsap.fromTo(number, 
                            { textContent: 0 },
                            {
                                textContent: numValue,
                                duration: 2,
                                ease: 'power2.out',
                                snap: { textContent: 1 },
                                onUpdate: function() {
                                        const currentValue = Math.round(this.targets()[0].textContent);
                                        let displayText = currentValue;
                                        if (hasPercent) displayText += '%';
                                        if (hasPlus) displayText += '+';
                                        number.textContent = displayText;
                                    }
                                }
                            );
                        }
                    }
                }
            });
        });

        // Enhanced framework card interactions with ripple effect
        document.querySelectorAll('.framework-card').forEach(card => {
            card.addEventListener('click', function(e) {
                const category = this.dataset.category;
                console.log(`Framework category clicked: ${category}`);
                
                // Ripple effect
                const ripple = document.createElement('div');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 50%;
                    pointer-events: none;
                    transform: scale(0);
                `;
                
                this.appendChild(ripple);
                
                gsap.to(ripple, {
                    scale: 2,
                    opacity: 0,
                    duration: 0.6,
                    ease: 'power2.out',
                    onComplete: () => ripple.remove()
                });
            });
        });

        // Animate cause items on scroll
        gsap.to('.cause-item', {
            scrollTrigger: {
                trigger: '.causes-list',
                start: 'top 80%',
                end: 'bottom 20%',
                toggleActions: 'play none none reverse'
            },
            opacity: 1,
            x: 0,
            duration: 0.8,
            stagger: 0.2,
            ease: 'power2.out'
        });

        // Animate defect cards
        gsap.to('.defect-card', {
            scrollTrigger: {
                trigger: '.defects-grid',
                start: 'top 80%',
                end: 'bottom 20%',
                toggleActions: 'play none none reverse'
            },
            opacity: 1,
            y: 0,
            duration: 0.8,
            stagger: {
                amount: 1.2,
                from: 'random'
            },
            ease: 'power2.out'
        });

        // Interactive Defect Triage Component
        function initializeTriageComponent() {
            const defectSelect = document.getElementById('defect-type-select');
            const statusSelect = document.getElementById('status-select');
            const description = document.getElementById('defect-description');
            const componentHeader = document.querySelector('.triage-card');

            if (!defectSelect || !statusSelect || !description || !componentHeader) {
                return; // Elements not found
            }

            // Initialize hint text styling
            if (!defectSelect.value) {
                const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
                defectSelect.style.color = isDarkMode ? 'hsl(215.4 16.3% 56.9%)' : 'hsl(215.4 16.3% 46.9%)';
                defectSelect.style.textIndent = '0';
                defectSelect.style.fontSize = '14px';
                defectSelect.classList.add('hint-selected');
            }

            // Defect type change handler
            defectSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const severity = selectedOption.getAttribute('data-severity');
                
                // Handle hint text display to prevent icon inheritance
                if (!this.value) {
                    // When hint text is selected, ensure clean display
                    const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
                    this.style.color = isDarkMode ? 'hsl(215.4 16.3% 56.9%)' : 'hsl(215.4 16.3% 46.9%)';
                    this.style.textIndent = '0';
                    this.style.fontSize = '14px';
                    this.classList.add('hint-selected');
                } else {
                    // When actual option is selected, use normal styling
                    const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
                    this.style.color = isDarkMode ? 'hsl(210 40% 98%)' : 'hsl(222.2 84% 4.9%)';
                    this.style.textIndent = '';
                    this.style.fontSize = '';
                    this.classList.remove('hint-selected');
                }
                
                // Component styling remains consistent - no color changes

                // Auto-populate description placeholder based on defect type
                if (this.value) {
                    if (this.value === 'missing-component') {
                        description.placeholder = 'Specify which component is missing and its expected location...';
                    } else if (this.value === 'broken-code') {
                        description.placeholder = 'Describe the code issue and its impact on functionality...';
                    } else if (this.value === 'content-misalignment') {
                        description.placeholder = 'Detail the content discrepancy between design and implementation...';
                    } else {
                        description.placeholder = 'Please provide a brief but accurate description of the defect.';
                    }
                } else {
                    description.placeholder = 'Please provide a brief but accurate description of the defect.';
                }

                // No visual feedback to prevent flashing
            });

            // Status change handler
            statusSelect.addEventListener('change', function() {
                // No visual feedback to prevent flashing
            });

            // Description change handler - provides subtle feedback
            description.addEventListener('input', function() {
                if (this.value.length > 10) {
                    // Add subtle border highlight when sufficient content is provided
                    this.style.borderColor = 'rgba(255, 255, 255, 0.7)';
                } else {
                    this.style.borderColor = '';
                }
            });

            // Defect card click to auto-select
            document.querySelectorAll('.defect-card').forEach(card => {
                card.addEventListener('click', function() {
                    const defectType = this.getAttribute('data-defect');
                    defectSelect.value = defectType;
                    
                    // Trigger change event
                    defectSelect.dispatchEvent(new Event('change'));
                    
                    // Scroll to component smoothly with GSAP
                    const triageComponent = document.querySelector('.triage-component-container');
                    if (triageComponent) {
                        gsap.killTweensOf(window);
                        
                        gsap.to(window, {
                            duration: 1.3,
                            scrollTo: {
                                y: triageComponent,
                                offsetY: 100,
                                autoKill: false
                            },
                            ease: "power3.inOut"
                        });
                    }
                    
                    // Add visual feedback
                    gsap.fromTo(this,
                        { scale: 1 },
                        { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1, ease: 'power2.out' }
                    );
                });
            });
        }

        // Initialize the triage component
        initializeTriageComponent();

        // Custom Defect Icon Mapping System
        const defectIconMap = {
            'missing-component': `<svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>`,
            'broken-code': `<svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>`,
            'content-misalignment': `<svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>`,
            'screen-reader': `<svg viewBox="0 0 24 24"><path d="M3,9V15H7L12,20V4L7,9H3M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.76 16.5,12M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23Z"/></svg>`,
            'layout-alignment': `<svg viewBox="0 0 24 24"><path d="M21,16V4H3V16H21M21,2A2,2 0 0,1 23,4V16A2,2 0 0,1 21,18H3A2,2 0 0,1 1,16V4A2,2 0 0,1 3,2H21M5,14L8.5,10.5L11,13L14.5,9.5L19,14H5Z"/></svg>`,
            'design-system': `<svg viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/></svg>`,
            'font-style': `<svg viewBox="0 0 24 24"><path d="M9,4V7H14V19H11V22H17V19H14V7H19V4H9Z"/></svg>`,
            'colour': `<svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20V4Z"/></svg>`,
            'spacing': `<svg viewBox="0 0 24 24"><path d="M7,15H9V9H7V15M11,19H13V5H11V19M15,11H17V13H15V11Z"/></svg>`,
            'other': `<svg viewBox="0 0 24 24"><path d="M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z"/></svg>`
        };

        // Function to update custom icons with user's repository icons
        function updateDefectIcons(customIcons = {}) {
            console.log('ðŸ”§ updateDefectIcons called with:', customIcons);
            
            // Merge custom icons with default icons
            const iconMap = { ...defectIconMap, ...customIcons };
            console.log('ðŸ“‹ Icon map:', Object.keys(iconMap));
            
            // Store globally for dropdown access
            window.currentIconMap = iconMap;
            
            // Update all defect card icons
            const iconContainers = document.querySelectorAll('.custom-defect-icon[data-icon]');
            console.log('ðŸŽ¯ Found icon containers:', iconContainers.length);
            
            iconContainers.forEach(iconContainer => {
                const iconType = iconContainer.getAttribute('data-icon');
                console.log(`ðŸ”„ Processing icon: ${iconType}`);
                
                if (iconMap[iconType]) {
                    console.log(`âœ… Updating ${iconType} with custom icon`);
                    iconContainer.innerHTML = iconMap[iconType];
                } else {
                    console.log(`âŒ No icon found for: ${iconType}`);
                }
            });
            
            // Update dropdown options with new icons
            refreshDropdownIcons();
            
            // Update defect table icons if the component exists
            if (typeof window.renderDefectCards === 'function') {
                console.log('ðŸ”„ Re-rendering defect table with updated icons');
                window.renderDefectCards();
            }
        }
        
        // Function to refresh dropdown icons after custom icons are loaded
        function refreshDropdownIcons() {
            console.log('ðŸ”„ Refreshing dropdown icons...');
            
            const customOptions = document.querySelectorAll('.custom-option[data-icon]');
            customOptions.forEach(optionDiv => {
                const iconType = optionDiv.getAttribute('data-icon');
                const iconMap = window.currentIconMap || defectIconMap;
                const iconContainer = optionDiv.querySelector('.option-icon');
                
                if (iconContainer && iconType && iconMap[iconType]) {
                    console.log(`ðŸ”„ Refreshing dropdown icon: ${iconType}`);
                    iconContainer.innerHTML = iconMap[iconType];
                }
            });
            
            // Also update selected display if defect type is selected
            const defectDropdown = document.querySelector('[data-dropdown-id="defect-type-select"]');
            if (defectDropdown) {
                const selectedIcon = defectDropdown.querySelector('.selected-icon');
                const selectedText = defectDropdown.querySelector('.selected-text');
                const originalDropdown = document.getElementById('defect-type-select');
                
                if (selectedIcon && originalDropdown && originalDropdown.value) {
                    const selectedOption = originalDropdown.querySelector(`option[value="${originalDropdown.value}"]`);
                    if (selectedOption) {
                        const iconType = selectedOption.getAttribute('data-icon');
                        const iconMap = window.currentIconMap || defectIconMap;
                        if (iconType && iconMap[iconType]) {
                            selectedIcon.innerHTML = iconMap[iconType];
                        }
                    }
                }
            }
        }

        // Universal function to create custom dropdowns
        function createCustomDropdown(dropdownId, hasIcons = false) {
            const dropdown = document.getElementById(dropdownId);
            if (!dropdown) return;

            // CHECK IF CUSTOM DROPDOWN ALREADY EXISTS - PREVENT DUPLICATES
            const existingCustomDropdown = document.querySelector(`[data-dropdown-id="${dropdownId}"]`);
            if (existingCustomDropdown) {
                console.log(`âš ï¸ Custom dropdown already exists for ${dropdownId}, skipping creation`);
                return;
            }

            console.log(`ðŸ”§ Creating custom dropdown for: ${dropdownId}`);

            // IMMEDIATELY hide original dropdown to prevent any flickering
            dropdown.style.display = 'none !important';
            dropdown.style.opacity = '0 !important';
            dropdown.style.visibility = 'hidden !important';
            dropdown.style.position = 'absolute !important';
            dropdown.style.zIndex = '-9999 !important';
            
            // Create a custom dropdown container
            const dropdownContainer = dropdown.parentElement;
            const customDropdown = document.createElement('div');
            customDropdown.className = 'custom-enhanced-dropdown';
            customDropdown.setAttribute('data-dropdown-id', dropdownId);
            
            // Get the default option text
            const defaultOption = dropdown.querySelector('option[value=""]') || dropdown.querySelector('option:first-child');
            const defaultText = defaultOption ? defaultOption.textContent : 'Select option...';
            
            // Create the display (what shows when dropdown is closed)
            const customDisplay = document.createElement('div');
            customDisplay.className = 'custom-dropdown-display';
            customDisplay.innerHTML = `
                <div class="selected-option">
                    <span class="selected-text">${defaultText}</span>
                </div>
                <svg class="dropdown-arrow" viewBox="0 0 24 24" width="20" height="20">
                    <path d="M7 10l5 5 5-5z"/>
                </svg>
            `;
            
            // Create the dropdown options list
            const optionsList = document.createElement('div');
            optionsList.className = 'custom-dropdown-options';
            // Align to theme palette immediately
            optionsList.style.setProperty('background-color', 'var(--surface-color)', 'important');
            optionsList.style.setProperty('border', '1px solid var(--border-color)', 'important');
            optionsList.style.setProperty('border-top', '1px solid var(--border-color)', 'important');
            
            // Populate options
            const options = dropdown.querySelectorAll('option');
            options.forEach((option, index) => {
                if (index === 0 && option.value === '') return; // Skip default empty option
                
                const optionDiv = document.createElement('div');
                optionDiv.className = 'custom-option';
                optionDiv.setAttribute('data-value', option.value);
                
                if (hasIcons) {
                    optionDiv.setAttribute('data-icon', option.getAttribute('data-icon'));
                    const iconType = option.getAttribute('data-icon');
                    const iconMap = window.currentIconMap || defectIconMap;
                    const iconHtml = iconMap[iconType] || '';
                    
                    optionDiv.innerHTML = `
                        <span class="option-icon">${iconHtml}</span>
                        <span class="option-text">${option.textContent}</span>
                    `;
                } else {
                    optionDiv.innerHTML = `<span class="option-text">${option.textContent}</span>`;
                }
                
                // Handle option click
                optionDiv.addEventListener('click', () => {
                    console.log(`ðŸ“ Option selected: ${option.value}`);
                    
                    // Update original dropdown
                    dropdown.value = option.value;
                    dropdown.dispatchEvent(new Event('change'));
                    
                    // Update custom display
                    const selectedOption = customDisplay.querySelector('.selected-option');
                    
                    if (hasIcons && option.getAttribute('data-icon')) {
                        // Add icon span if it doesn't exist
                        let iconSpan = selectedOption.querySelector('.selected-icon');
                        if (!iconSpan) {
                            iconSpan = document.createElement('span');
                            iconSpan.className = 'selected-icon';
                            selectedOption.insertBefore(iconSpan, selectedOption.firstChild);
                        }
                        
                        const iconType = option.getAttribute('data-icon');
                        const iconMap = window.currentIconMap || defectIconMap;
                        const iconHtml = iconMap[iconType] || '';
                        iconSpan.innerHTML = iconHtml;
                    }
                    customDisplay.querySelector('.selected-text').textContent = option.textContent;
                    
                    // Add has-selection class for styling when actual option is selected
                    if (option.value) {
                        customDisplay.classList.add('has-selection');
                    } else {
                        customDisplay.classList.remove('has-selection');
                    }
                    
                    // Remove active state from all options
                    optionsList.querySelectorAll('.custom-option').forEach(opt => opt.classList.remove('active'));
                    optionDiv.classList.add('active');
                    
                    // Close dropdown
                    customDropdown.classList.remove('open');
                    const optionsListToClose = customDropdown.querySelector('.custom-dropdown-options');
                    if (optionsListToClose) {
                        optionsListToClose.style.display = 'none';
                    }
                    console.log('ðŸ”’ Dropdown closed after selection');
                });
                
                // Mark as selected if it matches current value
                if (option.selected || option.value === dropdown.value) {
                    optionDiv.classList.add('active');
                    
                    const selectedOption = customDisplay.querySelector('.selected-option');
                    
                    if (hasIcons && option.getAttribute('data-icon')) {
                        // Add icon span if it doesn't exist
                        let iconSpan = selectedOption.querySelector('.selected-icon');
                        if (!iconSpan) {
                            iconSpan = document.createElement('span');
                            iconSpan.className = 'selected-icon';
                            selectedOption.insertBefore(iconSpan, selectedOption.firstChild);
                        }
                        
                        const iconType = option.getAttribute('data-icon');
                        const iconMap = window.currentIconMap || defectIconMap;
                        const iconHtml = iconMap[iconType] || '';
                        iconSpan.innerHTML = iconHtml;
                    }
                    customDisplay.querySelector('.selected-text').textContent = option.textContent;
                    
                    // Add has-selection class for styling when actual option is selected
                    if (option.value) {
                        customDisplay.classList.add('has-selection');
                    } else {
                        customDisplay.classList.remove('has-selection');
                    }
                }
                
                optionsList.appendChild(optionDiv);
            });
            
            // Assemble custom dropdown
            customDropdown.appendChild(customDisplay);
            customDropdown.appendChild(optionsList);
            dropdownContainer.insertBefore(customDropdown, dropdown);
            
            // Handle display click to toggle dropdown - SINGLE DROPDOWN RULE
            customDisplay.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                console.log(`ðŸ–±ï¸ Click detected on dropdown ${dropdownId}`);
                
                const isCurrentlyOpen = customDropdown.classList.contains('open');
                
                // CLOSE ALL DROPDOWNS FIRST - Only one dropdown open at a time
                closeAllDropdowns();
                
                // If this dropdown was already open, keep it closed. Otherwise, open it.
                if (!isCurrentlyOpen) {
                    openDropdown(customDropdown, customDisplay);
                }
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!customDropdown.contains(e.target)) {
                    closeDropdown(customDropdown);
                }
            });
            
                        // No need for repositioning with absolute positioning relative to container
            // The dropdown will naturally move with its parent
            
            // Close dropdown on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && customDropdown.classList.contains('open')) {
                    closeDropdown(customDropdown);
                }
            });
            
            // Original dropdown is already hidden immediately - no setTimeout needed
            console.log(`âœ… Original dropdown ${dropdownId} hidden immediately to prevent flickering`);
        }
        
        // Global dropdown management functions
        function closeAllDropdowns() {
            console.log('ðŸ”’ Closing all open dropdowns');
            const openDropdowns = document.querySelectorAll('.custom-enhanced-dropdown.open');
            openDropdowns.forEach(dropdown => {
                closeDropdown(dropdown);
            });
        }
        
        function closeDropdown(dropdown) {
            dropdown.classList.remove('open');
            const optionsList = dropdown.querySelector('.custom-dropdown-options');
            if (optionsList) {
                optionsList.style.display = 'none';
            }
            console.log('ðŸ”’ Dropdown closed:', dropdown.getAttribute('data-dropdown-id'));
        }
        
                function openDropdown(dropdown, display) {
            dropdown.classList.add('open');
            const optionsList = dropdown.querySelector('.custom-dropdown-options');
                if (!optionsList) {
                    console.error('âŒ No options list found!');
                    return;
                }
                
            // Check for dark theme
            const isDarkTheme = document.body.getAttribute('data-theme') === 'dark';
            const backgroundColor = getComputedStyle(document.body).getPropertyValue('--surface-color').trim() || (isDarkTheme ? '#0b0f17' : '#fff');
            const borderColor = getComputedStyle(document.body).getPropertyValue('--border-color').trim() || (isDarkTheme ? '#2a3446' : 'hsl(214.3 31.8% 91.4%)');
            
            // Use absolute positioning relative to the dropdown container
                    optionsList.style.cssText = `
                        display: block !important;
                        visibility: visible !important;
                        opacity: 1 !important;
                position: absolute !important;
                top: calc(100% - 1px) !important; /* Position right below the display */
                left: 0 !important;
                right: 0 !important;
                width: auto !important;
                        z-index: 999999 !important;
                background-color: ${backgroundColor} !important;
                border: 1px solid ${borderColor} !important;
                border-top: 1px solid ${borderColor} !important;
                        border-bottom-left-radius: 6px !important;
                        border-bottom-right-radius: 6px !important;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
                        max-height: 200px !important;
                        overflow-y: auto !important;
                        margin: 0 !important;
                        padding: 0 !important;
                    `;
            console.log('âœ… Dropdown opened:', dropdown.getAttribute('data-dropdown-id'));
            console.log('ðŸ“ Using absolute positioning relative to container');
        }

        // Function to initialize custom dropdowns from scratch
        function initializeDropdownIcons() {
            console.log('ðŸš€ Initializing custom dropdowns...');
            
            // CRITICAL: Add styles FIRST before creating dropdowns
            addDropdownStyles();
            
            // Create dropdowns for main card (default to High severity)
            createDropdownForSection('severity-section', 'severity-select', false, [
                { value: 'high', text: 'High' },
                { value: 'medium', text: 'Medium' },
                { value: 'low', text: 'Low' }
            ]);
            
            createDropdownForSection('defect-type-section', 'defect-type-select', true, [
                { value: '', text: 'Select defect type' },
                { value: 'missing-component', text: 'Missing component', 'data-icon': 'missing-component' },
                { value: 'broken-code', text: 'Malfunctioning component', 'data-icon': 'broken-code' },
                { value: 'layout-alignment', text: 'Layout and alignment', 'data-icon': 'layout-alignment' },
                { value: 'content-misalignment', text: 'Content misalignment', 'data-icon': 'content-misalignment' },
                { value: 'screen-reader', text: 'Screen reader sequence', 'data-icon': 'screen-reader' },
                { value: 'design-system', text: 'Design system misalignment', 'data-icon': 'design-system' },
                { value: 'colour', text: 'Colour', 'data-icon': 'colour' },
                { value: 'font-style', text: 'Font size & style', 'data-icon': 'font-style' },
                { value: 'spacing', text: 'Padding and spacing', 'data-icon': 'spacing' },
                { value: 'other', text: 'Other', 'data-icon': 'other' }
            ]);
            
            console.log('âœ… Custom dropdowns initialized');
        }
        
        // Create dropdown for a specific section without original select elements
        function createDropdownForSection(sectionClass, dropdownId, hasIcons, options, parentElement = document) {
            const section = parentElement.querySelector(`.${sectionClass}`);
            if (!section) return;
            
            // Create hidden select for form submission
            const hiddenSelect = document.createElement('select');
            hiddenSelect.id = dropdownId;
            hiddenSelect.style.display = 'none';
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option.value;
                opt.textContent = option.text;
                if (option['data-icon']) opt.setAttribute('data-icon', option['data-icon']);
                hiddenSelect.appendChild(opt);
            });
            section.appendChild(hiddenSelect);
            
            // Create custom dropdown
            createCustomDropdown(dropdownId, hasIcons);
            
            // Add event listeners
            if (dropdownId === 'severity-select') {
                hiddenSelect.addEventListener('change', function() {
                    updateAnnotationColor(this.value);
                });
            }
        }
        
        // Separate function to add styles first
        function addDropdownStyles() {
            // Remove any existing styles first
            const existingStyle = document.getElementById('enhanced-dropdown-styles');
            if (existingStyle) {
                existingStyle.remove();
                console.log('ðŸ—‘ï¸ Removed existing dropdown styles');
            }
            
            // ALSO REMOVE ANY DUPLICATE CUSTOM DROPDOWNS
            const allCustomDropdowns = document.querySelectorAll('.custom-enhanced-dropdown');
            const seenDropdownIds = new Set();
            allCustomDropdowns.forEach(customDropdown => {
                const dropdownId = customDropdown.getAttribute('data-dropdown-id');
                if (seenDropdownIds.has(dropdownId)) {
                    console.log(`ðŸ—‘ï¸ Removing duplicate custom dropdown for: ${dropdownId}`);
                    customDropdown.remove();
                } else {
                    seenDropdownIds.add(dropdownId);
                }
            });
            
            // Add enhanced dropdown styles
            const style = document.createElement('style');
            style.id = 'enhanced-dropdown-styles';
            style.textContent = `
                .custom-enhanced-dropdown {
                    position: relative !important;
                    width: 100%;
                    max-width: 100%;
                    min-width: 0;
                    z-index: 10; /* Ensure dropdowns appear above other content */
                }
                
                .custom-dropdown-display {
                    display: flex !important;
                    align-items: center !important;
                    justify-content: space-between !important;
                    padding: 8px 12px !important;
                    border: 1px solid var(--border-color) !important;
                    border-radius: 6px !important;
                    background-color: var(--surface-color) !important;
                    cursor: pointer !important;
                    font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                    font-size: 14px !important;
                    color: var(--text-secondary) !important;
                    transition: border-color 0.15s ease-in-out, background-color 0.15s ease-in-out !important;
                    height: 40px !important;
                    box-sizing: border-box !important;
                    width: 100% !important;
                    max-width: 100% !important;
                    min-width: 0 !important;
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                
                /* When an actual option is selected (not hint text) */
                .custom-dropdown-display.has-selection {
                    color: var(--text-color) !important;
                }
                
                /* Ensure placeholder text stays muted */
                .custom-dropdown-display:not(.has-selection) .selected-text {
                    color: var(--text-muted) !important;
                }
                
                .custom-dropdown-display:hover {
                    border-color: var(--border-hover);
                    background-color: var(--interactive-hover);
                }
                
                .custom-enhanced-dropdown.open .custom-dropdown-display {
                    border-bottom-left-radius: 0 !important;
                    border-bottom-right-radius: 0 !important;
                    border-bottom-color: transparent !important;
                    box-shadow: 0 2px 4px var(--shadow-light) !important;
                }
                
                .custom-enhanced-dropdown.open .dropdown-arrow {
                    transform: rotate(180deg);
                }
                
                .selected-option {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    min-height: 20px;
                    flex: 1 1 0 !important;
                    overflow: hidden !important;
                    min-width: 0 !important;
                }
                
                .selected-text {
                    flex: 1 1 0 !important;
                    white-space: nowrap !important;
                    overflow: hidden !important;
                    text-overflow: ellipsis !important;
                    line-height: 1.4 !important;
                    min-width: 0 !important;
                    opacity: 1 !important; /* Prevent flickering */
                    visibility: visible !important; /* Prevent flickering */
                }
                
                .selected-icon, .option-icon {
                    width: 20px !important;
                    height: 20px !important;
                    display: flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                    flex-shrink: 0 !important;
                    font-size: 18px !important;
                }
                
                .selected-icon svg, .option-icon svg {
                    width: 100% !important;
                    height: 100% !important;
                    fill: currentColor !important;
                }
                
                .option-text {
                    flex: 1 !important;
                    color: inherit !important;
                    font-size: inherit !important;
                    font-family: inherit !important;
                    white-space: nowrap !important;
                    overflow: hidden !important;
                    text-overflow: ellipsis !important;
                    line-height: 1.4 !important;
                }
                
                .dropdown-arrow {
                    fill: var(--text-secondary);
                    transition: transform 0.15s ease;
                    flex-shrink: 0 !important;
                    width: 20px !important;
                    height: 20px !important;
                }
                
                .custom-dropdown-options {
                    position: absolute !important;
                    top: calc(100% - 1px) !important;
                    left: 0 !important;
                    right: 0 !important;
                    background-color: var(--surface-color) !important;
                    border: 1px solid var(--border-color) !important;
                    border-top: 1px solid var(--border-color) !important;
                    border-bottom-left-radius: 6px !important;
                    border-bottom-right-radius: 6px !important;
                    box-shadow: 0 4px 12px var(--shadow-medium) !important;
                    max-height: 180px !important; /* Shows approximately 5 items (36px each) */
                    overflow-y: auto !important;
                    z-index: 999999 !important;
                    display: none;
                    animation: slideDown 0.15s ease-out;
                    
                    /* Very faint scrollbar styling */
                    scrollbar-width: thin;
                    scrollbar-color: var(--text-muted) transparent;
                }
                
                /* Webkit scrollbar styling for Chromium browsers */
                .custom-dropdown-options::-webkit-scrollbar {
                    width: 6px;
                }
                
                .custom-dropdown-options::-webkit-scrollbar-track {
                    background: transparent;
                }
                
                .custom-dropdown-options::-webkit-scrollbar-thumb {
                    background-color: var(--text-muted);
                    border-radius: 3px;
                    border: none;
                }
                
                .custom-dropdown-options::-webkit-scrollbar-thumb:hover {
                    background-color: var(--text-secondary);
                }
                
                /* Dark theme scrollbar */
                [data-theme="dark"] .custom-dropdown-options {
                    scrollbar-color: var(--text-muted) transparent !important;
                }
                
                [data-theme="dark"] .custom-dropdown-options::-webkit-scrollbar-thumb {
                    background-color: var(--text-muted) !important;
                }
                
                [data-theme="dark"] .custom-dropdown-options::-webkit-scrollbar-thumb:hover {
                    background-color: var(--text-secondary) !important;
                }
                
                @keyframes slideDown {
                    from {
                        opacity: 0;
                        transform: translateY(-4px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                
                .custom-enhanced-dropdown.open .custom-dropdown-options {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    border-top: 1px solid var(--border-color) !important;
                }
                
                .custom-option {
                    display: flex !important;
                    align-items: center !important;
                    gap: 8px !important;
                    padding: 8px 12px !important;
                    cursor: pointer !important;
                    font-family: 'Unica77LL', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
                    font-size: 14px !important;
                    color: var(--text-color) !important;
                    transition: background-color 0.15s ease !important;
                    min-height: 20px !important;
                    background-color: var(--surface-color) !important;
                    border: none !important;
                    margin: 0 !important;
                    line-height: 1.4 !important;
                }
                
                .custom-option:hover {
                    background-color: var(--interactive-hover) !important;
                }
                
                .custom-option.active {
                    background-color: var(--surface-secondary) !important;
                    color: var(--text-color) !important;
                }
                
                /* Dark theme styles */
                [data-theme="dark"] .custom-dropdown-display {
                    background-color: var(--surface-color) !important;
                    border-color: var(--border-color) !important;
                    color: var(--text-secondary) !important;
                }
                
                [data-theme="dark"] .custom-dropdown-display.has-selection {
                    color: var(--text-color) !important;
                }
                
                [data-theme="dark"] .custom-dropdown-display:not(.has-selection) .selected-text {
                    color: var(--text-muted) !important;
                }
                
                [data-theme="dark"] .custom-dropdown-display:hover {
                    border-color: var(--border-hover) !important;
                    background-color: var(--interactive-hover) !important;
                }
                
                [data-theme="dark"] .custom-dropdown-options {
                    background-color: var(--surface-color) !important;
                    border-color: var(--border-color) !important;
                }
                
                [data-theme="dark"] .custom-enhanced-dropdown.open .custom-dropdown-options {
                    border-top: 1px solid var(--border-color) !important;
                }
                
                [data-theme="dark"] .custom-option {
                    color: var(--text-color);
                    background-color: var(--surface-color) !important;
                }
                
                [data-theme="dark"] .custom-option:hover {
                    background-color: var(--interactive-hover) !important;
                }
                
                [data-theme="dark"] .custom-option.active {
                    background-color: var(--surface-secondary) !important;
                }
            `;
            document.head.appendChild(style);
            console.log('ðŸŽ¨ Enhanced dropdown styles added to head');
            
            // Verify styles are applied
            setTimeout(() => {
                const testDropdown = document.querySelector('.custom-enhanced-dropdown');
                if (testDropdown) {
                    console.log('ðŸ” Test dropdown position:', getComputedStyle(testDropdown).position);
                }
            }, 100);
        }

        // Remove test dropdown if it exists
        function removeTestDropdown() {
            const testDropdown = document.querySelector('.test-dropdown');
            if (testDropdown) {
                testDropdown.remove();
                console.log('ðŸ—‘ï¸ Removed test dropdown');
            }
        }
        
        // Function to update annotation color based on severity
        function updateAnnotationColor(severity) {
            const annotationCircle = document.getElementById('annotation-circle');
            if (!annotationCircle) return;
            
            // Remove all severity classes
            annotationCircle.classList.remove('severity-low', 'severity-medium', 'severity-high');
            
            // Add the appropriate severity class
            if (severity === 'low') {
                annotationCircle.classList.add('severity-low');
                console.log('ðŸŸ¨ Annotation color changed to amber/gold (low severity)');
            } else if (severity === 'medium') {
                annotationCircle.classList.add('severity-medium');
                console.log('ðŸŸ  Annotation color changed to orange (medium severity)');
            } else if (severity === 'high') {
                annotationCircle.classList.add('severity-high');
                console.log('ðŸ”´ Annotation color changed to red (high severity)');
            } else {
                console.log('âš« Annotation color reset to default (no severity selected)');
            }

    // Also mirror this severity onto all generated annotations in the compare canvas
    const triageAnnotations = document.querySelectorAll('.triage-annotation');
    triageAnnotations.forEach(el => {
        el.classList.remove('severity-low', 'severity-medium', 'severity-high');
        if (severity === 'low') el.classList.add('severity-low');
        else if (severity === 'medium') el.classList.add('severity-medium');
        else if (severity === 'high') el.classList.add('severity-high');
    });
        }

        // Initialize custom dropdown icons after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                removeTestDropdown();
                setTimeout(initializeDropdownIcons, 500);
                initializeDescriptionResize();
            });
        } else {
            // DOM is already ready
            removeTestDropdown();
            setTimeout(initializeDropdownIcons, 500);
            initializeDescriptionResize();
        }
        
        // Initialize description field auto-resize
        function initializeDescriptionResize() {
            const descriptionField = document.getElementById('defect-description');
            if (!descriptionField) return;
            
            // Set initial height - disabled for fixed 32px height
            // setTimeout(() => {
            //     resizeDescriptionField();
            // }, 100);
            
            // Auto-resize disabled - keeping fixed 32px height
            // descriptionField.addEventListener('input', () => {
            //     resizeDescriptionField();
            // });
            
            // descriptionField.addEventListener('paste', () => {
            //     setTimeout(() => {
            //         resizeDescriptionField();
            //     }, 10);
            // });
            
            // Initial resize after content loads - disabled for fixed 32px height
            // window.addEventListener('load', () => {
            //     setTimeout(() => {
            //         resizeDescriptionField();
            //     }, 200);
            // });
            
            console.log('ðŸ“ Description field fixed at 32px height (auto-resize disabled)');
        }

        // Wait for DOM to be fully loaded, then update icons
        console.log('ðŸš€ Initializing custom defect icons...');
        
        // Add a small delay to ensure DOM is ready
        setTimeout(() => {
            console.log('â° Running updateDefectIcons after timeout...');
            updateDefectIcons({
              'missing-component': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M80.2105 27.0495V24.1021H73.3339L73.3358 27.0495H80.2105ZM85 21V79.4279H15V21H85ZM18.6842 75.7437H81.3158V30.5237H18.6842V75.7437Z" fill="currentColor"/>
<path d="M70.9184 69.8817L61.7974 60.648C63.9436 57.9232 65.2346 54.4928 65.2351 50.7543C65.2339 41.9081 58.0654 34.7396 49.2191 34.7383C40.373 34.7396 33.2045 41.9081 33.2031 50.7543C33.2044 59.6005 40.373 66.769 49.2191 66.7703C52.8869 66.7698 56.2556 65.5238 58.9553 63.4503L68.0789 72.6866L70.9184 69.8817ZM49.2191 62.779C45.8923 62.7781 42.8987 61.4363 40.7163 59.2571C38.5372 57.0747 37.1954 54.0812 37.1944 50.7543C37.1954 47.4274 38.5372 44.4339 40.7163 42.2515C42.8987 40.0723 45.8923 38.7305 49.2191 38.7296C52.546 38.7305 55.5396 40.0723 57.7219 42.2515C59.9011 44.4339 61.2429 47.4274 61.2439 50.7543C61.2429 54.0812 59.9011 57.0747 57.7219 59.2571C55.5396 61.4363 52.546 62.7781 49.2191 62.779Z" fill="currentColor"/>
<path d="M49.5073 49.4449C48.555 50.3768 47.5009 51.3705 47.5009 52.9513V53.5594H50.2159V53.0505C50.338 51.9563 51.3896 51.1453 52.3438 50.2133C53.2153 49.3635 54.006 48.4322 54.006 47.0327C54.006 44.8845 52.4863 43.3851 49.5066 43.3851C46.6288 43.3851 44.6218 45.0467 44.5009 47.8641H47.319C47.4602 46.567 48.2102 45.777 49.3247 45.777C49.5314 45.7461 49.7425 45.763 49.9417 45.8265C50.1409 45.89 50.3229 45.9983 50.4736 46.1431C50.6244 46.2879 50.74 46.4653 50.8114 46.6618C50.8828 46.8583 50.9083 47.0685 50.8858 47.2763C50.8858 48.0874 50.2369 48.7356 49.5073 49.4449Z" fill="currentColor"/>
<path d="M50.3788 55.0969H47.2776V58.0766H50.3788V55.0969Z" fill="currentColor"/>
</svg>`,
              'broken-code': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M71.7641 48.6471C75.0467 48.6539 78.2305 47.5236 80.774 45.4485C83.3176 43.3734 85.0641 40.4814 85.7165 37.2642C86.369 34.047 85.8872 30.7032 84.353 27.801C82.8188 24.8989 80.3269 22.6177 77.301 21.3451C76.4824 21.044 75.6315 20.8392 74.7656 20.7349C74.7656 21.2813 74.7838 32.5919 74.7838 32.5919L71.815 34.3677L68.7679 32.4808C68.7679 32.4808 68.7279 21.4434 68.7279 20.7604C67.8606 20.8363 67.0089 21.0381 66.1998 21.3596C62.8668 22.7697 60.2002 25.4025 58.7478 28.7172C57.2953 32.032 57.1673 35.7771 58.3899 39.1833L52.3794 45.181L42.1471 35.4022C42.0707 35.132 41.9286 34.8849 41.7337 34.6828C41.3153 33.871 41.1265 32.9605 41.1875 32.0493C41.2485 31.1381 41.557 30.2608 42.0797 29.512C44.0431 27.3519 46.4874 26.78 49.795 26.5578L50.2958 20.6602C43.4202 17.1651 37.0874 20.0811 34.3863 21.3287L33.9219 21.5418C32.7442 22.2581 31.6248 23.0663 30.5743 23.9587L24.715 28.9055C23.7132 29.7435 22.9845 30.8616 22.6223 32.1165L21.9702 34.1601L20.8774 33.1092L14 39.9082L25.3197 50.7635L26.5454 49.5523L30.8821 45.2794L32.1934 43.9644L30.8985 42.7222C30.8839 42.7077 30.8784 42.6858 30.862 42.6694L30.7837 42.5984C31.8603 42.4531 32.9533 42.4832 34.0203 42.6876L44.2799 53.2514L28.2229 69.2647C27.061 70.4663 26.4174 72.0762 26.4309 73.7476C26.4444 75.4191 27.1139 77.0184 28.2951 78.201C29.4763 79.3837 31.0748 80.0551 32.7462 80.0706C34.4176 80.0861 36.0283 79.4445 37.2313 78.284L53.1517 62.4074L70.3252 79.9743L73.5417 80.0271L79.2152 74.3281L79.2061 71.0242L61.59 53.9927L67.5822 48.0169C68.9367 48.4356 70.3464 48.648 71.7641 48.6471V48.6471ZM26.9589 44.0045L25.2741 45.671L19.2273 39.87L20.912 38.2035L26.9589 44.0045ZM27.8605 39.8044L24.8917 36.9558L26.0992 33.1674C26.2614 32.5888 26.5947 32.0726 27.0554 31.6867L32.9092 26.7399C33.4556 26.2718 35.0439 25.0515 35.3954 24.8639L35.8981 24.6344C39.2484 22.7604 43.1906 22.2453 46.9099 23.1956C44.0165 23.5439 41.3426 24.9138 39.3696 27.0586C38.4229 28.2389 37.8076 29.6498 37.5867 31.1466C37.3659 32.6433 37.5475 34.1719 38.1128 35.5753L34.4264 39.0577C32.2175 38.592 29.9172 38.854 27.8696 39.8044H27.8605ZM37.5482 41.1049L40.2092 38.6023L49.795 47.7546L46.8608 50.6797L37.5482 41.1049ZM66.7153 43.7221L64.0634 46.3667L58.9436 51.4665L56.3646 54.0401L53.1863 57.2256L50.6073 59.7992L34.6523 75.7123C34.1318 76.2095 33.4396 76.487 32.7198 76.487C32 76.487 31.3079 76.2095 30.7874 75.7123C30.2757 75.2 29.9884 74.5057 29.9884 73.7817C29.9884 73.0577 30.2757 72.3633 30.7874 71.851L46.8116 55.8705L49.3906 53.297L52.4268 50.2699L55.0076 47.6963L60.1402 42.5765L62.7721 39.952C62.6792 39.8008 62.5808 39.6533 62.4952 39.4966C61.3107 37.3288 60.9233 34.8145 61.4005 32.3907C61.8777 29.9669 63.1892 27.787 65.107 26.2299L65.1325 34.5098L71.7859 38.6297L78.432 34.6537L78.4193 26.2154C80.4225 27.8206 81.7727 30.1003 82.2175 32.6285C82.6623 35.1567 82.1713 37.7604 80.8363 39.9529C79.5012 42.1455 77.4135 43.7769 74.9632 44.5423C72.5129 45.3077 69.8678 45.1547 67.5221 44.1119C67.2526 43.9881 66.9848 43.8624 66.7262 43.7221H66.7153Z" fill="currentColor"/>
</svg>`,
              'content-misalignment': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M46.577 17.3599H53.4376L52.5204 33.6633H47.4884L46.577 17.3599ZM46.9509 35.9378H53.0306V41.6475H46.9509V35.9378ZM22.0908 7.64062V81.6406L33.5803 73.7168L41.7592 79.8938L50.092 73.6623L57.2389 79.296L65.708 73.6175L77.9082 81.5121V7.64062H22.0908ZM74.0252 74.3633L65.6827 68.9633L57.4356 74.4938L50.166 68.7627L41.7807 75.0332L33.6874 68.9243L32.5307 69.7227L25.9856 74.2348V11.5354H74.0252V74.3633ZM67.5697 56.3229H32.4411V60.2176H67.5697V56.3229ZM67.5697 47.365H32.4411V51.2597H67.5697V47.365Z" fill="currentColor"/>
</svg>`,
              'screen-reader': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M80.2105 27.0495V24.1021H73.3339L73.3358 27.0495H80.2105ZM85 21V79.4279H15V21H85ZM18.6842 75.7437H81.3158V30.5237H18.6842V75.7437Z" fill="currentColor"/>
<path d="M37.252 48.1765L53.5454 40.3828V64.9322L37.252 57.1648V52.5501V48.1765Z" stroke="currentColor" stroke-width="4"/>
<path d="M58.9888 51.2089H69.346V55.3501H58.9888V51.2089Z" fill="currentColor"/>
<path d="M58.7376 44.9719L67.2217 39.0312L69.5969 42.4235L61.1128 48.3641L58.7376 44.9719Z" fill="currentColor"/>
<path d="M61.1126 58.1952L69.5967 64.1358L67.2214 67.5281L58.7373 61.5875L61.1126 58.1952Z" fill="currentColor"/>
<path d="M30.4033 52.5533V48.1797H37.2516V57.1679H30.4033V52.5533Z" stroke="currentColor" stroke-width="4"/>
<path d="M53.543 36.125L53.543 70.435" stroke="currentColor" stroke-width="4"/>
</svg>`,
             'layout-alignment': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M56.4644 70.3112H55.5144C53.0627 70.1362 50.6094 70.6301 48.4165 71.7403C48.0357 71.9774 47.5963 72.1037 47.1477 72.1049C47.0273 72.099 46.9075 72.0837 46.7894 72.0591C46.51 72.1194 46.2212 72.1221 45.9407 72.067C45.6602 72.0118 45.3939 71.8999 45.1581 71.7382C42.9647 70.6294 40.512 70.1348 38.0602 70.307H13.1436V18.0153H38.0623C41.1106 17.8834 44.1352 18.6049 46.7956 20.0987C49.478 18.619 52.5253 17.9312 55.5831 18.1153L80.4331 18.0216V50.5945C79.1313 49.822 77.7292 49.2324 76.2665 48.8424V22.2028L55.5227 22.2799C55.3831 22.2799 55.2352 22.2799 55.0811 22.2799C52.9983 22.1436 50.9187 22.5894 49.0748 23.5674C48.9436 23.6924 48.9436 23.7466 48.9436 23.8132V67.007C51.0803 66.3986 53.2951 66.1087 55.5165 66.1466H55.5706C55.6837 67.5675 55.982 68.9676 56.4581 70.3112H56.4644ZM44.6436 23.8112C44.6436 23.7466 44.6436 23.682 44.5061 23.5487C42.5455 22.5024 40.3288 22.0322 38.1123 22.1924H17.3206L17.3102 66.1507H38.0623C40.2839 66.1144 42.4986 66.4057 44.6352 67.0153L44.6436 23.8112ZM87.1644 82.8903L79.1665 74.8799C76.6331 76.678 73.5169 77.4594 70.4349 77.0692C67.3528 76.679 64.5297 75.1458 62.5243 72.7731C60.519 70.4004 59.4776 67.3612 59.6065 64.2572C59.7354 61.1532 61.0252 58.2108 63.2203 56.0126C65.4155 53.8143 68.3561 52.5204 71.4599 52.3871C74.5636 52.2538 77.6043 53.2908 79.9799 55.2928C82.3554 57.2948 83.8926 60.1158 84.2872 63.1973C84.6817 66.2788 83.9048 69.3961 82.1102 71.932L90.1081 79.9487L87.1644 82.8903ZM80.2269 64.807C80.2273 63.1854 79.7468 61.6001 78.8462 60.2517C77.9455 58.9032 76.6652 57.8522 75.1671 57.2314C73.6691 56.6107 72.0206 56.4482 70.4301 56.7644C68.8397 57.0807 67.3788 57.8615 66.2322 59.0081C65.0855 60.1547 64.3047 61.6157 63.9885 63.2061C63.6722 64.7965 63.8347 66.445 64.4555 67.9431C65.0762 69.4411 66.1273 70.7215 67.4757 71.6221C68.8242 72.5227 70.4095 73.0032 72.0311 73.0028C74.205 73.0001 76.2889 72.1348 77.8255 70.5971C79.3621 69.0593 80.2258 66.9746 80.2269 64.8007V64.807Z" fill="currentColor"/>
<path d="M21.4811 29.6349H40.523V33.807H21.4811V29.6349Z" fill="currentColor"/>
<path d="M21.4811 38.3547H32.0235V42.5269H21.4811V38.3547Z" fill="currentColor"/>
<path d="M40.523 59.9666H29.9806V55.7944H40.523V59.9666Z" fill="currentColor"/>
<path d="M34.8994 38.3547H40.523V42.5269H34.8994V38.3547Z" fill="currentColor"/>
<path d="M27.1047 59.9666H21.4811L21.4811 55.7944H27.1047V59.9666Z" fill="currentColor"/>
<path d="M21.4811 47.0746H40.523V51.2467H21.4811V47.0746Z" fill="currentColor"/>
</svg>`,
             'design-system': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M55.7206 42.1998C55.7164 34.4611 49.4619 28.1857 41.7259 28.1502V28.1485L41.6842 28.1481L41.663 28.148C33.9186 28.1494 27.638 34.4102 27.6079 42.1529H27.6065L27.6062 42.185L27.6061 42.2055C27.6075 49.9608 33.8858 56.2502 41.6436 56.2625H41.6816L41.7167 56.2614V56.2597C49.4474 56.2295 55.7082 49.965 55.7207 42.2252V42.2049L55.7206 42.1998ZM41.6638 52.4082L41.6494 52.4085C36.1926 52.4021 31.7714 47.973 31.7728 42.518V42.5037C31.7791 37.0468 36.2081 32.6257 41.663 32.6271H41.6774C47.1343 32.6335 51.5553 37.0623 51.554 42.5173V42.5317C51.5477 47.9886 47.1187 52.4096 41.6638 52.4082ZM87.2145 79.437L89.5167 72.4247L85.6362 69.672C85.6484 68.7078 85.566 67.7544 85.4137 66.8167L88.931 63.6408L85.6005 57.0544L80.8984 57.8539C80.2356 57.1739 79.5162 56.5431 78.7343 55.9793L78.9752 51.2573L71.9629 48.9551L69.2103 52.8356C68.246 52.8235 67.2924 52.9058 66.3549 53.058L63.179 49.5407L56.5927 52.8713L57.3922 57.5734C56.7122 58.2362 56.0813 58.9557 55.5177 59.7375L50.7954 59.4966L48.4933 66.5088L52.3737 69.2616C52.3616 70.2259 52.444 71.1793 52.5963 72.117L49.0788 75.2928L52.4095 81.8792L57.1116 81.0797C57.7743 81.7597 58.4938 82.3905 59.2756 82.9542L59.0348 87.6763L66.0471 89.9785L68.7997 86.0981C69.7641 86.1104 70.7175 86.0277 71.6551 85.8755L74.831 89.3929L81.4173 86.0624L80.618 81.3603C81.298 80.6975 81.9286 79.978 82.4924 79.1961L87.2145 79.437ZM66.9789 76.2729C63.22 75.0388 61.1732 70.9912 62.4073 67.2324C63.6413 63.4735 67.6889 61.4267 71.4478 62.6608C75.2067 63.8948 77.2534 67.9424 76.0194 71.7013C74.7853 75.4602 70.7377 77.5069 66.9789 76.2729ZM46.0614 73.4012L34.6187 73.3921L32.7167 66.3795C32.0398 66.1268 31.3791 65.8496 30.7344 65.5452L24.2718 68.9444L14.6298 59.2753L18.2465 52.9675C17.9461 52.322 17.673 51.6589 17.4238 50.9789L10.458 48.8148L10.4775 35.1601L17.4891 33.2585C17.7418 32.5817 18.0189 31.921 18.3234 31.2763L14.9243 24.8135L24.5932 15.1718L30.9012 18.7882C31.5469 18.4879 32.2099 18.2149 32.8898 17.9658L35.0535 11L48.7085 11.0192L50.61 18.0309C51.2869 18.2835 51.9477 18.5607 52.5923 18.8653L59.0549 15.4659L68.6967 25.1351L65.0803 31.4431C65.3806 32.0889 65.6537 32.7517 65.9028 33.4316L72.8682 35.5954L72.8554 46.1688L68.6904 44.8399L68.6979 38.6629L62.6405 36.7811L62.3142 35.7381C61.9443 34.5553 61.459 33.4106 60.8851 32.2995L60.3644 31.2915L63.4991 25.8237L58.2746 20.5842L52.6461 23.5448L51.6774 23.0376C50.5746 22.46 49.4311 21.972 48.2461 21.594L47.1655 21.2491L45.52 15.1813L38.121 15.1709L36.2396 21.2278L35.1964 21.5542C34.0134 21.9244 32.8683 22.4097 31.7577 22.9835L30.7496 23.5043L25.2818 20.3695L20.0425 25.5939L23.0031 31.2225L22.4958 32.1912C21.9184 33.294 21.4303 34.4377 21.0522 35.6224L20.7074 36.7029L14.6395 38.3486L14.6291 45.7476L20.6857 47.6292L21.0123 48.6722C21.3825 49.8552 21.8678 51.0001 22.4418 52.1109L22.9625 53.119L19.8275 58.5869L25.0522 63.8261L30.6807 60.8656L31.6494 61.3729C32.752 61.9504 33.8958 62.4384 35.0806 62.8166L36.1609 63.1613L37.8065 69.228L46.7518 69.2352L48.949 70.794L46.8451 72.6938L46.0614 73.4012Z" fill="currentColor"/>
</svg>`,
             'font-style': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M26.3472 63.6359H15.7812L31.8807 17H44.5871L60.6638 63.6359H50.0978L38.4161 27.657H38.0517L26.3472 63.6359ZM25.6868 45.3049H50.6443V53.0017H25.6868V45.3049Z" fill="currentColor"/>
<path d="M62.5426 83.1023H55.7502L66.0999 53.122H74.2683L84.6033 83.1023H77.8109L70.3012 59.973H70.067L62.5426 83.1023ZM62.1181 71.3181H78.1622V76.266H62.1181V71.3181Z" fill="currentColor"/>
</svg>`,
             'colour': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<circle cx="50" cy="50" r="30" stroke="currentColor" stroke-width="4"/>
<path d="M48 79.9316C32.364 78.9024 20 65.8964 20 50C20 34.1036 32.364 21.0966 48 20.0674V79.9316Z" fill="currentColor" stroke="currentColor" stroke-width="4"/>
</svg>`,
             'spacing': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M22.5858 73.2267C23.3668 74.0078 24.6332 74.0078 25.4142 73.2267L38.1421 60.4988C38.9232 59.7177 38.9232 58.4514 38.1421 57.6704C37.3611 56.8893 36.0948 56.8893 35.3137 57.6704L24 68.9841L12.6863 57.6704C11.9052 56.8893 10.6389 56.8893 9.85786 57.6704C9.07682 58.4514 9.07682 59.7177 9.85786 60.4988L22.5858 73.2267ZM25.4142 27.5885C24.6332 26.8074 23.3668 26.8074 22.5858 27.5885L9.85787 40.3164C9.07682 41.0974 9.07682 42.3638 9.85787 43.1448C10.6389 43.9259 11.9052 43.9259 12.6863 43.1448L24 31.8311L35.3137 43.1448C36.0948 43.9259 37.3611 43.9259 38.1421 43.1448C38.9232 42.3638 38.9232 41.0974 38.1421 40.3164L25.4142 27.5885ZM24 71.8125L26 71.8125L26 29.0027L24 29.0027L22 29.0027L22 71.8125L24 71.8125Z" fill="currentColor"/>
<path d="M84.9863 29L45.4341 29" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
<path d="M84.9863 43.2695H45.4341" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
<path d="M84.9863 57.543H45.4341" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
<path d="M84.9863 71.8125H45.4341" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
</svg>`,
             'other': `<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_225_98261)">
<path d="M87.9157 48.5954C75.1174 35.7679 62.1378 31.3051 50.6854 31.3243C39.2324 31.3304 29.4119 35.6753 22.4569 39.9653C15.4982 44.2636 11.3695 48.5379 11.2862 48.6219L9.86523 50.0946L11.3123 51.5417C24.1106 64.3691 37.0902 68.8319 48.5426 68.8127C59.9957 68.8066 69.8161 64.4617 76.7711 60.1717C83.7298 55.8734 87.8585 51.5991 87.9418 51.5151L89.3628 50.0425L87.9157 48.5954ZM49.614 62.152C46.2707 62.151 43.2629 60.8027 41.0697 58.6128C38.8797 56.4195 37.5314 53.4119 37.5304 50.0685C37.5314 46.7251 38.8797 43.7175 41.0697 41.5241C43.2629 39.3342 46.2707 37.986 49.614 37.985C52.9574 37.986 55.9651 39.3342 58.1584 41.5241C60.3483 43.7175 61.6965 46.7251 61.6975 50.0685C61.6965 53.4119 60.3483 56.4195 58.1584 58.6128C55.9651 60.8027 52.9574 62.151 49.614 62.152ZM25.2658 43.1328C29.3933 40.6475 34.4923 38.2406 40.2372 36.8116C36.0835 39.755 33.3646 44.5894 33.3638 50.0685C33.3646 55.9673 36.517 61.115 41.2187 63.9623C33.2453 62.4954 24.6643 58.4369 15.8102 50.0818C17.5873 48.4872 20.8453 45.791 25.2658 43.1328V43.1328ZM73.9622 57.0042C69.8347 59.4894 64.7357 61.8964 58.9906 63.3254C63.1443 60.382 65.8633 55.5477 65.8642 50.0685C65.8633 44.1699 62.7111 39.0219 58.0096 36.1747C65.983 37.6417 74.5638 41.7002 83.4178 50.0552C81.6407 51.6497 78.3827 54.346 73.9622 57.0042V57.0042Z" fill="currentColor"/>
<line x1="58.3386" y1="39.7962" x2="40.1858" y2="60.9046" stroke="currentColor" stroke-width="4"/>
</g>
<defs>
<clipPath id="clip0_225_98261">
<rect width="100" height="100" fill="white"/>
</clipPath>
</defs>
</svg>`
        });
        }, 500); // Wait 500ms to ensure DOM is fully loaded
        
        console.log('ðŸŽ¯ Script setup complete, waiting for DOM...');
        
        // Preload and warm up confetti library on page load
        function preloadConfetti() {
            if (typeof confetti !== 'undefined') {
                console.log('ðŸŽ‰ Confetti library loaded, warming up...');
                // Trigger a tiny invisible confetti to initialize the library
                confetti({
                    particleCount: 1,
                    spread: 1,
                    origin: { x: -1, y: -1 }, // Off-screen
                    colors: ['transparent']
                });
            } else {
                console.log('â³ Waiting for confetti library to load...');
                setTimeout(preloadConfetti, 100);
            }
        }
        
        // Start preloading after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(preloadConfetti, 200); // Small delay to ensure script is loaded
        });

        // Celebratory Confetti Animation for Resolved Status
        function triggerConfettiAnimation() {
            // Check if confetti library is loaded, if not wait and retry
            if (typeof confetti === 'undefined') {
                console.log('â³ Confetti library not ready, retrying in 100ms...');
                setTimeout(triggerConfettiAnimation, 100);
                return;
            }
            
            const colors = ['#a2e633', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#06b6d4', '#f97316', '#a2e633', '#a855f7'];
            
            // Perfect single burst - clean and celebratory
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: colors
            });
        }

        // Status Selection Management - DEPRECATED
        // This function was causing cross-contamination between cards
        // Individual card status selection is now handled by selectStatusForCard()

        // Modal Link Management
        let selectedService = null;

        function openLinkModal() {
            const modal = document.getElementById('link-modal');
            modal.classList.add('active');
            
            // Prevent background scrolling
            document.body.classList.add('modal-open');
            
            // Reset form
            selectedService = null;
            document.querySelectorAll('.service-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.getElementById('modal-url-input').value = '';
            document.getElementById('modal-api-token-input').value = '';
            
            // Hide error banner if showing
            closeErrorBanner();
            
            // Add keyboard event listeners
            document.addEventListener('keydown', handleModalKeydown);
            
            // Add entrance animation
            gsap.fromTo(modal.querySelector('.modal-content'), 
                { scale: 0.95, opacity: 0, y: -20 },
                { scale: 1, opacity: 1, y: 0, duration: 0.3, ease: 'power3.out' }
            );
        }

        function closeLinkModal() {
            const modal = document.getElementById('link-modal');
            const modalContent = modal.querySelector('.modal-content');
            
            // Re-enable background scrolling
            document.body.classList.remove('modal-open');
            
            // Remove keyboard event listeners
            document.removeEventListener('keydown', handleModalKeydown);
            
            // Hide error banner
            closeErrorBanner();
            
            // Add exit animation
            gsap.to(modalContent, {
                scale: 0.95,
                opacity: 0,
                y: -20,
                duration: 0.2,
                ease: 'power2.in',
                onComplete: () => {
                    modal.classList.remove('active');
                }
            });
        }

        function handleModalKeydown(e) {
            if (e.key === 'Escape') {
                closeLinkModal();
            }
        }

        function syncModal() {
            // For now, show the same message as the header sync button
            alert('I\'m sorry this feature is not yet available. We\'re still building and scaling.');
        }

        let syncTimeouts = new Map(); // Track auto-reset timeouts for each card
        
        // Helper function to animate container height smoothly
        function animateContainerHeight() {
            const container = document.querySelector('.triage-component-container');
            if (!container) return;
            
            // Get current height
            const currentHeight = container.offsetHeight;
            
            // Temporarily set height to auto to measure natural height
            container.style.height = 'auto';
            const naturalHeight = container.offsetHeight;
            
            // Set back to current height immediately
            container.style.height = currentHeight + 'px';
            
            // Force reflow
            container.offsetHeight;
            
            // Animate to natural height with GSAP for smoother control
            gsap.to(container, {
                height: naturalHeight + 'px',
                duration: 0.5,
                ease: 'power2.out',
                onComplete: () => {
                    // Reset to auto after animation completes for future content changes
                    container.style.height = 'auto';
                }
            });
        }
        
        function syncAuthor() {
            const syncBtn = document.querySelector('.author-sync-btn');
            syncAuthorForCard(syncBtn);
        }
        
        function syncAuthorForCard(syncBtn) {
            const cardId = syncBtn.closest('.triage-card')?.querySelector('.annotation-circle')?.textContent || 'main';
            const isSelected = syncBtn.classList.contains('selected');
            
            if (!isSelected) {
                // Clear any existing timeout for this card
                if (syncTimeouts.has(cardId)) {
                    clearTimeout(syncTimeouts.get(cardId));
                }
                
                // Toggle to selected state with sliding animation
                syncBtn.classList.add('selected');
                console.log(`âœ… Author synced for card ${cardId}`);
                
                // Set 2-second auto-reset for this specific card
                const timeout = setTimeout(() => {
                    syncBtn.classList.remove('selected');
                    console.log(`ðŸ”„ Author sync auto-reset after 2 seconds for card ${cardId}`);
                    syncTimeouts.delete(cardId);
                }, 2000);
                
                syncTimeouts.set(cardId, timeout);
                
            } else {
                // Manual toggle back to default
                if (syncTimeouts.has(cardId)) {
                    clearTimeout(syncTimeouts.get(cardId));
                    syncTimeouts.delete(cardId);
                }
                syncBtn.classList.remove('selected');
                console.log(`ðŸ”„ Author sync manually removed for card ${cardId}`);
            }
        }

        function showErrorBanner() {
            const errorBanner = document.getElementById('modal-error-banner');
            errorBanner.classList.add('active');
        }

        function closeErrorBanner() {
            const errorBanner = document.getElementById('modal-error-banner');
            errorBanner.classList.remove('active');
        }

        function selectService(service) {
            selectedService = service;
            
            // Hide error banner when user makes a selection
            closeErrorBanner();
            
            // Update UI
            document.querySelectorAll('.service-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`[data-service="${service}"]`).classList.add('selected');
            
            // Selection animation removed to prevent flickering
        }

        function saveLinkFromModal() {
            if (!selectedService) {
                showErrorBanner();
                return;
            }
            
            const url = document.getElementById('modal-url-input').value.trim();
            
            // Allow free form entry - no validation
            let validatedUrl = url;
            
            // Service configurations
            const serviceConfig = {
                jira: {
                    name: 'Jira',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Jira.png" width="20" height="20" alt="Jira">`,
                    defaultUrl: 'https://www.atlassian.com/software/jira?referer=jira.com'
                },
                confluence: {
                    name: 'Confluence',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Confluence.png" width="20" height="20" alt="Confluence">`,
                    defaultUrl: 'https://confluence.atlassian.com'
                },
                notion: {
                    name: 'Notion',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Notion.png" width="20" height="20" alt="Notion">`,
                    defaultUrl: 'https://notion.so'
                },
                figma: {
                    name: 'Figma',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Figma.png" width="20" height="20" alt="Figma">`,
                    defaultUrl: 'https://figma.com'
                },
                googledocs: {
                    name: 'Google Sheets',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Google-Sheets.png" width="20" height="20" alt="Google Sheets">`,
                    defaultUrl: 'https://docs.google.com'
                },
                zip: {
                    name: 'Zip',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/zip.png" width="27" height="20" alt="Zip">`,
                    defaultUrl: 'https://zip.co'
                }
            };
            
            const config = serviceConfig[selectedService];
            const finalUrl = validatedUrl || config.defaultUrl;
            
            // Add link to triage component (append, don't replace)
            const linksContainer = document.getElementById('links-container');
            
            // Remove the placeholder if it exists
            const placeholder = linksContainer.querySelector('.link-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            // Create new link element
            const linkElement = document.createElement('div');
            linkElement.className = 'link-item';
            linkElement.innerHTML = `
                <a href="${finalUrl}" target="_blank" class="simple-link service-link" title="${finalUrl}">
                    <span class="service-link-icon">${config.icon}</span>
                    <span>${config.name}</span>
                </a>
                <button class="remove-link-btn" onclick="removeLink(this)" title="Remove link">âœ•</button>
            `;
            
            // Append to container
            linksContainer.appendChild(linkElement);
            
            // Add success animation to the new link
            gsap.fromTo(linkElement, 
                { scale: 0.9, opacity: 0 },
                { scale: 1, opacity: 1, duration: 0.3, ease: 'power2.out',
                  onComplete: () => {
                      // Trigger description field resize after animation - disabled for fixed height
                      // resizeDescriptionField();
                  }
                }
            );
            
            closeLinkModal();
        }

        function removeLink(button) {
            const linkItem = button.closest('.link-item');
            const linksContainer = linkItem.closest('.links-container');
            
            // Add fade out animation
            gsap.to(linkItem, {
                opacity: 0,
                x: -20,
                duration: 0.3,
                ease: 'power2.out',
                onComplete: () => {
                    linkItem.remove();
                    
                    // If no more links, show placeholder
                    const remainingLinks = linksContainer.querySelectorAll('.link-item:not(.link-placeholder)');
                    if (remainingLinks.length === 0) {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'link-item link-placeholder';
                        // Determine card ID from container
                        const cardId = linksContainer.id === 'links-container' ? 1 : parseInt(linksContainer.id.split('-')[2]);
                        placeholder.onclick = () => openLinkModalForCard(cardId);
                        placeholder.innerHTML = `
                            <button class="add-link-btn-full" title="Add link">
                                <span class="add-icon">+</span>
                            </button>
                        `;
                        linksContainer.appendChild(placeholder);
                        
                        // Animate in the placeholder
                        gsap.fromTo(placeholder, 
                            { scale: 0.9, opacity: 0 },
                            { scale: 1, opacity: 1, duration: 0.3, ease: 'power2.out',
                              onComplete: () => {
                                  // Trigger description field resize after placeholder animation - disabled for fixed height
                                  // resizeDescriptionField();
                              }
                            }
                        );
                    } else {
                        // Trigger description field resize immediately if no placeholder animation - disabled for fixed height
                        // resizeDescriptionField();
                    }
                }
            });
        }

        function resetLinkPlaceholder() {
            const linksContainer = document.getElementById('links-container');
            
            // Add fade out animation
            gsap.to(linksContainer.firstElementChild, {
                opacity: 0,
                x: -20,
                duration: 0.3,
                ease: 'power2.out',
                onComplete: () => {
                    linksContainer.innerHTML = `
                        <div class="link-item link-placeholder" onclick="openLinkModalForCard(1)">
                            <button class="add-link-btn-full" title="Add link">
                                <span class="add-icon">+</span>
                            </button>
                        </div>
                    `;
                    
                    // Add fade in animation
                    gsap.fromTo(linksContainer.firstElementChild, 
                        { opacity: 0, x: 20 },
                        { opacity: 1, x: 0, duration: 0.3, ease: 'power2.out',
                          onComplete: () => {
                              // Trigger description field resize after reset animation - disabled for fixed height
                              // resizeDescriptionField();
                          }
                        }
                    );
                }
            });
        }

        // Smart close behavior: Reset if only one card, Remove if multiple cards
        function smartCloseTriageCard(button) {
            const allTriageCards = document.querySelectorAll('.triage-card');
            
            if (allTriageCards.length === 1) {
                // Only one card: Reset the component
                console.log('ðŸ”„ Only one card - resetting component');
                button.title = "Reset triage component";
                closeTriageComponent();
            } else {
                // Multiple cards: Remove this specific card
                console.log(`ðŸ—‘ï¸ Multiple cards (${allTriageCards.length}) - removing this card`);
                button.title = "Remove this triage card";
                removeTriageCard(button);
            }
        }

        // Close/Reset Triage Component
        function closeTriageComponent() {
            // Get the first triage card only (not affecting other cards)
            const firstTriageCard = document.querySelector('.triage-card');
            
            // Get all form elements - only from the first card
            const severitySelect = firstTriageCard.querySelector('#severity-select');
            const defectTypeSelect = firstTriageCard.querySelector('#defect-type-select');
            const statusButtons = firstTriageCard.querySelectorAll('.status-btn');
            const descriptionField = firstTriageCard.querySelector('#defect-description');
            const annotationCircle = firstTriageCard.querySelector('#annotation-circle');
            const linksContainer = firstTriageCard.querySelector('#links-container');
            
            // Reset all form fields immediately (no animations)
            if (severitySelect) severitySelect.value = '';
            if (defectTypeSelect) {
                defectTypeSelect.value = '';
                // Reset hint text styling
                const isDarkMode = document.body.getAttribute('data-theme') === 'dark';
                defectTypeSelect.style.color = isDarkMode ? 'hsl(215.4 16.3% 56.9%)' : 'hsl(215.4 16.3% 46.9%)';
                defectTypeSelect.style.textIndent = '0';
                defectTypeSelect.classList.add('hint-selected');
            }
            
            // Reset custom dropdown displays if they exist (only in first card)
            const customDropdowns = firstTriageCard.querySelectorAll('.custom-enhanced-dropdown');
            customDropdowns.forEach(customDropdown => {
                const dropdownId = customDropdown.getAttribute('data-dropdown-id');
                const originalSelect = document.getElementById(dropdownId);
                if (originalSelect) {
                    const defaultOption = originalSelect.querySelector('option[value=""]') || originalSelect.querySelector('option:first-child');
                    const defaultText = defaultOption ? defaultOption.textContent : 'Select option...';
                    
                    // Reset the custom display
                    const customDisplay = customDropdown.querySelector('.custom-dropdown-display');
                    if (customDisplay) {
                        const selectedText = customDisplay.querySelector('.selected-text');
                        if (selectedText) selectedText.textContent = defaultText;
                        
                        // Remove any selected icons
                        const selectedIcon = customDisplay.querySelector('.selected-icon');
                        if (selectedIcon) selectedIcon.remove();
                        
                        // Remove has-selection class
                        customDisplay.classList.remove('has-selection');
                        
                        // Reset active states in options
                        const options = customDropdown.querySelectorAll('.custom-option');
                        options.forEach(opt => opt.classList.remove('active'));
                    }
                }
            });
            
            // Reset status button to "Not Started" (pre-selected)
            statusButtons.forEach(btn => {
                btn.classList.remove('selected');
            });
            // Pre-select "Not Started" button (only in first card)
            const notStartedBtn = firstTriageCard.querySelector('.status-btn[data-status="not-started"]');
            if (notStartedBtn) {
                notStartedBtn.classList.add('selected');
            }
            // Update hidden input (only first card)
            const statusSelect = firstTriageCard.querySelector('#status-select');
            if (statusSelect) {
                statusSelect.value = 'not-started';
            }
            
            // Clear description
            if (descriptionField) descriptionField.value = '';
            
            // Reset annotation circle to default
            if (annotationCircle) {
                annotationCircle.textContent = '1';
                annotationCircle.className = 'annotation-circle';
            }
            
            // Reset links to default Zip + placeholder
            if (linksContainer) {
                linksContainer.innerHTML = `
                    <div class=\"link-item\">\n                        <a href=\"https://zip.co\" target=\"_blank\" class=\"simple-link service-link\" title=\"https://zip.co\">\n                            <span class=\"service-link-icon\"><img src=\"https://raw.githubusercontent.com/amachinic/Merem/main/zip.png\" width=\"27\" height=\"20\" alt=\"Zip\"></span>\n                            <span>Zip</span>\n                        </a>\n                        <button class=\"remove-link-btn\" onclick=\"removeLink(this)\" title=\"Remove link\">âœ•</button>\n                    </div>\n                    <div class=\"link-item link-placeholder\" onclick=\"openLinkModalForCard(1)\">\n                        <button class=\"add-link-btn-full\" title=\"Add link\">\n                            <span class=\"add-icon\">+</span>\n                        </button>\n                    </div>
                `;
            }
            
            // Renumber all cards to ensure proper sequence after reset
            renumberTriageCards();
            
            // Refresh dropdown icons
            if (typeof refreshDropdownIcons === 'function') {
                refreshDropdownIcons();
            }
            
            // Reset description field height - disabled for fixed 32px height
            // setTimeout(() => {
            //     resizeDescriptionField();
            // }, 100); // Small delay to ensure all reset operations complete
        }

        // Dynamic Description Field Resize Function
        function resizeDescriptionField() {
            const descriptionField = document.getElementById('defect-description');
            const linksContainer = document.getElementById('links-container');
            
            if (!descriptionField || !linksContainer) return;
            
            // Calculate total height of links container content
            const linkItems = linksContainer.querySelectorAll('.link-item:not(.link-placeholder)');
            const placeholderItem = linksContainer.querySelector('.link-placeholder');
            
            let totalLinksHeight = 0;
            
            // Add height of all actual link items
            linkItems.forEach(item => {
                const itemStyle = window.getComputedStyle(item);
                const itemHeight = item.offsetHeight + 
                    parseInt(itemStyle.marginTop) + 
                    parseInt(itemStyle.marginBottom);
                totalLinksHeight += itemHeight;
            });
            
            // Add gaps between items (8px each based on links-container gap)
            if (linkItems.length > 1) {
                totalLinksHeight += (linkItems.length - 1) * 8;
            }
            
            // Add placeholder height if it exists and no links are present
            if (placeholderItem && linkItems.length === 0) {
                const placeholderStyle = window.getComputedStyle(placeholderItem);
                totalLinksHeight = placeholderItem.offsetHeight + 
                    parseInt(placeholderStyle.marginTop) + 
                    parseInt(placeholderStyle.marginBottom);
            }
            
            // Calculate minimum height based on content
            const contentHeight = descriptionField.scrollHeight;
            const minHeight = 32; // Match your preferred compact height (32px)
            
            // Use the greater of: content height, links height, or minimum height
            const newHeight = Math.max(contentHeight, totalLinksHeight, minHeight);
            
            // Apply the new height
            descriptionField.style.height = newHeight + 'px';
            
            console.log(`ðŸ“ Description field resized: content=${contentHeight}px, links=${totalLinksHeight}px, final=${newHeight}px`);
        }

        // Global counter for unique triage card IDs
        let triageCardCounter = 1;



        // Remove individual triage card (or reset if it's the last one)
        function removeTriageCard(button) {
            const triageCard = button.closest('.triage-card');
            const allTriageCards = document.querySelectorAll('.triage-card');
            
            if (triageCard) {
                // If this is the last remaining card, reset it instead of removing
                if (allTriageCards.length === 1) {
                    console.log('ðŸ”„ Last card remaining - resetting instead of removing');
                    resetTriageCard(triageCard);
                } else {
                    // Multiple cards exist, proceed with removal
                    console.log(`ðŸ—‘ï¸ Removing card (${allTriageCards.length - 1} will remain)`);
                    
                    // Start fading out the card
                    gsap.to(triageCard, {
                        opacity: 0,
                        duration: 0.4,
                        ease: 'power2.out',
                        onComplete: () => {
                            triageCard.remove();
                            // Renumber all remaining cards after removal
                            renumberTriageCards();
                        }
                    });
                    
                    // Simultaneously animate container height to shrink as card disappears
                    setTimeout(() => {
                        // Small delay to ensure the fade has started
                        triageCard.style.display = 'none'; // Temporarily hide for height calculation
                        animateContainerHeight();
                        triageCard.style.display = ''; // Restore display for fade animation
                    }, 100);
                }
            }
        }

        // Reset a specific triage card to default state
        function resetTriageCard(triageCard) {
            // Get form elements from this specific card
            const statusButtons = triageCard.querySelectorAll('.status-btn');
            const hiddenInput = triageCard.querySelector('input[type="hidden"]');
            const descriptionField = triageCard.querySelector('textarea');
            const annotationCircle = triageCard.querySelector('.annotation-circle');
            const authorField = triageCard.querySelector('.author-input');
            const authorSyncBtn = triageCard.querySelector('.author-sync-btn');
            
            // Reset status to "Not Started"
            statusButtons.forEach(btn => btn.classList.remove('selected'));
            const notStartedBtn = triageCard.querySelector('.status-btn[data-status="not-started"]');
            if (notStartedBtn) {
                notStartedBtn.classList.add('selected');
            }
            if (hiddenInput) {
                hiddenInput.value = 'not-started';
            }
            
            // Clear description
            if (descriptionField) {
                descriptionField.value = '';
            }
            
            // Clear author field and reset sync button
            if (authorField) {
                authorField.value = '';
            }
            if (authorSyncBtn) {
                // Clear any active timeout for this card
                const cardId = annotationCircle?.textContent || 'main';
                if (syncTimeouts.has(cardId)) {
                    clearTimeout(syncTimeouts.get(cardId));
                    syncTimeouts.delete(cardId);
                }
                // Reset sync button to default state
                authorSyncBtn.classList.remove('selected');
            }
            
            // Reset annotation circle to default
            if (annotationCircle) {
                annotationCircle.className = 'annotation-circle';
            }
            
            // Reset dropdowns if they exist
            const customDropdowns = triageCard.querySelectorAll('.custom-enhanced-dropdown');
            customDropdowns.forEach(customDropdown => {
                const dropdownId = customDropdown.getAttribute('data-dropdown-id');
                const originalSelect = document.getElementById(dropdownId);
                if (originalSelect) {
                    originalSelect.value = '';
                    const defaultOption = originalSelect.querySelector('option[value=""]') || originalSelect.querySelector('option:first-child');
                    const defaultText = defaultOption ? defaultOption.textContent : 'Select option...';
                    
                    const customDisplay = customDropdown.querySelector('.custom-dropdown-display');
                    if (customDisplay) {
                        const selectedText = customDisplay.querySelector('.selected-text');
                        if (selectedText) selectedText.textContent = defaultText;
                        
                        const selectedIcon = customDisplay.querySelector('.selected-icon');
                        if (selectedIcon) selectedIcon.remove();
                        
                        customDisplay.classList.remove('has-selection');
                        
                        const options = customDropdown.querySelectorAll('.custom-option');
                        options.forEach(opt => opt.classList.remove('active'));
                    }
                }
            });
            
            // Reset links to placeholder
            const linksContainer = triageCard.querySelector('.links-container');
            if (linksContainer) {
                resetLinksForCard(triageCard, linksContainer);
            }
            
            console.log('âœ… Card reset to default state');
        }

        // Reset links for a specific card
        function resetLinksForCard(triageCard, linksContainer) {
            // Get the card ID from the links container ID or determine from context
            const containerId = linksContainer.id;
            let cardId = 1; // default for first card
            
            if (containerId && containerId.includes('-')) {
                const idParts = containerId.split('-');
                cardId = idParts[idParts.length - 1] || 1;
            }
            
            // Add fade out animation
            if (linksContainer.firstElementChild) {
                gsap.to(linksContainer.firstElementChild, {
                    opacity: 0,
                    x: -20,
                    duration: 0.3,
                    ease: 'power2.out',
                    onComplete: () => {
                        linksContainer.innerHTML = `
                            <div class="link-item link-placeholder" onclick="openLinkModalForCard(${cardId})">
                                <button class="add-link-btn-full" title="Add link">
                                    <span class="add-icon">+</span>
                                </button>
                            </div>
                        `;
                        
                        // Fade in the new placeholder
                        gsap.fromTo(linksContainer.firstElementChild, 
                            { opacity: 0, x: 20 },
                            { opacity: 1, x: 0, duration: 0.3, ease: 'power2.out' }
                        );
                    }
                });
            } else {
                // No existing content, just set the placeholder directly
                linksContainer.innerHTML = `
                    <div class="link-item link-placeholder" onclick="openLinkModalForCard(${cardId})">
                        <button class="add-link-btn-full" title="Add link">
                            <span class="add-icon">+</span>
                        </button>
                    </div>
                `;
            }
        }

        // Status selection for individual cards
        function selectStatusForCard(button, status) {
            const triageCard = button.closest('.triage-card');
            const statusButtons = triageCard.querySelectorAll('.status-btn');
            const hiddenInput = triageCard.querySelector('input[type="hidden"]');
            
            // Remove selected class from all buttons in this card
            statusButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Add selected class to clicked button
            button.classList.add('selected');
            
            // Update hidden input value
            if (hiddenInput) {
                hiddenInput.value = status;
            }
            
            console.log(`Status selected for card: ${status}`);
            
            // Trigger confetti animation for resolved status
            if (status === 'resolved') {
                triggerConfettiAnimation();
            }
        }

        // Status tooltip functionality
        function toggleStatusTooltip(button) {
            const tooltip = button.parentElement.querySelector('.status-tooltip');
            const isVisible = tooltip.style.display !== 'none';
            
            // Close all other status tooltips first
            document.querySelectorAll('.status-tooltip').forEach(t => {
                t.style.display = 'none';
            });
            
            // Toggle this tooltip
            if (!isVisible) {
                tooltip.style.display = 'block';
            }
        }

        function closeStatusTooltip(closeButton) {
            const tooltip = closeButton.closest('.status-tooltip');
            tooltip.style.display = 'none';
        }

        // Close status tooltip when clicking outside
        document.addEventListener('click', function(event) {
            const statusTooltips = document.querySelectorAll('.status-tooltip');
            const statusInfoBtns = document.querySelectorAll('.status-info-btn');
            
            let clickedStatusElement = false;
            
            // Check if clicked element is a status info button or tooltip
            statusInfoBtns.forEach(btn => {
                if (btn.contains(event.target)) {
                    clickedStatusElement = true;
                }
            });
            
            statusTooltips.forEach(tooltip => {
                if (tooltip.contains(event.target)) {
                    clickedStatusElement = true;
                }
            });
            
            // If clicked outside, close all tooltips
            if (!clickedStatusElement) {
                statusTooltips.forEach(tooltip => {
                    tooltip.style.display = 'none';
                });
            }
        });

        // Legacy function - now replaced with immediate initialization in addDefect()
        function initializeTriageCardEvents(triageCard, cardId) {
            // This function is no longer used - initialization now happens 
            // immediately in addDefect() before DOM insertion to prevent flickering
            console.log(`âš ï¸ Warning: Legacy initialization function called for card ${cardId}`);
        }



        // Initialize status buttons for a SPECIFIC card only (prevents cross-contamination)
        function initializeStatusButtonsForCard(card, cardId) {
            console.log(`ðŸŽ¯ Initializing status buttons for card ${cardId}...`);
            
            const statusButtons = card.querySelectorAll('.status-btn');
            const hiddenInput = card.querySelector('input[type="hidden"]');
            
            // Clear all selections in this card only
            statusButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Pre-select "Not Started" button
            const notStartedBtn = card.querySelector('.status-btn[data-status="not-started"]');
            if (notStartedBtn) {
                notStartedBtn.classList.add('selected');
                console.log(`âœ… Pre-selected "Not Started" for card ${cardId}`);
            }
            
            // Update hidden input value
            if (hiddenInput) {
                hiddenInput.value = 'not-started';
            }
        }
        
        // Dynamic annotation numbering system
        function renumberTriageCards() {
            console.log('ðŸ”„ Renumbering triage cards...');
            
            // Get all triage cards in order
            const triageCards = document.querySelectorAll('.triage-card');
            let newCardNumber = 1;
            
            triageCards.forEach((card, index) => {
                const annotationCircle = card.querySelector('.annotation-circle');
                if (annotationCircle) {
                    const oldNumber = annotationCircle.textContent;
                    annotationCircle.textContent = newCardNumber;
                    console.log(`ðŸ“ Card ${index + 1}: ${oldNumber} â†’ ${newCardNumber}`);
                    newCardNumber++;
                }
            });
            
            console.log(`âœ… Renumbered ${triageCards.length} triage cards`);
            
            // REMOVED: This was causing cross-contamination of status selections
            // initializeStatusButtons() was resetting ALL cards instead of just new ones
        }
        
        // Update triage card annotation color only (matching original card behavior)
        function updateTriageCardSeverity(triageCard, severity) {
            const annotationCircle = triageCard.querySelector('.annotation-circle');
            if (!annotationCircle) return;
            
            // Remove all severity classes from annotation circle
            annotationCircle.classList.remove('severity-low', 'severity-medium', 'severity-high');
            
            // Add the appropriate severity class to annotation circle only
            if (severity === 'low') {
                annotationCircle.classList.add('severity-low');
                console.log('ðŸŸ¨ New card annotation color changed to amber/gold (low severity)');
            } else if (severity === 'medium') {
                annotationCircle.classList.add('severity-medium');
                console.log('ðŸŸ  New card annotation color changed to orange (medium severity)');
            } else if (severity === 'high') {
                annotationCircle.classList.add('severity-high');
                console.log('ðŸ”´ New card annotation color changed to red (high severity)');
            } else {
                console.log('âš« New card annotation color reset to default (no severity selected)');
            }
        }

        // Update description placeholder for individual cards
        function updateDescriptionPlaceholder(descriptionField, defectType) {
            if (!descriptionField) return;
            
            switch (defectType) {
                case 'missing-component':
                    descriptionField.placeholder = 'Specify which component is missing and its expected location...';
                    break;
                case 'broken-code':
                    descriptionField.placeholder = 'Describe the code issue and its impact on functionality...';
                    break;
                case 'content-misalignment':
                    descriptionField.placeholder = 'Detail the content discrepancy between design and implementation...';
                    break;
                default:
                    descriptionField.placeholder = 'Please provide a brief but accurate description of the defect.';
            }
        }

        // Open link modal for specific triage card
        let currentCardId = 1; // Global variable to track which card's modal is open
        
        function openLinkModalForCard(cardId) {
            currentCardId = cardId;
            openLinkModal(); // Use existing modal functionality
        }
        
        // Override the saveLinkFromModal to handle specific cards
        const originalSaveLinkFromModal = saveLinkFromModal;
        saveLinkFromModal = function() {
            if (!selectedService) {
                showErrorBanner();
                return;
            }
            
            const url = document.getElementById('modal-url-input').value.trim();
            
            // Allow free form entry - no validation
            let validatedUrl = url;
            
            // Service configurations
            const serviceConfig = {
                jira: {
                    name: 'Jira',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Jira.png" width="20" height="20" alt="Jira">`,
                    defaultUrl: 'https://www.atlassian.com/software/jira?referer=jira.com'
                },
                confluence: {
                    name: 'Confluence',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Confluence.png" width="20" height="20" alt="Confluence">`,
                    defaultUrl: 'https://confluence.atlassian.com'
                },
                notion: {
                    name: 'Notion',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Notion.png" width="20" height="20" alt="Notion">`,
                    defaultUrl: 'https://notion.so'
                },
                figma: {
                    name: 'Figma',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Figma.png" width="20" height="20" alt="Figma">`,
                    defaultUrl: 'https://figma.com'
                },
                googledocs: {
                    name: 'Google Sheets',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/Google-Sheets.png" width="20" height="20" alt="Google Sheets">`,
                    defaultUrl: 'https://docs.google.com'
                },
                zip: {
                    name: 'Zip',
                    icon: `<img src="https://raw.githubusercontent.com/amachinic/Merem/main/zip.png" width="27" height="20" alt="Zip">`,
                    defaultUrl: 'https://zip.co'
                }
            };
            
            const config = serviceConfig[selectedService];
            const finalUrl = validatedUrl || config.defaultUrl;
            
            // Determine which links container to use based on currentCardId
            const linksContainerId = currentCardId === 1 ? 'links-container' : `links-container-${currentCardId}`;
            const linksContainer = document.getElementById(linksContainerId);
            
            if (!linksContainer) {
                console.error(`Links container not found for card ${currentCardId}`);
                return;
            }
            
            // Remove the placeholder if it exists
            const placeholder = linksContainer.querySelector('.link-placeholder');
            if (placeholder) {
                placeholder.remove();
            }
            
            // Create new link element
            const linkElement = document.createElement('div');
            linkElement.className = 'link-item';
            linkElement.innerHTML = `
                <a href="${finalUrl}" target="_blank" class="simple-link service-link" title="${finalUrl}">
                    <span class="service-link-icon">${config.icon}</span>
                    <span>${config.name}</span>
                </a>
                <button class="remove-link-btn" onclick="removeLink(this)" title="Remove link">âœ•</button>
            `;
            
            // Append to container
            linksContainer.appendChild(linkElement);
            
            // Add success animation to the new link
            gsap.fromTo(linkElement, 
                { scale: 0.9, opacity: 0 },
                { scale: 1, opacity: 1, duration: 0.3, ease: 'power2.out' }
            );
            
            closeLinkModal();
        }

        // Reset entire triage component
        function resetTriageComponent() {
            // Remove all additional triage cards
            const container = document.querySelector('.triage-component-container');
            const triageCards = container.querySelectorAll('.triage-card');
            
            // Remove all cards except the first one
            for (let i = 1; i < triageCards.length; i++) {
                triageCards[i].remove();
            }
            
            // Reset the first card
            const firstCard = triageCards[0];
            if (firstCard) {
                // Reset all form elements in the first card
                const selects = firstCard.querySelectorAll('select');
                const textareas = firstCard.querySelectorAll('textarea');
                const hiddenInputs = firstCard.querySelectorAll('input[type="hidden"]');
                const statusButtons = firstCard.querySelectorAll('.status-btn');
                
                selects.forEach(select => select.value = '');
                textareas.forEach(textarea => textarea.value = '');
                hiddenInputs.forEach(input => input.value = '');
                statusButtons.forEach(btn => btn.classList.remove('selected'));
                
                // Reset annotation circle severity styling
                const annotationCircle = firstCard.querySelector('.annotation-circle');
                if (annotationCircle) {
                    annotationCircle.classList.remove('severity-low', 'severity-medium', 'severity-high');
                }
                
                // Reset links container
                resetLinkPlaceholder();
            }
            
            // Reset counter
            triageCardCounter = 1;
            
            console.log('ðŸ”„ Triage component reset');
        }

        // Sprint Cycles Animations
        function initSprintAnimations() {
            // Animate sprint phases
            gsap.to('.sprint-phase', {
                scrollTrigger: {
                    trigger: '.sprint-phases',
                    start: 'top 80%',
                    end: 'bottom 20%',
                    toggleActions: 'play none none reverse'
                },
                opacity: 1,
                y: 0,
                duration: 0.8,
                stagger: 0.2,
                ease: 'power2.out'
            });

            // Animate team badges with sequential reveal
            gsap.to('.team-badge', {
                scrollTrigger: {
                    trigger: '.team-responsibilities',
                    start: 'top 80%',
                    end: 'bottom 20%',
                    toggleActions: 'play none none reverse'
                },
                opacity: 1,
                scale: 1,
                duration: 0.6,
                stagger: {
                    amount: 1.5,
                    from: 'start'
                },
                ease: 'back.out(1.7)'
            });

            // Animate workflow steps
            gsap.to('.workflow-step', {
                scrollTrigger: {
                    trigger: '.workflow-diagram',
                    start: 'top 80%',
                    end: 'bottom 20%',
                    toggleActions: 'play none none reverse'
                },
                opacity: 1,
                x: 0,
                duration: 0.8,
                stagger: 0.3,
                ease: 'power2.out'
            });

            // Animate decision diamond with special effect
            gsap.to('.decision-diamond', {
                scrollTrigger: {
                    trigger: '.decision-diamond',
                    start: 'top 85%',
                    toggleActions: 'play none none reverse'
                },
                opacity: 1,
                scale: 1,
                duration: 0.8,
                ease: 'elastic.out(1, 0.5)'
            });

            // Removed workflow arrow animations to prevent flashing
        }

        // QA Insights Animations
        function initInsightsAnimations() {
            // Animate insight cards with sophisticated entrance
            gsap.to('.insight-card', {
                scrollTrigger: {
                    trigger: '.insights-grid',
                    start: 'top 80%',
                    end: 'bottom 20%',
                    toggleActions: 'play none none reverse'
                },
                opacity: 1,
                y: 0,
                duration: 1,
                stagger: {
                    amount: 1.2,
                    from: 'left'
                },
                ease: 'power3.out'
            });

            // Removed insight icon animations to prevent flashing

            // Enhanced hover animations for insight cards
            document.querySelectorAll('.insight-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    gsap.to(this.querySelector('.insight-icon'), {
                        scale: 1.2,
                        rotation: 10,
                        duration: 0.3,
                        ease: 'power2.out'
                    });
                });

                card.addEventListener('mouseleave', function() {
                    gsap.to(this.querySelector('.insight-icon'), {
                        scale: 1,
                        rotation: 0,
                        duration: 0.3,
                        ease: 'power2.out'
                    });
                });
            });
        }

        // Enhanced Progressive Animations for Storytelling
        function initProgressiveAnimations() {
            // Team circles connection animation
            gsap.timeline({
                scrollTrigger: {
                    trigger: '.connected-circles',
                    start: 'top 80%',
                    toggleActions: 'play none none reverse'
                }
            })
            .from('.design-connected', { scale: 0, duration: 0.6, ease: 'back.out(1.7)' })
            .from('.dev-connected', { scale: 0, duration: 0.6, ease: 'back.out(1.7)' }, '-=0.3')
            .from('.qa-connected', { scale: 0, duration: 0.6, ease: 'back.out(1.7)' }, '-=0.3');

            // Removed defect card hover animations to prevent flashing

            // Removed severity dots pulse animation to prevent flashing
        }

        // Initialize all new animations
        initSprintAnimations();
        initInsightsAnimations();
        initProgressiveAnimations();
        
        // FORCE CLEAN STATE FIRST - Remove any existing custom dropdowns
        document.querySelectorAll('.custom-enhanced-dropdown').forEach(dropdown => {
            console.log('ðŸ—‘ï¸ Removing existing custom dropdown:', dropdown.getAttribute('data-dropdown-id'));
            dropdown.remove();
        });
        
        // Global escape key handler to close all dropdowns
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAllDropdowns();
            }
        });
        
        // Initialize dropdown system to hide original selects and create custom dropdowns
        initializeDropdownIcons();
        
        // Initialize annotation numbering on page load
        setTimeout(() => {
            renumberTriageCards();
        }, 100);
        
        // Initialize status buttons for first card only
        setTimeout(() => {
            const firstCard = document.querySelector('.triage-card');
            if (firstCard) {
                initializeStatusButtonsForCard(firstCard, 1);
            }
        }, 150);



        // Dynamic Pill CTA System - generalized for multiple sections
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.cta-pills-container').forEach(container => {
                const sectionRoot = container.closest('.hmw-content, .defect-glossary-content, .content-container, .story-content');
                const textPill = container.querySelector('.text-pill');
                const tldrPill = container.querySelector('.tldr-pill');
                // Voice pill is handled by the global audio widget logic; no per-section binding needed here
                if (!textPill || !tldrPill) return;

                const highlightTargets = sectionRoot ? sectionRoot.querySelectorAll('.highlight-target[data-highlight="tldr"]') : [];
            
            let isActive = false;
            let tldrSelected = false;
            
                // Initialize expanded state
                textPill.classList.add('active', 'connected');
                tldrPill.classList.add('show');
                isActive = true;
                
                // Text pill toggles TL;DR visibility within this container
                textPill.addEventListener('click', function(e) {
                    e.preventDefault();
                        if (!isActive) {
                            textPill.classList.add('connected', 'active');
                            tldrPill.classList.add('show');
                            tldrPill.classList.remove('selected');
                            isActive = true;
                        } else {
                            textPill.classList.remove('connected');
                            textPill.classList.add('active');
                            tldrPill.classList.remove('show', 'selected');
                        tldrPill.classList.add('hide');
                        highlightTargets.forEach(target => target.classList.remove('highlighted'));
                        setTimeout(() => { tldrPill.classList.remove('hide'); }, 400);
                            isActive = false;
                            tldrSelected = false;
                    }
                });

                // TL;DR pill toggles highlights for this section only
                tldrPill.addEventListener('click', function(e) {
                    e.preventDefault();
                    tldrSelected = !tldrSelected;
                    tldrPill.classList.toggle('selected', tldrSelected);
                    highlightTargets.forEach(target => target.classList.toggle('highlighted', tldrSelected));
                });
            });
        });

        // Simple MP3 Audio Player
        document.addEventListener('DOMContentLoaded', function() {
            const voicePills = Array.from(document.querySelectorAll('.voice-pill'));
            const audioWidget = document.getElementById('audioWidget');
            const audio = document.getElementById('voiceoverAudio');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const rewindBtn = document.getElementById('rewindBtn');
            const fastForwardBtn = document.getElementById('fastForwardBtn');
            const progressBar = document.getElementById('progressBar');
            const progressKnob = document.getElementById('progressKnob');
            const progressContainer = document.getElementById('audioProgressContainer');
            const speedButtons = document.querySelectorAll('.speed-btn');
            
            let isPlaying = false;
            let isWidgetVisible = false;
            
            // Initialize scroll-triggered animation
            initializeScrollAnimation();
            
            // Scroll animation function - voice pill availability tracking only (audio player stays visible once opened)
            function initializeScrollAnimation() {
                // Create scroll trigger for voice pill availability
                gsap.registerPlugin(ScrollTrigger);
                
                // Widget starts visible by default (no GSAP initialization needed)
                
                ScrollTrigger.create({
                    trigger: "#synopsis",
                    start: "top 80%",
                    end: "bottom 20%",
                    onEnter: () => {
                        console.log('ðŸŽ¯ Entering synopsis section');
                        
                        // Voice pill becomes available (audio player can be opened)
                        isWidgetVisible = true;
                        voicePills.forEach(p => p.classList.add('available'));
                    },
                    onEnterBack: () => {
                        console.log('ðŸ”™ Re-entering synopsis section from below');
                        
                        // Voice pill becomes available (audio player can be opened)
                        isWidgetVisible = true;
                        voicePills.forEach(p => p.classList.add('available'));
                    },
                    onLeave: () => {
                        console.log('ðŸšª Leaving synopsis section (scrolling down)');
                        
                        // Only remove availability, don't hide audio player
                        voicePills.forEach(p => p.classList.remove('available'));
                        isWidgetVisible = false;
                    },
                    onLeaveBack: () => {
                        console.log('ðŸšª Leaving synopsis section (scrolling up)');
                        
                        // Only remove availability, don't hide audio player
                        voicePills.forEach(p => p.classList.remove('available'));
                        isWidgetVisible = false;
                    }
                });
            }
            
            function showAudioWidgetIntelligent(shouldPlay = false) {
                // Show widget with slide up animation
                audioWidget.classList.remove('hidden');
                audioWidget.classList.add('active');
                
                // Update voice pill state
                if (currentVoicePill) currentVoicePill.classList.add('speaking');
                if (shouldPlay) {
                    if (currentVoicePill) currentVoicePill.textContent = '';
                    isPlaying = true;
                } else {
                    if (currentVoicePill) currentVoicePill.textContent = '';
                }
                
                // Start playing if requested (always from beginning for fresh start)
                if (shouldPlay) {
                    // Reset to beginning before starting
                    audio.currentTime = 0;
                    updateProgress();
                        playAudio();
                        console.log('â–¶ï¸ Starting audio playback from beginning');
                }
            }
            
            function closeAudioPlayer() {
                console.log('âŒ Closing audio player');
                
                // Stop audio immediately and reset position
                if (isPlaying) {
                    audio.pause();
                    isPlaying = false;
                }
                
                // Reset audio position to beginning
                audio.currentTime = 0;
                audio.volume = 1;
                updateProgress();
                
                // Reset state
                document.body.style.userSelect = '';
                document.body.style.cursor = '';
                
                // Hide widget with slide down animation
                audioWidget.classList.add('hidden');
                audioWidget.classList.remove('active');
                
                // Reset current voice pill to default state
                if (currentVoicePill) {
                    currentVoicePill.classList.remove('speaking', 'selected', 'playing');
                    currentVoicePill.textContent = '';
                }
                
                // Update play/pause button state
                playPauseBtn.classList.remove('playing');
                
                console.log('âœ… Audio player closed');
            }
            
            // Legacy function for compatibility
            function resetAudioPlayer() {
                closeAudioPlayer();
            }
            
            // Drag functionality variables
            let isDragging = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let widgetStartX = 0;
            let widgetStartY = 0;
            let scrollStartY = 0;
            let dragInitialized = false;
            
            // Initialize drag functionality
            function initializeDragFunctionality() {
                if (dragInitialized) return;
                dragInitialized = true;
                
                console.log('ðŸŽ¯ Initializing drag functionality');
                
                // Mouse events
                audioWidget.addEventListener('mousedown', startDrag);
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', endDrag);
                
                // Touch events for mobile
                audioWidget.addEventListener('touchstart', startDragTouch, { passive: false });
                document.addEventListener('touchmove', handleDragTouch, { passive: false });
                document.addEventListener('touchend', endDragTouch);
                
                // Scroll event to maintain relative position
                window.addEventListener('scroll', handleScrollDrag, { passive: true });
            }
            
            function startDrag(e) {
                // Don't drag if clicking on interactive elements
                if (e.target.closest('.audio-control-btn') || 
                    e.target.closest('.audio-close-btn') ||
                    e.target.closest('.audio-progress') ||
                    e.target.classList.contains('audio-progress-knob')) {
                    return;
                }
                
                e.preventDefault();
                isDragging = true;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                scrollStartY = window.scrollY;
                
                const rect = audioWidget.getBoundingClientRect();
                widgetStartX = rect.left;
                widgetStartY = rect.top;
                
                audioWidget.classList.add('dragging');
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'grabbing';
                
                console.log('ðŸŽ¯ Started dragging audio widget');
            }
            
            function startDragTouch(e) {
                // Don't drag if touching interactive elements
                if (e.target.closest('.audio-control-btn') || 
                    e.target.closest('.audio-close-btn') ||
                    e.target.closest('.audio-progress') ||
                    e.target.classList.contains('audio-progress-knob')) {
                    return;
                }
                
                e.preventDefault();
                const touch = e.touches[0];
                isDragging = true;
                dragStartX = touch.clientX;
                dragStartY = touch.clientY;
                scrollStartY = window.scrollY;
                
                const rect = audioWidget.getBoundingClientRect();
                widgetStartX = rect.left;
                widgetStartY = rect.top;
                
                audioWidget.classList.add('dragging');
                document.body.style.userSelect = 'none';
            }
            
            function handleDrag(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                updateWidgetPosition(deltaX, deltaY);
            }
            
            function handleDragTouch(e) {
                if (!isDragging) return;
                
                e.preventDefault();
                const touch = e.touches[0];
                const deltaX = touch.clientX - dragStartX;
                const deltaY = touch.clientY - dragStartY;
                
                updateWidgetPosition(deltaX, deltaY);
            }
            
            function updateWidgetPosition(deltaX, deltaY) {
                let newX = widgetStartX + deltaX;
                let newY = widgetStartY + deltaY;
                
                // Keep widget within viewport bounds
                const widgetWidth = audioWidget.offsetWidth;
                const widgetHeight = audioWidget.offsetHeight;
                const maxX = window.innerWidth - widgetWidth - 10;
                const maxY = window.innerHeight - widgetHeight - 10;
                
                newX = Math.max(10, Math.min(newX, maxX));
                newY = Math.max(10, Math.min(newY, maxY));
                
                // Apply position
                audioWidget.style.left = newX + 'px';
                audioWidget.style.top = newY + 'px';
                audioWidget.style.transform = 'none'; // Remove any existing transforms
            }
            
            function endDrag(e) {
                if (!isDragging) return;
                
                isDragging = false;
                audioWidget.classList.remove('dragging');
                document.body.style.userSelect = '';
                document.body.style.cursor = '';
                
                console.log('ðŸŽ¯ Ended dragging audio widget');
            }
            
            function endDragTouch(e) {
                if (!isDragging) return;
                
                isDragging = false;
                audioWidget.classList.remove('dragging');
                document.body.style.userSelect = '';
            }
            
            function handleScrollDrag() {
                // This function can be used to maintain position relative to scroll if needed
                // For now, fixed position maintains the widget position automatically
            }
            
            // Legacy compatibility functions
            function hideAudioWidgetWithFade() {
                closeAudioPlayer();
            }
            
            function hideAudioWidgetIntelligent() {
                // Hide widget with slide down animation
                audioWidget.classList.add('hidden');
                audioWidget.classList.remove('active');
                
                // Reset voice pill to default state
                voicePill.classList.remove('speaking', 'selected');
                voicePill.textContent = ''; // Empty text, sound icon shown via CSS
                
                // Update play/pause button state
                playPauseBtn.classList.remove('playing');
                
                console.log('âœ… Audio player hidden');
            }
            
            // Test updated audio source immediately
            console.log('ðŸ” Testing updated audio source:', audio.src);
            audio.load(); // Force reload new version
            
            // Add a manual test function to the window for debugging
            window.testAudio = function() {
                console.log('ðŸ§ª Manual audio test initiated');
                console.log('Audio state:', {
                    src: audio.src,
                    readyState: audio.readyState,
                    networkState: audio.networkState,
                    duration: audio.duration,
                    paused: audio.paused
                });
                
                audio.play().then(() => {
                    console.log('âœ… Manual test: Audio playing!');
                }).catch((error) => {
                    console.error('âŒ Manual test failed:', error);
                });
            };
            
            let currentVoicePill = null;
            function setAudioSourceFromPill(pill) {
                const src = pill.getAttribute('data-audio');
                if (!src) return;
                let source = audio.querySelector('source');
                if (!source) {
                    source = document.createElement('source');
                    source.type = 'audio/mpeg';
                    audio.appendChild(source);
                }
                source.src = src;
                audio.load();
            }

            if (voicePills.length && audio && audioWidget && playPauseBtn && progressBar && progressKnob) {
                voicePills.forEach(pill => {
                    pill.addEventListener('click', function(e) {
                    e.preventDefault();
                        const clicked = this;
                        const isActive = audioWidget.classList.contains('active');

                        // If switching to a different pill, update source and close previous
                        if (currentVoicePill && currentVoicePill !== clicked) {
                            currentVoicePill.classList.remove('selected', 'speaking', 'playing');
                            setAudioSourceFromPill(clicked);
                        }

                        if (!isActive || currentVoicePill !== clicked) {
                            currentVoicePill = clicked;
                            // Always set source on open (handles first-time play)
                            setAudioSourceFromPill(currentVoicePill);
                            currentVoicePill.classList.add('selected');
                        showAudioWidgetIntelligent(true);
                        } else {
                            // Same pill toggles close
                            clicked.classList.remove('selected');
                        closeAudioPlayer();
                            currentVoicePill = null;
                    }
                    });
                });
                
                // Audio close button (X) event listener
                const audioCloseBtn = document.getElementById('audioCloseBtn');
                if (audioCloseBtn) {
                    audioCloseBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('âŒ Close button clicked - closing audio player');
                        closeAudioPlayer();
                    });
                }

                // Mobile Settings Dropdown functionality
                const audioSettingsBtn = document.getElementById('audioSettingsBtn');
                const audioSettingsDropdown = document.getElementById('audioSettingsDropdown');
                
                if (audioSettingsBtn && audioSettingsDropdown) {
                    audioSettingsBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Toggle dropdown visibility
                        audioSettingsDropdown.classList.toggle('show');
                        console.log('âš™ï¸ Settings dropdown toggled');
                    });

                    // Close dropdown when clicking outside
                    document.addEventListener('click', function(e) {
                        if (!audioSettingsBtn.contains(e.target) && !audioSettingsDropdown.contains(e.target)) {
                            audioSettingsDropdown.classList.remove('show');
                        }
                    });

                    // Handle speed button clicks in dropdown
                    const dropdownSpeedBtns = audioSettingsDropdown.querySelectorAll('.speed-btn');
                    dropdownSpeedBtns.forEach(btn => {
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            const speed = parseFloat(this.getAttribute('data-speed'));
                            
                            // Update active state in dropdown
                            dropdownSpeedBtns.forEach(b => b.classList.remove('active'));
                            this.classList.add('active');
                            
                            // Sync with main speed controls
                            const mainSpeedBtns = document.querySelectorAll('.speed-controls .speed-btn');
                            mainSpeedBtns.forEach(b => b.classList.remove('active'));
                            const matchingMainBtn = document.querySelector(`.speed-controls .speed-btn[data-speed="${speed}"]`);
                            if (matchingMainBtn) {
                                matchingMainBtn.classList.add('active');
                            }
                            
                            // Set audio playback rate
                            if (audio) {
                                audio.playbackRate = speed;
                                console.log('ðŸŽµ Playback speed changed to:', speed + 'x');
                            }
                            
                            // Close dropdown after selection
                            audioSettingsDropdown.classList.remove('show');
                        });
                    });
                }
                
                // Play/Pause button
                playPauseBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    if (isPlaying) {
                        pauseAudio();
                    } else {
                        playAudio();
                    }
                });
                
                // Rewind 5 seconds
                rewindBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    audio.currentTime = Math.max(0, audio.currentTime - 5);
                });
                
                // Fast forward 5 seconds
                fastForwardBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    audio.currentTime = Math.min(audio.duration, audio.currentTime + 5);
                });
                
                // Speed control buttons
                speedButtons.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const speed = parseFloat(this.dataset.speed);
                        audio.playbackRate = speed;
                        
                        // Update active state
                        speedButtons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        
                        console.log(`âš¡ Speed changed to ${speed}x`);
                    });
                });
                
                // Progress bar and knob functionality
                let isDragging = false;
                
                // Click on progress track to jump to position
                progressContainer.addEventListener('click', function(e) {
                    if (audio.duration && !isDragging && e.target !== progressKnob) {
                        const track = this.querySelector('.audio-progress-track');
                        const rect = track.getBoundingClientRect();
                        const percent = (e.clientX - rect.left) / rect.width;
                        const newTime = Math.max(0, Math.min(percent * audio.duration, audio.duration));
                        audio.currentTime = newTime;
                        updateProgress();
                    }
                });
                
                // Knob dragging functionality (mouse)
                progressKnob.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    isDragging = true;
                    this.classList.add('dragging');
                    updateAudioTimeFromDrag(e);
                });
                
                document.addEventListener('mousemove', function(e) {
                    if (isDragging && audio.duration) {
                        updateAudioTimeFromDrag(e);
                    }
                });
                
                document.addEventListener('mouseup', function() {
                    if (isDragging) {
                        isDragging = false;
                        progressKnob.classList.remove('dragging');
                    }
                });
                
                // Touch support for mobile
                progressKnob.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    isDragging = true;
                    this.classList.add('dragging');
                    const touch = e.touches[0];
                    updateAudioTimeFromDrag(touch);
                });
                
                document.addEventListener('touchmove', function(e) {
                    if (isDragging && audio.duration) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        updateAudioTimeFromDrag(touch);
                    }
                }, { passive: false });
                
                document.addEventListener('touchend', function() {
                    if (isDragging) {
                        isDragging = false;
                        progressKnob.classList.remove('dragging');
                    }
                });
                
                function updateAudioTimeFromDrag(e) {
                    if (audio.duration) {
                        const track = progressContainer.querySelector('.audio-progress-track');
                        const rect = track.getBoundingClientRect();
                        const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                        const newTime = percent * audio.duration;
                        audio.currentTime = newTime;
                        updateProgress();
                    }
                }
                
                // Enhanced Audio event listeners for debugging
                audio.addEventListener('loadstart', function() {
                    console.log('ðŸ“¡ Audio load started');
                });
                
                audio.addEventListener('loadeddata', function() {
                    console.log('ðŸ“Š Audio data loaded');
                });
                
                audio.addEventListener('loadedmetadata', function() {
                    console.log('ðŸŽµ Audio metadata loaded, duration:', audio.duration);
                });
                
                audio.addEventListener('canplay', function() {
                    console.log('âœ… Audio can start playing');
                });
                
                audio.addEventListener('canplaythrough', function() {
                    console.log('ðŸš€ Audio can play through without buffering');
                });
                
                audio.addEventListener('timeupdate', function() {
                    updateProgress();
                });
                
                audio.addEventListener('ended', function() {
                    stopAudio();
                    console.log('ðŸ Audio ended');
                });
                
                audio.addEventListener('error', function(e) {
                    console.error('âŒ Audio error:', e);
                    console.error('ðŸ” Error details:', {
                        error: audio.error,
                        networkState: audio.networkState,
                        readyState: audio.readyState,
                        src: audio.src
                    });
                    hideAudioWidget();
                });
                
                audio.addEventListener('stalled', function() {
                    console.warn('âš ï¸ Audio download stalled');
                });
                
                audio.addEventListener('waiting', function() {
                    console.log('â³ Audio waiting for data');
                });
                
                audio.addEventListener('playing', function() {
                    console.log('â–¶ï¸ Audio started playing');
                });
                
                audio.addEventListener('pause', function() {
                    console.log('â¸ï¸ Audio paused');
                    if (currentVoicePill) currentVoicePill.classList.remove('playing');
                });

                audio.addEventListener('ended', function() {
                    console.log('ðŸ Audio ended');
                    isPlaying = false;
                    playPauseBtn.classList.remove('playing');
                    if (currentVoicePill) {
                        currentVoicePill.classList.remove('playing', 'speaking', 'selected');
                        currentVoicePill.textContent = '';
                    }
                });
                
                // Test audio connectivity on page load
                setTimeout(() => {
                    if (audio.readyState === 0) {
                        console.log('ðŸ”„ Loading updated audio file...');
                        audio.load();
                    } else {
                        console.log('âœ… Audio ready, duration:', audio.duration || 'Loading...');
                    }
                }, 1000);
                
                // Updated functions to use reset-based system
                function showAudioWidget() {
                    showAudioWidgetIntelligent(false);
                }
                
                function hideAudioWidget() {
                    closeAudioPlayer();
                }
                
                function playAudio() {
                    console.log('ðŸŽµ Attempting to play audio...', {
                        audioSrc: audio.src,
                        readyState: audio.readyState,
                        duration: audio.duration,
                        currentTime: audio.currentTime,
                        paused: audio.paused,
                        muted: audio.muted,
                        volume: audio.volume
                    });

                    // Ensure audio is loaded
                    if (audio.readyState < 2) {
                        console.log('ðŸ”„ Audio not ready, loading...');
                        audio.load();
                        
                        audio.addEventListener('canplaythrough', function() {
                            console.log('âœ… Audio ready, attempting play...');
                            audio.play().then(() => {
                                console.log('ðŸŽµ Audio playing successfully');
                                isPlaying = true;
                                playPauseBtn.classList.add('playing');
                                if (currentVoicePill) currentVoicePill.classList.add('playing');
                            }).catch((error) => {
                                console.error('âŒ Audio playback failed:', error);
                                isPlaying = false;
                                playPauseBtn.classList.remove('playing');
                                if (currentVoicePill) currentVoicePill.classList.remove('playing');
                            });
                        }, { once: true });
                        
                        return;
                    }

                    audio.play().then(() => {
                        console.log('ðŸŽµ Audio playing successfully');
                        isPlaying = true;
                        playPauseBtn.classList.add('playing');
                        if (currentVoicePill) currentVoicePill.classList.add('playing');
                    }).catch((error) => {
                        console.error('âŒ Audio playback failed:', error);
                        console.log('ðŸ” Detailed error info:', {
                            name: error.name,
                            message: error.message,
                            code: error.code
                        });
                        isPlaying = false;
                        playPauseBtn.classList.remove('playing');
                        if (currentVoicePill) currentVoicePill.classList.remove('playing');
                    });
                }
                
                function pauseAudio() {
                    audio.pause();
                    isPlaying = false;
                    playPauseBtn.classList.remove('playing');
                    if (currentVoicePill) currentVoicePill.classList.remove('playing');
                }
                
                function stopAudio() {
                    audio.pause();
                    audio.currentTime = 0;
                    isPlaying = false;
                    playPauseBtn.classList.remove('playing');
                    if (currentVoicePill) currentVoicePill.classList.remove('playing');
                    updateProgress();
                }
                
                function updateProgress() {
                    if (audio.duration) {
                        const progress = (audio.currentTime / audio.duration) * 100;
                        progressBar.style.width = progress + '%';
                        progressKnob.style.left = progress + '%';
                    }
                }
            }
        });

        // Custom Scrollbar Implementation - Wait for DOM elements to be available
        setTimeout(function() {
            console.log('ðŸ”§ Initializing scrollbar...');
            
        const scrollThumb = document.getElementById('scrollThumb');
        const sectionIndicators = document.getElementById('sectionIndicators');
        const sections = document.querySelectorAll('.section');
            
            // Null checks
            if (!scrollThumb) {
                console.error('âŒ scrollThumb element not found');
                return;
            }
            if (!sectionIndicators) {
                console.error('âŒ sectionIndicators element not found');
                return;
            }
            if (sections.length === 0) {
                console.error('âŒ No sections found');
                return;
            }
            
            console.log('âœ… All scrollbar elements found:', { scrollThumb, sectionIndicators, sectionsCount: sections.length });
            
            // Check if audio widget is properly visible
            const audioWidget = document.getElementById('audioWidget');
            if (audioWidget) {
                console.log('ðŸŽµ Audio widget found:', audioWidget);
                console.log('ðŸ” Audio widget classes:', audioWidget.className);
                
                // Keep audio widget hidden by default - only show when voice-pill is clicked
                // Remove any active class that might make it visible
                if (audioWidget.classList.contains('active')) {
                    console.log('ðŸ”‡ Removing active class to keep audio widget hidden by default');
                    audioWidget.classList.remove('active');
                }
                
                // Ensure it has the hidden class for proper initial state
                if (!audioWidget.classList.contains('hidden')) {
                    console.log('ðŸ”‡ Adding hidden class to keep audio widget concealed');
                    audioWidget.classList.add('hidden');
                }
                
                console.log('âœ… Audio widget properly hidden, will show when voice-pill is activated:', audioWidget.className);
                
                // Deep debugging - check computed styles and positioning
                const computedStyle = window.getComputedStyle(audioWidget);
                console.log('ðŸ” Audio widget computed styles:', {
                    position: computedStyle.position,
                    bottom: computedStyle.bottom,
                    left: computedStyle.left,
                    transform: computedStyle.transform,
                    opacity: computedStyle.opacity,
                    visibility: computedStyle.visibility,
                    zIndex: computedStyle.zIndex,
                    display: computedStyle.display,
                    width: computedStyle.width,
                    height: computedStyle.height
                });
                
                // Check if it's positioned correctly
                const rect = audioWidget.getBoundingClientRect();
                console.log('ðŸ“ Audio widget position:', {
                    top: rect.top,
                    left: rect.left,
                    bottom: rect.bottom,
                    right: rect.right,
                    width: rect.width,
                    height: rect.height,
                    isInViewport: rect.bottom > 0 && rect.right > 0 && rect.top < window.innerHeight && rect.left < window.innerWidth
                });
                
                // Check if ScrollSmoother is affecting positioning
                const isInsideScrollContent = audioWidget.closest('#smooth-content');
                console.log('ðŸ“ Audio widget inside ScrollSmoother content?', !!isInsideScrollContent);
                
                if (isInsideScrollContent) {
                    console.log('âš ï¸ PROBLEM: Audio widget is inside ScrollSmoother content - should be outside for fixed positioning!');
                } else {
                    console.log('âœ… Audio widget is correctly positioned outside ScrollSmoother content');
                }

                // Check global clock container positioning
                const clockContainer = document.getElementById('global-clock-container');
                if (clockContainer) {
                    const isClockInsideScrollContent = clockContainer.closest('#smooth-content');
                    console.log('ðŸ• Global clock container found:', clockContainer);
                    console.log('ðŸ“ Clock inside ScrollSmoother content?', !!isClockInsideScrollContent);
                    
                    if (isClockInsideScrollContent) {
                        console.log('âš ï¸ PROBLEM: Clock container is inside ScrollSmoother content - should be outside for fixed positioning!');
                    } else {
                        console.log('âœ… Clock container is correctly positioned outside ScrollSmoother content');
                    }
                } else {
                    console.log('âš ï¸ Global clock container not found');
                }
            } else {
                console.error('âŒ Audio widget not found!');
            }

        // Section data mapping
        const sectionData = [
            { id: 'overview', name: 'Overview' },
             { id: 'results', name: 'Impact' },
             { id: 'synopsis', name: 'Synopsis' },
             { id: 'how-might-we', name: 'How Might We' },
             { id: 'process-map', name: 'Process Map' },
             { id: 'defect-glossary', name: 'Defect Glossary' },
            { id: 'triage-component', name: 'Triage Tool'},
             { id: 'implementation', name: 'Future-Proofed' }
        ];

        let scrollTimeout;
        let isScrolling = false;
        let isDragging = false;

        // Create section indicators
        sectionData.forEach((section, index) => {
            const indicator = document.createElement('div');
            indicator.className = 'section-indicator';
            indicator.innerHTML = `
                <div class="indicator-bubble">${section.name}</div>
            `;
            sectionIndicators.appendChild(indicator);
        });

        const indicators = document.querySelectorAll('.section-indicator');

        // Fallback scrollbar function for when ScrollSmoother is not available
        function updateScrollbar() {
            // Only use this fallback if ScrollSmoother is not available
            if (window.smoother) return; // ScrollSmoother handles updates via onUpdate callback
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercentage = scrollHeight > 0 ? scrollTop / scrollHeight : 0;
            
            const scrollTrack = document.querySelector('.scroll-track');
            if (!scrollTrack || !scrollThumb) return;
            
            const trackHeight = scrollTrack.offsetHeight;
            const thumbHeight = Math.max(20, trackHeight * 0.1);
            const thumbTop = scrollPercentage * (trackHeight - thumbHeight);
            
            scrollThumb.style.height = thumbHeight + 'px';
            scrollThumb.style.top = thumbTop + 'px';

            // Update section indicators (fallback)
            let activeSection = 0;
            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
                    activeSection = index;
                }
            });

            const indicators = document.querySelectorAll('.section-indicator');
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === activeSection && isScrolling);
            });
        }

        function handleScrollStart() {
            isScrolling = true;
            clearTimeout(scrollTimeout);
            updateScrollbar();
        }

        function handleScrollEnd() {
            scrollTimeout = setTimeout(() => {
                isScrolling = false;
                indicators.forEach(indicator => {
                    indicator.classList.remove('active');
                });
            }, 1000); // Hide bubble 1 second after scrolling stops
        }

        // Handle scrollbar dragging
        let startY = 0;
        let startScrollTop = 0;

        scrollThumb.addEventListener('mousedown', (e) => {
            isDragging = true;
            isScrolling = true;
            startY = e.clientY;
            startScrollTop = window.pageYOffset || document.documentElement.scrollTop;
            document.body.style.userSelect = 'none';
            clearTimeout(scrollTimeout);
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const deltaY = e.clientY - startY;
            const trackHeight = document.querySelector('.scroll-track').offsetHeight;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollDelta = (deltaY / trackHeight) * scrollHeight;
            
            window.scrollTo(0, startScrollTop + scrollDelta);
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                document.body.style.userSelect = '';
                handleScrollEnd();
            }
        });

        // Handle scroll events (works with both regular scroll and ScrollSmoother)
        window.addEventListener('scroll', () => {
            handleScrollStart();
            handleScrollEnd();
            updateScrollbar();
        });
        
        // ScrollSmoother scroll events are handled in the ScrollSmoother initialization section

        window.addEventListener('resize', updateScrollbar);

        // Initial update
        updateScrollbar();

        // GSAP ScrollSmoother Setup - Complete Rewrite
        gsap.registerPlugin(ScrollSmoother, ScrollTrigger, ScrollToPlugin);

        // Check if ScrollSmoother is available
        if (typeof ScrollSmoother === 'undefined') {
            console.error('âŒ ScrollSmoother failed to load. Check CDN connection.');
        } else {
            console.log('âœ… ScrollSmoother loaded successfully');

            // Initialize ScrollSmoother
            const smoother = ScrollSmoother.create({
                wrapper: "#smooth-wrapper",
                content: "#smooth-content",
                smooth: 1, // Reduced smooth scrolling strength
                effects: false, // Keep disabled to preserve layout
                smoothTouch: 0.1, // Light smooth scrolling on touch
                normalizeScroll: false, // Disable to prevent scroll position conflicts
                ignoreMobileResize: true, // iOS stability
                onUpdate: self => {
                    // Update custom scrollbar on every ScrollSmoother update
                    updateCustomScrollbar(self);
                }
            });

            // Make smoother globally accessible
            window.smoother = smoother;

            // Custom scrollbar update function for ScrollSmoother
            function updateCustomScrollbar(smoother) {
                if (!scrollThumb || !document.querySelector('.scroll-track')) return;

                const progress = smoother.progress || 0;
                const scrollTrack = document.querySelector('.scroll-track');
                const trackHeight = scrollTrack.offsetHeight;
                const thumbHeight = Math.max(20, trackHeight * 0.1); // 10% of track height
                const thumbTop = progress * (trackHeight - thumbHeight);

                scrollThumb.style.height = thumbHeight + 'px';
                scrollThumb.style.top = thumbTop + 'px';

                // More accurate section detection - find section with most visible area
                let activeIndex = 0;
                let maxVisibleRatio = 0;
                
                sections.forEach((section, index) => {
                    const rect = section.getBoundingClientRect();
                    
                    // Calculate visible height of this section
                    const visibleTop = Math.max(rect.top, 0);
                    const visibleBottom = Math.min(rect.bottom, window.innerHeight);
                    const visibleHeight = Math.max(0, visibleBottom - visibleTop);
                    
                    // Calculate what percentage of the section is visible
                    const visibleRatio = visibleHeight / rect.height;
                    
                    // Also consider if section center is close to viewport center
                    const sectionCenter = rect.top + rect.height / 2;
                    const viewportCenter = window.innerHeight / 2;
                    const centerDistance = Math.abs(sectionCenter - viewportCenter);
                    const normalizedDistance = centerDistance / (window.innerHeight / 2);
                    
                    // Combine visibility ratio with center proximity (weighted)
                    const score = visibleRatio * 0.7 + (1 - normalizedDistance) * 0.3;
                    
                    if (score > maxVisibleRatio) {
                        maxVisibleRatio = score;
                        activeIndex = index;
                    }
                });

                const indicators = document.querySelectorAll('.section-indicator');
                
                indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === activeIndex);
                    
                    if (index === activeIndex && isScrolling) {
                        // Position indicator next to thumb
                        indicator.style.top = (thumbTop + thumbHeight / 2) + 'px';
                    }
                });
            }

            // Gentle auto-scroll setup with ScrollSmoother
            let lastScrollY = 0;
            let scrollDirection = 'down';
            let isAutoScrolling = false;

            // Track scroll direction
            smoother.scrollTrigger.addEventListener("scroll", () => {
                const currentScrollY = smoother.scrollTop();
                scrollDirection = currentScrollY > lastScrollY ? 'down' : 'up';
                lastScrollY = currentScrollY;
            });

            // Setup gentle auto-scroll for sections (exclude process-map to prevent conflicts)
            sections.forEach((section) => {
                // Skip auto-scroll for process-map section to prevent conflicts with horizontal scrolling
                if (section.id === 'process-map') return;
                
                ScrollTrigger.create({
                    trigger: section,
                    start: "top 25%",
                    end: "top 15%", 
                    onEnter: () => {
                        if (scrollDirection === 'down' && !isAutoScrolling) {
                            isAutoScrolling = true;
                            smoother.scrollTo(section, {
                                duration: 0.8,
                                ease: "power2.out",
                                onComplete: () => {
                                    setTimeout(() => isAutoScrolling = false, 1000);
                                }
                            });
                        }
                    }
                });
            });

            // Initialize scrollbar
            setTimeout(() => updateCustomScrollbar(smoother), 100);
            
            console.log('ðŸš€ ScrollSmoother with custom scrollbar initialized!');
        }

        }, 100); // End setTimeout - give DOM time to render

    </script>
        </div>
    </div>
    <script>
    // Randomize impact pill hover colors using gallery/metric palette (theme-aware)
    (function() {
        function getPalette() {
            const cs = getComputedStyle(document.body);
            return [
                cs.getPropertyValue('--case-study-qa-framework').trim(),
                cs.getPropertyValue('--case-study-design-system').trim(),
                cs.getPropertyValue('--case-study-mobile-experience').trim(),
                cs.getPropertyValue('--case-study-ai-integration').trim()
            ];
        }

        function pickRandom(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function applyHoverColor(pill, color) {
            pill.style.backgroundColor = color;
            pill.style.borderColor = color;
            pill.style.color = '#ffffff';
        }

        function clearHoverColor(pill) {
            pill.style.backgroundColor = '';
            pill.style.borderColor = '';
            pill.style.color = '';
        }

        function assignColorsToPills(palette) {
            document.querySelectorAll('.impact-pill').forEach(pill => {
                pill.setAttribute('data-hover-color', pickRandom(palette));
            });
        }

        function bindHoverHandlers() {
            document.querySelectorAll('.impact-pill').forEach(pill => {
                if (pill.dataset.hoverBound === '1') return;
                pill.addEventListener('mouseenter', () => {
                    const color = pill.getAttribute('data-hover-color');
                    if (color) applyHoverColor(pill, color);
                });
                pill.addEventListener('mouseleave', () => clearHoverColor(pill));
                pill.dataset.hoverBound = '1';
            });
        }

        function initImpactPillHovers() {
            assignColorsToPills(getPalette());
            bindHoverHandlers();
        }

        // Initialize on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initImpactPillHovers);
        } else {
            initImpactPillHovers();
        }

        // Observe theme changes (data-theme on body)
        const observer = new MutationObserver(mutations => {
            for (const m of mutations) {
                if (m.type === 'attributes' && m.attributeName === 'data-theme') {
                    document.querySelectorAll('.impact-pill').forEach(p => clearHoverColor(p));
                    assignColorsToPills(getPalette());
                }
            }
        });
        observer.observe(document.body, { attributes: true });
    })();
    </script>

    <!-- Custom Scrollbar (Outside ScrollSmoother for fixed positioning) -->
    <div class="custom-scrollbar">
        <div class="scroll-track">
            <div class="scroll-thumb" id="scrollThumb"></div>
        </div>
    </div>

    <!-- Section Indicators (Outside ScrollSmoother for fixed positioning) -->
    <div class="section-indicators" id="sectionIndicators"></div>

    <!-- Audio Control Widget (Outside ScrollSmoother for fixed positioning) -->
    <div class="audio-control-widget" id="audioWidget">
        <!-- Settings Button & Dropdown -->
        <button class="audio-settings-btn" id="audioSettingsBtn" title="Audio settings"></button>
        <div class="audio-settings-dropdown" id="audioSettingsDropdown">
            <button class="audio-control-btn speed-btn" data-speed="0.75">0.75x</button>
            <button class="audio-control-btn speed-btn active" data-speed="1">1x</button>
            <button class="audio-control-btn speed-btn" data-speed="1.5">1.5x</button>
        </div>
        
        <div class="audio-content">
            <div class="audio-main-controls">
                <button class="audio-control-btn seek-btn" id="rewindBtn" title="Rewind 5 seconds"></button>
                <button class="audio-control-btn play-pause-btn" id="playPauseBtn" title="Play/Pause"></button>
                <button class="audio-control-btn seek-btn" id="fastForwardBtn" title="Fast forward 5 seconds"></button>
            </div>
            <div class="speed-controls">
                <button class="audio-control-btn speed-btn" data-speed="0.75">0.75x</button>
                <button class="audio-control-btn speed-btn active" data-speed="1">1x</button>
                <button class="audio-control-btn speed-btn" data-speed="1.5">1.5x</button>
            </div>
            <div class="audio-progress" id="audioProgressContainer">
                <div class="audio-progress-track">
                    <div class="audio-progress-bar" id="progressBar"></div>
                    <div class="audio-progress-knob" id="progressKnob"></div>
                </div>
            </div>
        </div>
        
        <button class="audio-close-btn" id="audioCloseBtn" title="Close audio player"></button>
    </div>

    <!-- Link Selection Modal (Outside ScrollSmoother for proper z-index) -->
    <div id="link-modal" class="modal-overlay" onclick="closeLinkModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Add Link</h3>
                <button class="modal-close" onclick="closeLinkModal()">âœ•</button>
            </div>
            <div id="modal-error-banner" class="modal-error-banner">
                <svg class="error-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                    <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span class="error-message">Make a selection to save</span>
            </div>
            <div class="modal-body">
                <div class="service-options">
                    <button class="service-option" data-service="jira" onclick="selectService('jira')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/Jira.png" width="20" height="20" alt="Jira">
                        </div>
                        <span>Jira</span>
                    </button>
                    <button class="service-option" data-service="confluence" onclick="selectService('confluence')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/Confluence.png" width="20" height="20" alt="Confluence">
                        </div>
                        <span>Confluence</span>
                    </button>
                    <button class="service-option" data-service="notion" onclick="selectService('notion')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/Notion.png" width="20" height="20" alt="Notion">
                        </div>
                        <span>Notion</span>
                    </button>
                    <button class="service-option" data-service="figma" onclick="selectService('figma')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/Figma.png" width="20" height="20" alt="Figma">
                        </div>
                        <span>Figma</span>
                    </button>
                    <button class="service-option" data-service="googledocs" onclick="selectService('googledocs')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/Google-Sheets.png" width="20" height="20" alt="Google Sheets">
                        </div>
                        <span>Google Sheets</span>
                    </button>
                    <button class="service-option" data-service="zip" onclick="selectService('zip')">
                        <div class="service-icon">
                            <img src="https://raw.githubusercontent.com/amachinic/Merem/main/zip.png" width="27" height="20" alt="Zip">
                        </div>
                        <span>Zip</span>
                    </button>
                </div>
                <div class="url-input-row">
                    <label for="modal-url-input" class="modal-field-label">Website</label>
                    <input type="text" id="modal-url-input" placeholder="www.website.com" class="modal-url-input" />
                </div>
                <div class="api-token-input-row">
                    <label for="modal-api-token-input" class="modal-field-label">API Token</label>
                    <input type="text" id="modal-api-token-input" placeholder=" " class="modal-url-input" />
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-sync" tabindex="-1">
                    â‡„ Sync
                    <div class="modal-sync-tooltip">I'm sorry this feature is not yet available. We're still building and scaling.</div>
                </button>
                <div class="modal-footer-right">
                <button class="modal-btn modal-btn-secondary" onclick="closeLinkModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="saveLinkFromModal()">Save</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
</body>
</html>