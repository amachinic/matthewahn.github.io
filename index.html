<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f0f0f0" id="theme-color-meta">
    <title>Matthew Ahn</title>
	<style>gallery-archive{display:block;width:100%;min-height:720px}</style>
	<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
	<link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
	<link rel="preconnect" href="https://github.com" crossorigin>
	<link rel="dns-prefetch" href="https://github.com">
	<link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
	<link rel="dns-prefetch" href="https://raw.githubusercontent.com">
	<link rel="preload" href="public/typeface/UTypeface.woff" as="font" type="font/woff" crossorigin>
	<link rel="preload" href="public/typeface/ITypeface.woff" as="font" type="font/woff" crossorigin>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollToPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollSmoother.min.js"></script>
    <script src="global-clock-component.js"></script>
    <style>
        @font-face {
            font-family: 'Unica77LL';
            src: url('public/typeface/UTypeface.woff') format('woff'),
                 url('https://raw.githubusercontent.com/amachinic/matthewahn.github.io/main/public/typeface/UTypeface.woff') format('woff');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }
        
        @font-face {
            font-family: 'Input';
            src: url('public/typeface/ITypeface.woff') format('woff'),
                 url('https://raw.githubusercontent.com/amachinic/matthewahn.github.io/main/public/typeface/ITypeface.woff') format('woff');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        :root {
            /* NEW COLOR SYSTEM */
            /* PRIMITIVES */
            --brand-lime-500: #A2E633;
            --brand-lime-600: #7EBB1C;
            --neutral-0: #ffffff;
            --neutral-50: #f8f9fa;
            --neutral-100: #f3f4f6;
            --neutral-200: #f0f0f0;
            --neutral-700: #6b7280;
            --neutral-800: #333333;
            --ink-950: #000810;

            /* ROLES */
            --surface-1: var(--neutral-0);
            --surface-2: var(--neutral-50);
            --surface-3: var(--neutral-100);
            --bg: var(--neutral-200);

            --text-primary: var(--neutral-800);
            --text-secondary: var(--neutral-700);
            --text-muted: #9ca3af;

            --border-subtle: rgba(0,0,0,.10);
            --border: rgba(0,0,0,.15);
            --border-strong: rgba(0,0,0,.20);

            --shadow-sm: rgba(0,0,0,.08);
            --shadow-md: rgba(0,0,0,.12);
            --shadow-lg: rgba(0,0,0,.16);

            --focus-ring: var(--brand-lime-600);

            /* COMPONENT ALIASES */
            --card-bg: var(--surface-1);
            --card-text: var(--text-primary);

            --button-primary-bg: var(--brand-lime-500);
            --button-primary-text: #000;
            --button-neutral-bg: var(--surface-2);
            --button-neutral-text: var(--text-primary);
            --button-border: #D9D9D9;

            --state-hover: rgba(0,0,0,.04);
            --state-pressed: rgba(0,0,0,.08);
            --state-disabled: rgba(0,0,0,.12);

            /* LINKS */
            --link: #0066cc;
            --link-hover: #004499;
            --link-visited: #5a3ec8;

            /* MOTION */
            --motion-fast: 120ms;
            --motion-normal: 180ms;
            --motion-slow: 300ms;

            /* legacy aliases + prior vars */
            --white: var(--neutral-0);
            --nav-white-overlay: var(--state-hover);
            --lime-border: var(--brand-lime-600);
            --bg-color: var(--bg);
            --text-color: #2c2c2c;
            --secondary-text-color: var(--text-secondary);
            --nav-bg-color: var(--state-hover);
            --nav-border-color: var(--border-subtle);
            --nav-hover-color: rgba(0, 0, 0, 0.1);
            --clock-bg-color: var(--bg);
            --tooltip-bg-color: var(--surface-1);
            --tooltip-text-color: black;
            --shadow-color: var(--shadow-md);
            --toggle-border-color: var(--border);
            --light-nav-border-color: var(--border-subtle);
            --card-bg-color: #000;
            --card-text-color: var(--card-text);
            
            /* Design System: Case Study Color Palette */
            --case-study-qa-framework: rgb(0, 5, 11); /* Obsidian */
            --case-study-design-system: rgb(8, 0, 11); /* Violet */
            --case-study-mobile-experience: rgb(0, 10, 5); /* Forest green */
            --case-study-ai-integration: rgb(14, 6, 0); /* Rouge */
            --white: #ffffff;
            --nav-white-overlay: rgba(255, 255, 255, 0.2);
        }

        /* Dark mode removed */

        /* =================================
           TYPOGRAPHY SYSTEM
           ================================= */
        
        /* Typography Mapping Guide:
           - H1 (64px) = Major page titles
           - H2 (40px) = Section titles, project titles  
           - H3 (24px) = Subsection titles, problem questions
           - Body (16px) = General text, labels, team circles
           - Value (14px) = Meta values, form inputs, triage text
           - Caption (12px) = Pills, small labels, sublabels
        */
        
        /* Desktop & Tablet Typography (default) */
        .type-h1 {
            font-family: 'Unica77LL', Helvetica, sans-serif;
            font-size: 64px;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .type-h2 {
            font-family: 'Unica77LL', Helvetica, sans-serif;
            font-size: 40px;
            font-weight: 500;
            line-height: 1.3;
        }
        
        .type-h3 {
            font-family: 'Unica77LL', Helvetica, sans-serif;
            font-size: 24px;
            font-weight: 400;
            line-height: 1.5;
        }
        
        .type-body {
            font-family: Helvetica, sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 1.6;
        }
        
        .type-value {
            font-family: Helvetica, sans-serif;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.4;
        }
        
        .type-label,
        .type-caption {
            font-family: Helvetica, sans-serif;
            font-size: 12px;
            font-weight: 400;
            line-height: 1.4;
        }
        
        /* Mobile Typography */
        @media (max-width: 768px) {
            .type-h1 {
                font-size: 40px;
            }
            
            .type-h2 {
                font-size: 32px;
            }
            
            .type-h3 {
                font-size: 20px;
            }
            
            .type-body {
                font-size: 14px;
            }
            
            .type-value {
                font-size: 13px;
            }
            
            .type-label,
            .type-caption {
                font-size: 11px;
            }
        }
        
        /* Extra Small Mobile Typography */
        @media (max-width: 480px) {
            .type-h1 {
                font-size: 32px;
            }
            
            .type-h2 {
                font-size: 28px;
            }
            
            .type-h3 {
                font-size: 18px;
            }
            
            .type-body {
                font-size: 14px;
            }
            
            .type-value {
                font-size: 12px;
            }
            
            .type-label,
            .type-caption {
                font-size: 10px;
            }
        }

        html {
            background-color: var(--bg-color);
        }

        body {
            -webkit-overflow-scrolling: touch; /* iOS smooth scrolling */
            overscroll-behavior: none; /* Prevent bounce on scroll boundaries */
        }

        /* Enhanced scroll performance */
        * {
            scroll-padding-top: 120px; /* Account for clock container */
        }

        /* Smooth momentum scrolling for webkit browsers */
        body, html {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        /* Hide default scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Firefox scrollbar */
        html {
            scrollbar-width: none;
        }



        body {
            font-family: 'Unica77LL', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            opacity: 0;
            animation: fadeIn 1.5s ease-in-out forwards;
            min-height: 100vh;
        }

        /* Fade in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Fade out animation for page transitions */
        body.fade-out {
            animation: fadeOut 0.8s ease-in-out forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        /* Dark mode fade overlay */
        .fade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f0f0f;
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transition: opacity 0.8s ease-in-out;
        }

        .fade-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Navigation state styling */
        .navigating {
            overflow: hidden;
        }

        .navigating .gallery-cta,
        .navigating .work-cta {
            pointer-events: none;
            opacity: 0.7;
        }
        #intro {
            cursor: default;
        }
        #intro span {
            display: inline-block;
        }
        #intro-greeting {
            font-size: 24px;
            line-height: 1.2;
            margin-bottom: 18px;
            display: block;
        }
        #intro-description {
            font-size: 18px;
            line-height: 1.2;
            white-space: pre-wrap;
        }
        .trailing-char {
            display: inline-block;
            color: var(--secondary-text-color);
            transition: opacity 0.3s ease;
        }
        .scrambled {
            color: var(--secondary-text-color);
            transition: color 0.1s ease;
        }




        /* Updated styles for the navigation bar */
        #nav-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            top: auto;
            transform: translateX(-50%);
            z-index: 1001;
            transition: background-color 0.3s ease, backdrop-filter 0.3s ease, box-shadow 0.3s ease;
        }

        #nav-bar {
            display: flex;
            gap: 10px;
            border-radius: 12px;
            padding: 6px 10px;
            position: relative;
        }

        .nav-button {
            background: none;
            border: none;
            color: #161616ef;
            font-family: 'Input', monospace;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
            position: relative;
            z-index: 2;
            text-decoration: none;
            letter-spacing: -0.01em;
        }

        
/* Dark mode removed */

        /* Navigation slider indicator */
        #nav-slider {
            position: absolute;
            top: 6px;
            bottom: 6px;
            background-color: var(--nav-hover-color);
            border-radius: 8px;
            transition: left 0.3s ease, width 0.3s ease;
            z-index: 1;
            pointer-events: none;
        }

        /* Updated styles for the blur effect with drop shadow */
        .blur-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgb(255 255 255 / 60%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(3px);
            border-radius: 12px;
            z-index: 1;
            border: 1px solid var(--nav-border-color);
            transition: box-shadow 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        /* Navigation bar specific border for light mode */
        #nav-container .blur-bg {
            border: 1px solid var(--light-nav-border-color);
        }

        /* Dark mode navigation bar background */
/* Dark mode removed */
        /* Responsive adjustments for mobile */
        @media (max-width: 600px) {
            #nav-container {
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                width: auto;
                padding: 0;
            }
            #nav-bar {
                gap: 4px;
                padding: 6px;
                width: auto;
                display: flex;
                justify-content: center;
            }
            .nav-button {
                font-size: 13px;
                padding: 7px 10px;
                white-space: nowrap;
            }
            .blur-bg {
                border-radius: 8px;
            }
        }



        /* Section styles */
        .section {
            min-height: auto;
            padding: 60px 0;
            margin-bottom: 0;
            box-sizing: border-box;
            perspective: 1000px; /* enable 3D depth for convex transitions */
        }
        .section .section-content { transform-style: preserve-3d; }

        /* Archive section removed */

        #home {
            padding: 140px 0 120px 0;
        }

        .section-content {
            width: 100%;
            margin: 0;
            padding: 0px 40px 100px 40px;
            box-sizing: border-box;
            min-height: 0; /* Ensure consistent height calculation */
        }

        /* Section h2 extends H1 typography */
        .section h2 {
            font-size: 64px; /* type-h1 */
            margin-bottom: 60px;
            font-weight: 500;
        }

        /* Card styles */
        .card-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 40px;
            min-height: 0; /* Prevent height calculation shifts */
        }

        .card {
            background-color: var(--card-bg-color);
            color: var(--card-text-color);
            border-radius: 8px;
            padding: 40px;
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            border: 1px solid transparent;
            will-change: transform, opacity;
        }

        /* Ensure tall-card has same base background as gallery-slide for consistent color appearance */
        .card.tall-card {
            background-color: var(--card-bg-color);
        }

        /* Case study cards use individual color scheme - see CSS rules below */

        .card:hover {
            box-shadow: 0 12px 40px var(--shadow-color);
        }

        /* Section title styling for typing animation */
        .section-title {
            transition: color 0.3s ease;
            min-height: 1.2em;
            line-height: 1.2;
            display: inline-block;
            width: fit-content;
            cursor: default;
            letter-spacing: -0.04em;
            will-change: opacity;
            opacity: 0;
        }



        .section-title span {
            transition: color 0.15s ease;
            cursor: default;
        }

        /* Card h3 extends H3 typography */
        .card h3 {
            font-size: 24px; /* type-h3 */
            margin-bottom: 16px;
            font-weight: 500;
        }

        /* Card p extends body typography */
        .card p {
            font-size: 16px; /* type-body */
            line-height: 1.6;
            margin-bottom: 24px;
            opacity: 0.9;
        }

        /* Multi-column layouts */
        .card-grid.two-columns {
            grid-template-columns: 1fr 1fr;
        }

        .card-grid.three-columns {
            grid-template-columns: repeat(3, 1fr);
        }

        .card-grid.four-columns {
            grid-template-columns: repeat(4, 1fr);
        }

        .card.tall-card {
            min-height: 280px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-start;
            padding: 20px;
            text-align: left;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card.tall-card[onclick] {
            cursor: pointer;
        }

        .card.tall-card:hover {
            transform: translateY(-2px);
        }

        /* Work section card content styling (matches gallery exactly) */
        .card.tall-card h3 {
            font-family: 'Input', monospace;
            font-size: 12px;
            margin: 0 0 8px 0;
            font-weight: normal;
            color: var(--card-text-color);
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .card.tall-card p {
            font-family: 'Input', monospace;
            font-size: 12px;
            margin: 0;
            line-height: 1.4;
            color: var(--card-text-color);
            opacity: 0;
            transform: translateX(-20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            max-width: 350px;
        }

        /* Desktop hover animation for work cards */
        @media (min-width: 769px) {
            .card.tall-card:hover h3 {
                opacity: 1;
                transform: translateX(0);
            }

            .card.tall-card:hover p {
                opacity: 0.8;
                transform: translateX(0);
            }

            .card.tall-card:hover .work-cta {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile adjustments - hide text but show work CTA */
        @media (max-width: 768px) {
            .card.tall-card h3,
            .card.tall-card p {
                display: none; /* Hide text on mobile */
            }
            
            /* Work CTA mobile positioning (hidden by default) */
            .work-cta {
                top: 15px;
                right: 15px;
                padding: 10px 18px; /* Slightly larger for touch */
            }
            
            /* Mobile hover states for work cards */
            .card.tall-card:hover .work-cta {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Individual Case Study Card Backgrounds - Applied with maximum specificity */
        .card-grid .card.tall-card:nth-child(1),
        .gallery-slides .gallery-slide:nth-child(1) {
            background-color: var(--case-study-qa-framework) !important;
        }

        .card-grid .card.tall-card:nth-child(2),
        .gallery-slides .gallery-slide:nth-child(2) {
            background-color: var(--case-study-design-system) !important;
        }

        .card-grid .card.tall-card:nth-child(3),
        .gallery-slides .gallery-slide:nth-child(3) {
            background-color: var(--case-study-mobile-experience) !important;
        }

        .card-grid .card.tall-card:nth-child(4),
        .gallery-slides .gallery-slide:nth-child(4) {
            background-color: var(--case-study-ai-integration) !important;
        }

        /* Extra specificity for work cards to ensure colors are applied */
        #work .card-grid .card.tall-card:nth-child(1) {
            background-color: var(--case-study-qa-framework) !important;
        }

        #work .card-grid .card.tall-card:nth-child(2) {
            background-color: var(--case-study-design-system) !important;
        }

        #work .card-grid .card.tall-card:nth-child(3) {
            background-color: var(--case-study-mobile-experience) !important;
        }

        #work .card-grid .card.tall-card:nth-child(4) {
            background-color: var(--case-study-ai-integration) !important;
        }

        .card.featured {
            grid-column: 1 / -1;
            padding: 60px 40px;
        }

        .card.half-height {
            min-height: 200px;
        }

        .card.tall {
            min-height: 400px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .section-content {
                padding: 0 20px;
                box-sizing: border-box;
            }

            .section h2 {
                font-size: 36px;
                margin-bottom: 40px;
            }

            .card-grid.two-columns,
            .card-grid.three-columns,
            .card-grid.four-columns {
                grid-template-columns: 1fr;
            }

            .card.tall-card {
                min-height: 200px;
            }

            .card {
                padding: 24px;
            }

            .card.featured {
                padding: 40px 24px;
            }

            body {
                padding: 0;
            }

            #home {
                padding-top: 120px;
            }

        }

        /* Home section vertical layout */
        #home .section-content {
            display: flex;
            flex-direction: column;
        }

        #intro-column {
            width: 100%;
            margin-bottom: 40px;
        }

        #gallery-column {
            width: 100%;
            display: flex;
            justify-content: flex-end;
        }

        .gallery-wrapper {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Gallery card styles */
        .gallery-card {
            background-color: var(--card-bg-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            height: 60vh;
            width: 100%;
            will-change: transform, opacity;
        }

        .gallery-container {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }

        .gallery-slides {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .gallery-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            box-sizing: border-box;
            text-align: center;
            background-color: var(--card-bg-color);
            border-radius: 8px;
            transition: transform 0.6s ease-in-out, opacity 0.6s ease-in-out, z-index 0s linear 0.3s;
            transform-style: preserve-3d;
        }

        /* Simple card layout - no parallax */
        .gallery-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-start;
            padding: 20px;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }



        /* Active card - fully visible */
        .gallery-slide.active {
            opacity: 1;
            visibility: visible;
        }

        /* =============== Gallery Slide 3 Muppet Grid =============== */
        /* Scope strictly to slide 3 ONLY (do not affect tall-cards) */
        .gallery-slides .gallery-slide:nth-child(3) {
            overflow: hidden;
        }

        /* Hide default text/CTA on slide 3 to feature the grid */
        .gallery-slides .gallery-slide:nth-child(3) h3,
        .gallery-slides .gallery-slide:nth-child(3) p,
        .gallery-slides .gallery-slide:nth-child(3) .gallery-cta {
            display: none !important;
        }

        /* Grid container: 4 columns x 2 rows, flexible to container */
        .gallery-slides .gallery-slide:nth-child(3) .muppet-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 8px;
            width: 100%;
            height: 100%;
            align-content: stretch;
            justify-content: stretch;
        }

        /* Cells cut off content at edges (no overflow beyond dividers) */
        .gallery-slides .gallery-slide:nth-child(3) .muppet-cell {
            position: relative;
            overflow: hidden;
            border-radius: 6px;
            background: rgba(0,0,0,0.12);
            outline: 1px solid rgba(255,255,255,0.14);
            outline-offset: -1px;
        }
        /* Remove white outlines entirely for slide 3 grid cells */
        .gallery-slides .gallery-slide:nth-child(3) .muppet-cell {
            outline: none !important;
            outline-offset: 0 !important;
            border: none !important;
        }

        /* Content sits at the bottom and slides upward on reveal */
        .gallery-slides .gallery-slide:nth-child(3) .muppet-content {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            transform: translateY(110%);
            transform-origin: center bottom;
            will-change: transform;
            height: 100%;
			opacity: 0;
        }

        /* Media fit: allow images/gifs/mp4 to behave consistently */
        .gallery-slides .gallery-slide:nth-child(3) .muppet-content img,
        .gallery-slides .gallery-slide:nth-child(3) .muppet-content video {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
			object-position: center center;
        }

		/* Trampoline-like peek: single bounce then magnetic snap into place with fade-in */
        @keyframes muppetPopUp {
            0%   { transform: translateY(110%); opacity: 0; }
            35%  { opacity: 1; }
            55%  { transform: translateY(-7%); }
            100% { transform: translateY(0%); opacity: 1; }
        }

        /* Triggered only when slide 3 gets the .muppet-animate flag */
        .gallery-slides .gallery-slide:nth-child(3).muppet-animate .muppet-content {
            animation: muppetPopUp 800ms cubic-bezier(0.20, 0.75, 0.10, 1) both;
        }

        /* All cells animate together for a single smooth reveal */

        /* After first play, keep contents revealed without re-animating */
        .gallery-slides .gallery-slide:nth-child(3).muppet-played .muppet-content {
            transform: translateY(0%) !important;
			animation: none !important;
			opacity: 1 !important;
        }

		/* Responsive reduction of visible cells: 8 -> 4 -> 2 -> 1 */
		@media (max-width: 1024px) {
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid {
				grid-template-columns: repeat(2, 1fr);
				grid-template-rows: repeat(2, 1fr);
			}
			/* Show first 4 cells only */
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid .muppet-cell:nth-child(n+5) { display: none; }
		}

		@media (max-width: 680px) {
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid {
				grid-template-columns: repeat(2, 1fr);
				grid-template-rows: 1fr;
			}
			/* Show first 2 cells only */
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid .muppet-cell:nth-child(n+3) { display: none; }
		}

		@media (max-width: 420px) {
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid {
				grid-template-columns: 1fr;
				grid-template-rows: 1fr;
			}
			/* Show first 1 cell only */
			.gallery-slides .gallery-slide:nth-child(3) .muppet-grid .muppet-cell:nth-child(n+2) { display: none; }
		}

        /* Gallery slides use the CSS variables defined above for consistent theming */

        .gallery-slide h3 {
            color: var(--card-text-color);
            font-size: 28px;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .gallery-slide p {
            color: var(--card-text-color);
            font-size: 16px;
            line-height: 1.5;
            opacity: 0.8;
            max-width: 300px;
        }

        /* Force gallery headings and paragraph text to white in all viewports */
        .gallery-card .gallery-slide h3,
        .gallery-card .gallery-slide p {
            color: #ffffff !important;
            /* keep default hidden state; GSAP reveals on hover */
        }

        /* Work tall-cards: white text, hidden by default for hover animation */
        .card.tall-card h3,
        .card.tall-card p {
            color: #ffffff !important;
            opacity: 0; /* revealed on hover via GSAP */
            transform: translateX(-20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Tall-card background image fills card */
        .card.tall-card { position: relative; overflow: hidden; }
        .card.tall-card .card-bg {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center center;
            z-index: 0;
            pointer-events: none;
        }
        /* Lift content above background */
        .card.tall-card h3,
        .card.tall-card p,
        .card.tall-card .work-cta { position: relative; z-index: 1; }

        /* Ensure tall-card content is visible on mobile (no hover on touch) */
        @media (max-width: 768px) {
            .card.tall-card h3,
            .card.tall-card p { display: block !important; opacity: 1 !important; transform: none !important; }
            .card.tall-card .work-cta { opacity: 1 !important; transform: none !important; }
        }

        /* Desktop fallback: reveal on hover even if JS fails */
        @media (hover: hover) and (pointer: fine) {
            .card.tall-card:hover h3,
            .card.tall-card:hover p { opacity: 1; transform: none; }
            .card.tall-card:hover .work-cta { opacity: 1; }
        }

        /* Gallery arrow navigation */
        .gallery-arrows {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            opacity: 0;
            z-index: 20;
        }

        .gallery-card:hover .gallery-arrows {
            animation: arrowsDelayedEntry 0.3s ease forwards;
        }

        @keyframes arrowsDelayedEntry {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Prevent animation conflicts */
        .gallery-arrows {
            animation-fill-mode: both;
        }

        .gallery-card:not(:hover) .gallery-arrows {
            opacity: 0;
            animation: none;
        }

        .gallery-arrow {
            position: absolute;
            top: 20px;
            width: 116px;
            height: 48px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid rgba(240, 240, 240, 1);
            color: rgba(240, 240, 240, 1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease-in, border-color 0.2s ease-in, color 0.2s ease-in;
            pointer-events: auto;
            overflow: hidden;
            will-change: transform;
        }

        .gallery-arrow::before {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            background-color: currentColor;
            top: calc(50% - 0.5px);
            opacity: 0;
            transition: all 0.2s ease-in;
            will-change: width, opacity;
            border-radius: 0.5px;
        }

        .gallery-arrow svg {
            position: relative;
            z-index: 5;
            transition: transform 0.2s ease-in;
            will-change: transform;
            pointer-events: none;
            display: block;
        }

        .gallery-arrow:hover {
            background-color: rgba(240, 240, 240, 0.1);
            border-color: rgba(240, 240, 240, .6);
            color: rgba(240, 240, 240, .6);
        }

        /* Ensure stable hover area - prevent flickering */
        .gallery-arrow::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            z-index: 10;
            pointer-events: auto;
        }



        .gallery-arrow-left {
            left: 20px;
        }

        .gallery-arrow-left::before {
            left: 50%;
            transform-origin: left center;
        }

        .gallery-arrow-left:hover::before {
            width: 40px;
            opacity: 1;
            left: 34%;
        }

        .gallery-arrow-left:hover svg {
            transform: translateX(-12px);
        }

        .gallery-arrow-right {
            right: 20px;
        }

        .gallery-arrow-right::before {
            right: 50%;
            transform-origin: right center;
        }

        .gallery-arrow-right:hover::before {
            width: 40px;
            opacity: 1;
            right: 34%;
        }

        .gallery-arrow-right:hover svg {
            transform: translateX(12px);
        }

        /* Gallery card content styling */
        .gallery-slide h3 {
            font-family: 'Input', monospace;
            font-size: 12px;
            margin: 0 0 8px 0;
            font-weight: normal;
            color: var(--card-text-color);
            opacity: 0; /* hidden by default; revealed on hover via GSAP */
            transform: translateX(-20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .gallery-slide p {
            font-family: 'Input', monospace;
            font-size: 12px;
            margin: 0 0 16px 0;
            line-height: 1.4;
            color: var(--card-text-color);
            opacity: 0; /* hidden by default; revealed on hover via GSAP */
            transform: translateX(-20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            max-width: 350px; /* Expanded for better readability - allows 5-6 words per line */
        }

        /* Gallery CTA extends caption typography */
        .gallery-cta {
            font-family: 'Input', monospace;
            font-size: 12px; /* type-caption */
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(240, 240, 240, 1);
            color: rgba(240, 240, 240, 1);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease-in, border-color 0.2s ease-in, color 0.2s ease-in;
            opacity: 0;
            position: absolute;
            top: 44px; /* Arrow center: 20px (top) + 24px (half of 48px height) = 44px */
            left: 50%;
            transform: translate(-50%, -50%);
            will-change: transform;
            white-space: nowrap; /* Prevent text wrapping */
        }

		/* Match CTA height to gallery arrows on small viewports and ensure white description text */
		@media (max-width: 768px) {
			.gallery-card .gallery-cta.ui-btn {
				height: 48px;
				min-height: 48px;
				padding: 0 16px;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			.gallery-card .gallery-slide p { color: #ffffff !important; }
		}

        /* First card CTA starts in final position */
        .gallery-slide:first-child .gallery-cta {
            transform: translate(-50%, -50%);
            transition: background-color 0.2s ease-in, border-color 0.2s ease-in, color 0.2s ease-in, opacity 0.4s ease, transform 0.4s ease;
        }

        /* First card CTA gets offset when gallery is not hovered */
        .gallery-card:not(:hover) .gallery-slide:first-child .gallery-cta {
            transform: translate(-50%, -50%) translateY(-10px);
        }

        /* Cards 2-4 are static but fade with hover */
        .gallery-slide:not(:first-child) .gallery-cta {
            opacity: 0;
            transform: translate(-50%, -50%);
            transition: background-color 0.2s ease-in, border-color 0.2s ease-in, color 0.2s ease-in, opacity 0.3s ease;
        }

        .gallery-cta:hover {
            background: transparent;
            border: 1px solid rgba(240, 240, 240, 1);
            color: rgba(240, 240, 240, 1);
        }

        /* Global overlay CTA that always sits above the gallery card */
        .gallery-global-cta {
            position: absolute;
            top: 44px;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30; /* above arrows (z-index:20) and slide content */
            font-family: 'Input', monospace;
            font-size: 12px;
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(240, 240, 240, 1);
            color: rgba(240, 240, 240, 1);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease-in, border-color 0.2s ease-in, color 0.2s ease-in;
            white-space: nowrap;
        }

        .gallery-global-cta:hover {
            background-color: rgba(240, 240, 240, 0.25);
            border-color: rgba(240, 240, 240, .6);
            color: rgba(240, 240, 240, .8);
        }

        .gallery-global-cta.is-disabled {
            opacity: 0.6;
            cursor: default;
            pointer-events: none;
        }

        /* Work section CTA styling - extends caption typography */
        .work-cta {
            font-family: 'Input', monospace;
            font-size: 12px; /* type-caption */
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.24);
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in;
            opacity: 0;
            margin-top: 16px;
            align-self: flex-start;
            will-change: transform;
            white-space: nowrap; /* Prevent text wrapping */
        }

        .work-cta:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.6);
            color: rgba(255, 255, 255, 1);
        }

        /* Archive: search + layout */
        .search-container {
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
        }

        .search-field {
            position: relative;
            width: 100%;
            margin-bottom: 12px;
        }

        .search-input {
            width: 100%;
            height: 44px;
            padding: 0 48px 0 14px; /* room for button */
            border-radius: 10px;
            border: 1px solid var(--toggle-border-color);
            background: transparent;
            color: var(--text-color);
            font-family: 'Input', monospace;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
        }






        .search-input::placeholder {
            color: var(--secondary-text-color);
        }

        .search-input:focus {
            border-color: var(--text-color);
            background-color: var(--nav-hover-color);
        }

        .search-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .archive-grid {
            margin-top: 12px;
        }

        .search-button {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: var(--secondary-text-color);
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .search-button:hover {
            background-color: var(--nav-hover-color);
            color: var(--text-color);
        }

        

        .suggestion-tag {
            padding: 8px 16px;
            border: 1px solid var(--toggle-border-color);
            border-radius: 20px;
            background: transparent;
            color: var(--secondary-text-color);
            font-family: 'Input', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-tag:hover {
            border-color: var(--text-color);
            color: var(--text-color);
            background-color: var(--nav-hover-color);
        }

        /* Mobile adjustments for search */
        @media (max-width: 768px) {
            .search-container {
                max-width: 100%;
                padding: 0 20px;
            }

            

            .search-button {
                width: 36px;
                height: 36px;
                right: 6px;
            }

            .suggestion-tag {
                font-size: 11px;
                padding: 6px 12px;
            }
        }

        /* Contact section styling */
        #contact {
            border-top: 1px solid var(--border);
            /* More white space above divider to separate from Work cards */
            margin-top: 160px;
            /* Tighter space between divider and Contact title */
            padding-top: 24px;
            /* Much more room at the bottom */
            padding-bottom: 200px;
            margin-bottom: 160px;
        }
        .contact-container {
            display: flex;
            justify-content: center;
            align-items: start;
            opacity: 0;
            transform: translateY(30px);
            will-change: transform, opacity;
            margin-bottom: 60px;
        }

        .contact-form-card {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 60px;
            width: 100%;
            max-width: 1000px;
            box-sizing: border-box;
            border: 1px solid var(--toggle-border-color);
        }

/* Dark mode removed */



        .contact-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 36px;
            align-items: stretch; /* allow spanning item to fill rows */
        }

        /* Explicit grid placement for contact fields */
        #contact .contact-name { grid-column: 1; grid-row: 1; }
        #contact .contact-email { grid-column: 2; grid-row: 1; }
        #contact .contact-message { grid-column: 1 / span 2; grid-row: 2; }
        #contact .contact-submit { grid-column: 3; grid-row: 1 / span 2; display: flex; }
        #contact .contact-submit .submit-button { width: 100%; height: 100%; min-height: 0; }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Form label extends caption typography */
        .form-group label {
            font-family: 'Input', monospace;
            font-size: 12px; /* type-caption */
            color: var(--text-color);
            font-weight: 500;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"] {
            width: 100%;
            height: 48px;
            padding: 12px 16px;
            border: 1px solid var(--toggle-border-color);
            border-radius: 8px;
            background-color: #FFFFFF;
            color: var(--text-color);
            font-family: 'Unica77LL', Arial, sans-serif;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
            box-sizing: border-box;
        }

        .form-group input::placeholder {
            color: var(--secondary-text-color);
        }

        .form-group input:hover {

        }

        .form-group input:focus {
            border-color: var(--text-color);
            box-shadow: 0 0 0 1px var(--text-color);
            background-color: #FFFFFF;
        }

/* Dark mode removed */

        /* dark mode removed */



        /* Drag-to-send toggle styling */
        .send-toggle-container {
            margin-top: 24px;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .send-toggle-track {
            position: relative;
            width: 200px;
            height: 100px;
            background: rgba(250, 250, 250, 1);
            border-radius: 80px;
            border: 1px solid var(--toggle-border-color);
            box-shadow: inset -2px 4px 4px rgb(59 58 58 / 5%), inset 7px 4px 4px rgb(65 65 65 / 5%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }



        .send-toggle-thumb {
            position: absolute;
            left: 0; /* Will be positioned by JavaScript */
            top: calc((100% - 76px) / 2); /* Always vertically centered */
            width: 76px;
            height: 76px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            box-shadow: 
            4px 2px 8px rgba(0, 0, 0, 0.15), 
            0px 4px 8px rgba(0, 0, 0, 0.1), 
            inset 6px 2px 0 rgba(255, 255, 255, 0.8), 
            inset -1px -1px 0 rgba(0, 0, 0, 0.05);
            color: var(--secondary-text-color);
            border: 0.5px solid rgba(0, 0, 0, 0.08);
        }

        .send-toggle-thumb:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .send-toggle-thumb.active {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%);
            box-shadow: 
            4px 2px 8px rgba(0, 0, 0, 0.15), 
            0px 4px 8px rgba(0, 0, 0, 0.1), 
            inset 6px 2px 0 rgba(255, 255, 255, 0.8), 
            inset -1px -1px 0 rgba(0, 0, 0, 0.05);
            border: 0.5px solid rgba(0, 0, 0, 0.08);
        }

        .send-toggle-text {
            font-family: 'Input', monospace;
            font-size: 13px;
            color: var(--text-color);
            user-select: none;
            pointer-events: none;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .send-toggle-track.sending .send-toggle-text {
            opacity: 0;
        }



        /* dark mode removed */



        .canvas-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        #drawing-canvas,
        #drawing-canvas-desktop {
            background-color: white;
            border-radius: 8px;
            border: 1px solid var(--toggle-border-color);
            cursor: url("data:image/svg+xml,%3csvg width='18' height='18' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M14.5 1.5l2 2-10 10-3 1 1-3 10-10z' fill='none' stroke='%23555' stroke-width='1' stroke-linecap='round' stroke-linejoin='round'/%3e%3cpath d='M11.5 4.5l2 2' stroke='%23555' stroke-width='1' stroke-linecap='round'/%3e%3cpath d='M2.5 16.5h2' stroke='%23333' stroke-width='1.5' stroke-linecap='round'/%3e%3c/svg%3e") 2 16, crosshair;
            transition: border-color 0.3s ease;
            position: relative;
        }

        #drawing-canvas {
            width: 320px;
            max-width: 100%;
            height: 200px;
        }

        #drawing-canvas-desktop {
            width: 280px;
            height: 280px;
        }

        #drawing-canvas:focus,
        #drawing-canvas-desktop:focus {
            border-color: var(--text-color);
            outline: none;
        }

        .canvas-controls {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 10;
        }

        .trash-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            pointer-events: auto;
        }

        .brush-controls {
            position: absolute;
            bottom: 8px;
            right: 8px;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: 160px;
            padding: 12px 4px;
            border: 1px solid var(--toggle-border-color);
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.95);
            transition: all 0.2s ease;
            cursor: default;
        }

        .brush-controls:hover,
        .brush-controls:active {
            background-color: rgba(240, 240, 240, 0.4);
            border-color: var(--text-color);
        }

        /* dark mode removed */

        .trash-btn {
            width: 32px;
            height: 32px;
            padding: 8px;
            border: 1px solid var(--toggle-border-color);
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.95);
            color: var(--secondary-text-color);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trash-btn:hover {
            background-color: rgba(240, 240, 240, 0.4);
            border-color: var(--text-color);
            color: var(--text-color);
        }

/* Dark mode removed */

/* Dark mode removed */



        .brush-slider.vertical {
            width: 3px;
            height: 160px;
            background: var(--toggle-border-color);
            border-radius: 2px;
            outline: none;
            border: none;
            cursor: pointer;
            writing-mode: bt-lr; /* IE */
            -webkit-appearance: slider-vertical; /* WebKit */
            appearance: slider-vertical;
        }

        .brush-slider.vertical:focus {
            outline: none;
            box-shadow: none;
        }

        .brush-slider.vertical::-webkit-slider-thumb {
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--text-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .brush-slider.vertical::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--text-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .brush-label {
            font-family: 'Input', monospace;
            padding: 8px 0px 0px 0px;
            font-size: 9px;
            color: var(--secondary-text-color);
            white-space: nowrap;
            writing-mode: horizontal-tb;
        }

        /* Canvas form group styling */

        .canvas-form-group label {
            font-family: 'Input', monospace;
            font-size: 12px;
            color: var(--text-color);
            font-weight: 500;
            display: block;
        }

        .canvas-form-group .canvas-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        /* Canvas visibility controls */
        .canvas-form-group {
            display: none; /* Hidden on desktop */
        }

        .desktop-canvas-field {
            display: block; /* Shown on desktop */
        }

        /* Hide mobile toggle container on desktop */
        .mobile-toggle-container {
            display: none;
        }

        /* Show desktop toggle container on desktop */
        .desktop-toggle-container {
            display: block;
        }

        /* Form column styling */
        .form-inputs-column {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .canvas-column {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .toggle-column {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* Desktop canvas field styling */
        .desktop-canvas-field {
            margin-bottom: 0;
        }

        .desktop-canvas-field label {
            font-family: 'Input', monospace;
            font-size: 12px;
            color: var(--text-color);
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }

        .desktop-canvas-field .canvas-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }

        /* Mobile adjustments for contact */
        @media (max-width: 768px) {
            /* Show canvas form group on mobile */
            .canvas-form-group {
                display: block !important;
                width: 100%;
            }

            .contact-container {
                grid-template-columns: 1fr;
                gap: 0;
                display: block;
                margin-bottom: 60px;
            }

            .contact-form-card {
                padding: 40px 24px;
                margin: 0;
                border-radius: 12px;
                width: 100%;
                box-sizing: border-box;
            }

            /* Mobile form layout - single column (restore original) */
            .contact-form {
                display: flex;
                flex-direction: column;
                gap: 27px;
            }

            /* Hide desktop columns on mobile */
            .canvas-column {
                display: none;
            }

            .toggle-column {
                display: none;
            }
            
            .form-inputs-column {
                display: contents;
            }

            /* Full width input fields on mobile */
            .contact-form-card .form-group {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
            }

            .contact-form-card .form-group input {
                width: 100% !important;
                max-width: none !important;
                box-sizing: border-box;
            }
            
            /* Ensure form inputs column takes full width */
            .form-inputs-column {
                width: 100%;
            }

            .send-toggle-container {
                margin-top: 20px;
            }

            .send-toggle-track {
                width: 100%;
                max-width: 200px;
                height: 100px;
            }

            .send-toggle-thumb {
                width: 76px;
                height: 76px;
                left: 0; /* Will be positioned by JavaScript */
                top: calc((100% - 76px) / 2); /* Maintain vertical centering on mobile */
            }

            .send-toggle-text {
                font-size: 12px;
            }

            /* Hide desktop canvas on mobile */
            .desktop-canvas-field {
                display: none;
            }

            /* Hide desktop toggle container on mobile, show mobile toggle */
            .desktop-toggle-container {
                display: none !important;
            }

            .mobile-toggle-container {
                display: block !important;
                width: 100%;
                margin-top: 20px;
            }

            /* Mobile canvas styling */
            .canvas-form-group #drawing-canvas {
                width: 100%;
                height: 180px;
            }

            .canvas-form-group .canvas-container {
                align-items: flex-start;
                width: 100%;
                margin-top: 8px;
            }

            .canvas-form-group .canvas-controls {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                pointer-events: none;
                z-index: 10;
            }

            .canvas-form-group .trash-btn {
                position: absolute;
                top: 8px;
                right: 8px;
                pointer-events: auto;
            }

            .canvas-form-group .brush-controls {
                position: absolute;
                bottom: 8px;
                right: 8px;
                pointer-events: auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: space-between;
                width: 32px;
                height: 80px;
                padding: 8px 0;
                border: 1px solid var(--toggle-border-color);
                border-radius: 6px;
                background-color: rgba(255, 255, 255, 0.95);
                transition: all 0.2s ease;
                cursor: default;
            }

            .canvas-form-group .brush-controls:hover,
            .canvas-form-group .brush-controls:active {
                background-color: rgba(240, 240, 240, 0.4);
                border-color: var(--text-color);
            }

            .canvas-form-group .brush-slider.vertical {
                width: 3px !important;
                height: 60px;
                background: var(--toggle-border-color);
                border-radius: 2px;
                outline: none;
                border: none;
                cursor: pointer;
                writing-mode: bt-lr;
                -webkit-appearance: slider-vertical;
                appearance: slider-vertical;
            }

            .canvas-form-group .brush-slider.vertical:focus {
                outline: none;
                box-shadow: none;
            }

            .canvas-form-group .brush-slider.vertical::-webkit-slider-thumb {
                appearance: none;
                width: 12px;
                height: 12px;
                background: var(--text-color);
                border-radius: 50%;
                cursor: pointer;
            }

            .canvas-form-group .brush-slider.vertical::-moz-range-thumb {
                width: 12px;
                height: 12px;
                background: var(--text-color);
                border-radius: 50%;
                cursor: pointer;
                border: none;
            }

            .canvas-form-group .brush-label {
                font-size: 8px;
            }

            /* dark mode removed */
        }

        /* Desktop hover animation */
        @media (min-width: 769px) {
            /* Desktop CTA dimensions - width adjusted for text */
            .gallery-cta {
                width: 180px; /* Increased width to fit "Explore project" on one line */
                height: 48px; /* Match arrow icon height */
                padding: 14px 16px; /* Adjusted padding to match 48px height */
                display: flex;
                align-items: center;
                justify-content: center;
                white-space: nowrap; /* Prevent text wrapping */
            }

            .gallery-card:hover .gallery-slide.active h3 {
                opacity: 1;
                transform: translateX(0);
            }

            .gallery-card:hover .gallery-slide.active p {
                opacity: 0.8;
                transform: translateX(0);
            }

            /* First card CTA: movement + fade animation */
            .gallery-card:hover .gallery-slide.active:first-child .gallery-cta {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            /* Other cards CTA: fade in on hover (static position) */
            .gallery-card:hover .gallery-slide.active:not(:first-child) .gallery-cta {
                opacity: 1;
            }
        }

        /* Hide per-slide CTAs; use global overlay CTA instead */
        .gallery-slide .gallery-cta { display: none !important; }
        .gallery-slide.active .gallery-cta { display: none !important; }

        /* Mobile adjustments - hide text but show CTA */
        @media (max-width: 768px) {
            .gallery-slide h3,
            .gallery-slide p {
                display: none; /* Hide text on mobile */
            }
            
            /* Gallery CTA mobile sizing and positioning */
            .gallery-cta {
                padding: 0 18px !important;
                top: 20px; /* Align with arrows top */
                height: 36px !important;
                min-height: 36px !important;
                display: inline-flex;
                align-items: center;
            }

            /* First card uses same base position - translateY handles the offset */
            
            /* Mobile hover states for gallery */
            /* First card CTA: movement + fade animation */
            .gallery-card:hover .gallery-slide.active:first-child .gallery-cta {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            /* Other cards CTA: fade in on hover (static position) */
            .gallery-card:hover .gallery-slide.active:not(:first-child) .gallery-cta {
                opacity: 1;
            }
            
            /* Adjust arrow size on mobile to match CTA height */
            .gallery-arrow {
                width: 80px; /* Reduced from 116px */
                height: 36px; /* Match actual CTA rendered height */
                display: inline-flex; align-items: center; justify-content: center;
            }
            
            /* Smaller chevron icons for mobile arrows */
            .gallery-arrow svg {
                width: 32px; /* Reduced from 48px */
                height: 32px; /* Reduced from 48px */
            }

            /* Ensure global CTA matches arrow height on mobile */
            .gallery-global-cta {
                position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
                height: 36px !important;
                min-height: 36px !important;
                padding: 0 18px !important;
                display: inline-flex;
                align-items: center;
            }
            
            /* Adjust line positioning for mobile width */
            .gallery-arrow-left:hover::before {
                left: 30%; /* Closer connection for narrower button */
            }
            
            .gallery-arrow-right:hover::before {
                right: 30%; /* Closer connection for narrower button */
            }
        }



        /* Gallery drag/slide functionality */
        .gallery-container {
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
            touch-action: pan-y; /* allow vertical scrolling; keep horizontal for swipe */
        }

        .gallery-container:active {
            cursor: grabbing;
        }

        .gallery-slides {
            will-change: transform;
        }
        /* Prevent native media drag interfering with swipe */
        .gallery-slide img,
        .gallery-slide video {
            -webkit-user-drag: none;
            user-drag: none;
            -webkit-touch-callout: none;
        }

        /* Ensure background video fills and stays behind content */
        .gallery-card { position: relative; overflow: hidden; }
        .gallery-bg-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; pointer-events: none; }
        /* Consistent control button height across viewports */
        .gallery-arrow,
        .gallery-global-cta,
        .gallery-cta { height: 36px; min-height: 36px; display: inline-flex; align-items: center; justify-content: center; box-sizing: border-box; }
        /* Ensure background video fits within the slide/card bounds */
        .gallery-slide .gallery-bg-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; }
        /* Ensure active slide stacks above others and only its video is visible */
        .gallery-slide { z-index: 0; }
        .gallery-slide.active { z-index: 2; }
        .gallery-slide:not(.active) .gallery-bg-video { opacity: 0; }
        .gallery-slide.active .gallery-bg-video { opacity: 1; }
        /* Slide 2: keep content padding; ensure background video fills the container */
        .gallery-slides .gallery-slide:nth-child(2) { padding: 20px !important; overflow: hidden; }
        .gallery-slides .gallery-slide:nth-child(2) .gallery-bg-video { left: 0; right: 0; top: 0; bottom: 0; width: 100%; height: 100%; object-fit: cover; }
        .gallery-card .gallery-container,
        .gallery-card .gallery-slides { position: relative; z-index: 1; background: transparent !important; }
        /* Keep each slide absolutely stacked within the card */
        .gallery-card .gallery-slide { position: absolute; inset: 0; z-index: 1; background: transparent !important; }
        /* keep background video below content but above card background */
        .gallery-bg-video { z-index: 0; }

        /* Mobile responsiveness for home layout */
        @media (max-width: 768px) {
            #intro-column {
                margin-bottom: 60px;
            }

            #intro-description {
                white-space: pre-line;
            }

            #gallery-column {
                justify-content: center;
            }

            .gallery-card {
                height: 50vh;
            }

            .gallery-slide {
                padding: 30px 20px;
            }

            .gallery-slide h3 {
                font-size: 24px;
            }

            .gallery-slide p {
                font-size: 14px;
            }

            /* Work tall-cards: ensure CTA aligns with content padding on mobile */
            #work .card.tall-card {
                padding: 20px; /* match slide/content padding */
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            #work .card.tall-card h3,
            #work .card.tall-card p { margin: 0; }
            #work .card.tall-card .work-cta.ui-btn[data-variant="b4"] {
                height: 36px !important;
                min-height: 36px !important;
                padding: 0 16px !important; /* align with card padding rhythm */
                display: inline-flex;
                align-items: center;
                justify-content: center;
                position: static !important; /* ensure it sits in normal flow */
                inset: auto !important;
                align-self: flex-start; /* keep within content column, not full width */
                max-width: 100%;
                box-sizing: border-box;
            }
        }

        /* Archive grid layout: 6 columns; search spans centered 4 columns */
        /* Work cards: ensure CTAs fit within card bounds and align padding */
        #work .card.tall-card { position: relative; padding: 20px; box-sizing: border-box; }
        #work .card.tall-card .work-cta.ui-btn[data-variant="b4"] {
            height: 36px !important;
            min-height: 36px !important;
            padding: 0 16px !important;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            max-width: 100%;
            box-sizing: border-box;
        }
        #archive .section-content {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 20px;
            align-items: start;
            padding: 0; /* remove side padding so gallery-archive fills full width */
        }
        #archive .section-title {
            grid-column: 1 / -1; /* span full grid */
            justify-self: start; /* left-align title */
            margin-left: 40px; /* align with global section padding */
            margin-bottom: 0;
        }
        #archive #archive-search-mount {
            grid-column: 2 / span 4; /* columns 2 through 5 */
            justify-self: center;
            width: 100%;
        }
        /* Ensure inserted custom element spans full grid width in legacy archive sections */
        #archive .section-content > gallery-archive,
        #archive-new .section-content > gallery-archive {
            grid-column: 1 / -1 !important;
            justify-self: stretch !important;
            width: 100% !important;
        }
        /* archive-new and archive-v2 removed */

        /* Fully standalone archive container (no grid parents) */
        #archive-standalone {
            width: 100%;
            display: block;
            margin: 40px 0;
        }
        #archive-standalone-container {
            width: 100% !important;
            max-width: none !important;
            margin: 0 auto;
            padding: 0 40px; /* match section padding */
            box-sizing: border-box;
            display: block;
            min-height: 100px;
        }
        #archive-standalone-container > * {
            display: block !important;
            width: 100% !important;
            max-width: none !important;
        }
        /* Contact overrides - scoped to #contact to avoid global collisions */
        #contact .contact-container {
            display: block;
            max-width: 800px;
            margin: 0; /* left-align to section title */
            opacity: 1;
            transform: none;
            margin-bottom: 60px;
        }
        #contact .contact-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto;
            column-gap: 36px;
            row-gap: 28px;
            align-items: stretch; /* allow spanning item to fill rows */
            justify-items: stretch;
            border-top: 1px solid var(--border-color);
        }
        /* Grid placement */
        #contact .contact-name { grid-column: 1; grid-row: 1; }
        #contact .contact-email { grid-column: 2; grid-row: 1; }
        #contact .contact-message { grid-column: 1 / span 2; grid-row: 2; }
        #contact .contact-submit { grid-column: 3; grid-row: 1 / span 2; display: flex; }
        #contact .contact-submit .submit-button { width: 100%; height: 100%; min-height: 0; }
        #contact .form-row { display: contents; }
        /* form-group removed: grid spans handled by .ui-input */
        #contact .contact-form .ui-input.full-width { grid-column: 1 / -1; }
        #contact .form-field { position: relative; width: 100%; display: block; }
        /* Hugging label + field (chip variant)  exactly as component */
        #contact .ui-input { display: block; width: 100%; min-width: 0; box-sizing: border-box; color: var(--ui-text); justify-self: stretch; }
        #contact .ui-input .ui-field { width: 100%; box-sizing: border-box; }
        #contact .ui-field input, #contact .ui-field textarea { appearance: none; border: 0; outline: 0; background: transparent; width: 100%; color: inherit; font: inherit; line-height: inherit; }
        #contact .ui-field input::placeholder, #contact .ui-field textarea::placeholder { color: #838383; }
        #contact .ui-input[data-variant="chip"] .ui-label {
          display: block; width: fit-content; padding: 2px 8px; background: var(--ui-bg);
          border-top: 1px solid var(--ui-border); border-right: 1px solid var(--ui-border); border-left: 1px solid var(--ui-border); border-bottom: none;
          border-radius: 4px 4px 0 0; font-size: 10px; font-weight: 400; margin: 0 0 -1px 0;
        }
        #contact .ui-input[data-variant="chip"] .ui-field {
          display: block; width: 100%; padding: 12px 8px; border: 1px solid var(--ui-border); border-radius: 0 0 4px 4px; background: var(--ui-bg);
          font-size: 14px; line-height: 16px; font-weight: 400;
          transition: background var(--motion-ms) var(--ease-smooth), border-color var(--motion-ms) var(--ease-smooth), box-shadow var(--motion-ms) var(--ease-smooth);
        }
        #contact .ui-input[data-variant="chip"] .ui-field:hover { background: var(--ui-active-bg); }
        #contact .ui-input[data-variant="chip"] .ui-field:focus-within { border-color: var(--ui-active-border); background: var(--ui-active-bg); }
        /* Inputs inside chip fields are borderless */
        #contact .form-field input, #contact .form-field textarea {
            width: 100%; padding: 0; background: transparent; color: var(--ui-text);
            border: none; border-radius: 0; font-family: 'Unica77LL', Arial, sans-serif; font-size: 16px; outline: none; resize: none; box-sizing: border-box;
        }
        #contact .form-field input { height: 24px; }
        #contact .form-field textarea { min-height: 140px; padding-top: 2px; resize: vertical; overflow: auto; }
        #contact .form-field input::placeholder, #contact .form-field textarea::placeholder { color: var(--text-muted); transition: opacity .2s ease; }
        #contact .form-label { display: none; }
        #contact .form-field input:focus, #contact .form-field textarea:focus {
            background: var(--surface-color);
            border-color: var(--border-focus);
        }
        #contact .form-field input:focus::placeholder, #contact .form-field textarea:focus::placeholder { opacity: 0; }
        #contact .submit-group { grid-column: 1 / -1; border-bottom: none; position: relative; overflow: hidden; }
        /* Ensure the submit CTA is in column 3 spanning both rows and fills height */
        #contact .submit-group.contact-submit { grid-column: 3; grid-row: 1 / span 2; display: flex; align-items: stretch; height: 100%; align-self: stretch; }
        #contact .submit-group.contact-submit .submit-button { width: 100%; height: 100% !important; min-height: 0 !important; }
        #contact .submit-button.ui-btn[data-variant="b1"] {
            width: 100%;
            height: 56px;
            min-height: 56px;
            border-radius: 6px;
            font-size: 16px;
            letter-spacing: 0.5px;
        }
        /* Align submit button styling to search bar behavior */
        #contact .submit-button.ui-btn {
            background: rgba(162,230,51,0.15) !important;
            color: var(--ui-text) !important;
            border: 1px solid var(--btn-lime-border, #A2E633) !important;
            transition: background 300ms cubic-bezier(0.4, 0, 0.2, 1), border-color 300ms cubic-bezier(0.4, 0, 0.2, 1), color 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        #contact .submit-button.ui-btn:hover,
        #contact .submit-button.ui-btn:focus-visible {
            background: rgba(162,230,51,0.25) !important;
            border-color: var(--btn-lime-border, #A2E633) !important;
        }
        #contact .submit-button.ui-btn[aria-pressed="true"],
        #contact .submit-button.ui-btn:active {
            background: rgba(162,230,51,0.25) !important;
            border-color: var(--btn-lime-border, #A2E633) !important;
        }
        /* form-group removed */
        @media (max-width: 768px) {
            #contact .contact-container { max-width: none; }
            #contact .contact-form {
                grid-template-columns: 1fr;
                column-gap: 0;
                row-gap: 16px;
            }
            /* Reset grid placement for single-column layout */
            #contact .contact-name,
            #contact .contact-email,
            #contact .contact-message,
            #contact .contact-submit { grid-column: 1; grid-row: auto; }
            #contact .submit-group.contact-submit { grid-column: 1; grid-row: auto; }
            #contact .contact-submit { align-self: stretch; height: auto; margin-top: 12px; }
            #contact .submit-button { width: 100%; min-height: 48px; height: auto; padding: 16px; }
            /* Compact field padding on mobile while keeping full width */
            #contact .form-field input, #contact .form-field textarea { padding: 16px 14px; }
            #contact .form-label { left: 14px; top: 16px; }
            /* Reduce large vertical gap by removing enforced min-height on Archive section */
            #archive.section { min-height: auto !important; }
        }
        #contact .form-success { padding: 40px 20px; text-align: center; border: 1px solid var(--border-color); background: rgba(255,255,255,0.5); border-radius: 12px; margin-top: 16px; }
        #contact .form-success h3 { margin: 0 0 12px 0; font-family: 'Unica77LL', Helvetica, sans-serif; font-size: 18px; font-weight: 500; }
        #contact .form-success p { margin: 0; color: var(--secondary-text-color); font-size: 14px; }
        #contact .hidden { display: none; }

        /* Design System: Buttons (light mode only) */
        :root {
            --ui-border: #D9D9D9;
            --ui-text: #000810;
            --ui-bg: var(--white);
            --ui-active-border: var(--lime-border);
            --ui-active-bg: rgba(162,230,51,0.05);
            --ui-alt-active-border: #000810;
            --ui-alt-active-bg: rgba(0,8,16,0.03);
            --ui-error-border: #710C0E;
            --ui-error-bg: rgba(113,12,14,0.05);
            --motion-ms: 1000ms;
            --ease-smooth: cubic-bezier(.2,.7,.2,1);
            --btn-dark: #000810;
            --btn-lime: #A2E633;
            --btn-lime-border: var(--lime-border);
            --btn-gray: #9C9C9C;
            --btn-gray-bg: #F0F0F0;
            --btn-lime-40: rgba(162,230,51,0.40);
            --btn-white: var(--white);
        }

/* Dark mode removed: always apply light styles */
.ui-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 36px;
            padding: 0 20px;
            border-radius: 6px;
            border: 1px solid transparent;
            font-family: 'Unica77LL', Helvetica, sans-serif;
            font-size: 14px;
            line-height: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background var(--motion-ms) var(--ease-smooth), border-color var(--motion-ms) var(--ease-smooth), color var(--motion-ms) var(--ease-smooth), box-shadow var(--motion-ms) var(--ease-smooth);
        }
        .ui-btn.pill { border-radius: 999px; }
        /* B1 */
        .ui-btn[data-variant="b1"] { background: var(--btn-lime-40) !important; border-color: var(--btn-lime-border) !important; color: var(--ui-text) !important; }
        .ui-btn[data-variant="b1"]:hover { background: var(--btn-lime) !important; border-color: var(--btn-lime-border) !important; }
        .ui-btn[data-variant="b1"][aria-pressed="true"] { background: var(--btn-dark) !important; border-color: var(--btn-dark) !important; color: var(--btn-white) !important; }
        /* B2 */
        .ui-btn[data-variant="b2"] { background: var(--btn-lime-40) !important; border-color: var(--btn-lime-border) !important; color: var(--ui-text) !important; }
        .ui-btn[data-variant="b2"]:hover { background: var(--btn-lime-40) !important; border-color: var(--btn-lime-border) !important; }
        .ui-btn[data-variant="b2"][aria-pressed="true"] { background: var(--btn-lime) !important; border-color: var(--btn-lime-border) !important; color: var(--ui-text) !important; }
        /* B4 */
        .ui-btn[data-variant="b4"] {     background: rgba(240, 240, 240, 0.1); border: 1px solid rgba(240, 240, 240, 1);   color: rgba(240, 240, 240, 1); width: auto; height: 36px; }
        .ui-btn[data-variant="b4"]:hover { background-color: rgba(240, 240, 240, 0.25); border-color: rgba(240, 240, 240, .6); color: rgba(240, 240, 240, .8); }
        .ui-btn[data-variant="b4"][aria-pressed="true"] { background: var(--btn-dark) !important; border-color: var(--btn-dark) !important; color: var(--btn-white) !important; }
        /* B5 */
        .ui-btn.pill[data-variant="b5"] { background: var(--btn-white) !important; border-color: var(--btn-gray) !important; color: #777 !important; }
        .ui-btn.pill[data-variant="b5"]:hover { background: var(--btn-white) !important; border-color: var(--btn-gray) !important; }
        .ui-btn.pill[data-variant="b5"][aria-pressed="true"] { background: var(--btn-dark) !important; border-color: var(--btn-dark) !important; color: var(--btn-white) !important; }
        /* B6 */
        .ui-btn.pill[data-variant="b6"] { background: var(--btn-white) !important; border-color: var(--btn-gray) !important; color: #777 !important; }
        .ui-btn.pill[data-variant="b6"]:hover { background: var(--btn-dark) !important; border-color: var(--btn-dark) !important; color: var(--btn-white) !important; }

        /* Standardized Input Component (Default, Alt Active, Chip) */
        .ui-input { display: inline-block; width: 100%; color: var(--ui-text); }
        .ui-field input, .ui-field textarea { appearance: none; border: 0; outline: 0; background: transparent; width: 100%; color: inherit; font: inherit; line-height: inherit; }
        .ui-field input::placeholder, .ui-field textarea::placeholder { color: #838383; }

        /* Default + Alt Active label */
        .ui-input[data-variant="default"] .ui-label,
        .ui-input[data-variant="alt-active"] .ui-label {
          display: block; width: 100%; padding: 2px 8px; border-radius: 4px 4px 0 0;
          border-top: 1px solid var(--ui-border); border-right: 1px solid var(--ui-border); border-left: 1px solid var(--ui-border); border-bottom: none;
          background: var(--ui-bg); font-size: 10px; font-weight: 400; text-transform: uppercase; letter-spacing: 0.08em;
        }
        /* Default + Alt Active field */
        .ui-input[data-variant="default"] .ui-field,
        .ui-input[data-variant="alt-active"] .ui-field {
          display: block; width: 100%; padding: 12px 8px; border: 1px solid var(--ui-border); border-radius: 0 0 4px 4px; background: var(--ui-bg);
          font-size: 14px; font-weight: 400;
          transition: background var(--motion-ms) var(--ease-smooth), border-color var(--motion-ms) var(--ease-smooth), box-shadow var(--motion-ms) var(--ease-smooth);
        }
        .ui-input[data-variant="default"] .ui-field:hover { background: var(--ui-active-bg); }
        .ui-input[data-variant="default"] .ui-field:focus-within { border-color: var(--ui-active-border); background: var(--ui-active-bg); }
        .ui-input[data-variant="alt-active"] .ui-field:hover { background: var(--ui-alt-active-bg); }
        .ui-input[data-variant="alt-active"] .ui-field:focus-within { border-color: var(--ui-alt-active-border); background: var(--ui-alt-active-bg); }

        /* Chip (hugging) */
        .ui-input[data-variant="chip"] .ui-label {
          display: block; width: fit-content; padding: 2px 8px; background: var(--ui-bg);
          border-top: 1px solid var(--ui-border); border-right: 1px solid var(--ui-border); border-left: 1px solid var(--ui-border); border-bottom: none;
          border-radius: 4px 4px 0 0; font-size: 10px; font-weight: 400; margin: 0 0 -1px 0; text-transform: uppercase; letter-spacing: 0.08em;
        }
        .ui-input[data-variant="chip"] .ui-field {
          display: block; width: 100%; padding: 12px 8px; border: 1px solid var(--ui-border); border-radius: 0 0 4px 4px; background: var(--ui-bg);
          font-size: 14px; line-height: 16px; font-weight: 400;
          transition: background var(--motion-ms) var(--ease-smooth), border-color var(--motion-ms) var(--ease-smooth), box-shadow var(--motion-ms) var(--ease-smooth);
        }
        .ui-input[data-variant="chip"] .ui-field:hover { background: var(--ui-active-bg); }
        .ui-input[data-variant="chip"] .ui-field:focus-within { border-color: var(--ui-active-border); background: var(--ui-active-bg); }

        /* Error state */
        .ui-input[data-state="error"] .ui-field { border-color: var(--ui-error-border); background: var(--ui-error-bg); }
        .ui-input[data-state="error"][data-variant="chip"] .ui-label { border-color: var(--ui-error-border); }
    </style>
</head>
<body>
    <!-- Simple page preloader -->
    <div id="preloader" style="position:fixed;inset:0;z-index:9999;background:var(--bg-color,#ffffff);display:flex;align-items:center;justify-content:center;opacity:1;transition:opacity .4s ease">
        <div class="preloader-bar" style="width:min(560px,80vw);height:4px;background:linear-gradient(90deg,#e5e7eb,#d1d5db);border-radius:999px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(0,0,0,.06)">
            <div id="preloader-thumb" style="height:100%;width:0%;background:#e5e7eb;transition:width .5s cubic-bezier(.22,.7,.2,1)"></div>
        </div>
    </div>
    <!-- Global Clock Component Container -->
    <div id="global-clock-container"></div>

    <!-- ScrollSmoother Wrapper -->
    <div id="smooth-wrapper">
        <div id="smooth-content">
    
    <!-- Home Section -->
    <section id="home" class="section">
        <div class="section-content">
            <!-- Left Column: Header and Description -->
            <div id="intro-column">
                <div id="intro">
                    <div id="intro-greeting"></div>
                    <div id="intro-description"></div>
                </div>
            </div>
            
            <!-- Right Column: Gallery Card -->
            <div id="gallery-column">
                <div class="gallery-wrapper">
                                    <div class="gallery-card" style="position:relative; overflow:hidden;">
                    <div class="gallery-container">
                        <div class="gallery-slides" id="gallery-slides">
                            <div class="gallery-slide active">
                                <video class="gallery-bg-video" autoplay muted loop playsinline preload="auto" src="https://raw.githubusercontent.com/amachinic/matthewahn.github.io/main/public/assets/eye.mp4"></video>
                                <h3>QA Framework</h3>
                                <p>A systematic approach to UI quality assurance<br>that ensures consistent design standards<br>across teams while maintaining<br>creative flexibility.</p>
                                <button class="gallery-cta ui-btn" data-variant="b4" aria-pressed="false" onclick="navigateToCase('case-study-qa-framework.html')">Explore</button>
                            </div>
                            <div class="gallery-slide">
                                <video id="gallery-bg-video-2" class="gallery-bg-video" autoplay muted loop playsinline preload="auto" aria-hidden="true">
                                    <source src="https://raw.githubusercontent.com/amachinic/matthewahn.github.io/main/public/assets/kinetic%20typography.mp4" type="video/mp4" />
                                </video>
                                <h3>Design System</h3>
                                <p>Creating cohesive design languages that scale across products and teams, ensuring consistency and efficiency in every interaction.</p>
                                <button class="gallery-cta ui-btn" data-variant="b4" aria-pressed="false">Currently Unavailable</button>
                            </div>
                            <div class="gallery-slide">
                                <!-- Slide 3: Muppet grid content -->
                                <div class="muppet-grid">
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu1/800/800" alt="cell 1" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu2/800/800" alt="cell 2" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu3/800/800" alt="cell 3" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu4/800/800" alt="cell 4" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu5/800/800" alt="cell 5" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu6/800/800" alt="cell 6" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu7/800/800" alt="cell 7" /></div></div>
                                    <div class="muppet-cell"><div class="muppet-content"><img src="https://picsum.photos/seed/mu8/800/800" alt="cell 8" /></div></div>
                                </div>
                            </div>
                            <div class="gallery-slide">
                                <h3>AI Integration</h3>
                                <p>Seamlessly integrating artificial intelligence into user workflows, making complex tasks simple and intelligent automation accessible.</p>
                                <button class="gallery-cta ui-btn" data-variant="b4" aria-pressed="false">Currently Unavailable</button>
                            </div>

                        </div>
                    </div>
                    
                    <!-- Arrow Navigation - Inside gallery card -->
                    <div class="gallery-arrows">
                        <button class="gallery-arrow gallery-arrow-left" id="gallery-prev">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="gallery-arrow gallery-arrow-right" id="gallery-next">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="0.75" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <!-- Global overlay CTA that mirrors the active slide's CTA -->
                    <button class="gallery-global-cta ui-btn" data-variant="b4" aria-pressed="false">Explore</button>
                </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Archive Section -->
    <section id="archive" class="section">
        <div class="section-content">
            <h2 id="archive-title" class="section-title">Archive</h2>
            
            <div id="archive-search-mount"></div>
            <div id="new-search-mount"></div>

            <gallery-archive style="display:block;"></gallery-archive>

            <!-- Archive grid removed as requested -->
        </div>
    </section>

    <!-- archive-new and archive-v2 removed -->

    <!-- Archive Standalone (outside any grid system entirely) -->
    <div id="archive-standalone">
        <div id="archive-standalone-container"></div>
    </div>

    <!-- Work Section -->
    <section id="work" class="section">
        <div class="section-content">
            <h2 id="work-title" class="section-title">Work</h2>
            <div class="card-grid two-columns">
                <div class="card tall-card">
                    <img class="card-bg" src="https://picsum.photos/seed/work1/1200/800" alt="Work background" />
                    <h3>QA Framework</h3>
                    <p>A systematic approach to UI quality assurance that ensures consistent design standards across teams while maintaining creative flexibility.</p>
                    <button class="work-cta ui-btn" data-variant="b4" aria-pressed="false" onclick="navigateToCase('case-study-qa-framework.html')">Explore</button>
                </div>
                <div class="card tall-card">
                    <img class="card-bg" src="https://picsum.photos/seed/work2/1200/800" alt="Work background" />
                    <h3>Design System</h3>
                    <p>Creating cohesive design languages that scale across products and teams, ensuring consistency and efficiency in every interaction.</p>
                    <button class="work-cta ui-btn" data-variant="b4" aria-pressed="false">Currently Unavailable</button>
                </div>
                <div class="card tall-card">
                    <img class="card-bg" src="https://picsum.photos/id/1015/1200/800" alt="Work background" />
                    <h3>Mobile Experience</h3>
                    <p>Crafting intuitive mobile experiences that feel natural and delightful, with careful attention to touch interactions and performance.</p>
                    <button class="work-cta ui-btn" data-variant="b4" aria-pressed="false">Explore</button>
                </div>
                <div class="card tall-card">
                    <img class="card-bg" src="https://picsum.photos/seed/work4/1200/800" alt="Work background" />
                    <h3>AI Integration</h3>
                    <p>Seamlessly integrating artificial intelligence into user workflows, making complex tasks simple and intelligent automation accessible.</p>
                    <button class="work-cta ui-btn" data-variant="b4" aria-pressed="false">Currently Unavailable</button>
                </div>
            </div>
        </div>
    </section>


    <!-- Contact Section -->
    <section id="contact" class="section">
        <div class="section-content">
            <h2 id="contact-title" class="section-title">Collaborate</h2>
            <div class="contact-container" style="max-width: none; width: 100%;">
                <form id="contact-form" class="contact-form" style="width: 100%;">
                        <div class="ui-input contact-name" data-variant="chip">
                            <label class="ui-label" for="name">Name</label>
                            <div class="ui-field">
                                <input type="text" id="name" name="name" placeholder="Hello" required>
                            </div>
                        </div>
                    
                        <div class="ui-input contact-email" data-variant="chip">
                            <label class="ui-label" for="email">Email</label>
                            <div class="ui-field">
                                <input type="email" id="email" name="email" placeholder="you@site.com" required>
                            </div>
                        </div>
                    
                        <div class="ui-input contact-message" data-variant="chip">
                            <label class="ui-label" for="message">Message</label>
                            <div class="ui-field">
                                <textarea id="message" name="message" placeholder="Tell me about your project..." required></textarea>
                            </div>
                        </div>
                    
                    <div class="submit-group contact-submit">
                        <button type="submit" class="submit-button ui-btn" data-variant="b1" aria-pressed="false">
                            Send Message
                        </button>
                    </div>
                </form>

                <!-- Success message (hidden by default) -->
                <div id="success-message" class="form-success hidden">
                    <h3>Message sent successfully!</h3>
                    <p>Thank you for reaching out. I'll get back to you soon.</p>
                </div>
            </div>
        </div>
    </section>

        </div>
    </div>

    <!-- New navigation bar -->
    <div id="nav-container">
        <nav id="nav-bar">
            <div class="blur-bg"></div>
            <div id="nav-slider"></div>
            <a href="#home" class="nav-button">Home</a>
            <a href="#archive" class="nav-button">Archive</a>
            <a href="#work" class="nav-button">Work</a>
            <a href="#contact" class="nav-button">Collaborate</a>
        </nav>
    </div>

    <script>
        const introGreeting = document.getElementById('intro-greeting');
        const introDescription = document.getElementById('intro-description');
        const greetingText = `Hey! I'm Matthew.`;
        // Different text versions for desktop and mobile
        const descriptionTextDesktop = `I'm a design strategist and engineer. 
I have a deep curiousity in harmonizing humanity and technology.`;

        const descriptionTextMobile = `I'm a design strategist and engineer. 
I have a deep curiousity in harmonizing 
humanity and technology.`;
        
        // Determine which text to use based on screen size
        const isMobile = window.innerWidth <= 768;
        const descriptionText = isMobile ? descriptionTextMobile : descriptionTextDesktop;

        let greetingIndex = 0;
        let descriptionIndex = 0;
        let isGreetingComplete = false;
        let isDescriptionComplete = false;
        let isTypingComplete = false;
        let galleryTriggered = false;
        const multilingualChars = ''
            + ''
            + ''
            + ''
            + ''
            + ''
            + ''
            + ''
            + '';

        function getRandomChar() {
            return multilingualChars[Math.floor(Math.random() * multilingualChars.length)];
        }

        function typeGreeting() {
            const spans = introGreeting.querySelectorAll('span');
            
            if (greetingIndex < spans.length) {
                // Show current character
                spans[greetingIndex].style.opacity = '1';
                
                // Add blinking effect for next few characters
                const maxBlinkLength = 3;
                const blinkLength = Math.min(maxBlinkLength, spans.length - greetingIndex - 1);
                
                for (let i = 1; i <= blinkLength; i++) {
                    if (spans[greetingIndex + i]) {
                        spans[greetingIndex + i].textContent = getRandomChar();
                        spans[greetingIndex + i].style.opacity = `${1 - i * 0.25}`;
                        spans[greetingIndex + i].style.color = 'var(--secondary-text-color)';
                    }
                }

                setTimeout(() => {
                    // Reset blinking characters back to original
                    for (let i = 1; i <= blinkLength; i++) {
                        if (spans[greetingIndex + i]) {
                            const originalChar = greetingText[greetingIndex + i];
                            spans[greetingIndex + i].innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                            spans[greetingIndex + i].style.color = '';
                            spans[greetingIndex + i].style.opacity = '0';
                        }
                    }
                    
                    greetingIndex++;
                    typeGreeting();
                }, 50);
            } else {
                isGreetingComplete = true;
                wrapGreetingLetters();
                // Start typing description after a short delay
                setTimeout(() => {
                    typeDescription();
                }, 1000);
            }
        }

        function typeDescription() {
            const spans = introDescription.querySelectorAll('span');
            const currentDescriptionText = window.descriptionText || descriptionText;
            // Create array of non-line-break characters for mapping
            const textChars = currentDescriptionText.split('').filter(char => char !== '\n');
            
            if (descriptionIndex < spans.length) {
                // Show current character
                spans[descriptionIndex].style.opacity = '1';
                
                // Add blinking effect for next few characters
                const maxBlinkLength = 3;
                const blinkLength = Math.min(maxBlinkLength, spans.length - descriptionIndex - 1);
                
                for (let i = 1; i <= blinkLength; i++) {
                    if (spans[descriptionIndex + i]) {
                        spans[descriptionIndex + i].textContent = getRandomChar();
                        spans[descriptionIndex + i].style.opacity = `${1 - i * 0.25}`;
                        spans[descriptionIndex + i].style.color = 'var(--secondary-text-color)';
                    }
                }

                setTimeout(() => {
                    // Reset blinking characters back to original
                    for (let i = 1; i <= blinkLength; i++) {
                        if (spans[descriptionIndex + i] && textChars[descriptionIndex + i]) {
                            const originalChar = textChars[descriptionIndex + i];
                            spans[descriptionIndex + i].innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                            spans[descriptionIndex + i].style.color = '';
                            spans[descriptionIndex + i].style.opacity = '0';
                        }
                    }
                    
                    descriptionIndex++;
                    
                    // Trigger gallery fade-in right after the first sentence finishes
                    const firstPeriodIndex = currentDescriptionText.indexOf('.');
                    if (firstPeriodIndex !== -1 && descriptionIndex >= firstPeriodIndex + 1 && !galleryTriggered) {
                        galleryTriggered = true;
                        triggerGalleryFadeIn();
                    }
                    
                    typeDescription();
                }, 70);
            } else {
                isDescriptionComplete = true;
                isTypingComplete = true;
                wrapDescriptionLetters();
            }
        }

        function wrapGreetingLetters() {
            const spans = introGreeting.querySelectorAll('span');
            spans.forEach((span, index) => {
                const char = greetingText[index];
                span.setAttribute('data-char', char);
                span.style.opacity = '1';
            });
        }

        function wrapDescriptionLetters() {
            const spans = introDescription.querySelectorAll('span');
            const currentDescriptionText = window.descriptionText || descriptionText;
            const textChars = currentDescriptionText.split('').filter(char => char !== '\n');
            
            spans.forEach((span, index) => {
                const char = textChars[index];
                if (char) {
                    span.setAttribute('data-char', char);
                    span.style.opacity = '1';
                }
            });
        }



        typeGreeting();

        function scrambleNearby(e) {
            const greetingSpans = introGreeting.querySelectorAll('span');
            const descriptionSpans = introDescription.querySelectorAll('span');

            const rect = e.currentTarget.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            // Handle greeting spans if greeting is complete
            if (isGreetingComplete) {
                greetingSpans.forEach(span => {
                const spanRect = span.getBoundingClientRect();
                const spanX = spanRect.left - rect.left + spanRect.width / 2;
                const spanY = spanRect.top - rect.top + spanRect.height / 2;
                const distance = Math.sqrt(Math.pow(mouseX - spanX, 2) + Math.pow(mouseY - spanY, 2));

                    if (distance < 15 && span.dataset.char !== '.') {
                    span.textContent = getRandomChar();
                    span.classList.add('scrambled');
                } else {
                    const originalChar = span.dataset.char;
                    span.innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                    span.classList.remove('scrambled');
                }
            });
            }

            // Handle description spans if description is complete
            if (isDescriptionComplete) {
                descriptionSpans.forEach(span => {
                    const spanRect = span.getBoundingClientRect();
                    const spanX = spanRect.left - rect.left + spanRect.width / 2;
                    const spanY = spanRect.top - rect.top + spanRect.height / 2;
                    const distance = Math.sqrt(Math.pow(mouseX - spanX, 2) + Math.pow(mouseY - spanY, 2));

                    if (distance < 15 && span.dataset.char !== '.') {
                        span.textContent = getRandomChar();
                        span.classList.add('scrambled');
                    } else {
                        const originalChar = span.dataset.char;
                        span.innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                        span.classList.remove('scrambled');
                    }
                });
            }
        }

        function revertText() {
            if (isGreetingComplete) {
                const greetingSpans = introGreeting.querySelectorAll('span');
                greetingSpans.forEach(span => {
                    const originalChar = span.dataset.char;
                    span.innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                    span.classList.remove('scrambled');
                });
            }

            if (isDescriptionComplete) {
                const descriptionSpans = introDescription.querySelectorAll('span');
                descriptionSpans.forEach(span => {
                    const originalChar = span.dataset.char;
                    span.innerHTML = originalChar === ' ' ? '&nbsp;' : originalChar;
                    span.classList.remove('scrambled');
                });
            }
        }

        document.getElementById('intro').addEventListener('mousemove', scrambleNearby);
        document.getElementById('intro').addEventListener('mouseleave', revertText);

        // Store original characters after typing is complete
        document.getElementById('intro').addEventListener('DOMSubtreeModified', () => {
            if (isTypingComplete) {
                const greetingSpans = introGreeting.querySelectorAll('span');
                const descriptionSpans = introDescription.querySelectorAll('span');
                const allSpans = [...greetingSpans, ...descriptionSpans];
                
                allSpans.forEach(span => {
                    if (!span.dataset.originalChar) {
                        span.dataset.originalChar = span.textContent;
                    }
                });
            }
        }, { once: true });



        // Elegant case study navigation with smooth transition
        function navigateToCase(url) {
            if (document.body.classList.contains('navigating')) return;
            document.body.classList.add('navigating');
            document.body.classList.add('fade-out');
            setTimeout(() => { window.location.href = url; }, 800);
        }



        // Scroll handler for navigation
        function handleScroll() {
            const navContainer = document.getElementById('nav-container');

            // Keep glass-like appearance for bottom nav
            navContainer.style.backgroundColor = 'transparent';
        }

        // Navigation slider positioning
        function updateNavSlider(activeButton) {
            const slider = document.getElementById('nav-slider');
            const navBar = document.getElementById('nav-bar');
            
            if (activeButton) {
                // Hug the active button width exactly
                const left = activeButton.offsetLeft;
                const width = activeButton.offsetWidth;
                if (!width || width < 4) {
                    // Defer until fonts/layout have settled
                    slider.style.opacity = '0';
                    try { if (document.fonts && document.fonts.ready) { document.fonts.ready.then(() => setTimeout(() => updateNavSlider(activeButton), 0)); } } catch(_) {}
                    requestAnimationFrame(() => updateNavSlider(activeButton));
                    return;
                }
                slider.style.left = `${left}px`;
                slider.style.width = `${width}px`;
                slider.style.opacity = '1';
            } else {
                slider.style.opacity = '0';
            }
        }

        let isManualNavigation = false;

        // Navigation active state tracking (robust with fixed header + smooth scrolling)
        function updateActiveNavigation() {
            if (isManualNavigation) return;

            const ids = ['home','archive','work','contact'];
            const header = document.getElementById('clock-container');
            const headerH = header ? Math.max(0, Math.min(window.innerHeight, header.getBoundingClientRect().height)) : 0;
            const vpTop = headerH;
            const vpBottom = window.innerHeight;
            const navButtons = document.querySelectorAll('.nav-button');

            // Top-of-page rule and near-bottom bias
            const scrollerTop = (window.smoother && typeof window.smoother.scrollTop === 'function') ? window.smoother.scrollTop() : window.scrollY;
            if (scrollerTop <= 2) {
                applyNavState('home');
                return;
            }
            const docHeight = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
            const nearBottom = (scrollerTop + window.innerHeight) >= (docHeight - 50);
            if (nearBottom) {
                applyNavState('contact');
                return;
            }

            let bestId = 'home';
            let bestVisible = -1;
            ids.forEach((id) => {
                const el = document.getElementById(id);
                if (!el) return;
                const rect = el.getBoundingClientRect();
                const topClamped = Math.max(rect.top, vpTop);
                const bottomClamped = Math.min(rect.bottom, vpBottom);
                const visible = Math.max(0, bottomClamped - topClamped);
                if (visible > bestVisible) {
                    bestVisible = visible;
                    bestId = id;
                }
            });
            applyNavState(bestId);

            function applyNavState(sectionId) {
                let activeButton = null;
                navButtons.forEach(button => {
                    const href = button.getAttribute('href');
                    if (href === `#${sectionId}`) {
                        button.classList.add('active');
                        activeButton = button;
                    } else {
                        button.classList.remove('active');
                    }
                });
                updateNavSlider(activeButton);
            }
        }

        // Initialize GSAP plugins for Home page
        gsap.registerPlugin(ScrollSmoother, ScrollTrigger, ScrollToPlugin);

        // Initialize smooth scrolling consistent with case study page
        (function initScrollSmoother() {
            if (typeof ScrollSmoother === 'undefined') return;
            try {
                const smoother = ScrollSmoother.create({
                    wrapper: "#smooth-wrapper",
                    content: "#smooth-content",
                    smooth: 1,
                    effects: false,
                    smoothTouch: 0.1,
                    normalizeScroll: false,
                    ignoreMobileResize: true
                });
                window.smoother = smoother;
            } catch (e) {
                console.warn('ScrollSmoother init failed:', e);
            }
        })();

        // Convex perspective section transitions
        (function convexSectionTransitions(){
            try {
                const sections = document.querySelectorAll('.section');
                sections.forEach((section, i) => {
                    const content = section.querySelector('.section-content');
                    if (!content) return;

                    // Reset initial state for both outgoing and incoming motions
                    gsap.set(content, { transformPerspective: 1000, transformOrigin: '50% 50%', z: 0 });

                    // As this section scrolls out (past center), tilt/scale/fade away
                    ScrollTrigger.create({
                        trigger: section,
                        start: 'top top',
                        end: 'bottom top',
                        scrub: true,
                        onUpdate: self => {
                            const p = self.progress; // 01 as section leaves viewport top
                            const rotateX = gsap.utils.mapRange(0, 1, 0, 8, p); // slight tilt away
                            const scale = gsap.utils.mapRange(0, 1, 1, 0.92, p);
                            const opacity = gsap.utils.mapRange(0, 1, 1, 0.0, p);
                            const translateZ = gsap.utils.mapRange(0, 1, 0, -120, p);
                            gsap.to(content, { rotateX, scale, opacity, z: translateZ, overwrite: true, duration: 0 });
                        }
                    });

                    // As next section enters, bring it forward to full presence
                    const next = sections[i+1];
                    if (next) {
                        const nextContent = next.querySelector('.section-content');
                        if (nextContent) {
                            // Prepare incoming state once
                            gsap.set(nextContent, { transformPerspective: 1000, rotateX: -4, scale: 0.97, z: -80, opacity: 0.0, transformOrigin: '50% 50%' });
                            ScrollTrigger.create({
                                trigger: next,
                                start: 'top bottom',
                                end: 'top top',
                                scrub: true,
                                onUpdate: self => {
                                    const p = self.progress; // 01 as next reaches top
                                    const rotateX = gsap.utils.mapRange(0, 1, -4, 0, p);
                                    const scale = gsap.utils.mapRange(0, 1, 0.97, 1, p);
                                    const opacity = gsap.utils.mapRange(0, 1, 0.0, 1, p);
                                    const translateZ = gsap.utils.mapRange(0, 1, -80, 0, p);
                                    gsap.to(nextContent, { rotateX, scale, opacity, z: translateZ, overwrite: true, duration: 0 });
                                }
                            });
                        }
                    }
                });
            } catch (e) {
                console.warn('convexSectionTransitions failed', e);
            }
        })();

        // Advanced GSAP smooth scrolling for navigation
        function smoothScrollToSection(targetId) {
            const targetSection = document.querySelector(targetId);
            if (targetSection) {
                const headerOffset = 120; // Offset for clock container
                
                if (window.smoother) {
                    window.smoother.scrollTo(targetSection, {
                        duration: 1.4,
                        offsetY: headerOffset,
                        ease: "power3.inOut",
                        onStart: () => { document.body.style.pointerEvents = 'none'; },
                        onComplete: () => {
                            document.body.style.pointerEvents = 'auto';
                            setTimeout(() => { if (!isManualNavigation) updateActiveNavigation(); }, 50);
                        }
                    });
                } else {
                    // Kill any existing scroll animations for smooth interruption
                    gsap.killTweensOf(window);
                    gsap.to(window, {
                        duration: 1.4,
                        scrollTo: { y: targetSection, offsetY: headerOffset, autoKill: false },
                        ease: "power3.inOut",
                        onStart: () => { document.body.style.pointerEvents = 'none'; },
                        onComplete: () => {
                            document.body.style.pointerEvents = 'auto';
                            setTimeout(() => { if (!isManualNavigation) updateActiveNavigation(); }, 50);
                        }
                    });
                }
            }
        }

        // Enhanced scroll to top with elegant animation
        function smoothScrollToTop() {
            if (window.smoother) {
                window.smoother.scrollTo(0, { duration: 1.8, ease: "power4.inOut" });
            } else {
                gsap.killTweensOf(window);
                gsap.to(window, {
                    duration: 1.8,
                    scrollTo: { y: 0 },
                    ease: "power4.inOut",
                    onStart: () => { document.body.style.pointerEvents = 'none'; },
                    onComplete: () => { document.body.style.pointerEvents = 'auto'; }
                });
            }
        }

        // Function to trigger gallery fade-in
        function triggerGalleryFadeIn() {
            const galleryCard = document.querySelector('.gallery-card');
            if (!galleryCard) return;
            gsap.to(galleryCard, {
                opacity: 1,
                y: 0,
                scale: 1,
                duration: 0.6,
                ease: "power2.out"
            });
        }

        // Function to restart typing animation
        function restartTypingAnimation() {
            // Reset all typing variables
            greetingIndex = 0;
            descriptionIndex = 0;
            isGreetingComplete = false;
            isDescriptionComplete = false;
            isTypingComplete = false;
            galleryTriggered = false;
            
            // Update description text based on current screen size
            const isMobile = window.innerWidth <= 768;
            const newDescriptionText = isMobile ? descriptionTextMobile : descriptionTextDesktop;
            
            // Update the global descriptionText variable
            window.descriptionText = newDescriptionText;
            
            // Reset gallery card
            const galleryCard = document.querySelector('.gallery-card');
            
            if (galleryCard) {
                gsap.set(galleryCard, {
                    opacity: 0,
                    y: 10,
                    scale: 1
                });
            }
            
            // Update description content if screen size changed
            const currentIsMobile = window.innerWidth <= 768;
            const currentDescriptionText = currentIsMobile ? 
                `I'm a design strategist and engineer. 
I have a deep curiousity in harmonizing 
humanity and technology.` :
                `I'm a design strategist and engineer. 
I have a deep curiousity in harmonizing humanity and technology.`;

            // Rebuild description spans if text content changed
            if (newDescriptionText !== currentDescriptionText) {
                introDescription.innerHTML = newDescriptionText.split('').map(char => {
                    if (char === '\n') {
                        return '<br>';
                    } else {
                        return char === ' ' ? `<span style="opacity: 0;">&nbsp;</span>` : `<span style="opacity: 0;">${char}</span>`;
                    }
                }).join('');
            }
            
            // Reset existing spans
            const greetingSpans = introGreeting.querySelectorAll('span');
            const descriptionSpans = introDescription.querySelectorAll('span');
            
            greetingSpans.forEach(span => span.style.opacity = '0');
            descriptionSpans.forEach(span => span.style.opacity = '0');
            
            // Start typing sequence
            typeGreeting();
        }

        // Add click handlers to navigation buttons
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                
                // Prevent scroll-based navigation updates during manual navigation
                isManualNavigation = true;
                
                // Immediately update slider to clicked button
                document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                updateNavSlider(this);
                
                // Scroll to target section
                smoothScrollToSection(targetId);
                
                // Extended timeout to prevent bouncing - wait for animation to complete fully
                setTimeout(() => {
                    isManualNavigation = false;
                }, 1600); // Match GSAP animation duration (1.4s) + buffer
            });
        });

        // Add event listener for scroll
        // Initialize Global Clock Component
        const globalClock = new GlobalClockComponent({
            showNameDisplay: true,
            hideLocationClock: false,
            backLinkText: '' // No back button on home page
        });
        
        // Inject the component's CSS
        const style = document.createElement('style');
        style.textContent = globalClock.getCSS();
        document.head.appendChild(style);
        
        // Render the component
        const clockContainer = document.getElementById('global-clock-container');
        if (clockContainer) {
            clockContainer.innerHTML = globalClock.getHTML();
            globalClock.init();
        }

        window.addEventListener('scroll', handleScroll);
        window.addEventListener('scroll', updateActiveNavigation);
        // Ensure slider sizes correctly after fonts/layout settle
        const rerunNav = () => updateActiveNavigation();
        try { if (document.fonts && document.fonts.ready) { document.fonts.ready.then(() => setTimeout(rerunNav, 0)); } } catch(_) {}
        window.addEventListener('load', () => setTimeout(rerunNav, 0), { once: true });
        setTimeout(rerunNav, 150);
        setTimeout(rerunNav, 350);
        
        // Add resize event listener for responsive navigation slider
        window.addEventListener('resize', function() {
            // Recalculate slider position on window resize
            const activeButton = document.querySelector('.nav-button.active');
            if (activeButton) {
                updateNavSlider(activeButton);
            }
        });
        
        // Call once to set initial state
        handleScroll();
        updateActiveNavigation();

        // Gallery slider functionality
        let currentSlide = 0;
        const totalSlides = 4;
        const slidesContainer = document.getElementById('gallery-slides');
        const galleryContainer = document.querySelector('.gallery-container');
        const prevButton = document.getElementById('gallery-prev');
        const nextButton = document.getElementById('gallery-next');
        
        // Randomize slide 3's original image set each time the animation runs
        function randomizeSlide3Muppets() {
            const slide3 = document.querySelectorAll('.gallery-slide')[2];
            if (!slide3) return;
            const cells = slide3.querySelectorAll('.muppet-cell .muppet-content');
            if (!cells || cells.length === 0) return;

            // Use the original eight seeded images only
            const originalImages = [
                'https://picsum.photos/seed/mu1/800/800',
                'https://picsum.photos/seed/mu2/800/800',
                'https://picsum.photos/seed/mu3/800/800',
                'https://picsum.photos/seed/mu4/800/800',
                'https://picsum.photos/seed/mu5/800/800',
                'https://picsum.photos/seed/mu6/800/800',
                'https://picsum.photos/seed/mu7/800/800',
                'https://picsum.photos/seed/mu8/800/800'
            ];

            // Place the provided MP4 in two early cells for visibility on small viewports
            const videoSrc = 'https://raw.githubusercontent.com/amachinic/matthewahn.github.io/main/public/assets/Animation%20AI%20file%20Bigger%202_1.mp4';
            const videoCells = [0, 1]; // zero-based indices
            videoCells.forEach((cellIndex) => {
                const contentEl = cells[cellIndex];
                if (!contentEl) return;
                contentEl.innerHTML = '';
                const video = document.createElement('video');
                video.setAttribute('muted', '');
                video.setAttribute('autoplay', '');
                video.setAttribute('loop', '');
                video.setAttribute('playsinline', '');
                video.src = videoSrc;
                contentEl.appendChild(video);
                contentEl.style.removeProperty('transform');
            });

            // Shuffle a copy
            const picks = originalImages.slice();
            for (let i = picks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [picks[i], picks[j]] = [picks[j], picks[i]];
            }

            // Assign images to non-video cells; update existing <img> or create one
            let pickIndex = 0;
            cells.forEach((contentEl, idx) => {
                if (videoCells.includes(idx)) return; // skip video cells
                const src = picks[pickIndex % picks.length];
                pickIndex++;
                let img = contentEl.querySelector('img');
                if (!img) {
                    // Replace any other content with an img
                    contentEl.innerHTML = '';
                    img = document.createElement('img');
                    img.alt = `grid media ${idx + 1}`;
                    contentEl.appendChild(img);
                }
                img.src = src;
                contentEl.style.removeProperty('transform');
            });
        }

        function updateGallerySlide(slideIndex) {
            currentSlide = slideIndex;
            const slides = document.querySelectorAll('.gallery-slide');
            const globalCta = document.querySelector('.gallery-global-cta');
            const wasActive = document.querySelector('.gallery-slide.active');
            
            // Simple slide switching - just update active class
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === slideIndex) {
                    slide.classList.add('active');
                }

                // Manage background video playback per slide
                const bgVideo = slide.querySelector('.gallery-bg-video');
                if (bgVideo) {
                    try {
                        if (index === slideIndex) {
                            bgVideo.setAttribute('playsinline', '');
                            bgVideo.setAttribute('webkit-playsinline', '');
                            bgVideo.setAttribute('muted', '');
                            bgVideo.autoplay = true;
                            bgVideo.muted = true;
                            bgVideo.loop = true;
                            if (bgVideo.paused) {
                                const playPromise = bgVideo.play();
                                if (playPromise && typeof playPromise.catch === 'function') {
                                    playPromise.catch(() => {
                                        setTimeout(() => { try { bgVideo.play(); } catch (_) {} }, 100);
                                    });
                                }
                            }
                        } else {
                            bgVideo.pause();
                        }
                    } catch (_) {}
                }
            });
            // Animation is controlled in nextSlide/prevSlide for consistency
            
            // Sync global CTA label and click with active slide
            if (globalCta) {
                const activeSlide = slides[slideIndex];
                const slideButton = activeSlide ? activeSlide.querySelector('.gallery-cta') : null;
                if (slideButton) {
                    globalCta.textContent = slideButton.textContent || 'Explore';
                    const onclickAttr = slideButton.getAttribute('onclick');
                    globalCta.classList.toggle('is-disabled', slideButton.disabled || slideButton.textContent.toLowerCase().includes('unavailable'));

                    // Reset handler
                    globalCta.onclick = null;
                    if (onclickAttr && !globalCta.classList.contains('is-disabled')) {
                        globalCta.setAttribute('onclick', onclickAttr);
                    } else {
                        globalCta.removeAttribute('onclick');
                    }
                }
            }
            
            // Update arrow visibility based on current position
            updateArrowVisibility();
        }
        
        function updateArrowVisibility() {
            const leftArrow = document.getElementById('gallery-prev');
            const rightArrow = document.getElementById('gallery-next');
            
            if (leftArrow && rightArrow) {
                // Always show both arrows for bi-directional navigation
                leftArrow.style.display = 'flex';
                rightArrow.style.display = 'flex';
            }
        }

        // Ensure active slide background video is reliably autoplaying and looping
        function ensureActiveVideoPlaying() {
            try {
                const activeSlide = document.querySelector('.gallery-slide.active');
                if (!activeSlide) return;
                const video = activeSlide.querySelector('.gallery-bg-video');
                if (!video) return;
                video.setAttribute('playsinline', '');
                video.setAttribute('webkit-playsinline', '');
                video.setAttribute('muted', '');
                video.autoplay = true;
                video.muted = true;
                video.loop = true;
                // Kick the decoder if needed
                if (video.readyState < 2) {
                    try { video.load(); } catch (_) {}
                }
                const attemptPlay = () => {
                    const p = video.play();
                    if (p && typeof p.catch === 'function') {
                        p.catch(() => setTimeout(() => { try { video.play(); } catch (_) {} }, 120));
                    }
                };
                attemptPlay();
            } catch (_) {}
        }

        // GSAP-powered directional fade for gallery titles/descriptions on hover
        function animateActiveSlideContent(card, direction) {
            try {
                const active = card.querySelector('.gallery-slide.active') || card.querySelector('.gallery-slide');
                if (!active) return;
                const title = active.querySelector('h3');
                const para = active.querySelector('p');
                const elems = [title, para].filter(Boolean);
                if (elems.length === 0) return;
                gsap.killTweensOf(elems);
                if (direction === 'in') {
                    gsap.set(elems, { x: -18, opacity: 0 });
                    if (title) gsap.to(title, { x: 0, opacity: 1, duration: 0.20, ease: 'power2.out' });
                    if (para) gsap.to(para, { x: 0, opacity: 1, duration: 0.18, ease: 'power2.out', delay: 0.06 });
                } else {
                    gsap.to(elems, { x: -18, opacity: 0, duration: 0.18, ease: 'power2.in' });
                }
            } catch (_) {}
        }

        function setupGalleryHoverAnimations() {
            document.querySelectorAll('.gallery-card').forEach((card) => {
                card.addEventListener('mouseenter', () => animateActiveSlideContent(card, 'in'));
                card.addEventListener('mouseleave', () => animateActiveSlideContent(card, 'out'));
            });
        }

        // Apply identical animation to Work section tall cards
        function animateTallCardContent(card, direction) {
            try {
                const title = card.querySelector('h3');
                const para = card.querySelector('p');
                const cta = card.querySelector('.work-cta');
                const moveElems = [title, para].filter(Boolean);
                const allElems = cta ? [...moveElems, cta] : moveElems;
                if (allElems.length === 0) return;
                gsap.killTweensOf(allElems);
                if (direction === 'in') {
                    // Title/paragraph slide + fade
                    if (moveElems.length) gsap.set(moveElems, { x: -18, opacity: 0 });
                    if (title) gsap.to(title, { x: 0, opacity: 1, duration: 0.20, ease: 'power2.out' });
                    if (para) gsap.to(para, { x: 0, opacity: 1, duration: 0.18, ease: 'power2.out', delay: 0.06 });
                    // CTA fade only (no movement)
                    if (cta) {
                        gsap.set(cta, { opacity: 0 });
                        gsap.to(cta, { opacity: 1, duration: 0.18, ease: 'power2.out', delay: 0.06 });
                    }
                } else {
                    if (moveElems.length) gsap.to(moveElems, { x: -18, opacity: 0, duration: 0.18, ease: 'power2.in' });
                    if (cta) gsap.to(cta, { opacity: 0, duration: 0.18, ease: 'power2.in' });
                }
            } catch (_) {}
        }

        function setupTallCardHoverAnimations() {
            document.querySelectorAll('.card.tall-card').forEach((card) => {
                card.addEventListener('mouseenter', () => animateTallCardContent(card, 'in'));
                card.addEventListener('mouseleave', () => animateTallCardContent(card, 'out'));
            });
        }

        function nextSlide() {
            const nextIndex = (currentSlide + 1) % totalSlides;
            const prevIndex = currentSlide;
            updateGallerySlide(nextIndex);
            // If moving from 2 -> 3, reset and play muppet animation
            if (prevIndex === 1 && nextIndex === 2) {
                const slides = document.querySelectorAll('.gallery-slide');
                const slide3 = slides[2];
                if (slide3) {
                    randomizeSlide3Muppets();
                    slide3.classList.remove('muppet-played', 'muppet-animate');
                    // Force reflow to restart CSS animation properly
                    void slide3.offsetWidth;
                    slide3.classList.add('muppet-animate');
                    setTimeout(() => {
                        slide3.classList.remove('muppet-animate');
                        slide3.classList.add('muppet-played');
                    }, 950);
                }
            }
        }

        function prevSlide() {
            const prevIndex = (currentSlide - 1 + totalSlides) % totalSlides;
            const fromIndex = currentSlide;
            updateGallerySlide(prevIndex);
            // If moving from 4 -> 3, reset and play muppet animation
            if (fromIndex === 3 && prevIndex === 2) {
                const slides = document.querySelectorAll('.gallery-slide');
                const slide3 = slides[2];
                if (slide3) {
                    randomizeSlide3Muppets();
                    slide3.classList.remove('muppet-played', 'muppet-animate');
                    // Force reflow
                    void slide3.offsetWidth;
                    slide3.classList.add('muppet-animate');
                    setTimeout(() => {
                        slide3.classList.remove('muppet-animate');
                        slide3.classList.add('muppet-played');
                    }, 950);
                }
            }
        }

        // Drag/slide variables
        let isDragging = false;
        let startX = 0;
        let startY = 0;



        // Mouse drag functionality
        galleryContainer.addEventListener('mousedown', handleStart);
        galleryContainer.addEventListener('mousemove', handleMove);
        galleryContainer.addEventListener('mouseup', handleEnd);
        galleryContainer.addEventListener('mouseleave', handleEnd);

        // Touch functionality for mobile
        galleryContainer.addEventListener('touchstart', handleStart);
        galleryContainer.addEventListener('touchmove', handleMove);
        galleryContainer.addEventListener('touchend', handleEnd);

        function handleStart(e) {
            isDragging = true;
            startX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
            startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
        }

        function handleMove(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            // Visual feedback during drag can be added here if needed
        }

        function handleEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            
            // Calculate drag distance and direction
            const currentX = e.type === 'mouseup' ? e.clientX : (e.changedTouches ? e.changedTouches[0].clientX : startX);
            const currentY = e.type === 'mouseup' ? e.clientY : (e.changedTouches ? e.changedTouches[0].clientY : startY);
            
            const deltaX = currentX - startX;
            const deltaY = currentY - startY;
            const containerWidth = galleryContainer.offsetWidth;
            
            // Determine if it's a horizontal swipe (more horizontal than vertical)
            const minSwipeDistance = containerWidth * 0.1; // Reduced threshold for easier swiping
            
            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > minSwipeDistance) {
                if (deltaX > 0) {
                    // Swiped right - go to previous card
                    prevSlide();
                } else {
                    // Swiped left - go to next card
                    nextSlide();
                }
            }
        }

        // Arrow navigation event listeners
        if (prevButton && nextButton) {
            prevButton.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                prevSlide();
            });

            nextButton.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                nextSlide();
            });
        }

        // Initialize gallery on page load
        updateGallerySlide(0);
        
        // Set initial arrow visibility
        updateArrowVisibility();
        // Nudge autoplay for the initial active slide video
        ensureActiveVideoPlaying();

        // Initialize hover animations for gallery titles/descriptions
        setupGalleryHoverAnimations();
        // Ensure all tall-cards have title, paragraph, and CTA; then set up animations
        (function ensureTallCardElements(){
            document.querySelectorAll('.card.tall-card').forEach((card) => {
                let title = card.querySelector('h3');
                if (!title) {
                    title = document.createElement('h3');
                    title.textContent = 'Case Study';
                    card.insertBefore(title, card.firstChild);
                }
                let para = card.querySelector('p');
                const cta = card.querySelector('.work-cta');
                if (!para) {
                    para = document.createElement('p');
                    para.textContent = 'Description coming soon.';
                    if (cta) {
                        card.insertBefore(para, cta);
                    } else {
                        card.appendChild(para);
                    }
                }
                if (!cta) {
                    const btn = document.createElement('button');
                    btn.className = 'work-cta ui-btn';
                    btn.setAttribute('data-variant','b4');
                    btn.setAttribute('aria-pressed','false');
                    btn.textContent = 'Explore';
                    card.appendChild(btn);
                }
            });
        })();
        setupTallCardHoverAnimations();

        // Set initial state for all animated elements immediately to prevent layout shifts
        const initialCards = document.querySelectorAll('.card');
        const initialTitles = document.querySelectorAll('.section-title');
        const galleryCard = document.querySelector('.gallery-card');
        
        // Force all cards to initial state immediately, regardless of class
        initialCards.forEach(card => {
            gsap.set(card, {
                opacity: 0,
                y: 30,
                force3D: true // Use hardware acceleration
            });
        });
        
        // Set up section titles immediately with proper spacing
        initialTitles.forEach(title => {
            const titleText = title.textContent.trim();
            // Set full text immediately with invisible characters to reserve space
            title.innerHTML = titleText.split('').map(char => 
                char === ' ' ? ' ' : `<span style="opacity: 0;">${char}</span>`
            ).join('');
            gsap.set(title, { opacity: 0 });
        });
        
        if (galleryCard) {
            gsap.set(galleryCard, { opacity: 0, y: 10 });
            // Fade in after 1 second from page load
            setTimeout(() => {
                try {
                    gsap.to(galleryCard, { opacity: 1, y: 0, duration: 0.6, ease: 'power2.out' });
                } catch (_) {
                    // Fallback without GSAP
                    galleryCard.style.transition = 'opacity .6s ease, transform .6s ease';
                    galleryCard.style.opacity = '1';
                    galleryCard.style.transform = 'translateY(0)';
                }
            }, 1000);
        }

        // Preloader: brief delay to ensure it paints first, then simulate progress until DOM ready or max timeout
        (function setupPreloader(){
            const preloader = document.getElementById('preloader');
            const thumb = document.getElementById('preloader-thumb');
            if (!preloader || !thumb) return;

            const start = () => {
                let progress = 0;
                const pump = () => {
                    progress = Math.min(progress + (8 + Math.random() * 10), 92);
                    thumb.style.width = progress + '%';
                };
                const interval = setInterval(pump, 140);

                const finish = () => {
                    clearInterval(interval);
                    thumb.style.transition = 'width .35s cubic-bezier(.22,.7,.2,1)';
                    thumb.style.width = '100%';
                    setTimeout(() => {
                        preloader.style.opacity = '0';
                        setTimeout(() => { preloader.remove(); }, 400);
                    }, 300);
                };

                const MAX_WAIT_MS = 2500;
                let finished = false;
                const safeFinish = () => { if (!finished) { finished = true; finish(); } };

                if (document.readyState === 'interactive' || document.readyState === 'complete') {
                    safeFinish();
                } else {
                    document.addEventListener('DOMContentLoaded', safeFinish, { once: true });
                }
                // Safety valve so the loader never lingers too long
                setTimeout(safeFinish, MAX_WAIT_MS);
            };

            // Ensure the preloader is the first thing visible; start quickly but not blocking paint
            setTimeout(start, 120);
        })();
        
        // Set up contact container initial state
        const contactContainer = document.querySelector('.contact-container');
        if (contactContainer) {
            // Ensure contact section is visible immediately
            gsap.set(contactContainer, { opacity: 1, y: 0 });
        }
        
        // Set up intro text immediately to prevent home section height changes
        // Use the same variables that the typing animation expects
        if (introGreeting && introDescription) {
            // Set full greeting text immediately with invisible characters (every character gets a span)
            introGreeting.innerHTML = greetingText.split('').map(char => 
                char === ' ' ? `<span data-char="${char}" style="opacity: 0;">&nbsp;</span>` : `<span data-char="${char}" style="opacity: 0;">${char}</span>`
            ).join('');
            
            // Set full description text immediately with invisible characters (every character except line breaks gets a span)
            const currentDescriptionText = isMobile ? descriptionTextMobile : descriptionTextDesktop;
            introDescription.innerHTML = currentDescriptionText.split('').map(char => {
                if (char === '\n') {
                    return '<br>';
                } else {
                    return char === ' ' ? `<span data-char="${char}" style="opacity: 0;">&nbsp;</span>` : `<span data-char="${char}" style="opacity: 0;">${char}</span>`;
                }
            }).join('');
        }
        
        // Force all sections to maintain stable layout during animations
        const allSections = document.querySelectorAll('.section');
        allSections.forEach(section => {
            const sectionContent = section.querySelector('.section-content');
            if (sectionContent) {
                gsap.set(sectionContent, {
                    force3D: true // Hardware acceleration for stability
                });
            }
        });
        

        
        // Section title typing animation
        const sectionTitles = [
            { id: 'archive-title', text: 'Archive' },
            { id: 'work-title', text: 'Work' },
            { id: 'contact-title', text: 'Collaborate' }
        ];

        const animatedSections = new Set();

        function typeSectionTitle(titleConfig) {
            const element = document.getElementById(titleConfig.id);
            if (!element || animatedSections.has(titleConfig.id)) return;

            animatedSections.add(titleConfig.id);
            element.classList.add('typing');
            
            // GSAP fade-in animation for container
            gsap.to(element, {
                opacity: 1,
                duration: 0.8,
                ease: "power2.out",
                delay: 0.2
            });
            
            // Delay the start of typing by 0.2 seconds (synchronized with GSAP)
            setTimeout(() => {
                let index = 0;
                const spans = element.querySelectorAll('span');

                function typeCharacter() {
                    if (index < spans.length) {
                        // Show current character
                        spans[index].style.opacity = '1';
                        
                        // Add blinking effect for next few characters
                        const maxBlinkLength = 2;
                        const blinkLength = Math.min(maxBlinkLength, spans.length - index - 1);
                        
                        for (let i = 1; i <= blinkLength; i++) {
                            if (spans[index + i]) {
                                spans[index + i].textContent = getRandomChar();
                                spans[index + i].style.opacity = `${1 - i * 0.3}`;
                                spans[index + i].style.color = 'var(--secondary-text-color)';
                            }
                        }

                        setTimeout(() => {
                            // Reset blinking characters back to original
                            for (let i = 1; i <= blinkLength; i++) {
                                if (spans[index + i]) {
                                    spans[index + i].textContent = titleConfig.text[index + i];
                                    spans[index + i].style.color = '';
                                    spans[index + i].style.opacity = '0';
                                }
                            }
                            
                            index++;
                            setTimeout(typeCharacter, 40);
                        }, 50);
                    } else {
                        // Animation complete - all characters visible
                        spans.forEach(span => {
                            span.style.opacity = '1';
                            span.style.color = '';
                        });
                    }
                }

                typeCharacter();
            }, 200);
        }

        function wrapSectionTitleLetters(element, text) {
            element.innerHTML = text.split('').map((char, index) => 
                char === ' ' ? ' ' : `<span data-original="${char}" data-index="${index}">${char}</span>`
            ).join('');

            const spans = element.querySelectorAll('span');
            
            // Just wrap letters in spans for styling, no hover events
            spans.forEach((span, index) => {
                span.style.userSelect = 'none'; // Prevent text selection
            });
        }

        function checkSectionVisibility() {
            sectionTitles.forEach(titleConfig => {
                const section = document.getElementById(titleConfig.id.replace('-title', ''));
                if (section && !animatedSections.has(titleConfig.id)) {
                    const rect = section.getBoundingClientRect();
                    const windowHeight = window.innerHeight;
                    
                    // Trigger when section is 70% visible
                    if (rect.top < windowHeight * 0.7 && rect.bottom > 0) {
                        typeSectionTitle(titleConfig);
                        animateCardsInSection(section);
                    }
                }
            });
        }

        // Track animated cards to prevent re-animation
        const animatedCards = new Set();

        function animateCardsInSection(section) {
            const cards = section.querySelectorAll('.card');
            const searchContainer = section.querySelector('.search-container');
            const contactContainer = section.querySelector('.contact-container');
            const sectionId = section.id;
            
            if (!animatedCards.has(sectionId)) {
                animatedCards.add(sectionId);
                
                if (sectionId === 'contact' && contactContainer) {
                    // Contact section should be visible instantly; no delayed animation
                    gsap.set(contactContainer, { opacity: 1, y: 0 });
                } else if (sectionId === 'archive' && searchContainer) {
                    // Archive section: fade in search
                    gsap.to(searchContainer, {
                        opacity: 1,
                        y: 0,
                        duration: 0.4,
                        ease: "power2.out",
                        delay: 0.2
                    });
                    // Then fade in cards
                    cards.forEach((card, index) => {
                        gsap.to(card, {
                            opacity: 1,
                            y: 0,
                            duration: 0.25,
                            ease: "power2.in",
                            delay: 0.3 + (index * 0.06)
                        });
                    });
                } else {
                    // Other sections: individual card animation
                    cards.forEach((card, index) => {
                        gsap.to(card, {
                            opacity: 1,
                            y: 0,
                            duration: 0.25,
                            ease: "power2.in",
                            delay: 0.2 + (index * 0.06)
                        });
                    });
                }
            }
        }

        // Initialize scroll listener for section animations
        window.addEventListener('scroll', checkSectionVisibility);
        window.addEventListener('load', checkSectionVisibility);

        // Contact mode: only when ?section=contact is present should we focus contact on load
        (function initContactMode(){
            try {
                const params = new URLSearchParams(window.location.search);
                const isContactMode = params.get('section') === 'contact';
                if (!isContactMode) return;

                // Mark Contact nav active and move thumb without scrolling
                document.querySelectorAll('#nav-bar .nav-button').forEach(btn => btn.classList.remove('active'));
                const contactNav = document.querySelector('#nav-bar .nav-button[href="#contact"]');
                if (contactNav) contactNav.classList.add('active');
                if (typeof moveToggleThumbToSection === 'function') {
                    moveToggleThumbToSection('contact');
                }

                // Instantly set contact container visible and prevent other animations from overriding
                const contactSection = document.getElementById('contact');
                const contactContainerEl = document.querySelector('#contact .contact-container');
                if (contactContainerEl) {
                    gsap.set(contactContainerEl, { opacity: 1, y: 0 });
                }
                // Ensure the Collaborate title is wrapped and animated on entry
                try {
                    const titleEl = document.getElementById('contact-title');
                    if (titleEl && !animatedSections.has('contact-title')) {
                        wrapSectionTitleLetters(titleEl, 'Collaborate');
                        typeSectionTitle({ id: 'contact-title', text: 'Collaborate' });
                    }
                } catch (_) {}

                // Position so Contact title and form are fully in view beneath the fixed header
                requestAnimationFrame(() => {
                    const section = contactSection;
                    if (!section) return;

                    const computeAndScroll = () => {
                        const header = document.getElementById('clock-container');
                        const hh = header ? header.offsetHeight : 58; // prefer current height, fallback to scrolled height
                        const topMargin = 12;
                        const bottomMargin = 16;

                        const rect = section.getBoundingClientRect();
                        const top = rect.top + window.scrollY;
                        const height = rect.height;

                        // Range to keep section fully visible if it fits
                        const minTop = top - (hh + topMargin); // align section top below header
                        const maxTop = top + height - (window.innerHeight - bottomMargin); // align section bottom above viewport bottom

                        const usable = window.innerHeight - hh - topMargin - bottomMargin;
                        let target = minTop;
                        if (height <= usable) {
                            // Center within usable space to avoid clipping title/form
                            target = Math.round((minTop + Math.max(minTop, maxTop)) / 2);
                        }

                        const maxScroll = Math.max(0, Math.max(document.documentElement.scrollHeight, document.body.scrollHeight) - window.innerHeight);
                        target = Math.max(0, Math.min(maxScroll, target));
                        window.scrollTo({ top: target, left: 0, behavior: 'auto' });
                    };

                    computeAndScroll();
                    // Recompute after header collapses to scrolled state
                    setTimeout(computeAndScroll, 140);

                    // Clear the query so refresh doesn't re-enter contact mode
                    try {
                        const newUrl = window.location.pathname + window.location.hash;
                        window.history.replaceState({}, '', newUrl);
                    } catch (_) { }
                });

                // Prevent over-scrolling downwards by ensuring body is scrollable normally
                // No further constraints; just ensure we didn't attach any smooth scroll to hash
            } catch (e) {
                console.warn('initContactMode failed', e);
            }
        })();

        // Handle window resize to update description text if needed
        window.addEventListener('resize', function() {
            // Debounce resize events
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                const currentIsMobile = window.innerWidth <= 768;
                const currentDescriptionText = currentIsMobile ? descriptionTextMobile : descriptionTextDesktop;
                
                // Only rebuild if the text should actually change
                if (currentIsMobile !== isMobile) {
                    // Update global variable
                    window.isMobile = currentIsMobile;
                    window.descriptionText = currentDescriptionText;
                    
                    // Rebuild description spans with correct text
                    if (introDescription) {
                        introDescription.innerHTML = currentDescriptionText.split('').map(char => {
                            if (char === '\n') {
                                return '<br>';
                            } else {
                                return char === ' ' ? `<span data-char="${char}" style="opacity: 0;">&nbsp;</span>` : `<span data-char="${char}" style="opacity: 0;">${char}</span>`;
                            }
                        }).join('');
                        
                        // If typing is complete, make all spans visible
                        if (isDescriptionComplete) {
                            const spans = introDescription.querySelectorAll('span');
                            spans.forEach(span => span.style.opacity = '1');
                        }
                    }
                }
            }, 250);
        });

        // Set initial state for all cards immediately to prevent layout shifts
        const allCards = document.querySelectorAll('.card');
        gsap.set(allCards, {
            opacity: 0,
            y: 30
        });

        // Auto-advance removed - gallery is now fully manual
        
        // Reset animation state and start greeting
        greetingIndex = 0;
        descriptionIndex = 0;
        isGreetingComplete = false;
        isDescriptionComplete = false;
        isTypingComplete = false;
        galleryTriggered = false;
        
        // Ensure description stays hidden until greeting is complete
        if (introDescription) {
            const descSpans = introDescription.querySelectorAll('span');
            descSpans.forEach(span => span.style.opacity = '0');
        }
        
        // Start typing animation with greeting only
        typeGreeting();




        // Gallery CTA buttons are display-only with hover states
        // Archive search: mount provided 1:1 search UI in Shadow DOM to avoid global style conflicts
        (function mountArchiveSearchShadow() {
            const mount = document.getElementById('archive-search-mount');
            if (!mount) return;
        })();

        // Archive V2: shadow search removed
        (function mountArchiveV2SearchShadow() {
            const mount = document.getElementById('archive-v2-search');
            if (!mount) return;
        })();

        // Contact form and canvas functionality
        const mobileCanvas = document.getElementById('drawing-canvas');
        const desktopCanvas = document.getElementById('drawing-canvas-desktop');
        const mobileCtx = mobileCanvas ? mobileCanvas.getContext('2d') : null;
        const desktopCtx = desktopCanvas ? desktopCanvas.getContext('2d') : null;
        const clearBtns = document.querySelectorAll('.clear-btn');
        const brushSizeSliders = document.querySelectorAll('.brush-slider');
        const contactForm = document.getElementById('contact-form');

        // Canvas drawing functionality
        function setupCanvas(canvas, ctx, clearBtn, brushSizeSlider) {
            if (!canvas || !ctx) return;

            let isDrawing = false;
            let brushSize = 3;

            // Set up canvas
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#333';
            ctx.lineWidth = brushSize;

            // Brush size control
            if (brushSizeSlider) {
                brushSizeSlider.addEventListener('input', function() {
                    brushSize = this.value;
                    ctx.lineWidth = brushSize;
                });
            }

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                ctx.beginPath();
                ctx.moveTo(x, y);
            }

            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const x = (e.clientX - rect.left) * scaleX;
                const y = (e.clientY - rect.top) * scaleY;
                ctx.lineTo(x, y);
                ctx.stroke();
            }

            function stopDrawing() {
                isDrawing = false;
                ctx.beginPath();
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                  e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }

            // Clear canvas
            if (clearBtn) {
                clearBtn.addEventListener('click', function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                });
            }
        }

        // Set up both canvases
        const mobileBrushSlider = document.getElementById('brush-size');
        const desktopBrushSlider = document.getElementById('brush-size-desktop');
        const mobileClearBtn = document.querySelector('.canvas-form-group .clear-btn');
        const desktopClearBtn = document.querySelector('.desktop-canvas-field .clear-btn');

        setupCanvas(mobileCanvas, mobileCtx, mobileClearBtn, mobileBrushSlider);
        setupCanvas(desktopCanvas, desktopCtx, desktopClearBtn, desktopBrushSlider);

                        // Simple toggle functionality - select the visible toggle based on screen size
        function getActiveToggleElements() {
            // Check which toggle container is actually visible instead of relying on screen width
            const mobileContainer = document.querySelector('.mobile-toggle-container');
            const desktopContainer = document.querySelector('.desktop-toggle-container');
            
            const mobileVisible = mobileContainer && window.getComputedStyle(mobileContainer).display !== 'none';
            const desktopVisible = desktopContainer && window.getComputedStyle(desktopContainer).display !== 'none';
            
            if (mobileVisible) {
                return {
                    thumb: document.querySelector('.mobile-toggle-container .send-toggle-thumb'),
                    track: document.querySelector('.mobile-toggle-container .send-toggle-track'),
                    text: document.querySelector('.mobile-toggle-container .send-toggle-text')
                };
            } else if (desktopVisible) {
                return {
                    thumb: document.querySelector('.desktop-toggle-container .send-toggle-thumb'),
                    track: document.querySelector('.desktop-toggle-container .send-toggle-track'),
                    text: document.querySelector('.desktop-toggle-container .send-toggle-text')
                };
            }
            
            // Fallback: if neither is visible, check screen width
            const isMobileView = window.innerWidth <= 768;
            if (isMobileView) {
                return {
                    thumb: document.querySelector('.mobile-toggle-container .send-toggle-thumb'),
                    track: document.querySelector('.mobile-toggle-container .send-toggle-track'),
                    text: document.querySelector('.mobile-toggle-container .send-toggle-text')
                };
            } else {
                return {
                    thumb: document.querySelector('.desktop-toggle-container .send-toggle-thumb'),
                    track: document.querySelector('.desktop-toggle-container .send-toggle-track'),
                    text: document.querySelector('.desktop-toggle-container .send-toggle-text')
                };
            }
        }

        let activeToggle = null;
        let sendToggleThumb = null;
        let sendToggleTrack = null;
        
        let isToggleDragging = false;
        let dragStartX = 0;
        let thumbStartX = 0;
        let isToggleActive = false; // Track toggle state
        let hasDraggedDistance = false; // Track if we've actually moved during drag

        // Function to bind events to toggle elements
        function bindToggleEvents(thumbElement, trackElement) {
            if (!thumbElement || !trackElement) return;
            
            // Remove existing event listeners to prevent duplicates
            thumbElement.removeEventListener('click', handleToggleClick);
            trackElement.removeEventListener('click', handleTrackClick);
            thumbElement.removeEventListener('mousedown', startDrag);
            thumbElement.removeEventListener('touchstart', startDrag);
            
            // Add event listeners for both mouse and touch
            thumbElement.addEventListener('click', handleToggleClick);
            trackElement.addEventListener('click', handleTrackClick);
            thumbElement.addEventListener('mousedown', startDrag);
            thumbElement.addEventListener('touchstart', startDrag, { passive: false });
            
            // Ensure track can handle touch clicks too
            trackElement.addEventListener('touchstart', function(e) {
                if (e.target === thumbElement) return;
                e.preventDefault();
                handleTrackClick(e);
            }, { passive: false });
        }

        // Initialize toggle with retry logic
        function initializeToggle() {
            activeToggle = getActiveToggleElements();
            sendToggleThumb = activeToggle.thumb;
            sendToggleTrack = activeToggle.track;
            
            if (sendToggleThumb && sendToggleTrack) {
                console.log('Toggle elements found:', { thumb: !!sendToggleThumb, track: !!sendToggleTrack });
                updateTogglePositions();
                bindToggleEvents(sendToggleThumb, sendToggleTrack);
                
                // Global events for drag (attached once per successful init)
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchmove', drag, { passive: false });
                document.addEventListener('touchend', endDrag);
                
                // Initialize position
                setTimeout(() => {
                    updateTogglePositions();
                    if (sendToggleThumb) {
                        sendToggleThumb.style.left = window.leftPosition + 'px';
                        console.log('Initialized toggle at position:', window.leftPosition);
                    }
                }, 100);
                
                return true;
            } else {
                console.log('Toggle elements not found, retrying...', { thumb: !!sendToggleThumb, track: !!sendToggleTrack });
                return false;
            }
        }
        
        // Try to initialize immediately, with retry logic
        if (!initializeToggle()) {
            // If initial attempt fails, retry with delays
            setTimeout(() => {
                if (!initializeToggle()) {
                    setTimeout(() => {
                        initializeToggle();
                    }, 500);
                }
            }, 100);
        }

        // Hover over nav buttons previews thumb position (including Archive)
        document.querySelectorAll('.nav-button').forEach((btn) => {
            btn.addEventListener('mouseenter', () => {
                const href = btn.getAttribute('href') || '';
                const id = href.startsWith('#') ? href.slice(1) : href;
                if (typeof moveToggleThumbToSection === 'function') {
                    moveToggleThumbToSection(id || 'home');
                }
            });
        });

            function updateTogglePositions() {
                const currentTrack = activeToggle.track;
                if (!currentTrack) return;

                const trackWidth = currentTrack.offsetWidth;
                const thumbWidth = 76; // Fixed thumb width for consistent calculation
                const paddingPercent = 0.08; // slightly reduced padding for better range

                const minX = Math.round((trackWidth - thumbWidth) * paddingPercent);
                const maxX = Math.round(trackWidth - thumbWidth - (trackWidth - thumbWidth) * paddingPercent);

                // Define stops mapped to sections (ensure Archive is included)
                const sectionOrder = ['home', 'archive', 'work', 'contact'];
                const stopsCount = sectionOrder.length;
                const span = maxX - minX;
                const step = stopsCount > 1 ? span / (stopsCount - 1) : 0;

                window.toggleMinX = minX;
                window.toggleMaxX = maxX;
                window.toggleStops = sectionOrder.map((id, idx) => ({ id, x: Math.round(minX + idx * step) }));
                window.trackWidth = trackWidth;
                window.thumbWidth = thumbWidth;

                // Place thumb to current section stop if possible
                const currentId = getActiveSectionId();
                const idx = window.toggleStops.findIndex(s => s.id === currentId);
                if (activeToggle.thumb && idx >= 0) {
                    activeToggle.thumb.style.left = window.toggleStops[idx].x + 'px';
                    window.currentStopIndex = idx;
                }
            }

            // Keep toggle thumb in sync while scrolling
            window.addEventListener('scroll', () => {
                try { updateTogglePositions(); } catch (_) {}
            }, { passive: true });

            function getActiveSectionId() {
                // Robust detection: pick section with largest visible height within viewport below the fixed header
                const sections = ['home','archive','work','contact'];
                const header = document.getElementById('clock-container');
                const headerH = header ? Math.max(0, Math.min(window.innerHeight, header.getBoundingClientRect().height)) : 0;
                const vpTop = headerH;
                const vpBottom = window.innerHeight;
                const doc = document.documentElement;
                const nearBottom = (window.scrollY + window.innerHeight) >= (doc.scrollHeight - 50);
                if (nearBottom) return 'contact';

                let bestId = 'home';
                let bestVisible = -1;
                for (const id of sections) {
                    const el = document.getElementById(id);
                    if (!el) continue;
                    const rect = el.getBoundingClientRect();
                    const topClamped = Math.max(rect.top, vpTop);
                    const bottomClamped = Math.min(rect.bottom, vpBottom);
                    const visible = Math.max(0, bottomClamped - topClamped);
                    if (visible > bestVisible) {
                        bestVisible = visible;
                        bestId = id;
                    }
                }
                return bestId;
            }

            // Move toggle thumb to a specific section stop without scrolling
            function moveToggleThumbToSection(sectionId) {
                try {
                    const stops = window.toggleStops || [];
                    if (!activeToggle || !activeToggle.thumb || !stops.length) return;
                    const idx = stops.findIndex(s => s.id === sectionId);
                    if (idx >= 0) {
                        activeToggle.thumb.style.transition = 'left 0.25s ease';
                        activeToggle.thumb.style.left = stops[idx].x + 'px';
                        window.currentStopIndex = idx;
                    }
                } catch (_) {}
            }

            let clickTimeout = null;

            function handleToggleClick(e) {
                e.stopPropagation();
                // Small delay to distinguish from drag
                clickTimeout = setTimeout(() => {
                    if (!isToggleDragging && !hasDraggedDistance) {
                        console.log('Toggle click triggered');
                        togglePosition();
                    }
                }, 50);
            }

            function handleTrackClick(e) {
                const currentThumb = activeToggle.thumb;
                if (e.target === currentThumb) return; // Don't trigger if clicking on thumb
                e.stopPropagation();
                
                // Small delay to distinguish from drag
                clickTimeout = setTimeout(() => {
                    if (!isToggleDragging && !hasDraggedDistance) {
                        console.log('Track click triggered');
                        togglePosition();
                    }
                }, 50);
            }

            function togglePosition() {
                const currentThumb = activeToggle.thumb;
                if (!currentThumb || !Array.isArray(window.toggleStops) || !window.toggleStops.length) return;
                currentThumb.style.transition = 'all 0.3s ease';

                // Advance to next stop cyclically
                const nextIndex = (window.currentStopIndex || 0) + 1 >= window.toggleStops.length ? 0 : (window.currentStopIndex || 0) + 1;
                window.currentStopIndex = nextIndex;
                const target = window.toggleStops[nextIndex];
                currentThumb.style.left = target.x + 'px';
                // Scroll to the mapped section smoothly
                smoothScrollToSection(`#${target.id}`);
            }

            function startDrag(e) {
                e.preventDefault();
                
                console.log('startDrag called');
                
                const currentThumb = activeToggle.thumb;
                if (!currentThumb) return;
                
                // Clear any pending click timeout
                if (clickTimeout) {
                    clearTimeout(clickTimeout);
                    clickTimeout = null;
                }
                
                isToggleDragging = true;
                hasDraggedDistance = false;
                const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
                dragStartX = clientX;
                thumbStartX = currentThumb.offsetLeft;
                currentThumb.style.transition = 'none';
                currentThumb.style.cursor = 'grabbing';
            }

            function drag(e) {
                if (!isToggleDragging) return;
                e.preventDefault();

                const currentThumb = activeToggle.thumb;
                if (!currentThumb) return;

                const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
                const deltaX = clientX - dragStartX;
                
                // Track if we've moved significantly
                if (Math.abs(deltaX) > 5) {
                    hasDraggedDistance = true;
                }
                
                let newPosition = thumbStartX + deltaX;

                // Constrain within bounds
                newPosition = Math.max(window.leftPosition, Math.min(newPosition, window.rightPosition));
                currentThumb.style.left = newPosition + 'px';
                
                console.log('Dragging to position:', newPosition);
            }

            function endDrag(e) {
                if (!isToggleDragging) return;
                
                console.log('endDrag called, hasDraggedDistance:', hasDraggedDistance);
                isToggleDragging = false;
                
                const currentThumb = activeToggle.thumb;
                if (!currentThumb) return;
                
                currentThumb.style.cursor = 'pointer';
                
                // If we haven't dragged significantly, treat as click
                if (!hasDraggedDistance) {
                    console.log('No drag distance, treating as click');
                    // Let the click handler deal with this
                    return;
                }
                
                const currentPosition = currentThumb.offsetLeft;
                currentThumb.style.transition = 'all 0.3s ease';
                
                // Update positions in case of resize
                updateTogglePositions();

                // Snap to nearest stop and navigate
                const stops = window.toggleStops || [];
                if (stops.length) {
                    let nearestIdx = 0;
                    let nearestDist = Infinity;
                    stops.forEach((s, idx) => {
                        const d = Math.abs(s.x - currentPosition);
                        if (d < nearestDist) { nearestDist = d; nearestIdx = idx; }
                    });
                    window.currentStopIndex = nearestIdx;
                    const target = stops[nearestIdx];
                    currentThumb.style.left = target.x + 'px';
                    smoothScrollToSection(`#${target.id}`);
                }
                
                // Reset drag flag after the interaction is complete to allow future track clicks
                setTimeout(() => {
                    hasDraggedDistance = false;
                    console.log('Reset hasDraggedDistance flag - track clicks now enabled');
                }, 100);
            }

            function sendMessage() {
                // Get drawing from the appropriate canvas (mobile or desktop)
                const isMobileView = window.innerWidth <= 768;
                const activeCanvas = isMobileView ? mobileCanvas : desktopCanvas;
                
                const formData = {
                    preferredName: document.getElementById('preferred-name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    drawing: activeCanvas ? activeCanvas.toDataURL() : null
                };

                console.log('Message sent:', formData);
                
                // Clear form and canvases
                if (contactForm) {
                    contactForm.reset();
                }
                if (mobileCanvas && mobileCtx) {
                    mobileCtx.clearRect(0, 0, mobileCanvas.width, mobileCanvas.height);
                }
                if (desktopCanvas && desktopCtx) {
                    desktopCtx.clearRect(0, 0, desktopCanvas.width, desktopCanvas.height);
                }
            }

            // Handle window resize
            window.addEventListener('resize', () => {
                // Re-initialize toggle for new screen size
                const wasActive = isToggleActive;
                initializeToggle();
                
                // Maintain current state position
                if (sendToggleThumb) {
                    hasDraggedDistance = false; // Reset drag flag
                    const idx = typeof window.currentStopIndex === 'number' ? window.currentStopIndex : 0;
                    const target = (window.toggleStops && window.toggleStops[idx]) || (window.toggleStops && window.toggleStops[0]);
                    if (target) {
                        sendToggleThumb.style.left = target.x + 'px';
                    }
                }
            });



        // Phone number formatting (flexible for international numbers)
        const phoneInput = document.getElementById('phone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function(e) {
                // Allow more flexible formatting for international numbers
                // Just ensure basic cleanup but don't force specific format
                let value = e.target.value;
                // Remove any characters that aren't numbers, spaces, parentheses, hyphens, or plus
                value = value.replace(/[^\d\s\(\)\-\+]/g, '');
                e.target.value = value;
            });
        }
    </script>
    <script src="gallery-archive.js"></script>
    <script>
        (function ensureArchiveComponent(){
            const onReady = () => {
                try {
                    const mount = document.getElementById('archive-search-mount');
                    if (!mount) return;
                    const already = document.querySelector('gallery-archive');
                    if (!already) {
                        const el = document.createElement('gallery-archive');
                        el.style.display = 'block';
                        el.style.marginTop = '16px';
                        mount.insertAdjacentElement('afterend', el);
                    }
                } catch (e) {
                    console.error('gallery-archive mount failed', e);
                }
            };
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', onReady, { once: true });
            } else {
                onReady();
            }
        })();

        // Archive V2: ensure gallery component is mounted inside the v2 container
        (function ensureArchiveV2Component(){
            const onReady = () => {
                try {
                    const container = document.getElementById('archive-v2-container');
                    if (!container) return;
                    const alreadyInside = container.querySelector('gallery-archive');
                    if (!alreadyInside) {
                        const el = document.createElement('gallery-archive');
                        el.style.display = 'block';
                        el.style.width = '100%';
                        el.style.marginTop = '16px';
                        container.appendChild(el);
                    }
                } catch (e) {
                    console.error('archive-v2 gallery mount failed', e);
                }
            };
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', onReady, { once: true });
            } else {
                onReady();
            }
        })();
    </script>
</body>
</html>